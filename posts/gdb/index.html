<!doctype html><html lang=en><head><title>gdb è¦ç‚¹ç®€è®° ::
Asky â€” My note blog
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="é…ç½® # set print pretty on set print elements unlimited set pagination off python è„šæœ¬ # ç›´æ¥å®‰è£…çš„ gdb éƒ½æ˜¯é¢„å…ˆç¼–è¯‘ python çš„ï¼Œå¯ä»¥ä½¿ç”¨ python å®ç°ä¸€äº›æœ‰ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è‡ªå®šä¹‰å‘½ä»¤ï¼Œæ‰“å°è‡ªå®šä¹‰ç±»å‹ç­‰ã€‚å¯ä»¥å‚è€ƒ gdb python æ‰©å±•
gdb python äº¤äº’ # (gdb) python &amp;gt;print(1+1) &amp;gt;end 2 (gdb) python &amp;gt;v = 3 &amp;gt;end (gdb) python print(v) 3 (gdb) python è§£é‡Šå™¨ä¸­çš„å€¼ä¸æ˜¯ä¸´æ—¶å˜é‡ï¼Œå¯ä»¥å®šä¹‰ä¹‹ååç»­ä½¿ç”¨ é‡ç‚¹ API # gdb.Value ï¼Œç›´æ¥åœ¨ gdb ä¸­è®¿é—®çš„å€¼ï¼Œåœ¨ python ä¸­ï¼Œè¢«åŒ…è£…ä¸º gdb.Value å¯¹è±¡ï¼ŒåŒ…å«å¯¹è±¡çš„å…·ä½“å€¼ï¼Œç±»å‹ç­‰ä¿¡æ¯ã€‚
# struct box # { # int a; # int b; # }; # using box_ptr = box *; # using box_ref = box &amp;amp;; # box *b1 = new box{1, 2}; # box b2 = box{3, 4}; # box_ptr b3 = b1; # box_ref b4 = b2; b1 = gdb."><meta name=keywords content="ç¨‹åºå‘˜ã€ç å†œã€databaseã€C++"><meta name=robots content="noodp"><link rel=canonical href=https://askyx.github.io/posts/gdb/><link rel=stylesheet href=//cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.6.0/lxgwwenkaiscreen.css media=print onload='this.media="all"'><link rel=stylesheet href=https://askyx.github.io/assets/style.css><link rel=stylesheet href=https://askyx.github.io/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://askyx.github.io/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://askyx.github.io/favicon.ico><link rel=apple-touch-icon href=https://askyx.github.io/favicon.ico><link rel=bookmark href=https://askyx.github.io/favicon.ico><link rel=apple-touch-icon-precomposed sizes=180x180 href=https://askyx.github.io/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:title content="gdb è¦ç‚¹ç®€è®°"><meta name=twitter:description content="gdb ä¸­çš„ä¸€äº›å¸¸ç”¨æ–¹æ³•ï¼Œä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ï¼Œè®°å¿† gdb çš„ python æ‰©å±•çš„ä½¿ç”¨æ–¹æ³•"><meta property="og:title" content="gdb è¦ç‚¹ç®€è®°"><meta property="og:description" content="gdb ä¸­çš„ä¸€äº›å¸¸ç”¨æ–¹æ³•ï¼Œä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ï¼Œè®°å¿† gdb çš„ python æ‰©å±•çš„ä½¿ç”¨æ–¹æ³•"><meta property="og:type" content="article"><meta property="og:url" content="https://askyx.github.io/posts/gdb/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-11T10:17:52+08:00"><meta property="article:modified_time" content="2023-07-11T10:17:52+08:00"></head><body class=light-theme><div class=container><header class=header><span class=header__inner><a href=https://askyx.github.io/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>Asky</span>
<span class=logo__cursor></span>
</a><span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=/archive>Archive</a></li><li><a href=/search>ğŸ”</a></li><li><a href=javascript:; onclick=randomPost() title=éšæœºè®¿é—®ä¸€ç¯‡æ–‡ç« ><svg t="1660103436159" class="icon search-box-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="1184" width="32" height="32"><path d="M421.376 481.28s117.248 24.576 175.104-8.704c0 0-89.6 70.144-89.6 166.4.512-.512-8.192-121.344-85.504-157.696zm17.408 487.936s68.608 6.656 68.608-80.896c0 0 3.072 88.576 65.024 78.336.0.512-50.688 22.016-133.632 2.56zM161.28 238.08s-30.208 65.536 11.264 91.648c0 0-67.072-17.408-81.408 37.376.0.0 8.704-82.944 70.144-129.024zM857.6 227.328s49.152 50.176 1.024 81.408c0 0 58.88-18.432 66.56 36.352.0.0 5.12-69.632-67.584-117.76z" p-id="1185"/><path d="M443.392 970.752c-5.632.0-10.752-1.024-15.36-3.072L157.184 810.496l-1.536-1.024s-1.024-1.024-4.608-2.56c-51.2-29.184-62.976-94.208-65.536-120.832V386.56c0-3.072.512-7.168 1.024-11.264l.512-3.584 1.024-2.56c19.456-50.688 76.8-51.2 103.936-44.032l-1.536 5.632 4.096-6.144L476.16 486.4l18.944 37.888c20.992 36.864 29.184 77.824 32.768 99.84v258.048c-4.608 56.32-36.864 76.288-55.808 82.944-1.024.512-15.36 5.632-28.672 5.632zM181.248 774.656l263.168 152.576c12.288-.512 36.864-6.656 40.448-48.128V628.736c-4.608-31.744-20.992-103.936-72.192-128L322.56 445.44l1.536 3.072L181.76 366.08c-2.048-.512-40.448-9.216-52.736 15.872-.512 2.56-.512 4.608-.512 6.144v294.4c1.536 16.896 9.728 67.072 43.52 86.528 3.584 2.048 6.656 4.096 9.216 5.632z" p-id="1186"/><path d="M837.632 212.992c6.656 4.096 12.8 7.168 18.432 10.752l1.536 1.024 1.536 1.536c5.12 4.096 10.752 9.216 16.384 15.36 6.144 11.776 5.632 33.28 4.608 49.152-1.024 12.288-6.656 30.208-26.624 44.544l-1.024.512-247.808 156.672c-26.624 14.336-62.976 18.432-96.256 18.432-40.96.0-77.824-6.656-89.088-8.704l-3.072-.512-245.248-142.336c-39.424-29.696-28.16-85.504-15.36-113.664l2.56-6.144 263.68-166.912c29.184-14.336 104.448-43.008 173.056-1.024 3.584 2.56 58.368 34.304 119.296 69.632M431.616 460.8c40.448 7.168 114.176 13.824 152.576-6.144L828.928 299.52c7.168-5.632 8.192-10.24 8.704-12.8 1.024-11.264-9.728-26.624-15.36-32.768-55.808-32.256-243.712-141.312-250.368-145.408-49.664-30.72-107.008-9.216-130.048 2.56L192.512 268.8c-4.096 12.288-12.288 42.496 3.584 55.808L431.616 460.8z" p-id="1187"/><path d="M831.488 299.008c4.096-1.024 38.4-11.264 66.048 6.144 7.168 4.608 17.92 11.776 24.064 24.576 1.024 5.632 4.096 10.752 4.608 16.896v2.048l-1.024 323.072c-5.12 35.328-22.528 91.648-77.312 125.44l-5.12 3.584h-1.024L579.584 966.656l-4.608.512c-4.096.512-8.704 1.024-12.8 1.024-15.872.0-30.208-5.12-41.984-14.848-24.576-20.48-32.768-55.808-35.328-73.728l-1.024-252.928h1.536c6.144-96.768 88.576-164.864 96.768-171.008l-.512-.512L829.44 299.52M528.384 867.328c.512 10.24 5.12 41.472 19.968 53.76 3.072 2.56 7.68 5.632 16.384 5.12L829.44 758.272c56.32-38.4 53.76-115.712 53.76-116.224l-.512-32.256 1.024-250.368h-.512c-1.536-12.8-7.168-16.384-8.704-17.408-8.704-5.632-23.552-3.072-28.672-2.048L610.304 488.96c-1.024.512-80.896 65.024-80.896 149.504h-1.536l.512 228.864zM435.2 264.192c0 27.648 31.744 50.176 71.168 50.176s71.168-22.528 71.168-50.176-31.744-50.176-71.168-50.176S435.2 236.544 435.2 264.192z" p-id="1188"/><path d="M663.552 782.848c0 30.72-22.528 67.072-49.664 80.384-27.648 13.824-50.176-.512-50.176-31.232s22.528-67.072 50.176-80.384c27.136-13.824 49.664.0 49.664 31.232zM760.32 602.624c0 30.72-22.528 67.072-49.664 80.384-27.648 13.824-49.664-.512-49.664-31.232s22.528-67.072 49.664-80.384c27.136-13.824 49.664.512 49.664 31.232zM867.84 428.032c0 30.72-22.528 67.072-49.664 80.384C790.528 522.24 768 507.904 768 477.184s22.528-67.072 50.176-80.384c27.136-13.824 49.664.0 49.664 31.232zM270.848 538.112c0 30.72-22.016 41.984-48.64 24.576-27.136-16.896-48.64-55.808-48.64-86.528s22.016-41.984 48.64-24.576c26.624 16.896 48.64 55.808 48.64 86.528zm161.28 285.184c0 30.72-22.016 41.984-48.64 24.576-26.624-17.408-48.64-55.808-48.64-86.528s22.016-41.984 48.64-24.576c26.624 16.896 48.64 55.808 48.64 86.528z" p-id="1189"/></svg></a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=/archive>Archive</a></li><li><a href=/search>ğŸ”</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><div class=breadcrumb><li><a href=https://askyx.github.io/>é¦–é¡µ</a></li><li><a href=https://askyx.github.io/posts/>Posts</a></li><li class=active><a href=https://askyx.github.io/posts/gdb/>gdb è¦ç‚¹ç®€è®°</a></li></div><h2 class=post-title><a href=https://askyx.github.io/posts/gdb/>gdb è¦ç‚¹ç®€è®°</a></h2><div class=post-meta><span class=post-date>2023-07-11</span></div><div class=post-content><aside class=table-of-contents><nav id=TableOfContents><ul><li><a href=#é…ç½®>é…ç½®</a></li><li><a href=#python-è„šæœ¬>python è„šæœ¬</a><ul><li><a href=#gdb-python-äº¤äº’>gdb python äº¤äº’</a></li><li><a href=#é‡ç‚¹-api>é‡ç‚¹ API</a></li><li><a href=#è‡ªå®šä¹‰å‘½ä»¤>è‡ªå®šä¹‰å‘½ä»¤</a></li><li><a href=#pretty-printer>pretty printer</a></li><li><a href=#auto-load>auto load</a></li></ul></li><li><a href=#checkpoint>checkpoint</a></li><li><a href=#i-am-stupid>i am stupid</a></li></ul></nav></aside><h2 id=é…ç½®>é…ç½®
<a href=#%e9%85%8d%e7%bd%ae class=h-anchor aria-hidden=true>#</a></h2><pre><code>set print pretty on
set print elements unlimited
set pagination off
</code></pre><h2 id=python-è„šæœ¬>python è„šæœ¬
<a href=#python-%e8%84%9a%e6%9c%ac class=h-anchor aria-hidden=true>#</a></h2><p>ç›´æ¥å®‰è£…çš„ gdb éƒ½æ˜¯é¢„å…ˆç¼–è¯‘ python çš„ï¼Œå¯ä»¥ä½¿ç”¨ python å®ç°ä¸€äº›æœ‰ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è‡ªå®šä¹‰å‘½ä»¤ï¼Œæ‰“å°è‡ªå®šä¹‰ç±»å‹ç­‰ã€‚å¯ä»¥å‚è€ƒ <a href=https://sourceware.org/gdb/onlinedocs/gdb/Python-API.html#Python-API>gdb python æ‰©å±•</a></p><h3 id=gdb-python-äº¤äº’>gdb python äº¤äº’
<a href=#gdb-python-%e4%ba%a4%e4%ba%92 class=h-anchor aria-hidden=true>#</a></h3><pre tabindex=0><code>(gdb) python
&gt;print(1+1)
&gt;end
2
(gdb) python
&gt;v = 3
&gt;end
(gdb) python print(v)
3
(gdb)
</code></pre><ul><li>python è§£é‡Šå™¨ä¸­çš„å€¼ä¸æ˜¯ä¸´æ—¶å˜é‡ï¼Œå¯ä»¥å®šä¹‰ä¹‹ååç»­ä½¿ç”¨</li></ul><h3 id=é‡ç‚¹-api>é‡ç‚¹ API
<a href=#%e9%87%8d%e7%82%b9-api class=h-anchor aria-hidden=true>#</a></h3><ol><li><p><code>gdb.Value</code> ï¼Œç›´æ¥åœ¨ gdb ä¸­è®¿é—®çš„å€¼ï¼Œåœ¨ python ä¸­ï¼Œè¢«åŒ…è£…ä¸º <code>gdb.Value</code> å¯¹è±¡ï¼ŒåŒ…å«å¯¹è±¡çš„å…·ä½“å€¼ï¼Œç±»å‹ç­‰ä¿¡æ¯ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># struct box</span>
</span></span><span style=display:flex><span><span style=color:#75715e># {</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#     int a;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#     int b;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># };</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># using box_ptr = box *;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># using box_ref = box &amp;;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># box *b1 = new box{1, 2};</span>
</span></span><span style=display:flex><span><span style=color:#75715e># box b2 = box{3, 4};</span>
</span></span><span style=display:flex><span><span style=color:#75715e># box_ptr b3 = b1;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># box_ref b4 = b2;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>b1 <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>parse_and_eval(<span style=color:#e6db74>&#39;b1&#39;</span>)
</span></span><span style=display:flex><span>b2 <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>parse_and_eval(<span style=color:#e6db74>&#39;b2&#39;</span>)
</span></span><span style=display:flex><span>b3 <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>parse_and_eval(<span style=color:#e6db74>&#39;b3&#39;</span>)
</span></span><span style=display:flex><span>b4 <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>parse_and_eval(<span style=color:#e6db74>&#39;b4&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;address b1 </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, b2 </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, b3 </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, b4 </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(b1<span style=color:#f92672>.</span>address, b2<span style=color:#f92672>.</span>address, b3<span style=color:#f92672>.</span>address, b4<span style=color:#f92672>.</span>address))
</span></span><span style=display:flex><span>address b1 <span style=color:#ae81ff>0x7fffffffda58</span>, b2 <span style=color:#ae81ff>0x7fffffffda88</span>, b3 <span style=color:#ae81ff>0x7fffffffda60</span>, b4 <span style=color:#ae81ff>0x7fffffffda88</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;type b1 </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, b2 </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, b3 </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, b4 </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(b1<span style=color:#f92672>.</span>type, b2<span style=color:#f92672>.</span>type, b3<span style=color:#f92672>.</span>type, b4<span style=color:#f92672>.</span>type))
</span></span><span style=display:flex><span>type b1 box <span style=color:#f92672>*</span>, b2 box, b3 box_ptr, b4 box_ref
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(gdb) python print(b1<span style=color:#f92672>.</span>dereference())  
</span></span><span style=display:flex><span>{a <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>, b <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>}
</span></span><span style=display:flex><span>(gdb) python print(b2<span style=color:#f92672>.</span>dereference())  
</span></span><span style=display:flex><span>Traceback (most recent call last):
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;&lt;string&gt;&#34;</span>, line <span style=color:#ae81ff>1</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>gdb<span style=color:#f92672>.</span>error: Attempt to take contents of a non<span style=color:#f92672>-</span>pointer value<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>Error <span style=color:#66d9ef>while</span> executing Python code<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>(gdb) python print(b3<span style=color:#f92672>.</span>dereference())  
</span></span><span style=display:flex><span>{a <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>, b <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>}
</span></span><span style=display:flex><span>(gdb) python print(b4<span style=color:#f92672>.</span>dereference())  
</span></span><span style=display:flex><span>Traceback (most recent call last):
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;&lt;string&gt;&#34;</span>, line <span style=color:#ae81ff>1</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>gdb<span style=color:#f92672>.</span>error: Attempt to take contents of a non<span style=color:#f92672>-</span>pointer value<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>Error <span style=color:#66d9ef>while</span> executing Python code<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(gdb) python print(b1<span style=color:#f92672>.</span>referenced_value())
</span></span><span style=display:flex><span>{a <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>, b <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>}
</span></span><span style=display:flex><span>(gdb) python print(b2<span style=color:#f92672>.</span>referenced_value())
</span></span><span style=display:flex><span>Traceback (most recent call last):
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;&lt;string&gt;&#34;</span>, line <span style=color:#ae81ff>1</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>gdb<span style=color:#f92672>.</span>error: Trying to get the referenced value <span style=color:#f92672>from</span> a value which <span style=color:#f92672>is</span> neither a pointer nor a reference<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>Error <span style=color:#66d9ef>while</span> executing Python code<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>(gdb) python print(b3<span style=color:#f92672>.</span>referenced_value())
</span></span><span style=display:flex><span>{a <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>, b <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>}
</span></span><span style=display:flex><span>(gdb) python print(b4<span style=color:#f92672>.</span>referenced_value())
</span></span><span style=display:flex><span>{a <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>, b <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(gdb) python print(b1<span style=color:#f92672>.</span>reference_value())
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#ae81ff>0x7fffffffda58</span>
</span></span><span style=display:flex><span>(gdb) python print(b2<span style=color:#f92672>.</span>reference_value())
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#ae81ff>0x7fffffffda88</span>
</span></span><span style=display:flex><span>(gdb) python print(b3<span style=color:#f92672>.</span>reference_value())
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#ae81ff>0x7fffffffda60</span>
</span></span><span style=display:flex><span>(gdb) python print(b4<span style=color:#f92672>.</span>reference_value())
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#ae81ff>0x7fffffffda88</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(gdb) python print(b1<span style=color:#f92672>.</span>const_value())
</span></span><span style=display:flex><span><span style=color:#ae81ff>0x55555556d750</span>
</span></span><span style=display:flex><span>(gdb) python print(b2<span style=color:#f92672>.</span>const_value())
</span></span><span style=display:flex><span>{a <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>, b <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>}
</span></span><span style=display:flex><span>(gdb) python print(b3<span style=color:#f92672>.</span>const_value())
</span></span><span style=display:flex><span><span style=color:#ae81ff>0x55555556d750</span>
</span></span><span style=display:flex><span>(gdb) python print(b4<span style=color:#f92672>.</span>const_value())
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#ae81ff>0x7fffffffda88</span>
</span></span></code></pre></div></li><li><p><code>gdb.Type</code> ï¼Œç±»å‹ï¼ŒåŒ…å«ç±»å‹ä¿¡æ¯ï¼Œæ¯”å¦‚æŒ‡é’ˆï¼Œæ•°ç»„ï¼Œç»“æ„ä½“ç­‰ã€‚å¯ä»¥ä½¿ç”¨ lookup_type è½¬æ¢ç±»å‹ä¸º å†…ç½® gdb.Type å¯¹è±¡ã€‚ç„¶åä½¿ç”¨ gdb.Value.cast æ–¹æ³•è½¬æ¢ä¸ºæŒ‡å®šç±»å‹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>(gdb) p <span style=color:#f92672>*</span> best_path
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>3</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  type <span style=color:#f92672>=</span> T_ProjectionPath,
</span></span><span style=display:flex><span>  pathtype <span style=color:#f92672>=</span> T_Result,
</span></span><span style=display:flex><span>  parent <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x563e104048b0</span>,
</span></span><span style=display:flex><span>  pathtarget <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x563e10404780</span>,
</span></span><span style=display:flex><span>  param_info <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x0</span>,
</span></span><span style=display:flex><span>  parallel_aware <span style=color:#f92672>=</span> false,
</span></span><span style=display:flex><span>  parallel_safe <span style=color:#f92672>=</span> false,
</span></span><span style=display:flex><span>  parallel_workers <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>  rows <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>  startup_cost <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.047500000000000014</span>,
</span></span><span style=display:flex><span>  total_cost <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.052500000000000012</span>,
</span></span><span style=display:flex><span>  pathkeys <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x563e103fb180</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>(gdb) python path <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>parse_and_eval(<span style=color:#e6db74>&#39;best_path&#39;</span>)
</span></span><span style=display:flex><span>(gdb) python print(path<span style=color:#f92672>.</span>type)
</span></span><span style=display:flex><span>Path <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>(gdb) python print(gdb<span style=color:#f92672>.</span>lookup_type(<span style=color:#e6db74>&#39;ProjectionPath&#39;</span>)<span style=color:#f92672>.</span>pointer())
</span></span><span style=display:flex><span>ProjectionPath <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>(gdb) python print(gdb<span style=color:#f92672>.</span>lookup_type(<span style=color:#e6db74>&#39;ProjectionPath&#39;</span>)<span style=color:#f92672>.</span>reference())
</span></span><span style=display:flex><span>ProjectionPath <span style=color:#f92672>&amp;</span>
</span></span><span style=display:flex><span>(gdb) python print(path<span style=color:#f92672>.</span>cast(gdb<span style=color:#f92672>.</span>lookup_type(<span style=color:#e6db74>&#39;ProjectionPath&#39;</span>)<span style=color:#f92672>.</span>pointer())<span style=color:#f92672>.</span>type)
</span></span><span style=display:flex><span>ProjectionPath <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>(gdb) python print(path<span style=color:#f92672>.</span>cast(gdb<span style=color:#f92672>.</span>lookup_type(<span style=color:#e6db74>&#39;ProjectionPath&#39;</span>)<span style=color:#f92672>.</span>pointer())<span style=color:#f92672>.</span>referenced_value())
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  path <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    type <span style=color:#f92672>=</span> T_ProjectionPath,
</span></span><span style=display:flex><span>    pathtype <span style=color:#f92672>=</span> T_Result,
</span></span><span style=display:flex><span>    parent <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x563e104048b0</span>,
</span></span><span style=display:flex><span>    pathtarget <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x563e10404780</span>,
</span></span><span style=display:flex><span>    param_info <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x0</span>,
</span></span><span style=display:flex><span>    parallel_aware <span style=color:#f92672>=</span> false,
</span></span><span style=display:flex><span>    parallel_safe <span style=color:#f92672>=</span> false,
</span></span><span style=display:flex><span>    parallel_workers <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>    rows <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    startup_cost <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.047500000000000014</span>,
</span></span><span style=display:flex><span>    total_cost <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.052500000000000012</span>,
</span></span><span style=display:flex><span>    pathkeys <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x563e103fb180</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  subpath <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x563e10404668</span>,
</span></span><span style=display:flex><span>  dummypp <span style=color:#f92672>=</span> true
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><p><code>gdb.parse_and_eval</code> æ–¹æ³•ï¼Œå¯ä»¥è§£æè¡¨è¾¾å¼ï¼Œè·å–è¡¨è¾¾å¼çš„å€¼ã€‚ä¾‹å¦‚å…·ä½“çš„æŸä¸ªå˜é‡ï¼Œæˆ–è€…å‡½æ•°ç­‰ã€‚</p></li></ol><h3 id=è‡ªå®šä¹‰å‘½ä»¤>è‡ªå®šä¹‰å‘½ä»¤
<a href=#%e8%87%aa%e5%ae%9a%e4%b9%89%e5%91%bd%e4%bb%a4 class=h-anchor aria-hidden=true>#</a></h3><p>ç»§æ‰¿ gdb.Command ç±»ï¼Œå®ç° invoke æ–¹æ³•ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå° demo</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>(gdb) python
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HelloWorld</span> (gdb<span style=color:#f92672>.</span>Command):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> __init__ (self):
</span></span><span style=display:flex><span>    super (HelloWorld, self)<span style=color:#f92672>.</span>__init__ (<span style=color:#e6db74>&#34;pp&#34;</span>, gdb<span style=color:#f92672>.</span>COMMAND_USER)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>invoke</span> (self, args, from_tty):
</span></span><span style=display:flex><span>    argv <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>string_to_argv (args)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len (argv) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>raise</span> gdb<span style=color:#f92672>.</span>GdbError (<span style=color:#e6db74>&#34;pp takes no arguments&#34;</span>)
</span></span><span style=display:flex><span>    print (argv)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>HelloWorld ()
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>end
</span></span><span style=display:flex><span>(gdb) pp
</span></span><span style=display:flex><span>pp takes no arguments
</span></span><span style=display:flex><span>(gdb) pp <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>[<span style=color:#e6db74>&#39;3&#39;</span>]
</span></span><span style=display:flex><span>(gdb)
</span></span></code></pre></div><h3 id=pretty-printer>pretty printer
<a href=#pretty-printer class=h-anchor aria-hidden=true>#</a></h3><p>å¯¹äºå¤æ‚çš„å¤§å‹ç¨‹åºï¼Œ ç‰¹åˆ«æ˜¯ C ç¨‹åºï¼Œç”±äºä¸ç›´æ¥æ”¯æŒå¤šæ€ï¼Œæ‰€ä»¥ä¼šä½¿ç”¨ä¸€äº›å–å·§çš„æ–¹å¼ï¼Œä¾‹å¦‚ Postgres ä¸­ï¼Œå¤§éƒ¨åˆ†ç»“æ„ä½“éƒ½ç›´æ¥æˆ–è€…é—´æ¥çš„ç»§æ‰¿è‡ª Node ï¼Œå¤§éƒ¨åˆ†æŒ‡é’ˆ
ç›´æ¥å°±æ˜¯ä¸€ä¸ª <code>Node*</code>, ä¸ä¸€å±‚ä¸€å±‚å±•å¼€ï¼Œæ˜¯ä¸çŸ¥é“ <code>Node*</code> çš„æŒ‡é’ˆçš„ 8 å­—èŠ‚ä¸‹åˆ°åº•éšè—ç€ä»€ä¹ˆæ·±æ¸Šå·¨å…½ã€‚æœ‰æ—¶å€™å¯èƒ½ä¸ºäº†æŸ¥çœ‹æŸä¸ªæ‰§è¡Œè®¡åˆ’ä¸­çš„æŸä¸ªå­—æ®µå…·ä½“æ˜¯ä»€ä¹ˆï¼Œå¯èƒ½éœ€è¦åå¤çš„
è¿›è¡Œå¼ºè½¬æ‰“å°</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> p * <span style=color:#f92672>((</span>JoinPath*<span style=color:#f92672>)((</span>JoinPath*<span style=color:#f92672>)((</span>SortPath*<span style=color:#f92672>)(((</span>ProjectionPath*<span style=color:#f92672>)</span>best_path<span style=color:#f92672>)</span>-&gt;subpath<span style=color:#f92672>))</span>-&gt;subpath<span style=color:#f92672>)</span>-&gt;outerjoinpath<span style=color:#f92672>)</span>-&gt;outerjoinpath
</span></span><span style=display:flex><span>$25 <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  type <span style=color:#f92672>=</span> T_Path,
</span></span><span style=display:flex><span>  pathtype <span style=color:#f92672>=</span> T_SeqScan,
</span></span><span style=display:flex><span>  parent <span style=color:#f92672>=</span> 0x563e103ded10,
</span></span><span style=display:flex><span>  pathtarget <span style=color:#f92672>=</span> 0x563e103def18,
</span></span><span style=display:flex><span>  param_info <span style=color:#f92672>=</span> 0x0,
</span></span><span style=display:flex><span>  parallel_aware <span style=color:#f92672>=</span> false,
</span></span><span style=display:flex><span>  parallel_safe <span style=color:#f92672>=</span> true,
</span></span><span style=display:flex><span>  parallel_workers <span style=color:#f92672>=</span> 0,
</span></span><span style=display:flex><span>  rows <span style=color:#f92672>=</span> 1,
</span></span><span style=display:flex><span>  startup_cost <span style=color:#f92672>=</span> 0,
</span></span><span style=display:flex><span>  total_cost <span style=color:#f92672>=</span> 0,
</span></span><span style=display:flex><span>  pathkeys <span style=color:#f92672>=</span> 0x0
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>å½“ç„¶å¯ä»¥ä½¿ç”¨ pprint ï¼Œä½†æ˜¯ pprint åªèƒ½æ‰“å°ç»§æ‰¿è‡ª Node çš„å¯¹è±¡ï¼Œå¯¹äºå…¶ä»–ç±»å‹ï¼Œpprint åˆ™æ— èƒ½ä¸ºåŠ›ï¼Œè€Œä¸” pprint æœ€å¤§çš„ç¼ºç‚¹æ˜¯æ— æ³•åœ¨ core æ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œæ­¤æ—¶ä¼šæç¤º <code>You can't do that without a process to debug.</code></p><p>æ­¤å¤–éƒ¨åˆ†äººåº”è¯¥ä½¿ç”¨è¿‡ <a href=https://github.com/tvondra/gdbpg.git>https://github.com/tvondra/gdbpg.git</a> è¿™ä¸ªç¨‹åºï¼Œå¯èƒ½ä¹Ÿé’ˆå¯¹ç‰¹å®šçš„ postgres ç‰ˆæœ¬åšäº†ä¸€äº›å®šåˆ¶ã€‚
æˆ‘å½“å‰æ‰€åœ¨å…¬å¸æ˜¯æŸä¸ª pg çš„è¡ç”Ÿæ•°æ®åº“ï¼Œ æˆ‘ä¹Ÿæƒ³ä½¿ç”¨è¿™ä¸ªè„šæœ¬åšä¸‹æ‰©å±•ï¼Œæ–¹ä¾¿è‡ªå·±ä½¿ç”¨ï¼Œä½†æ˜¯æŸå¤©çªç„¶æƒ³è°ƒè¯•ä¸‹å…¶ä»– pg ç±»æ•°æ®åº“ï¼Œä¾‹å¦‚ gpï¼Œ tbase å•¥çš„ï¼Œæ­¤æ—¶ä¹Ÿéœ€è¦å†å–è¿›è¡Œæ‰©å±•ï¼Œä½†æ˜¯ç”±äºä¸æ˜¯å¤ªç†Ÿæ‚‰ï¼Œä¸€æ—¶ä¹‹é—´ä¸çŸ¥é“ä»€ä¹ˆè¯¥æ‰“å°ï¼Œä»€ä¹ˆä¸è¯¥æ‰“å°ï¼Œä¸­é—´å®¹æ˜“é‡åˆ°é—®é¢˜ï¼Œå¼„æ¥å¼„å»å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥å°±æ”¾å¼ƒäº†ã€‚</p><p>å¥½åœ¨ gdb æä¾› pretty printer æœºåˆ¶ï¼Œå¯ä»¥è‡ªå®šä¹‰æ‰“å°æ–¹æ³•ï¼ŒC++ çš„ STL åº“å°±æä¾›äº†å¯¹åº”çš„ python è„šæœ¬ï¼Œå…·ä½“æ–‡ä»¶åœ¨ <code>/usr/share/gcc/python/libstdcxx/v6</code> ç›®å½•ä¸‹ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹æ€ä¹ˆæ˜¯å®ç°çš„ã€‚</p><p>ä¸‹é¢æ˜¯åœ¨å®ç° <a href=https://github.com/askyx/pretty_printer.git>postgres pretty printer</a> çš„åŠŸèƒ½ä¸­çš„ä¸€äº›é—®é¢˜å’Œæ€è€ƒã€‚</p><p>é¦–å…ˆæ˜¯å®˜æ–¹çš„ä¸€ä¸ªå° demo ï¼Œ åšäº†ç‚¹å°ä¿®æ”¹ï¼Œæ–¹ä¾¿ç†è§£ä¸‹é¢çš„è®²è§£</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>struct foo { int a, b; };
</span></span></span><span style=display:flex><span><span style=color:#e6db74>struct bar { struct foo x, y; };
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> gdb
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>fooPrinter</span>:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Print a foo object.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, val):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>__val <span style=color:#f92672>=</span> val
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_string</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (<span style=color:#e6db74>&#34;a=&lt;&#34;</span> <span style=color:#f92672>+</span> str(self<span style=color:#f92672>.</span>__val[<span style=color:#e6db74>&#34;a&#34;</span>]) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;&gt; b=&lt;&#34;</span> <span style=color:#f92672>+</span> str(self<span style=color:#f92672>.</span>__val[<span style=color:#e6db74>&#34;b&#34;</span>]) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&gt;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>barPrinter</span>:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Print a bar object.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, val):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>__val <span style=color:#f92672>=</span> val
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_string</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (<span style=color:#e6db74>&#34;x=&lt;&#34;</span> <span style=color:#f92672>+</span> str(self<span style=color:#f92672>.</span>__val[<span style=color:#e6db74>&#34;x&#34;</span>]) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;&gt; y=&lt;&#34;</span> <span style=color:#f92672>+</span> str(self<span style=color:#f92672>.</span>__val[<span style=color:#e6db74>&#34;y&#34;</span>]) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&gt;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>build_pretty_printer</span>():
</span></span><span style=display:flex><span>    pp <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>printing<span style=color:#f92672>.</span>RegexpCollectionPrettyPrinter(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;my_library&#34;</span>)
</span></span><span style=display:flex><span>    pp<span style=color:#f92672>.</span>add_printer(<span style=color:#e6db74>&#39;foo&#39;</span>, <span style=color:#e6db74>&#39;^foo$&#39;</span>, fooPrinter)
</span></span><span style=display:flex><span>    pp<span style=color:#f92672>.</span>add_printer(<span style=color:#e6db74>&#39;bar&#39;</span>, <span style=color:#e6db74>&#39;^bar$&#39;</span>, barPrinter)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> pp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gdb<span style=color:#f92672>.</span>printing<span style=color:#f92672>.</span>register_pretty_printer(
</span></span><span style=display:flex><span>    gdb<span style=color:#f92672>.</span>current_objfile(),
</span></span><span style=display:flex><span>    build_pretty_printer())
</span></span></code></pre></div><h4 id=1-gdb-pretty-printer-å®ç°åŸç†>1. gdb pretty printer å®ç°åŸç†
<a href=#1-gdb-pretty-printer-%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86 class=h-anchor aria-hidden=true>#</a></h4><p>å…·ä½“å‚è€ƒ gdb æºç ä¸­çš„ <code>py-prettyprint.c</code> å’Œ <code>printing.py</code> æ–‡ä»¶ï¼Œå¤§æ„æ˜¯ï¼š</p><ol><li><p>å‘ <code>gdb.pretty_printers</code> ä¸­æ³¨å†Œä¸€ä¸ª printerï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè¿™æ­¥ç”± <code>register_pretty_printer</code> å®ç°ï¼Œ <code>register_pretty_printer</code> ä¼šæŠŠ <code>RegexpCollectionPrettyPrinter</code> å¯¹è±¡æ·»åŠ åˆ° <code>gdb.pretty_printers</code> ä¸­ï¼Œå¯ä»¥æŸ¥çœ‹ å¯¹åº”çš„ gdb ä¸­çš„æºç ï¼Œå…¶å®ç°æ ¸å¿ƒæ˜¯ <code>obj.pretty_printers.insert(0, printer)</code></p></li><li><p>æ³¨å†Œçš„è¿™ä¸ª printer å¿…é¡»å®ç° <code>__call__</code>ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ gdb å†…ç½®çš„ <code>RegexpCollectionPrettyPrinter</code> æˆ–è€… STL åº“ä¸­çš„ <code>Printer</code> ç­‰ã€‚å…¶å†…éƒ¨ä¸»è¦æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«å…·ä½“çš„å¯¹åº”æŸç±»å‹çš„ printerï¼Œ
gdb åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œåœ¨ <code>__call__</code>ä¸­ï¼Œè·å– Value çš„ typeï¼Œ ç„¶åç”±è¿™ä¸ª type æ‰¾åˆ°æ•°ç»„ä¸­å…·ä½“çš„ printer ç±»ï¼Œç„¶åæ„é€ ä¸€ä¸ªå¯¹è±¡è¿”å›</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __call__(self, val):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Lookup the pretty-printer for the provided value.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Get the type name.</span>
</span></span><span style=display:flex><span>        typename <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>types<span style=color:#f92672>.</span>get_basic_type(val<span style=color:#f92672>.</span>type)<span style=color:#f92672>.</span>tag
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> typename:
</span></span><span style=display:flex><span>            typename <span style=color:#f92672>=</span> val<span style=color:#f92672>.</span>type<span style=color:#f92672>.</span>name
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> typename:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Iterate over table of type regexps to determine</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># if a printer is registered for that type.</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Return an instantiation of the printer if found.</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> printer <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>subprinters:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> printer<span style=color:#f92672>.</span>enabled <span style=color:#f92672>and</span> printer<span style=color:#f92672>.</span>compiled_re<span style=color:#f92672>.</span>search(typename):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> printer<span style=color:#f92672>.</span>gen_printer(val)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Cannot find a pretty printer.  Return None.</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>
</span></span></code></pre></div></li><li><p>å¯¹äºå…·ä½“ç±»å‹çš„ printerï¼Œéœ€è¦å®ç° <code>to_string</code> æ–¹æ³•ï¼Œå¯é€‰çš„ä¸º <code>children</code> å’Œ <code>display_hint</code> æ–¹æ³•ç­‰ï¼Œå…·ä½“è¯´æ˜å‚è€ƒ<a href=https://sourceware.org/gdb/current/onlinedocs/gdb.html/Pretty-Printing-API.html#Pretty-Printing-API>å®˜æ–¹æ–‡æ¡£</a>ï¼Œè¿™æ˜¯æˆ‘ä»¬å®ç°è‡ªå®šä¹‰ pretty printer çš„å…³é”®æ­¥éª¤ã€‚åœ¨ gdb ä¸­ï¼Œè·å– printer å¯¹è±¡ä¹‹åï¼Œ å…¶å†…éƒ¨ä¼šä½¿ç”¨ C ä»£ç è°ƒç”¨å¯¹è±¡çš„å®ç°çš„å‡½æ•°ï¼Œå®ç°æ‰“å°åŠŸèƒ½ï¼Œå…·ä½“å‡½æ•°ä¸º <code>pretty_print_one_value</code></p></li></ol><h4 id=2-å®ç°è‡ªå®šä¹‰-pretty-printer>2. å®ç°è‡ªå®šä¹‰ pretty printer
<a href=#2-%e5%ae%9e%e7%8e%b0%e8%87%aa%e5%ae%9a%e4%b9%89-pretty-printer class=h-anchor aria-hidden=true>#</a></h4><p>æˆ‘ä»¬å¯ä»¥ä»¿ç…§ demo å®ç°è‡ªå®šä¹‰ printerï¼Œä½†æ˜¯åœ¨ pg REL_16_STABLE ä¸­ï¼Œ nodetags.h ä¸­å®šä¹‰äº† 454 ä¸ªç±»å‹ï¼Œå¦‚æœä¸€ä¸€å®ç°æ˜¯ä¸ç°å®çš„ï¼Œæ­¤å¤–è¿˜å¾—å…¼é¡¾ä¸åŒçš„ç‰ˆæœ¬ï¼Œä¸åŒçš„ pg ç±»æ•°æ®åº“ç­‰ã€‚æƒ³æƒ³åœ¨ gdb è°ƒè¯•ä¸­ï¼Œ çªç„¶å‘ç°æŸä¸ªç±»å‹æ— æ³•æ‰“å°ï¼Œç”šè‡³å‡ºé”™äº†å¯¼è‡´ gdb å´©æ‰çš„æƒ…å†µï¼Œå¥½å¥½çš„æ€è·¯å°±è¿™ä¹ˆå‘—æ‰“æ–­äº†ï¼ŒçœŸçš„æ— æ³•å¿å—ï¼Œä¸ºäº†å¯ä»¥å¿«é€Ÿå®ç° printer æ·»åŠ ä¿®æ”¹ï¼Œè¿™é‡Œå®ç°çš„å…¶å®ä¸æ˜¯ pretty printerï¼Œ è€Œåº”è¯¥æ˜¯ pretty printer generator</p><ol><li><p>å¿«é€Ÿæ·»åŠ ä¸€ä¸ª printer</p><p>å¦‚ demo ä¸­ï¼Œ å®ç°å…·ä½“çš„ printer ä¹‹åï¼Œ ä½¿ç”¨ add_printer æ·»åŠ åˆ° RegexpCollectionPrettyPrinter ä¸­ï¼Œ å¦‚æœæœ‰å‡ ç™¾ä¸Šåƒä¸ªç±»å‹ï¼Œ æ‰‹åŠ¨æ·»åŠ ä¼šå¾ˆéº»çƒ¦ï¼Œ æ‰€ä»¥å¯ä»¥å†™ä¸€ä¸ªè£…é¥°å™¨ï¼Œ è‡ªåŠ¨æ³¨å†Œ printerï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span>printer <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>printing<span style=color:#f92672>.</span>RegexpCollectionPrettyPrinter(<span style=color:#e6db74>&#39;REL_16_STABLE&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>register_printer</span>(name):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__registe</span>(_printer):
</span></span><span style=display:flex><span>        printer<span style=color:#f92672>.</span>add_printer(name, <span style=color:#e6db74>&#39;^&#39;</span> <span style=color:#f92672>+</span> name <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;$&#39;</span>, _printer)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> __registe
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@register_printer</span>(<span style=color:#e6db74>&#39;Relids&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RelidsPrinter</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, val) <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>val <span style=color:#f92672>=</span> val
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_string</span>(self):
</span></span><span style=display:flex><span>        list <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>        rid <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>parse_and_eval(<span style=color:#e6db74>&#39;bms_next_member((</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>) </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, -1)&#39;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>val<span style=color:#f92672>.</span>type<span style=color:#f92672>.</span>pointer(), self<span style=color:#f92672>.</span>val<span style=color:#f92672>.</span>dereference()<span style=color:#f92672>.</span>address))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> rid <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            list<span style=color:#f92672>.</span>append(int(rid))
</span></span><span style=display:flex><span>            rid <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>parse_and_eval(<span style=color:#e6db74>&#39;bms_next_member((</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>) </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>)&#39;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>val<span style=color:#f92672>.</span>type<span style=color:#f92672>.</span>pointer(), self<span style=color:#f92672>.</span>val<span style=color:#f92672>.</span>dereference()<span style=color:#f92672>.</span>address, rid))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> str(list)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gdb<span style=color:#f92672>.</span>printing<span style=color:#f92672>.</span>register_pretty_printer(
</span></span><span style=display:flex><span>    gdb<span style=color:#f92672>.</span>current_objfile(),
</span></span><span style=display:flex><span>    printer, <span style=color:#66d9ef>True</span>)
</span></span></code></pre></div></li><li><p>å®ç° printer generatorï¼Œæ€ä¹ˆåŠ¨æ€ç”Ÿæˆï¼Œæ€ä¹ˆè·å–æƒ³è¦æ‰“å°å¯¹è±¡çš„ç»“æ„</p><p>å¦‚æœä¸è¦æ±‚ä¸ªæ€§åŒ–ï¼Œåˆ™å¤§éƒ¨åˆ†çš„ printer æ˜¯ç±»ä¼¼çš„ï¼Œä¾‹å¦‚ FuncExpr ï¼Œæ‰‹å†™çš„è¯å¤§æ¦‚ç±»ä¼¼è¿™ä¸ª</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@register_printer</span>(<span style=color:#e6db74>&#39;FuncExpr&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FuncExprPrinter</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, val) <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>val <span style=color:#f92672>=</span> val
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_string</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;FuncExpr[funcid: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, funcresulttype: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, funcretset: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, funcvariadic: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, funcformat: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, funccollid: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, inputcollid: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>]&#39;</span> <span style=color:#f92672>%</span> (
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>val[<span style=color:#e6db74>&#39;funcid&#39;</span>],
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>val[<span style=color:#e6db74>&#39;funcresulttype&#39;</span>],
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>val[<span style=color:#e6db74>&#39;funcretset&#39;</span>],
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>val[<span style=color:#e6db74>&#39;funcvariadic&#39;</span>],
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>val[<span style=color:#e6db74>&#39;funcformat&#39;</span>],
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>val[<span style=color:#e6db74>&#39;funccollid&#39;</span>],
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>val[<span style=color:#e6db74>&#39;inputcollid&#39;</span>]
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>children</span>(self):
</span></span><span style=display:flex><span>        list <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>        add_list(list, self<span style=color:#f92672>.</span>val, <span style=color:#e6db74>&#39;args&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> list
</span></span></code></pre></div><p>pg Node ç»“æ„ä½“è¦æ±‚å…¶å­ç±»å®ç°ä¸€äº›ç‰¹å®šå‡½æ•°ï¼Œ ä»¥ä¾¿äº pg å®ç°ç‰¹å®šçš„åŠŸèƒ½ï¼Œä¾‹å¦‚ read, writeç­‰ï¼Œä¹‹å‰éƒ½æ˜¯ write by hand ï¼Œåé¢å®ç°äº†ä¸€ä¸ªè„šæœ¬ <code>gen_node_support.pl</code>ï¼Œç”¨æ¥å¤„ç†è¿™ä¸ªé‡å¤çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬åªéœ€è¦ç¨å¾®æ”¹åŠ¨ä¸‹è¿™ä¸ªæ–‡ä»¶ï¼ŒæŠŠç»“æ„ä½“å¯¼å‡ºå³å¯ï¼Œç„¶åå†ç¨å¾®å¤„ç†ä¸‹ï¼Œ å°±è·å¾—äº†æˆ‘ä»¬æƒ³è¦çš„æ ¼å¼ï¼Œå½“å‰æ‰€æœ‰çš„å¯æ‰“å°çš„ç»“æ„ä½“éƒ½åœ¨ <code>node_struct.py</code> ä¸­</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>RangeVar <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;char*&#39;</span>, <span style=color:#e6db74>&#39;catalogname&#39;</span>),
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;char*&#39;</span>, <span style=color:#e6db74>&#39;schemaname&#39;</span>),
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;char*&#39;</span>, <span style=color:#e6db74>&#39;relname&#39;</span>),
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;bool&#39;</span>, <span style=color:#e6db74>&#39;inh&#39;</span>),
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;char&#39;</span>, <span style=color:#e6db74>&#39;relpersistence&#39;</span>),
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;Alias*&#39;</span>, <span style=color:#e6db74>&#39;alias&#39;</span>),
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;int&#39;</span>, <span style=color:#e6db74>&#39;location&#39;</span>),
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>å¦‚æœä»¿ç…§ FuncExpr å®ç°ä¸€ä¸ª RangeVarPrinterï¼Œç»“æ„æ˜¯ç±»ä¼¼çš„ï¼Œæ‰€ä»¥å¯ä»¥å®ç°ä¸€ä¸ªå…¬æœ‰æ–¹æ³•ï¼Œè§£æè¿™ä¸ªç»“æ„ä½“ï¼ŒæŠŠæŒ‡é’ˆå’Œå…¶ä»–ç±»å‹åŒºåˆ†å¼€ï¼ŒæŒ‡é’ˆæ”¾åœ¨ children ä¸­æ‰“å°ï¼Œå…¶ä»–çš„æ”¾åœ¨ to_string ä¸­æ‰“å°å³å¯ï¼Œå¯ä»¥å‚è€ƒ <a href=https://github.com/askyx/pretty_printer.git>postgres pretty printer</a> ä¸­çš„ <code>split_field</code> å‡½æ•°å’Œ <code>print_to_string</code> ï¼Œ<code>print_children</code>ï¼Œå¤§éƒ¨åˆ†é€»è¾‘åœ¨ BasePrinter ç±»ä¸‹é¢</p></li><li><p>æ€ä¹ˆå¤„ç†ç»§æ‰¿å…³ç³»</p><p>å¯¹äºç»§æ‰¿å…³ç³»ï¼Œä¸ºäº†æ–¹ä¾¿å¤„ç†ï¼Œå¯¹åº”å­ç±»çš„ç»“æ„ä½“ä¸­éœ€è¦åŠ ä¸Šçˆ¶ç±»ç»“æ„ä½“çš„å­—æ®µï¼Œåœ¨ python ä¸­è·å–å€¼å¾—æ—¶å€™ï¼Œè§£æå­—æ®µä¸ºæ•°ç»„ï¼Œç„¶åä½¿ç”¨ç±»ä¼¼ <code>val['path']['pathtype']</code> çš„è¯­æ³•æ¥è·å–ï¼Œä½†æ˜¯ç»§æ‰¿çš„æ·±åº¦ä¸ç¡®å®šï¼Œä¾‹å¦‚ <code>('NodeTag', 'jpath.path.pathtype'),</code>ï¼Œæ‰€ä»¥éœ€è¦åŠ¨æ€è·å–ï¼Œè¿™é‡Œä½¿ç”¨ python çš„ reduce å‡½æ•° <code>reduce(operator.getitem, fields, self.val)</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>IndexPath <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;NodeTag&#39;</span>, <span style=color:#e6db74>&#39;path.pathtype&#39;</span>),
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;RelOptInfo*&#39;</span>, <span style=color:#e6db74>&#39;path.parent&#39;</span>),
</span></span><span style=display:flex><span>  <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;ScanDirection&#39;</span>, <span style=color:#e6db74>&#39;indexscandir&#39;</span>),
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;Cost&#39;</span>, <span style=color:#e6db74>&#39;indextotalcost&#39;</span>),
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;Selectivity&#39;</span>, <span style=color:#e6db74>&#39;indexselectivity&#39;</span>),
</span></span><span style=display:flex><span>]
</span></span></code></pre></div></li><li><p>æ€ä¹ˆæ‰“å° æ•°ç»„</p><p>å¯¹äºæ•°ç»„ï¼Œå…¸å‹çš„å°±æ˜¯ Sort ä¸­çš„ key çš„æ“ä½œç¬¦ä¿¡æ¯ï¼Œè¿™é‡Œéœ€è¦åœ¨ç»“æ„ä½“ä¸­æ ‡æ˜é•¿åº¦ä¿¡æ¯ï¼Œ ç„¶åè§£æé•¿åº¦ï¼Œå†ä½¿ç”¨é•¿åº¦è·å–å¯¹åº”å­—æ®µä¿¡æ¯ï¼Œå…·ä½“å‚è€ƒ <code>print_children_array</code> å‡½æ•°</p></li><li><p>ç‰¹æ®Šå‡½æ•°</p><p>ä¸€äº›ç‰¹æ®Šç»“æ„ä½“ï¼Œæ— æ³•ä½¿ç”¨ä¸Šé¢å¾—æ–¹æ³•å®ç°ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦è‡ªå·±æ‰‹å†™ï¼Œä¾‹å¦‚ List ï¼ŒBitmapset ä»¥åŠ Value ç­‰</p></li></ol><h4 id=3-åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šå¿«é€Ÿæ·»åŠ æˆ–ä¿®æ”¹ç»“æ„ä½“>3. åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šå¿«é€Ÿæ·»åŠ æˆ–ä¿®æ”¹ç»“æ„ä½“
<a href=#3-%e5%9c%a8%e4%b8%8a%e9%9d%a2%e7%9a%84%e5%9f%ba%e7%a1%80%e4%b8%8a%e5%bf%ab%e9%80%9f%e6%b7%bb%e5%8a%a0%e6%88%96%e4%bf%ae%e6%94%b9%e7%bb%93%e6%9e%84%e4%bd%93 class=h-anchor aria-hidden=true>#</a></h4><p><code>gen_node_support.pl</code> æ˜¯æ¯”è¾ƒæ–°çš„ pg ç‰ˆæœ¬ä¸Šæ‰ä¼šæœ‰çš„ï¼Œæ‰€ä»¥å…¶ä»–ç‰ˆæœ¬æ— æ³•ç›´æ¥ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶å¤„ç†ç»“æ„ä½“ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±æ‰‹åŠ¨æŸ¥æ‰¾ä¿®æ”¹ï¼Œè™½ç„¶å„ä¸ªç‰ˆæœ¬ä¹‹é—´å·®å¼‚ç‚¹ä¸å¤§ï¼Œä½†æ˜¯ä»å‡ ç™¾ä¸ªç»“æ„ä½“é‡Œé¢æ‰¾ä¸åŒè¿˜æ˜¯æŒºéš¾çš„ï¼Œä¸ºäº†æ–¹ä¾¿å¿«é€Ÿçš„æ·»åŠ æˆ–ä¿®æ”¹ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ª trace æ–‡ä»¶ï¼Œç±»ä¼¼ pstackï¼ŒæŒ‰ç…§è‡ªå·±çš„å…·ä½“çš„æ–‡ä»¶æ·»åŠ  æ–­ç‚¹ï¼Œattach ä¸Šè¿›ç¨‹ä¹‹åï¼Œæ‰“å°å…³é”® ç»“æ„ä½“ï¼Œå³å¯å¿«é€ŸæŸ¥æ‰¾å‡ºå·®å¼‚ç‚¹ï¼Œ ç„¶åå¿«é€Ÿä¿®æ”¹ï¼Œå½“å‰æ˜¯ä½¿ç”¨ tpch çš„è¯­å¥ æµ‹è¯•çš„ï¼Œæš‚æ—¶æ²¡æœ‰ä½¿ç”¨å…¶ä»–å¤æ‚è¯­å¥æˆ–ç±»å‹æµ‹è¯•ï¼Œåç»­å‘ç°äº†å†æ…¢æ…¢æ·»åŠ ä¿®æ”¹ï¼Œè¿™é‡Œåº”è¯¥å¯ä»¥è¦†ç›–å¤§éƒ¨åˆ†å¸¸ç”¨åœºæ™¯äº†</p><ul><li>trace æ–‡ä»¶è¿˜å¯ä½œä¸ºæ—¥å¸¸çš„è°ƒè¯•å·¥å…·ï¼Œå¦‚æœåªæ˜¯æƒ³ç®€å•è°ƒè¯•ï¼Œæ— éœ€æ‰‹å·¥æ¥å…¥çš„è¯ï¼Œå¯ä»¥ç›´æ¥ attach ä¸Šï¼Œç›´æ¥æ·»åŠ è‡ªå·±æƒ³è¦trace çš„ä¿¡æ¯å³å¯</li></ul><h4 id=attention>attention
<a href=#attention class=h-anchor aria-hidden=true>#</a></h4><ul><li><p>å½“å‰æ”¯æŒçš„æ˜¯å››ä¸ªç­‰çº§ï¼Œä½¿ç”¨ <code>print pg_pretty</code> æ§åˆ¶</p><ul><li>off ä¸ºå…³é—­æ‰“å°</li><li>origin ä¼šä½¿ç”¨ pprint æ‰“å°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ç”±äºæ— æ³•ç¡®å®š print çš„æ—¶å€™ï¼ŒæŒ‡é’ˆå…·ä½“æ˜¯ä»€ä¹ˆç±»å‹ï¼Œ ä¹Ÿä¸æƒ³ä¸ºæ¯ä¸ªç±»å‹å†™ä¸ªæ­£åˆ™ï¼Œ æ‰€ä»¥åªèƒ½æŠŠæŒ‡é’ˆè½¬æ¢ä¸º Node ä¹‹åå†æ‰“å°ï¼Œä¾‹å¦‚<code>p *(Node*) best_path</code>ï¼Œ
éœ€è¦æ³¨æ„çš„æ˜¯ pprint æ˜¯ builtin functionï¼Œæ‰€ä»¥å¦‚æœæ˜¯è°ƒè¯• core æ–‡ä»¶ï¼Œæ˜¯æ— æ³•ä½¿ç”¨æ­¤ç­‰çº§çš„</li><li>trace ä¼šä½¿ç”¨ python è„šæœ¬ä¸­å®ç°çš„ printer ï¼Œé¢„å…ˆè®¾è®¡æ˜¯å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼Œä½†æ˜¯å½“å‰ Bitmapset ä½¿ç”¨äº† pg å†…ç½®çš„ bmsToString å‡½æ•°ï¼Œæš‚æ—¶æ— æ³•ç›´æ¥åœ¨è°ƒè¯• core çš„æ—¶å€™ä½¿ç”¨ï¼Œè¿™é‡Œæš‚æ—¶æ²¡æœ‰è¿™ä¸ªéœ€æ±‚ï¼Œæ‰€ä»¥å°±å…ˆæš‚æ—¶æç½®ï¼Œä»¥åéœ€è¦çš„æ—¶å€™å†å®ç°ã€‚è¿™é‡Œå…¶å®ä¹Ÿç®€å•å°è¯•è¿‡ï¼Œ å®ç°çš„ <code>bms_next_member</code> å‡½æ•°å•ç‹¬ä½¿ç”¨çš„æ—¶å€™è¿˜æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ï¼Œä½†æ˜¯å¾ªç¯ä½¿ç”¨çš„æ—¶å€™ä¼šæ­»å¾ªç¯ï¼Œ ä¸çŸ¥é“ä¸ºå•¥ã€‚ã€‚çŸ¥é“æ˜¯ bug è¿˜æ˜¯å®ç°æœ‰é—®é¢˜ï¼Œåé¢å†çœ‹</li><li>info ç®€åŒ–æ‰“å°ä¿¡æ¯ï¼Œå®ç°ç±»ä¼¼ explain çš„è¾“å‡ºçš„æ ·å¼ï¼Œä½†æ˜¯è¿™ä¸ªéœ€è¦æ‰‹å†™ï¼Œæš‚æ—¶æ²¡æœ‰å®ç°ã€‚é¢„ä¼°éš¾ç‚¹å’ŒåŠŸèƒ½ä¸º<ol><li>æ ¼å¼æ˜¯ä»€ä¹ˆ</li><li>printer ä¹‹é—´æ— æ³•ä¼ é€’ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œç±»ä¼¼ Var è¿™ç§ç»“æ„ä½“ä¸çŸ¥é“å½’å±ï¼Œå¯èƒ½éœ€è¦è‡ªå·±æ”¹é€  <code>RegexpCollectionPrettyPrinter</code></li><li>å•ç‹¬æ‰“å°æŸä¸ªç»“æ„ä½“çš„æ—¶å€™ï¼Œèƒ½å¦èƒ½ä»æŸä¸ªåœ°æ–¹è·å–æŸäº›ä¿¡æ¯ï¼Œä¾‹å¦‚ PlannerInfo ä¸­çš„ simple_rel_array</li></ol></li></ul></li><li><p>å®ç°ä¸­æ³¨æ„ç›¸äº’å¼•ç”¨é—®é¢˜ï¼Œ å…¸å‹çš„ä¾‹å¦‚ RestrictInfoï¼Œä¸€äº›ç»“æ„ä½“ä¸­çš„å­—æ®µå¯èƒ½ä¿å­˜çš„ä¸Šå±‚çš„æŸä¸ªç»“æ„ä½“ï¼Œæ­¤æ—¶ä¸èƒ½æ‰“å°</p></li></ul><h4 id=todo>TODO
<a href=#todo class=h-anchor aria-hidden=true>#</a></h4><ol><li>å®Œå–„åŠŸèƒ½ï¼Œæ”¯æŒæ›´å¤šç»“æ„ä½“ï¼Œæ”¯æŒæ›´å¤šçš„ç±»å‹</li><li>æŠ½å–å…¬å…±éƒ¨åˆ†ï¼Œæé«˜å¤ç”¨æ€§ï¼Œå®ç°ä¸€ä¸ª gdb pretty printer generatorï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆ printerï¼Œ å¹¶ä¸”å¯ä»¥æŒ‡å®šç»“æ„ä½“çš„ç‰ˆæœ¬ï¼Œè‡ªåŠ¨å¤„ç†ç»§æ‰¿å…³ç³»ï¼Œè‡ªåŠ¨å¤„ç†æ•°ç»„ç­‰ï¼Œä»¥æ”¯æŒé™¤ pg ä¹‹å¤–çš„å…¶ä»–é¡¹ç›®</li><li>æ˜¯å¦éœ€è¦å®ç°ä¸€ä¸ª pg æ’ä»¶ï¼Œé…åˆä½¿ç”¨ï¼Œpython æ— æ³•å®ç°çš„åŠŸèƒ½åœ¨æ’ä»¶ä¸­å®ç°ï¼Œç„¶åä½¿ç”¨ python æ¥è°ƒç”¨</li><li>å®Œå–„æµ‹è¯•ï¼Œç›®å‰åªæ˜¯ç®€å•æµ‹è¯•äº†å‡ ä¸ªç»“æ„ä½“ï¼Œåç»­éœ€è¦æµ‹è¯•æ›´å¤šçš„ç»“æ„ä½“ï¼ŒåŒ…æ‹¬å¤æ‚çš„ç»“æ„ä½“ï¼Œä¾‹å¦‚å¤æ‚çš„æŸ¥è¯¢è®¡åˆ’ï¼Œå¤æ‚çš„å‡½æ•°è°ƒç”¨ï¼Œå¤æ‚çš„è¡¨è¾¾å¼ç­‰ç­‰</li><li>å®Œå–„æ–‡æ¡£ï¼ŒåŒ…æ‹¬ READMEï¼Œ å¦‚ä½•ä½¿ç”¨ï¼Œå¦‚ä½•å¼€å‘ï¼Œå¦‚ä½•æµ‹è¯•ç­‰ç­‰</li><li>ä½¿ç”¨ç³»ç»Ÿå‡½æ•°è·å–æŸäº›å…ƒæ•°æ®ä¿¡æ¯ï¼Œæ˜¯å¦ä¼šå½±å“ç¨‹åºçš„è¿è¡Œï¼ŒåŸæ¥çš„ç¼“å­˜æ˜¯å¦ä¼šè¢«æ±¡æŸ“ï¼Œæ˜¯å¦éœ€è¦æ”¯æŒé«˜çš„ç­‰çº§</li></ol><ul><li>é¡¹ç›®è¿˜åœ¨æ¼”åŒ–ä¸­ï¼ŒæŸäº›åŠŸèƒ½å¯èƒ½ä¼šå˜</li></ul><h3 id=auto-load>auto load
<a href=#auto-load class=h-anchor aria-hidden=true>#</a></h3><p>gdb çš„ auto-load æœºåˆ¶ï¼Œå¯ä»¥å®ç°åœ¨ gdb å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨åŠ è½½æŒ‡å®šçš„è„šæœ¬ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ‰‹åŠ¨ source äº†ã€‚ä¸”å¯ä»¥é™åˆ¶åŠ è½½çš„èŒƒå›´ï¼ŒåªåŠ è½½æŒ‡å®šçš„ç¨‹åºã€‚å¦‚æœæ²¡æœ‰é™å®š pretty printer çš„ä½¿ç”¨èŒƒå›´ ï¼Œ ç›´æ¥åœ¨ .gdbinit ä¸­ source python è„šæœ¬ï¼Œåˆ™è„šæœ¬å†…å®¹æ˜¯å…¨å±€çš„ï¼Œæ­¤æ—¶ä»»ä½•çš„ç¨‹åºåªè¦æœ‰ç›¸åŒåå­—çš„ç»“æ„ä½“ï¼Œéƒ½ä¼šè§¦å‘ prtty printerã€‚ä½†æ˜¯å…·ä½“çš„ç»“æ„ä½“å†…å®¹ä¸ä¸€æ ·ï¼Œç›´æ¥ä½¿ç”¨æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ‰€ä»¥å¯¹äºè‡ªå·±çš„ pretty printer ï¼Œè¿˜æ˜¯æœ‰å¿…è¦é™å®šä½¿ç”¨èŒƒå›´ã€‚</p><pre tabindex=0><code class=language-gdb data-lang=gdb>(gdb) info pretty-printer
global pretty-printers:
  builtin
    mpx_bound128
  REL_16_STABLE
    (Node|Expr)
    A_ArrayExpr
    A_Const
    A_Expr
    A_Indices
    A_Indirection
    A_Star
    AccessPriv
    Agg
    AggPath
    Aggref
    Alias
</code></pre><p>è¯¦æƒ…å‚è€ƒ<a href=https://sourceware.org/gdb/current/onlinedocs/gdb.html/Auto_002dloading-extensions.html#Auto_002dloading-extensions>å®˜æ–¹æ–‡æ¡£</a>ï¼Œè¿™é‡Œä¸å¤šèµ˜è¿°ï¼Œé‡ç‚¹æ€»ç»“ä¸‹</p><ol><li><p>auto-load è„šæœ¬çš„åç§°ï¼Œéœ€è¦åŒ¹é…ä½ æƒ³åŠ¨æ€åŠ è½½çš„æ–‡ä»¶çš„åç§°ï¼Œä¾‹å¦‚çš„ <code>libstdc++.so.6.0.31</code> æ–‡ä»¶ï¼ŒåŒ¹é…çš„æ–‡ä»¶åç§°ä¸º <code>libstdc++.so.6.0.31-gdb.py</code>ã€‚å½“ç„¶ç”±äº gdb çš„è„šæœ¬æ–‡ä»¶ä¸ä»…ä»…åªæ”¯æŒ pythonï¼Œ æ‰€ä»¥ auto-load ä¹Ÿè¿›è¡Œæ–‡ä»¶åçš„åŒºåˆ†ï¼Œå…·ä½“åŠ è½½ä»€ä¹ˆå–å†³äºä½ æä¾›çš„æ–‡ä»¶ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ª gdb åŠ è½½ libstdc++.so.6.0.32-gdb.py çš„ trace</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr&#34;</span>, 0x7ffd8c8eb4d0, 1023<span style=color:#f92672>)</span>  <span style=color:#f92672>=</span> -1 EINVAL <span style=color:#f92672>(</span>Invalid argument<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr/lib&#34;</span>, 0x7ffd8c8eb4d0, 1023<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 EINVAL <span style=color:#f92672>(</span>Invalid argument<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr/lib/x86_64-linux-gnu&#34;</span>, 0x7ffd8c8eb4d0, 1023<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 EINVAL <span style=color:#f92672>(</span>Invalid argument<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr/lib/x86_64-linux-gnu/libstdc++.so.6&#34;</span>, <span style=color:#e6db74>&#34;libstdc++.so.6.0.32&#34;</span>, 1023<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>19</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.32&#34;</span>, 0x7ffd8c8eb4d0, 1023<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 EINVAL <span style=color:#f92672>(</span>Invalid argument<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>openat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.32-gdb.gdb&#34;</span>, O_RDONLY|O_CLOEXEC<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 ENOENT <span style=color:#f92672>(</span>No such file or directory<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>openat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/usr/lib/debug/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.32-gdb.gdb&#34;</span>, O_RDONLY|O_CLOEXEC<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 ENOENT <span style=color:#f92672>(</span>No such file or directory<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>openat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/usr/share/gdb/auto-load/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.32-gdb.gdb&#34;</span>, O_RDONLY|O_CLOEXEC<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 ENOENT <span style=color:#f92672>(</span>No such file or directory<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/lib&#34;</span>, <span style=color:#e6db74>&#34;usr/lib&#34;</span>, 1023<span style=color:#f92672>)</span>       <span style=color:#f92672>=</span> <span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr&#34;</span>, 0x7ffd8c8eb4d0, 1023<span style=color:#f92672>)</span>  <span style=color:#f92672>=</span> -1 EINVAL <span style=color:#f92672>(</span>Invalid argument<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr/lib&#34;</span>, 0x7ffd8c8eb4d0, 1023<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 EINVAL <span style=color:#f92672>(</span>Invalid argument<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr/lib/x86_64-linux-gnu&#34;</span>, 0x7ffd8c8eb4d0, 1023<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 EINVAL <span style=color:#f92672>(</span>Invalid argument<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr/lib/x86_64-linux-gnu/libstdc++.so.6&#34;</span>, <span style=color:#e6db74>&#34;libstdc++.so.6.0.32&#34;</span>, 1023<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>19</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.32&#34;</span>, 0x7ffd8c8eb4d0, 1023<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 EINVAL <span style=color:#f92672>(</span>Invalid argument<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>openat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.32-gdb.py&#34;</span>, O_RDONLY|O_CLOEXEC<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 ENOENT <span style=color:#f92672>(</span>No such file or directory<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>openat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/usr/lib/debug/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.32-gdb.py&#34;</span>, O_RDONLY|O_CLOEXEC<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 ENOENT <span style=color:#f92672>(</span>No such file or directory<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>openat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/usr/share/gdb/auto-load/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.32-gdb.py&#34;</span>, O_RDONLY|O_CLOEXEC<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>16</span>
</span></span></code></pre></div></li><li><p>auto-load è„šæœ¬çš„è·¯å¾„ä¸€èˆ¬åœ¨ <code>/usr/share/gdb/auto-load/</code> å’Œ <code>/usr/lib/debug</code> ç›®å½•ä¸‹ï¼Œåœ¨æ­¤ç›®å½•ä¸‹å»ºç«‹ä¸€ä¸ªä½ éœ€è¦åŠ¨æ€åŠ è½½çš„æ–‡ä»¶çš„å…¨ç›®å½•ç±»ä¼¼çš„ç›®å½•ç»“æ„ï¼Œä¾‹å¦‚ <code>usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.31-gdb.py</code> ï¼Œæ­¤æ—¶ä½ çš„æ–‡ä»¶çš„å…¨è·¯å¾„å°±æ˜¯ <code>/usr/share/gdb/auto-load/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.32-gdb.py</code> ï¼Œä¸€èˆ¬ç³»ç»Ÿä¸‹è¿˜æœ‰å…¶ä»–æ–‡ä»¶ï¼Œå¯ä»¥è‡ªè¡Œæµ‹è¯•</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>â¯ tree
</span></span><span style=display:flex><span>.
</span></span><span style=display:flex><span>â”œâ”€â”€ lib
</span></span><span style=display:flex><span>â”‚Â Â  â””â”€â”€ x86_64-linux-gnu
</span></span><span style=display:flex><span>â”‚Â Â      â””â”€â”€ libpthread-2.35.so-gdb.py
</span></span><span style=display:flex><span>â””â”€â”€ usr
</span></span><span style=display:flex><span>    â”œâ”€â”€ lib
</span></span><span style=display:flex><span>    â”‚Â Â  â””â”€â”€ x86_64-linux-gnu
</span></span><span style=display:flex><span>    â”‚Â Â      â”œâ”€â”€ libisl.so.23.1.0-gdb.py
</span></span><span style=display:flex><span>    â”‚Â Â      â””â”€â”€ libstdc++.so.6.0.32-gdb.py
</span></span><span style=display:flex><span>    â””â”€â”€ lib32
</span></span><span style=display:flex><span>        â””â”€â”€ libstdc++.so.6.0.32-gdb.py
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>6</span> directories, <span style=color:#ae81ff>4</span> files
</span></span><span style=display:flex><span>/usr/share/gdb/auto-load â¯
</span></span></code></pre></div></li><li><p>æ­¤å¤–ï¼Œè„šæœ¬æ–‡ä»¶ä¹Ÿå¯ä»¥æ”¾åœ¨ä½ è°ƒè¯•æ–‡ä»¶çš„ç›®å½•ä¸‹ï¼Œæ­¤æ—¶åªè¦åŠ è½½åˆ°æ­¤æ–‡ä»¶ï¼Œåˆ™ä¹Ÿä¼šåŒæ—¶åŠ è½½æ­¤æ–‡ä»¶ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯éœ€è¦åœ¨ <code>.gdbinit</code> ä¸­æ·»åŠ  <code>add-auto-load-safe-path {your_path}</code> , å¦åˆ™ gdb ä¼šæç¤º <code>auto-loading has been declined by your `auto-load safe-path' set to "$debugdir:$datadir/auto-load".</code>ï¼ŒåŠ è½½ä¹‹åï¼ŒæŸ¥çœ‹ <code>auto-load safe-path</code> å¦‚ä¸‹</p><pre tabindex=0><code>(gdb) show auto-load safe-path
List of directories from which it is safe to auto-load files is $debugdir:$datadir/auto-load:/home/asky/.build/bin.
</code></pre></li><li><p>æ­¤æ—¶ gdb å¯åŠ¨ä¹‹åï¼Œå†æŸ¥çœ‹ pretty printerï¼Œä¼šçœ‹è§ pretty printer ä¸åœ¨ global pretty-printers ä¸‹é¢äº†ï¼Œè€Œæ˜¯å’Œæ–‡ä»¶å…³è”åœ¨ä¸€èµ·</p><pre tabindex=0><code>global pretty-printers:
  builtin
    mpx_bound128
objfile /home/asky/.build/bin/postgres pretty-printers:
  REL_16_STABLE
    (Node|Expr)
    A_ArrayExpr
    A_Const
    A_Expr
    A_Indices
    A_Indirection
    A_Star
    AccessPriv
    Agg
    AggInfo
    AggPath
</code></pre></li></ol><p>ä¸ä»…ä»…åªæ˜¯ pretty printer ï¼Œå…¶ä»–çš„è„šæœ¬æ–‡ä»¶ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„æ–¹æ³•å’Œç¨‹åºç»‘å®šåœ¨ä¸€èµ·ï¼Œé¿å…äº†ä¸åŒç¨‹åºä¹‹é—´ç›¸äº’å¹²æ‰°çš„é—®é¢˜</p><h2 id=checkpoint>checkpoint
<a href=#checkpoint class=h-anchor aria-hidden=true>#</a></h2><ul><li><p>parse_and_eval å¯ä»¥è¿ç®—è¡¨è¾¾å¼ï¼Œç„¶åä¿å­˜ä¸º python å†…ç½®å˜é‡ï¼Œè¿ç”¨èŒƒå›´æå¹¿</p></li><li><p>vscode ä¹Ÿå¯ä»¥ä½¿ç”¨ pretty printerï¼Œåªéœ€è¦æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤å®ç°è‡ªå®šä¹‰çš„ printerï¼Œ ç„¶åè®¾ç½® auto load å³å¯</p><ol><li>vscode çª—å£ä¸­æ˜¾ç¤ºå˜é‡å€¼éœ€è¦è¦æ±‚æ˜¯å¯¹è±¡ï¼Œè€Œä¸èƒ½æ˜¯æŒ‡é’ˆ</li><li>çª—å£ä¸­æ˜¾ç¤ºçš„å€¼éœ€è¦åœ¨ children ä¸­è¿”å›æ‰æ˜¾ç¤ºï¼Œ to_string æ˜¾ç¤ºçš„å€¼çª—å£æ˜¯ä¸ä¼šæ˜¾ç¤ºçš„ï¼Œä¾‹å¦‚ vector gdb ä¸­æ˜¾ç¤ºçš„æ˜¯ <code>$1 = std::vector of length 4, capacity 4 = {"hello", "world", "c++", "python"}</code>ï¼Œè€Œçª—å£ä¸­åªæ˜¾ç¤ºå®é™…çš„å†…å®¹ <code>{"hello", "world", "c++", "python"}</code>ï¼Œto_string æ›´ç±»ä¼¼æ˜¯ä¸€ä¸ª prompt</li><li>æ‰€ä»¥è‡ªå®šä¹‰çš„ printer å®ç°çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä»€ä¹ˆæ˜¯é‡ç‚¹ï¼Œ ä»€ä¹ˆæ˜¯å¯ä»¥å¿½ç•¥çš„ï¼Œæ‰“å°ä¸»ä½“éœ€è¦æ”¾åœ¨ children ä¸­</li></ol></li><li><p>å¯ä»¥ä½¿ç”¨ python ç›´æ¥ä»ç¨‹åºä¸­è§£æç»“æ„ä½“ï¼Œç„¶åæ„é€  printer ï¼Œç†è®ºå¯è¡Œï¼Œä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹å®Œå…¨ä¸å¯æ§ï¼Œä¸”éš¾ä»¥å®ç°</p></li></ul><pre tabindex=0><code>(gdb) b planner
Breakpoint 1 at 0x55a0564fc233: file /workspaces/postgres/src/backend/optimizer/plan/planner.c, line 397.
(gdb) c
Continuing.

Breakpoint 1, planner (parse=0x55a05825e918, ...) at /workspaces/postgres/src/backend/optimizer/plan/planner.c:397
397             if (planner_hook)
(gdb) python v = gdb.parse_and_eval(&#39;parse&#39;)
(gdb) python print(gdb.types.get_basic_type(v.dereference().type).fields())
[&lt;gdb.Field object at 0x7fea1ad730b0&gt;, &lt;gdb.Field object at 0x7fea1ad73730&gt;, &lt;gdb.Field object at 0x7fea1ad71970&gt;, &lt;gdb.Field object at 0x7fea1ad731d0&gt;, &lt;gdb.Field object at 0x7fea1ad72bf0&gt;, &lt;gdb.Field object at 0x7fea1ad71f90&gt;, &lt;gdb.Field object at 0x7fea1ad71ed0&gt;, &lt;gdb.Field object at 0x7fea1ad734d0&gt;, &lt;gdb.Field object at 0x7fea1ad73950&gt;, &lt;gdb.Field object at 0x7fea1ad70cd0&gt;, &lt;gdb.Field object at 0x7fea1ad72e70&gt;, &lt;gdb.Field object at 0x7fea1ad72ff0&gt;, &lt;gdb.Field object at 0x7fea1ad73070&gt;, &lt;gdb.Field object at 0x7fea1ad73db0&gt;, &lt;gdb.Field object at 0x7fea1ad72370&gt;, &lt;gdb.Field object at 0x7fea1ad71f70&gt;, &lt;gdb.Field object at 0x7fea1ad72b30&gt;, &lt;gdb.Field object at 0x7fea1ad73eb0&gt;, &lt;gdb.Field object at 0x7fea1ad71630&gt;, &lt;gdb.Field object at 0x7fea1ad70e50&gt;, &lt;gdb.Field object at 0x7fea1ad70cb0&gt;, &lt;gdb.Field object at 0x7fea1ad70db0&gt;, &lt;gdb.Field object at 0x7fea1ad73590&gt;, &lt;gdb.Field object at 0x7fea1ad70950&gt;, &lt;gdb.Field object at 0x7fea1ad726f0&gt;, &lt;gdb.Field object at 0x7fea1ad72950&gt;, &lt;gdb.Field object at 0x7fea1ad73470&gt;, &lt;gdb.Field object at 0x7fea1ad72e30&gt;, &lt;gdb.Field object at 0x7fea1ad71b10&gt;, &lt;gdb.Field object at 0x7fea1ad71c70&gt;, &lt;gdb.Field object at 0x7fea1ad73150&gt;, &lt;gdb.Field object at 0x7fea1ad72830&gt;, &lt;gdb.Field object at 0x7fea1ad71710&gt;, &lt;gdb.Field object at 0x7fea1ad72890&gt;, &lt;gdb.Field object at 0x7fea1ad72850&gt;, &lt;gdb.Field object at 0x7fea1ad719f0&gt;, &lt;gdb.Field object at 0x7fea1ad72530&gt;, &lt;gdb.Field object at 0x7fea1ad736b0&gt;, &lt;gdb.Field object at 0x7fea1ad71590&gt;, &lt;gdb.Field object at 0x7fea1ad72670&gt;, &lt;gdb.Field object at 0x7fea1ad713b0&gt;, &lt;gdb.Field object at 0x7fea1ad739f0&gt;, &lt;gdb.Field object at 0x7fea1ad71750&gt;, &lt;gdb.Field object at 0x7fea1ad73a10&gt;]
(gdb) python print(gdb.types.get_basic_type(v.dereference().type).fields()[0].type)
NodeTag
(gdb) python print(gdb.types.get_basic_type(v.dereference().type).fields()[1].type)
CmdType
(gdb)
</code></pre><ul><li>å¯ä»¥æŠŠå¤æ‚é€»è¾‘äº¤ç»™ç¨‹åºå®ç°ï¼Œç„¶åæä¾›å‡½æ•°æ¥å£ç»™ pythonï¼Œ python ç›´æ¥è°ƒç”¨å‡½æ•°æ‰“å°å¯¹è±¡ï¼Œä¾‹å¦‚å¯ä»¥å®ç°ä¸€ä¸ª pg çš„æ’ä»¶ï¼Œprint çš„åœ¨æ’ä»¶ä¸­å®ç°ã€‚</li></ul><h2 id=i-am-stupid>i am stupid
<a href=#i-am-stupid class=h-anchor aria-hidden=true>#</a></h2><p>å½“å‰çš„å®ç°å­˜åœ¨å·¨å¤§é—®é¢˜ï¼Œæ‰€æœ‰çš„pinter èšåœ¨ä¸€èµ·ï¼Œ å‡ºäº†é—®é¢˜æ ¹æœ¬æ— æ³•å®šä½æ˜¯é‚£ä¸ªprinterçš„é”…ï¼ŒæŠŠç¯å¢ƒä» Ubuntu 22 å‡çº§åˆ° Ubuntu 24 ä¹‹åï¼Œ æ•´ä¸ªå°±å‡ ä¹ gg äº†
åç»­è€ƒè™‘æ˜¾å¼å®ç°æ¯ä¸€ä¸ªç±»å‹çš„printerï¼Œå½“ç„¶ä¸èƒ½æ‰‹å†™ï¼Œæ‰“ç®—å†™ä¸ªæ’ä»¶å®ç°ã€‚printer gennerator å°±ä¸åº”è¯¥äº¤ç»™ python è¿™ç§è¯­è¨€ï¼Œå¼±ç±»å‹ï¼Œå¤ªè‡ªç”±äº†</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://askyx.github.io/posts/cmake/><span class=button__icon>â†</span>
<span class=button__text>cmake é€ŸæŸ¥æ¨¡æ¿</span>
</a></span><span class="button next"><a href=https://askyx.github.io/posts/optimizer/><span class=button__text>Postgres æŠ€æœ¯å†…å¹•ï¼ŒOptimizerè¿‡ç¨‹åˆ†æ</span>
<span class=button__icon>â†’</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><a href=https://askyx.github.io/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>Asky</span>
<span class=logo__cursor></span></a><div class=copyright><span>Â© 2024 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=https://askyx.github.io/assets/main.js></script><script src=https://askyx.github.io/assets/prism.js></script></div></body></html>