<!doctype html><html lang=zh-Hans x-data :class=$store.darkMode.class() :data-theme=$store.darkMode.theme()><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>gdb è¦ç‚¹ç®€è®° | Askyx's Blog</title><link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%2210 0 100 100%22><text y=%22.90em%22 font-size=%2290%22>ğŸŒ±</text></svg>"></link>
<link rel=canonical href=https://askyx.github.io/posts/others/gdb/><meta name=author content="Askyx"><meta name=description content="gdb ä¸­çš„ä¸€äº›å¸¸ç”¨æ–¹æ³•ï¼Œä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ï¼Œè®°å¿† gdb çš„ python æ‰©å±•çš„ä½¿ç”¨æ–¹æ³•"><meta name=keywords content><meta name=generator content="Hugo 0.148.1"><meta property="og:url" content="https://askyx.github.io/posts/others/gdb/"><meta property="og:site_name" content="Askyx's Blog"><meta property="og:title" content="gdb è¦ç‚¹ç®€è®°"><meta property="og:description" content="gdb ä¸­çš„ä¸€äº›å¸¸ç”¨æ–¹æ³•ï¼Œä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ï¼Œè®°å¿† gdb çš„ python æ‰©å±•çš„ä½¿ç”¨æ–¹æ³•"><meta property="og:locale" content="zh_Hans"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-11T10:17:52+08:00"><meta property="article:modified_time" content="2025-07-16T23:38:40+08:00"><meta property="og:image" content="https://askyx.github.io/img/global-background.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://askyx.github.io/img/global-background.jpg"><meta name=twitter:title content="gdb è¦ç‚¹ç®€è®°"><meta name=twitter:description content="gdb ä¸­çš„ä¸€äº›å¸¸ç”¨æ–¹æ³•ï¼Œä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ï¼Œè®°å¿† gdb çš„ python æ‰©å±•çš„ä½¿ç”¨æ–¹æ³•"><link rel=stylesheet href=/css/output.min.css><style>pre{padding:1em;overflow:auto}</style><link rel=stylesheet href=/css/custom.css><script defer src=https://cdn.jsdelivr.net/npm/alpinejs@3/dist/cdn.min.js integrity="sha256-PtHu0lJIiSHfZeNj1nFd6wTX+Squ255SGZ/fc8seCtM=" crossorigin=anonymous></script></head><body x-data="{
    flip: false,
  }"><div id=dream-global-bg></div><nav x-data="{ isSticky: false }" x-init="window.addEventListener('scroll', () => { isSticky = window.scrollY > 30 })" class="sticky top-0 z-30 mt-4 lg:mt-8 py-4" :class="{ 'bg-base-100 shadow-lg dark:border-b dark:border-base-content/30': isSticky }"><div class="container flex justify-between px-4"><section class="flex items-center gap-4"><div class="avatar cursor-pointer hover:avatar-online" @click="flip = !flip" title="Flip it!"><div class="h-10 rounded-full"><img src=/img/personal/avatar.jpg alt="Askyx's Blog"></div></div><div><a href=https://askyx.github.io/ class="text-lg font-semibold cursor-pointer">Askyx's Blog</a><div class="text-base-content/60 text-sm">life is short, use Python</div></div></section><div class="dropdown dropdown-end sm:hidden"><div tabindex=0 role=button class="btn btn-ghost btn-square" aria-label="Select an option"><ion-icon name=menu class=text-2xl></ion-icon></div><ul tabindex=0 class="dropdown-content menu w-36 bg-base-100 rounded-box z-1 shadow-md"><li><div role=link tabindex=0 class="inline-flex items-center p-2 cursor-pointer" @click="flip = !flip" title=About><ion-icon name=information-circle></ion-icon>About</div></li><li><a class="group inline-flex items-center p-2 cursor-pointer" href=/search title=Search><ion-icon name=search></ion-icon>Search</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=https://github.com/askyx target=_blank title=GitHub><ion-icon name=logo-github></ion-icon>GitHub</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/posts title=Archives><ion-icon name=archive></ion-icon>Archives</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/tags title="All Tags"><ion-icon name=pricetags></ion-icon>All Tags</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/index.xml title=RSS><ion-icon name=logo-rss></ion-icon>RSS</a></li></ul></div><section class="hidden sm:flex sm:items-center sm:gap-2 md:gap-4"><div role=link tabindex=0 class="text-sm font-semibold cursor-pointer hover:underline" @click="flip = !flip" title=About>About</div><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/search title=Search><ion-icon class=group-hover:text-primary-content name=search></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=https://github.com/askyx target=_blank title=GitHub><ion-icon class=group-hover:text-primary-content name=logo-github></ion-icon></a><div class="dropdown dropdown-end dropdown-hover"><div tabindex=0 role=button class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" aria-label="Select an option"><ion-icon class="group-hover:text-primary-content text-xl" name=menu></ion-icon></div><ul tabindex=0 class="dropdown-content menu w-36 bg-base-100 rounded-box z-1 shadow-xl"><li><a class="inline-flex items-center p-2 cursor-pointer" href=/posts title=Archives><ion-icon name=archive></ion-icon>Archives</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/tags title="All Tags"><ion-icon name=pricetags></ion-icon>All Tags</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/index.xml title=RSS><ion-icon name=logo-rss></ion-icon>RSS</a></li></ul></div></section></div></nav><div class=flip-container :class="{ 'flip-it': flip }"><div class=flipper><div class=front><div class=container><div class="lg:grid lg:grid-cols-4 gap-4 mt-4 px-4"><div class="hidden lg:block"></div><div class=lg:col-span-2><article class="mx-auto prose prose-quoteless dark:prose-invert" id=dream-single-post-main itemscope itemtype=http://schema.org/Article><meta itemprop=name content="gdb è¦ç‚¹ç®€è®°"><meta itemprop=description content="gdb ä¸­çš„ä¸€äº›å¸¸ç”¨æ–¹æ³•ï¼Œä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ï¼Œè®°å¿† gdb çš„ python æ‰©å±•çš„ä½¿ç”¨æ–¹æ³•"><meta itemprop=datePublished content="2023-07-11T10:17:52+08:00"><meta itemprop=dateModified content="2025-07-16T23:38:40+08:00"><meta itemprop=wordCount content="5452"><meta itemprop=image content="https://askyx.github.io/img/global-background.jpg"><header><h1 itemprop=headline>gdb è¦ç‚¹ç®€è®°</h1><p class=text-sm><span data-format=luxon>2023-07-11T10:17:52+08:00</span>
| <span>11 minute read</span>
| <span>Updated at
<span data-format=luxon>2025-07-16T23:38:40+08:00</span></span></p></header><section id=dream-single-post-content itemprop=articleBody><h2 id=é…ç½®>é…ç½®</h2><pre><code>set print pretty on
set print elements unlimited
set pagination off
</code></pre><h2 id=python-è„šæœ¬>python è„šæœ¬</h2><p>ç›´æ¥å®‰è£…çš„ gdb éƒ½æ˜¯é¢„å…ˆç¼–è¯‘ python çš„ï¼Œå¯ä»¥ä½¿ç”¨ python å®ç°ä¸€äº›æœ‰ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è‡ªå®šä¹‰å‘½ä»¤ï¼Œæ‰“å°è‡ªå®šä¹‰ç±»å‹ç­‰ã€‚å¯ä»¥å‚è€ƒ <a href=https://sourceware.org/gdb/onlinedocs/gdb/Python-API.html#Python-API target=_blank>gdb python æ‰©å±•</a></p><h3 id=gdb-python-äº¤äº’>gdb python äº¤äº’</h3><pre tabindex=0><code>(gdb) python
&gt;print(1+1)
&gt;end
2
(gdb) python
&gt;v = 3
&gt;end
(gdb) python print(v)
3
(gdb)
</code></pre><ul><li>python è§£é‡Šå™¨ä¸­çš„å€¼ä¸æ˜¯ä¸´æ—¶å˜é‡ï¼Œå¯ä»¥å®šä¹‰ä¹‹ååç»­ä½¿ç”¨</li></ul><h3 id=é‡ç‚¹-api>é‡ç‚¹ API</h3><ol><li><p><code>gdb.Value</code> ï¼Œç›´æ¥åœ¨ gdb ä¸­è®¿é—®çš„å€¼ï¼Œåœ¨ python ä¸­ï¼Œè¢«åŒ…è£…ä¸º <code>gdb.Value</code> å¯¹è±¡ï¼ŒåŒ…å«å¯¹è±¡çš„å…·ä½“å€¼ï¼Œç±»å‹ç­‰ä¿¡æ¯ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># struct box</span>
</span></span><span style=display:flex><span><span style=color:#75715e># {</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#     int a;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#     int b;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># };</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># using box_ptr = box *;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># using box_ref = box &amp;;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># box *b1 = new box{1, 2};</span>
</span></span><span style=display:flex><span><span style=color:#75715e># box b2 = box{3, 4};</span>
</span></span><span style=display:flex><span><span style=color:#75715e># box_ptr b3 = b1;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># box_ref b4 = b2;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>b1 <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>parse_and_eval(<span style=color:#e6db74>&#39;b1&#39;</span>)
</span></span><span style=display:flex><span>b2 <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>parse_and_eval(<span style=color:#e6db74>&#39;b2&#39;</span>)
</span></span><span style=display:flex><span>b3 <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>parse_and_eval(<span style=color:#e6db74>&#39;b3&#39;</span>)
</span></span><span style=display:flex><span>b4 <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>parse_and_eval(<span style=color:#e6db74>&#39;b4&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;address b1 </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, b2 </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, b3 </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, b4 </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(b1<span style=color:#f92672>.</span>address, b2<span style=color:#f92672>.</span>address, b3<span style=color:#f92672>.</span>address, b4<span style=color:#f92672>.</span>address))
</span></span><span style=display:flex><span>address b1 <span style=color:#ae81ff>0x7fffffffda58</span>, b2 <span style=color:#ae81ff>0x7fffffffda88</span>, b3 <span style=color:#ae81ff>0x7fffffffda60</span>, b4 <span style=color:#ae81ff>0x7fffffffda88</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;type b1 </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, b2 </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, b3 </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, b4 </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(b1<span style=color:#f92672>.</span>type, b2<span style=color:#f92672>.</span>type, b3<span style=color:#f92672>.</span>type, b4<span style=color:#f92672>.</span>type))
</span></span><span style=display:flex><span>type b1 box <span style=color:#f92672>*</span>, b2 box, b3 box_ptr, b4 box_ref
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(gdb) python print(b1<span style=color:#f92672>.</span>dereference())  
</span></span><span style=display:flex><span>{a <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>, b <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>}
</span></span><span style=display:flex><span>(gdb) python print(b2<span style=color:#f92672>.</span>dereference())  
</span></span><span style=display:flex><span>Traceback (most recent call last):
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;&lt;string&gt;&#34;</span>, line <span style=color:#ae81ff>1</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>gdb<span style=color:#f92672>.</span>error: Attempt to take contents of a non<span style=color:#f92672>-</span>pointer value<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>Error <span style=color:#66d9ef>while</span> executing Python code<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>(gdb) python print(b3<span style=color:#f92672>.</span>dereference())  
</span></span><span style=display:flex><span>{a <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>, b <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>}
</span></span><span style=display:flex><span>(gdb) python print(b4<span style=color:#f92672>.</span>dereference())  
</span></span><span style=display:flex><span>Traceback (most recent call last):
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;&lt;string&gt;&#34;</span>, line <span style=color:#ae81ff>1</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>gdb<span style=color:#f92672>.</span>error: Attempt to take contents of a non<span style=color:#f92672>-</span>pointer value<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>Error <span style=color:#66d9ef>while</span> executing Python code<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(gdb) python print(b1<span style=color:#f92672>.</span>referenced_value())
</span></span><span style=display:flex><span>{a <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>, b <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>}
</span></span><span style=display:flex><span>(gdb) python print(b2<span style=color:#f92672>.</span>referenced_value())
</span></span><span style=display:flex><span>Traceback (most recent call last):
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;&lt;string&gt;&#34;</span>, line <span style=color:#ae81ff>1</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>gdb<span style=color:#f92672>.</span>error: Trying to get the referenced value <span style=color:#f92672>from</span> a value which <span style=color:#f92672>is</span> neither a pointer nor a reference<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>Error <span style=color:#66d9ef>while</span> executing Python code<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>(gdb) python print(b3<span style=color:#f92672>.</span>referenced_value())
</span></span><span style=display:flex><span>{a <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>, b <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>}
</span></span><span style=display:flex><span>(gdb) python print(b4<span style=color:#f92672>.</span>referenced_value())
</span></span><span style=display:flex><span>{a <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>, b <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(gdb) python print(b1<span style=color:#f92672>.</span>reference_value())
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#ae81ff>0x7fffffffda58</span>
</span></span><span style=display:flex><span>(gdb) python print(b2<span style=color:#f92672>.</span>reference_value())
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#ae81ff>0x7fffffffda88</span>
</span></span><span style=display:flex><span>(gdb) python print(b3<span style=color:#f92672>.</span>reference_value())
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#ae81ff>0x7fffffffda60</span>
</span></span><span style=display:flex><span>(gdb) python print(b4<span style=color:#f92672>.</span>reference_value())
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#ae81ff>0x7fffffffda88</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(gdb) python print(b1<span style=color:#f92672>.</span>const_value())
</span></span><span style=display:flex><span><span style=color:#ae81ff>0x55555556d750</span>
</span></span><span style=display:flex><span>(gdb) python print(b2<span style=color:#f92672>.</span>const_value())
</span></span><span style=display:flex><span>{a <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>, b <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>}
</span></span><span style=display:flex><span>(gdb) python print(b3<span style=color:#f92672>.</span>const_value())
</span></span><span style=display:flex><span><span style=color:#ae81ff>0x55555556d750</span>
</span></span><span style=display:flex><span>(gdb) python print(b4<span style=color:#f92672>.</span>const_value())
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#ae81ff>0x7fffffffda88</span>
</span></span></code></pre></div></li><li><p><code>gdb.Type</code> ï¼Œç±»å‹ï¼ŒåŒ…å«ç±»å‹ä¿¡æ¯ï¼Œæ¯”å¦‚æŒ‡é’ˆï¼Œæ•°ç»„ï¼Œç»“æ„ä½“ç­‰ã€‚å¯ä»¥ä½¿ç”¨ lookup_type è½¬æ¢ç±»å‹ä¸º å†…ç½® gdb.Type å¯¹è±¡ã€‚ç„¶åä½¿ç”¨ gdb.Value.cast æ–¹æ³•è½¬æ¢ä¸ºæŒ‡å®šç±»å‹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>(gdb) p <span style=color:#f92672>*</span> best_path
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>3</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  type <span style=color:#f92672>=</span> T_ProjectionPath,
</span></span><span style=display:flex><span>  pathtype <span style=color:#f92672>=</span> T_Result,
</span></span><span style=display:flex><span>  parent <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x563e104048b0</span>,
</span></span><span style=display:flex><span>  pathtarget <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x563e10404780</span>,
</span></span><span style=display:flex><span>  param_info <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x0</span>,
</span></span><span style=display:flex><span>  parallel_aware <span style=color:#f92672>=</span> false,
</span></span><span style=display:flex><span>  parallel_safe <span style=color:#f92672>=</span> false,
</span></span><span style=display:flex><span>  parallel_workers <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>  rows <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>  startup_cost <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.047500000000000014</span>,
</span></span><span style=display:flex><span>  total_cost <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.052500000000000012</span>,
</span></span><span style=display:flex><span>  pathkeys <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x563e103fb180</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>(gdb) python path <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>parse_and_eval(<span style=color:#e6db74>&#39;best_path&#39;</span>)
</span></span><span style=display:flex><span>(gdb) python print(path<span style=color:#f92672>.</span>type)
</span></span><span style=display:flex><span>Path <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>(gdb) python print(gdb<span style=color:#f92672>.</span>lookup_type(<span style=color:#e6db74>&#39;ProjectionPath&#39;</span>)<span style=color:#f92672>.</span>pointer())
</span></span><span style=display:flex><span>ProjectionPath <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>(gdb) python print(gdb<span style=color:#f92672>.</span>lookup_type(<span style=color:#e6db74>&#39;ProjectionPath&#39;</span>)<span style=color:#f92672>.</span>reference())
</span></span><span style=display:flex><span>ProjectionPath <span style=color:#f92672>&amp;</span>
</span></span><span style=display:flex><span>(gdb) python print(path<span style=color:#f92672>.</span>cast(gdb<span style=color:#f92672>.</span>lookup_type(<span style=color:#e6db74>&#39;ProjectionPath&#39;</span>)<span style=color:#f92672>.</span>pointer())<span style=color:#f92672>.</span>type)
</span></span><span style=display:flex><span>ProjectionPath <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>(gdb) python print(path<span style=color:#f92672>.</span>cast(gdb<span style=color:#f92672>.</span>lookup_type(<span style=color:#e6db74>&#39;ProjectionPath&#39;</span>)<span style=color:#f92672>.</span>pointer())<span style=color:#f92672>.</span>referenced_value())
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  path <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    type <span style=color:#f92672>=</span> T_ProjectionPath,
</span></span><span style=display:flex><span>    pathtype <span style=color:#f92672>=</span> T_Result,
</span></span><span style=display:flex><span>    parent <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x563e104048b0</span>,
</span></span><span style=display:flex><span>    pathtarget <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x563e10404780</span>,
</span></span><span style=display:flex><span>    param_info <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x0</span>,
</span></span><span style=display:flex><span>    parallel_aware <span style=color:#f92672>=</span> false,
</span></span><span style=display:flex><span>    parallel_safe <span style=color:#f92672>=</span> false,
</span></span><span style=display:flex><span>    parallel_workers <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>    rows <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    startup_cost <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.047500000000000014</span>,
</span></span><span style=display:flex><span>    total_cost <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.052500000000000012</span>,
</span></span><span style=display:flex><span>    pathkeys <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x563e103fb180</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  subpath <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x563e10404668</span>,
</span></span><span style=display:flex><span>  dummypp <span style=color:#f92672>=</span> true
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><p><code>gdb.parse_and_eval</code> æ–¹æ³•ï¼Œå¯ä»¥è§£æè¡¨è¾¾å¼ï¼Œè·å–è¡¨è¾¾å¼çš„å€¼ã€‚ä¾‹å¦‚å…·ä½“çš„æŸä¸ªå˜é‡ï¼Œæˆ–è€…å‡½æ•°ç­‰ã€‚</p></li></ol><h3 id=è‡ªå®šä¹‰å‘½ä»¤>è‡ªå®šä¹‰å‘½ä»¤</h3><p>ç»§æ‰¿ gdb.Command ç±»ï¼Œå®ç° invoke æ–¹æ³•ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå° demo</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>(gdb) python
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HelloWorld</span> (gdb<span style=color:#f92672>.</span>Command):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span> (self):
</span></span><span style=display:flex><span>    super (HelloWorld, self)<span style=color:#f92672>.</span><span style=color:#a6e22e>__init__</span> (<span style=color:#e6db74>&#34;pp&#34;</span>, gdb<span style=color:#f92672>.</span>COMMAND_USER)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>invoke</span> (self, args, from_tty):
</span></span><span style=display:flex><span>    argv <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>string_to_argv (args)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len (argv) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>raise</span> gdb<span style=color:#f92672>.</span>GdbError (<span style=color:#e6db74>&#34;pp takes no arguments&#34;</span>)
</span></span><span style=display:flex><span>    print (argv)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>HelloWorld ()
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>end
</span></span><span style=display:flex><span>(gdb) pp
</span></span><span style=display:flex><span>pp takes no arguments
</span></span><span style=display:flex><span>(gdb) pp <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>[<span style=color:#e6db74>&#39;3&#39;</span>]
</span></span><span style=display:flex><span>(gdb)
</span></span></code></pre></div><h3 id=pretty-printer>pretty printer</h3><p>å¯¹äºå¤æ‚çš„å¤§å‹ç¨‹åºï¼Œ ç‰¹åˆ«æ˜¯ C ç¨‹åºï¼Œç”±äºä¸ç›´æ¥æ”¯æŒå¤šæ€ï¼Œæ‰€ä»¥ä¼šä½¿ç”¨ä¸€äº›å–å·§çš„æ–¹å¼ï¼Œä¾‹å¦‚ Postgres ä¸­ï¼Œå¤§éƒ¨åˆ†ç»“æ„ä½“éƒ½ç›´æ¥æˆ–è€…é—´æ¥çš„ç»§æ‰¿è‡ª Node ï¼Œå¤§éƒ¨åˆ†æŒ‡é’ˆ
ç›´æ¥å°±æ˜¯ä¸€ä¸ª <code>Node*</code>, ä¸ä¸€å±‚ä¸€å±‚å±•å¼€ï¼Œæ˜¯ä¸çŸ¥é“ <code>Node*</code> çš„æŒ‡é’ˆçš„ 8 å­—èŠ‚ä¸‹åˆ°åº•éšè—ç€ä»€ä¹ˆæ·±æ¸Šå·¨å…½ã€‚æœ‰æ—¶å€™å¯èƒ½ä¸ºäº†æŸ¥çœ‹æŸä¸ªæ‰§è¡Œè®¡åˆ’ä¸­çš„æŸä¸ªå­—æ®µå…·ä½“æ˜¯ä»€ä¹ˆï¼Œå¯èƒ½éœ€è¦åå¤çš„
è¿›è¡Œå¼ºè½¬æ‰“å°</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> p * <span style=color:#f92672>((</span>JoinPath*<span style=color:#f92672>)((</span>JoinPath*<span style=color:#f92672>)((</span>SortPath*<span style=color:#f92672>)(((</span>ProjectionPath*<span style=color:#f92672>)</span>best_path<span style=color:#f92672>)</span>-&gt;subpath<span style=color:#f92672>))</span>-&gt;subpath<span style=color:#f92672>)</span>-&gt;outerjoinpath<span style=color:#f92672>)</span>-&gt;outerjoinpath
</span></span><span style=display:flex><span>$25 <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  type <span style=color:#f92672>=</span> T_Path,
</span></span><span style=display:flex><span>  pathtype <span style=color:#f92672>=</span> T_SeqScan,
</span></span><span style=display:flex><span>  parent <span style=color:#f92672>=</span> 0x563e103ded10,
</span></span><span style=display:flex><span>  pathtarget <span style=color:#f92672>=</span> 0x563e103def18,
</span></span><span style=display:flex><span>  param_info <span style=color:#f92672>=</span> 0x0,
</span></span><span style=display:flex><span>  parallel_aware <span style=color:#f92672>=</span> false,
</span></span><span style=display:flex><span>  parallel_safe <span style=color:#f92672>=</span> true,
</span></span><span style=display:flex><span>  parallel_workers <span style=color:#f92672>=</span> 0,
</span></span><span style=display:flex><span>  rows <span style=color:#f92672>=</span> 1,
</span></span><span style=display:flex><span>  startup_cost <span style=color:#f92672>=</span> 0,
</span></span><span style=display:flex><span>  total_cost <span style=color:#f92672>=</span> 0,
</span></span><span style=display:flex><span>  pathkeys <span style=color:#f92672>=</span> 0x0
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>å½“ç„¶å¯ä»¥ä½¿ç”¨ pprint ï¼Œä½†æ˜¯ pprint åªèƒ½æ‰“å°ç»§æ‰¿è‡ª Node çš„å¯¹è±¡ï¼Œå¯¹äºå…¶ä»–ç±»å‹ï¼Œpprint åˆ™æ— èƒ½ä¸ºåŠ›ï¼Œè€Œä¸” pprint æœ€å¤§çš„ç¼ºç‚¹æ˜¯æ— æ³•åœ¨ core æ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œæ­¤æ—¶ä¼šæç¤º <code>You can't do that without a process to debug.</code></p><p>æ­¤å¤–éƒ¨åˆ†äººåº”è¯¥ä½¿ç”¨è¿‡ <a href=https://github.com/tvondra/gdbpg.git target=_blank>https://github.com/tvondra/gdbpg.git</a>
è¿™ä¸ªç¨‹åºï¼Œå¯èƒ½ä¹Ÿé’ˆå¯¹ç‰¹å®šçš„ postgres ç‰ˆæœ¬åšäº†ä¸€äº›å®šåˆ¶ã€‚
æˆ‘å½“å‰æ‰€åœ¨å…¬å¸æ˜¯æŸä¸ª pg çš„è¡ç”Ÿæ•°æ®åº“ï¼Œ æˆ‘ä¹Ÿæƒ³ä½¿ç”¨è¿™ä¸ªè„šæœ¬åšä¸‹æ‰©å±•ï¼Œæ–¹ä¾¿è‡ªå·±ä½¿ç”¨ï¼Œä½†æ˜¯æŸå¤©çªç„¶æƒ³è°ƒè¯•ä¸‹å…¶ä»– pg ç±»æ•°æ®åº“ï¼Œä¾‹å¦‚ gpï¼Œ tbase å•¥çš„ï¼Œæ­¤æ—¶ä¹Ÿéœ€è¦å†å–è¿›è¡Œæ‰©å±•ï¼Œä½†æ˜¯ç”±äºä¸æ˜¯å¤ªç†Ÿæ‚‰ï¼Œä¸€æ—¶ä¹‹é—´ä¸çŸ¥é“ä»€ä¹ˆè¯¥æ‰“å°ï¼Œä»€ä¹ˆä¸è¯¥æ‰“å°ï¼Œä¸­é—´å®¹æ˜“é‡åˆ°é—®é¢˜ï¼Œå¼„æ¥å¼„å»å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥å°±æ”¾å¼ƒäº†ã€‚</p><p>å¥½åœ¨ gdb æä¾› pretty printer æœºåˆ¶ï¼Œå¯ä»¥è‡ªå®šä¹‰æ‰“å°æ–¹æ³•ï¼ŒC++ çš„ STL åº“å°±æä¾›äº†å¯¹åº”çš„ python è„šæœ¬ï¼Œå…·ä½“æ–‡ä»¶åœ¨ <code>/usr/share/gcc/python/libstdcxx/v6</code> ç›®å½•ä¸‹ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹æ€ä¹ˆæ˜¯å®ç°çš„ã€‚</p><p>ä¸‹é¢æ˜¯åœ¨å®ç° <a href=https://github.com/askyx/pretty_printer.git target=_blank>postgres pretty printer</a>
çš„åŠŸèƒ½ä¸­çš„ä¸€äº›é—®é¢˜å’Œæ€è€ƒã€‚</p><p>é¦–å…ˆæ˜¯å®˜æ–¹çš„ä¸€ä¸ªå° demo ï¼Œ åšäº†ç‚¹å°ä¿®æ”¹ï¼Œæ–¹ä¾¿ç†è§£ä¸‹é¢çš„è®²è§£</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>struct foo { int a, b; };
</span></span></span><span style=display:flex><span><span style=color:#e6db74>struct bar { struct foo x, y; };
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> gdb
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>fooPrinter</span>:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Print a foo object.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self, val):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>__val <span style=color:#f92672>=</span> val
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_string</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (<span style=color:#e6db74>&#34;a=&lt;&#34;</span> <span style=color:#f92672>+</span> str(self<span style=color:#f92672>.</span>__val[<span style=color:#e6db74>&#34;a&#34;</span>]) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;&gt; b=&lt;&#34;</span> <span style=color:#f92672>+</span> str(self<span style=color:#f92672>.</span>__val[<span style=color:#e6db74>&#34;b&#34;</span>]) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&gt;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>barPrinter</span>:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Print a bar object.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self, val):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>__val <span style=color:#f92672>=</span> val
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_string</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (<span style=color:#e6db74>&#34;x=&lt;&#34;</span> <span style=color:#f92672>+</span> str(self<span style=color:#f92672>.</span>__val[<span style=color:#e6db74>&#34;x&#34;</span>]) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;&gt; y=&lt;&#34;</span> <span style=color:#f92672>+</span> str(self<span style=color:#f92672>.</span>__val[<span style=color:#e6db74>&#34;y&#34;</span>]) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&gt;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>build_pretty_printer</span>():
</span></span><span style=display:flex><span>    pp <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>printing<span style=color:#f92672>.</span>RegexpCollectionPrettyPrinter(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;my_library&#34;</span>)
</span></span><span style=display:flex><span>    pp<span style=color:#f92672>.</span>add_printer(<span style=color:#e6db74>&#39;foo&#39;</span>, <span style=color:#e6db74>&#39;^foo$&#39;</span>, fooPrinter)
</span></span><span style=display:flex><span>    pp<span style=color:#f92672>.</span>add_printer(<span style=color:#e6db74>&#39;bar&#39;</span>, <span style=color:#e6db74>&#39;^bar$&#39;</span>, barPrinter)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> pp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gdb<span style=color:#f92672>.</span>printing<span style=color:#f92672>.</span>register_pretty_printer(
</span></span><span style=display:flex><span>    gdb<span style=color:#f92672>.</span>current_objfile(),
</span></span><span style=display:flex><span>    build_pretty_printer())
</span></span></code></pre></div><h4 id=1-gdb-pretty-printer-å®ç°åŸç†>1. gdb pretty printer å®ç°åŸç†</h4><p>å…·ä½“å‚è€ƒ gdb æºç ä¸­çš„ <code>py-prettyprint.c</code> å’Œ <code>printing.py</code> æ–‡ä»¶ï¼Œå¤§æ„æ˜¯ï¼š</p><ol><li><p>å‘ <code>gdb.pretty_printers</code> ä¸­æ³¨å†Œä¸€ä¸ª printerï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè¿™æ­¥ç”± <code>register_pretty_printer</code> å®ç°ï¼Œ <code>register_pretty_printer</code> ä¼šæŠŠ <code>RegexpCollectionPrettyPrinter</code> å¯¹è±¡æ·»åŠ åˆ° <code>gdb.pretty_printers</code> ä¸­ï¼Œå¯ä»¥æŸ¥çœ‹ å¯¹åº”çš„ gdb ä¸­çš„æºç ï¼Œå…¶å®ç°æ ¸å¿ƒæ˜¯ <code>obj.pretty_printers.insert(0, printer)</code></p></li><li><p>æ³¨å†Œçš„è¿™ä¸ª printer å¿…é¡»å®ç° <code>__call__</code>ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ gdb å†…ç½®çš„ <code>RegexpCollectionPrettyPrinter</code> æˆ–è€… STL åº“ä¸­çš„ <code>Printer</code> ç­‰ã€‚å…¶å†…éƒ¨ä¸»è¦æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«å…·ä½“çš„å¯¹åº”æŸç±»å‹çš„ printerï¼Œ
gdb åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œåœ¨ <code>__call__</code>ä¸­ï¼Œè·å– Value çš„ typeï¼Œ ç„¶åç”±è¿™ä¸ª type æ‰¾åˆ°æ•°ç»„ä¸­å…·ä½“çš„ printer ç±»ï¼Œç„¶åæ„é€ ä¸€ä¸ªå¯¹è±¡è¿”å›</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__call__</span>(self, val):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Lookup the pretty-printer for the provided value.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Get the type name.</span>
</span></span><span style=display:flex><span>        typename <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>types<span style=color:#f92672>.</span>get_basic_type(val<span style=color:#f92672>.</span>type)<span style=color:#f92672>.</span>tag
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> typename:
</span></span><span style=display:flex><span>            typename <span style=color:#f92672>=</span> val<span style=color:#f92672>.</span>type<span style=color:#f92672>.</span>name
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> typename:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Iterate over table of type regexps to determine</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># if a printer is registered for that type.</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Return an instantiation of the printer if found.</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> printer <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>subprinters:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> printer<span style=color:#f92672>.</span>enabled <span style=color:#f92672>and</span> printer<span style=color:#f92672>.</span>compiled_re<span style=color:#f92672>.</span>search(typename):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> printer<span style=color:#f92672>.</span>gen_printer(val)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Cannot find a pretty printer.  Return None.</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>
</span></span></code></pre></div></li><li><p>å¯¹äºå…·ä½“ç±»å‹çš„ printerï¼Œéœ€è¦å®ç° <code>to_string</code> æ–¹æ³•ï¼Œå¯é€‰çš„ä¸º <code>children</code> å’Œ <code>display_hint</code> æ–¹æ³•ç­‰ï¼Œå…·ä½“è¯´æ˜å‚è€ƒ<a href=https://sourceware.org/gdb/current/onlinedocs/gdb.html/Pretty-Printing-API.html#Pretty-Printing-API target=_blank>å®˜æ–¹æ–‡æ¡£</a>
ï¼Œè¿™æ˜¯æˆ‘ä»¬å®ç°è‡ªå®šä¹‰ pretty printer çš„å…³é”®æ­¥éª¤ã€‚åœ¨ gdb ä¸­ï¼Œè·å– printer å¯¹è±¡ä¹‹åï¼Œ å…¶å†…éƒ¨ä¼šä½¿ç”¨ C ä»£ç è°ƒç”¨å¯¹è±¡çš„å®ç°çš„å‡½æ•°ï¼Œå®ç°æ‰“å°åŠŸèƒ½ï¼Œå…·ä½“å‡½æ•°ä¸º <code>pretty_print_one_value</code></p></li></ol><h4 id=2-å®ç°è‡ªå®šä¹‰-pretty-printer>2. å®ç°è‡ªå®šä¹‰ pretty printer</h4><p>æˆ‘ä»¬å¯ä»¥ä»¿ç…§ demo å®ç°è‡ªå®šä¹‰ printerï¼Œä½†æ˜¯åœ¨ pg REL_16_STABLE ä¸­ï¼Œ nodetags.h ä¸­å®šä¹‰äº† 454 ä¸ªç±»å‹ï¼Œå¦‚æœä¸€ä¸€å®ç°æ˜¯ä¸ç°å®çš„ï¼Œæ­¤å¤–è¿˜å¾—å…¼é¡¾ä¸åŒçš„ç‰ˆæœ¬ï¼Œä¸åŒçš„ pg ç±»æ•°æ®åº“ç­‰ã€‚æƒ³æƒ³åœ¨ gdb è°ƒè¯•ä¸­ï¼Œ çªç„¶å‘ç°æŸä¸ªç±»å‹æ— æ³•æ‰“å°ï¼Œç”šè‡³å‡ºé”™äº†å¯¼è‡´ gdb å´©æ‰çš„æƒ…å†µï¼Œå¥½å¥½çš„æ€è·¯å°±è¿™ä¹ˆå‘—æ‰“æ–­äº†ï¼ŒçœŸçš„æ— æ³•å¿å—ï¼Œä¸ºäº†å¯ä»¥å¿«é€Ÿå®ç° printer æ·»åŠ ä¿®æ”¹ï¼Œè¿™é‡Œå®ç°çš„å…¶å®ä¸æ˜¯ pretty printerï¼Œ è€Œåº”è¯¥æ˜¯ pretty printer generator</p><ol><li><p>å¿«é€Ÿæ·»åŠ ä¸€ä¸ª printer</p><p>å¦‚ demo ä¸­ï¼Œ å®ç°å…·ä½“çš„ printer ä¹‹åï¼Œ ä½¿ç”¨ add_printer æ·»åŠ åˆ° RegexpCollectionPrettyPrinter ä¸­ï¼Œ å¦‚æœæœ‰å‡ ç™¾ä¸Šåƒä¸ªç±»å‹ï¼Œ æ‰‹åŠ¨æ·»åŠ ä¼šå¾ˆéº»çƒ¦ï¼Œ æ‰€ä»¥å¯ä»¥å†™ä¸€ä¸ªè£…é¥°å™¨ï¼Œ è‡ªåŠ¨æ³¨å†Œ printerï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span>printer <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>printing<span style=color:#f92672>.</span>RegexpCollectionPrettyPrinter(<span style=color:#e6db74>&#39;REL_16_STABLE&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>register_printer</span>(name):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__registe</span>(_printer):
</span></span><span style=display:flex><span>        printer<span style=color:#f92672>.</span>add_printer(name, <span style=color:#e6db74>&#39;^&#39;</span> <span style=color:#f92672>+</span> name <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;$&#39;</span>, _printer)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> __registe
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@register_printer</span>(<span style=color:#e6db74>&#39;Relids&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RelidsPrinter</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self, val) <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>val <span style=color:#f92672>=</span> val
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_string</span>(self):
</span></span><span style=display:flex><span>        list <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>        rid <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>parse_and_eval(<span style=color:#e6db74>&#39;bms_next_member((</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>) </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, -1)&#39;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>val<span style=color:#f92672>.</span>type<span style=color:#f92672>.</span>pointer(), self<span style=color:#f92672>.</span>val<span style=color:#f92672>.</span>dereference()<span style=color:#f92672>.</span>address))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> rid <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            list<span style=color:#f92672>.</span>append(int(rid))
</span></span><span style=display:flex><span>            rid <span style=color:#f92672>=</span> gdb<span style=color:#f92672>.</span>parse_and_eval(<span style=color:#e6db74>&#39;bms_next_member((</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>) </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>, </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>)&#39;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>val<span style=color:#f92672>.</span>type<span style=color:#f92672>.</span>pointer(), self<span style=color:#f92672>.</span>val<span style=color:#f92672>.</span>dereference()<span style=color:#f92672>.</span>address, rid))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> str(list)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gdb<span style=color:#f92672>.</span>printing<span style=color:#f92672>.</span>register_pretty_printer(
</span></span><span style=display:flex><span>    gdb<span style=color:#f92672>.</span>current_objfile(),
</span></span><span style=display:flex><span>    printer, <span style=color:#66d9ef>True</span>)
</span></span></code></pre></div></li><li><p>å®ç° printer generatorï¼Œæ€ä¹ˆåŠ¨æ€ç”Ÿæˆï¼Œæ€ä¹ˆè·å–æƒ³è¦æ‰“å°å¯¹è±¡çš„ç»“æ„</p><p>å¦‚æœä¸è¦æ±‚ä¸ªæ€§åŒ–ï¼Œåˆ™å¤§éƒ¨åˆ†çš„ printer æ˜¯ç±»ä¼¼çš„ï¼Œä¾‹å¦‚ FuncExpr ï¼Œæ‰‹å†™çš„è¯å¤§æ¦‚ç±»ä¼¼è¿™ä¸ª</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@register_printer</span>(<span style=color:#e6db74>&#39;FuncExpr&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FuncExprPrinter</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self, val) <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>val <span style=color:#f92672>=</span> val
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_string</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;FuncExpr[funcid: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, funcresulttype: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, funcretset: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, funcvariadic: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, funcformat: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, funccollid: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, inputcollid: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>]&#39;</span> <span style=color:#f92672>%</span> (
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>val[<span style=color:#e6db74>&#39;funcid&#39;</span>],
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>val[<span style=color:#e6db74>&#39;funcresulttype&#39;</span>],
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>val[<span style=color:#e6db74>&#39;funcretset&#39;</span>],
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>val[<span style=color:#e6db74>&#39;funcvariadic&#39;</span>],
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>val[<span style=color:#e6db74>&#39;funcformat&#39;</span>],
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>val[<span style=color:#e6db74>&#39;funccollid&#39;</span>],
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>val[<span style=color:#e6db74>&#39;inputcollid&#39;</span>]
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>children</span>(self):
</span></span><span style=display:flex><span>        list <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>        add_list(list, self<span style=color:#f92672>.</span>val, <span style=color:#e6db74>&#39;args&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> list
</span></span></code></pre></div><p>pg Node ç»“æ„ä½“è¦æ±‚å…¶å­ç±»å®ç°ä¸€äº›ç‰¹å®šå‡½æ•°ï¼Œ ä»¥ä¾¿äº pg å®ç°ç‰¹å®šçš„åŠŸèƒ½ï¼Œä¾‹å¦‚ read, writeç­‰ï¼Œä¹‹å‰éƒ½æ˜¯ write by hand ï¼Œåé¢å®ç°äº†ä¸€ä¸ªè„šæœ¬ <code>gen_node_support.pl</code>ï¼Œç”¨æ¥å¤„ç†è¿™ä¸ªé‡å¤çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬åªéœ€è¦ç¨å¾®æ”¹åŠ¨ä¸‹è¿™ä¸ªæ–‡ä»¶ï¼ŒæŠŠç»“æ„ä½“å¯¼å‡ºå³å¯ï¼Œç„¶åå†ç¨å¾®å¤„ç†ä¸‹ï¼Œ å°±è·å¾—äº†æˆ‘ä»¬æƒ³è¦çš„æ ¼å¼ï¼Œå½“å‰æ‰€æœ‰çš„å¯æ‰“å°çš„ç»“æ„ä½“éƒ½åœ¨ <code>node_struct.py</code> ä¸­</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>RangeVar <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;char*&#39;</span>, <span style=color:#e6db74>&#39;catalogname&#39;</span>),
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;char*&#39;</span>, <span style=color:#e6db74>&#39;schemaname&#39;</span>),
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;char*&#39;</span>, <span style=color:#e6db74>&#39;relname&#39;</span>),
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;bool&#39;</span>, <span style=color:#e6db74>&#39;inh&#39;</span>),
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;char&#39;</span>, <span style=color:#e6db74>&#39;relpersistence&#39;</span>),
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;Alias*&#39;</span>, <span style=color:#e6db74>&#39;alias&#39;</span>),
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;int&#39;</span>, <span style=color:#e6db74>&#39;location&#39;</span>),
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>å¦‚æœä»¿ç…§ FuncExpr å®ç°ä¸€ä¸ª RangeVarPrinterï¼Œç»“æ„æ˜¯ç±»ä¼¼çš„ï¼Œæ‰€ä»¥å¯ä»¥å®ç°ä¸€ä¸ªå…¬æœ‰æ–¹æ³•ï¼Œè§£æè¿™ä¸ªç»“æ„ä½“ï¼ŒæŠŠæŒ‡é’ˆå’Œå…¶ä»–ç±»å‹åŒºåˆ†å¼€ï¼ŒæŒ‡é’ˆæ”¾åœ¨ children ä¸­æ‰“å°ï¼Œå…¶ä»–çš„æ”¾åœ¨ to_string ä¸­æ‰“å°å³å¯ï¼Œå¯ä»¥å‚è€ƒ <a href=https://github.com/askyx/pretty_printer.git target=_blank>postgres pretty printer</a>
ä¸­çš„ <code>split_field</code> å‡½æ•°å’Œ <code>print_to_string</code> ï¼Œ<code>print_children</code>ï¼Œå¤§éƒ¨åˆ†é€»è¾‘åœ¨ BasePrinter ç±»ä¸‹é¢</p></li><li><p>æ€ä¹ˆå¤„ç†ç»§æ‰¿å…³ç³»</p><p>å¯¹äºç»§æ‰¿å…³ç³»ï¼Œä¸ºäº†æ–¹ä¾¿å¤„ç†ï¼Œå¯¹åº”å­ç±»çš„ç»“æ„ä½“ä¸­éœ€è¦åŠ ä¸Šçˆ¶ç±»ç»“æ„ä½“çš„å­—æ®µï¼Œåœ¨ python ä¸­è·å–å€¼å¾—æ—¶å€™ï¼Œè§£æå­—æ®µä¸ºæ•°ç»„ï¼Œç„¶åä½¿ç”¨ç±»ä¼¼ <code>val['path']['pathtype']</code> çš„è¯­æ³•æ¥è·å–ï¼Œä½†æ˜¯ç»§æ‰¿çš„æ·±åº¦ä¸ç¡®å®šï¼Œä¾‹å¦‚ <code>('NodeTag', 'jpath.path.pathtype'),</code>ï¼Œæ‰€ä»¥éœ€è¦åŠ¨æ€è·å–ï¼Œè¿™é‡Œä½¿ç”¨ python çš„ reduce å‡½æ•° <code>reduce(operator.getitem, fields, self.val)</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>IndexPath <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;NodeTag&#39;</span>, <span style=color:#e6db74>&#39;path.pathtype&#39;</span>),
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;RelOptInfo*&#39;</span>, <span style=color:#e6db74>&#39;path.parent&#39;</span>),
</span></span><span style=display:flex><span>  <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;ScanDirection&#39;</span>, <span style=color:#e6db74>&#39;indexscandir&#39;</span>),
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;Cost&#39;</span>, <span style=color:#e6db74>&#39;indextotalcost&#39;</span>),
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;Selectivity&#39;</span>, <span style=color:#e6db74>&#39;indexselectivity&#39;</span>),
</span></span><span style=display:flex><span>]
</span></span></code></pre></div></li><li><p>æ€ä¹ˆæ‰“å° æ•°ç»„</p><p>å¯¹äºæ•°ç»„ï¼Œå…¸å‹çš„å°±æ˜¯ Sort ä¸­çš„ key çš„æ“ä½œç¬¦ä¿¡æ¯ï¼Œè¿™é‡Œéœ€è¦åœ¨ç»“æ„ä½“ä¸­æ ‡æ˜é•¿åº¦ä¿¡æ¯ï¼Œ ç„¶åè§£æé•¿åº¦ï¼Œå†ä½¿ç”¨é•¿åº¦è·å–å¯¹åº”å­—æ®µä¿¡æ¯ï¼Œå…·ä½“å‚è€ƒ <code>print_children_array</code> å‡½æ•°</p></li><li><p>ç‰¹æ®Šå‡½æ•°</p><p>ä¸€äº›ç‰¹æ®Šç»“æ„ä½“ï¼Œæ— æ³•ä½¿ç”¨ä¸Šé¢å¾—æ–¹æ³•å®ç°ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦è‡ªå·±æ‰‹å†™ï¼Œä¾‹å¦‚ List ï¼ŒBitmapset ä»¥åŠ Value ç­‰</p></li></ol><h4 id=3-åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šå¿«é€Ÿæ·»åŠ æˆ–ä¿®æ”¹ç»“æ„ä½“>3. åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šå¿«é€Ÿæ·»åŠ æˆ–ä¿®æ”¹ç»“æ„ä½“</h4><p><code>gen_node_support.pl</code> æ˜¯æ¯”è¾ƒæ–°çš„ pg ç‰ˆæœ¬ä¸Šæ‰ä¼šæœ‰çš„ï¼Œæ‰€ä»¥å…¶ä»–ç‰ˆæœ¬æ— æ³•ç›´æ¥ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶å¤„ç†ç»“æ„ä½“ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±æ‰‹åŠ¨æŸ¥æ‰¾ä¿®æ”¹ï¼Œè™½ç„¶å„ä¸ªç‰ˆæœ¬ä¹‹é—´å·®å¼‚ç‚¹ä¸å¤§ï¼Œä½†æ˜¯ä»å‡ ç™¾ä¸ªç»“æ„ä½“é‡Œé¢æ‰¾ä¸åŒè¿˜æ˜¯æŒºéš¾çš„ï¼Œä¸ºäº†æ–¹ä¾¿å¿«é€Ÿçš„æ·»åŠ æˆ–ä¿®æ”¹ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ª trace æ–‡ä»¶ï¼Œç±»ä¼¼ pstackï¼ŒæŒ‰ç…§è‡ªå·±çš„å…·ä½“çš„æ–‡ä»¶æ·»åŠ  æ–­ç‚¹ï¼Œattach ä¸Šè¿›ç¨‹ä¹‹åï¼Œæ‰“å°å…³é”® ç»“æ„ä½“ï¼Œå³å¯å¿«é€ŸæŸ¥æ‰¾å‡ºå·®å¼‚ç‚¹ï¼Œ ç„¶åå¿«é€Ÿä¿®æ”¹ï¼Œå½“å‰æ˜¯ä½¿ç”¨ tpch çš„è¯­å¥ æµ‹è¯•çš„ï¼Œæš‚æ—¶æ²¡æœ‰ä½¿ç”¨å…¶ä»–å¤æ‚è¯­å¥æˆ–ç±»å‹æµ‹è¯•ï¼Œåç»­å‘ç°äº†å†æ…¢æ…¢æ·»åŠ ä¿®æ”¹ï¼Œè¿™é‡Œåº”è¯¥å¯ä»¥è¦†ç›–å¤§éƒ¨åˆ†å¸¸ç”¨åœºæ™¯äº†</p><ul><li>trace æ–‡ä»¶è¿˜å¯ä½œä¸ºæ—¥å¸¸çš„è°ƒè¯•å·¥å…·ï¼Œå¦‚æœåªæ˜¯æƒ³ç®€å•è°ƒè¯•ï¼Œæ— éœ€æ‰‹å·¥æ¥å…¥çš„è¯ï¼Œå¯ä»¥ç›´æ¥ attach ä¸Šï¼Œç›´æ¥æ·»åŠ è‡ªå·±æƒ³è¦trace çš„ä¿¡æ¯å³å¯</li></ul><h4 id=attention>attention</h4><ul><li><p>å½“å‰æ”¯æŒçš„æ˜¯å››ä¸ªç­‰çº§ï¼Œä½¿ç”¨ <code>print pg_pretty</code> æ§åˆ¶</p><ul><li>off ä¸ºå…³é—­æ‰“å°</li><li>origin ä¼šä½¿ç”¨ pprint æ‰“å°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ç”±äºæ— æ³•ç¡®å®š print çš„æ—¶å€™ï¼ŒæŒ‡é’ˆå…·ä½“æ˜¯ä»€ä¹ˆç±»å‹ï¼Œ ä¹Ÿä¸æƒ³ä¸ºæ¯ä¸ªç±»å‹å†™ä¸ªæ­£åˆ™ï¼Œ æ‰€ä»¥åªèƒ½æŠŠæŒ‡é’ˆè½¬æ¢ä¸º Node ä¹‹åå†æ‰“å°ï¼Œä¾‹å¦‚<code>p *(Node*) best_path</code>ï¼Œ
éœ€è¦æ³¨æ„çš„æ˜¯ pprint æ˜¯ builtin functionï¼Œæ‰€ä»¥å¦‚æœæ˜¯è°ƒè¯• core æ–‡ä»¶ï¼Œæ˜¯æ— æ³•ä½¿ç”¨æ­¤ç­‰çº§çš„</li><li>trace ä¼šä½¿ç”¨ python è„šæœ¬ä¸­å®ç°çš„ printer ï¼Œé¢„å…ˆè®¾è®¡æ˜¯å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼Œä½†æ˜¯å½“å‰ Bitmapset ä½¿ç”¨äº† pg å†…ç½®çš„ bmsToString å‡½æ•°ï¼Œæš‚æ—¶æ— æ³•ç›´æ¥åœ¨è°ƒè¯• core çš„æ—¶å€™ä½¿ç”¨ï¼Œè¿™é‡Œæš‚æ—¶æ²¡æœ‰è¿™ä¸ªéœ€æ±‚ï¼Œæ‰€ä»¥å°±å…ˆæš‚æ—¶æç½®ï¼Œä»¥åéœ€è¦çš„æ—¶å€™å†å®ç°ã€‚è¿™é‡Œå…¶å®ä¹Ÿç®€å•å°è¯•è¿‡ï¼Œ å®ç°çš„ <code>bms_next_member</code> å‡½æ•°å•ç‹¬ä½¿ç”¨çš„æ—¶å€™è¿˜æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ï¼Œä½†æ˜¯å¾ªç¯ä½¿ç”¨çš„æ—¶å€™ä¼šæ­»å¾ªç¯ï¼Œ ä¸çŸ¥é“ä¸ºå•¥ã€‚ã€‚çŸ¥é“æ˜¯ bug è¿˜æ˜¯å®ç°æœ‰é—®é¢˜ï¼Œåé¢å†çœ‹</li><li>info ç®€åŒ–æ‰“å°ä¿¡æ¯ï¼Œå®ç°ç±»ä¼¼ explain çš„è¾“å‡ºçš„æ ·å¼ï¼Œä½†æ˜¯è¿™ä¸ªéœ€è¦æ‰‹å†™ï¼Œæš‚æ—¶æ²¡æœ‰å®ç°ã€‚é¢„ä¼°éš¾ç‚¹å’ŒåŠŸèƒ½ä¸º<ol><li>æ ¼å¼æ˜¯ä»€ä¹ˆ</li><li>printer ä¹‹é—´æ— æ³•ä¼ é€’ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œç±»ä¼¼ Var è¿™ç§ç»“æ„ä½“ä¸çŸ¥é“å½’å±ï¼Œå¯èƒ½éœ€è¦è‡ªå·±æ”¹é€  <code>RegexpCollectionPrettyPrinter</code></li><li>å•ç‹¬æ‰“å°æŸä¸ªç»“æ„ä½“çš„æ—¶å€™ï¼Œèƒ½å¦èƒ½ä»æŸä¸ªåœ°æ–¹è·å–æŸäº›ä¿¡æ¯ï¼Œä¾‹å¦‚ PlannerInfo ä¸­çš„ simple_rel_array</li></ol></li></ul></li><li><p>å®ç°ä¸­æ³¨æ„ç›¸äº’å¼•ç”¨é—®é¢˜ï¼Œ å…¸å‹çš„ä¾‹å¦‚ RestrictInfoï¼Œä¸€äº›ç»“æ„ä½“ä¸­çš„å­—æ®µå¯èƒ½ä¿å­˜çš„ä¸Šå±‚çš„æŸä¸ªç»“æ„ä½“ï¼Œæ­¤æ—¶ä¸èƒ½æ‰“å°</p></li></ul><h4 id=todo>TODO</h4><ol><li>å®Œå–„åŠŸèƒ½ï¼Œæ”¯æŒæ›´å¤šç»“æ„ä½“ï¼Œæ”¯æŒæ›´å¤šçš„ç±»å‹</li><li>æŠ½å–å…¬å…±éƒ¨åˆ†ï¼Œæé«˜å¤ç”¨æ€§ï¼Œå®ç°ä¸€ä¸ª gdb pretty printer generatorï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆ printerï¼Œ å¹¶ä¸”å¯ä»¥æŒ‡å®šç»“æ„ä½“çš„ç‰ˆæœ¬ï¼Œè‡ªåŠ¨å¤„ç†ç»§æ‰¿å…³ç³»ï¼Œè‡ªåŠ¨å¤„ç†æ•°ç»„ç­‰ï¼Œä»¥æ”¯æŒé™¤ pg ä¹‹å¤–çš„å…¶ä»–é¡¹ç›®</li><li>æ˜¯å¦éœ€è¦å®ç°ä¸€ä¸ª pg æ’ä»¶ï¼Œé…åˆä½¿ç”¨ï¼Œpython æ— æ³•å®ç°çš„åŠŸèƒ½åœ¨æ’ä»¶ä¸­å®ç°ï¼Œç„¶åä½¿ç”¨ python æ¥è°ƒç”¨</li><li>å®Œå–„æµ‹è¯•ï¼Œç›®å‰åªæ˜¯ç®€å•æµ‹è¯•äº†å‡ ä¸ªç»“æ„ä½“ï¼Œåç»­éœ€è¦æµ‹è¯•æ›´å¤šçš„ç»“æ„ä½“ï¼ŒåŒ…æ‹¬å¤æ‚çš„ç»“æ„ä½“ï¼Œä¾‹å¦‚å¤æ‚çš„æŸ¥è¯¢è®¡åˆ’ï¼Œå¤æ‚çš„å‡½æ•°è°ƒç”¨ï¼Œå¤æ‚çš„è¡¨è¾¾å¼ç­‰ç­‰</li><li>å®Œå–„æ–‡æ¡£ï¼ŒåŒ…æ‹¬ READMEï¼Œ å¦‚ä½•ä½¿ç”¨ï¼Œå¦‚ä½•å¼€å‘ï¼Œå¦‚ä½•æµ‹è¯•ç­‰ç­‰</li><li>ä½¿ç”¨ç³»ç»Ÿå‡½æ•°è·å–æŸäº›å…ƒæ•°æ®ä¿¡æ¯ï¼Œæ˜¯å¦ä¼šå½±å“ç¨‹åºçš„è¿è¡Œï¼ŒåŸæ¥çš„ç¼“å­˜æ˜¯å¦ä¼šè¢«æ±¡æŸ“ï¼Œæ˜¯å¦éœ€è¦æ”¯æŒé«˜çš„ç­‰çº§</li></ol><ul><li>é¡¹ç›®è¿˜åœ¨æ¼”åŒ–ä¸­ï¼ŒæŸäº›åŠŸèƒ½å¯èƒ½ä¼šå˜</li></ul><h3 id=auto-load>auto load</h3><p>gdb çš„ auto-load æœºåˆ¶ï¼Œå¯ä»¥å®ç°åœ¨ gdb å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨åŠ è½½æŒ‡å®šçš„è„šæœ¬ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ‰‹åŠ¨ source äº†ã€‚ä¸”å¯ä»¥é™åˆ¶åŠ è½½çš„èŒƒå›´ï¼ŒåªåŠ è½½æŒ‡å®šçš„ç¨‹åºã€‚å¦‚æœæ²¡æœ‰é™å®š pretty printer çš„ä½¿ç”¨èŒƒå›´ ï¼Œ ç›´æ¥åœ¨ .gdbinit ä¸­ source python è„šæœ¬ï¼Œåˆ™è„šæœ¬å†…å®¹æ˜¯å…¨å±€çš„ï¼Œæ­¤æ—¶ä»»ä½•çš„ç¨‹åºåªè¦æœ‰ç›¸åŒåå­—çš„ç»“æ„ä½“ï¼Œéƒ½ä¼šè§¦å‘ prtty printerã€‚ä½†æ˜¯å…·ä½“çš„ç»“æ„ä½“å†…å®¹ä¸ä¸€æ ·ï¼Œç›´æ¥ä½¿ç”¨æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ‰€ä»¥å¯¹äºè‡ªå·±çš„ pretty printer ï¼Œè¿˜æ˜¯æœ‰å¿…è¦é™å®šä½¿ç”¨èŒƒå›´ã€‚</p><pre tabindex=0><code class=language-gdb data-lang=gdb>(gdb) info pretty-printer
global pretty-printers:
  builtin
    mpx_bound128
  REL_16_STABLE
    (Node|Expr)
    A_ArrayExpr
    A_Const
    A_Expr
    A_Indices
    A_Indirection
    A_Star
    AccessPriv
    Agg
    AggPath
    Aggref
    Alias
</code></pre><p>è¯¦æƒ…å‚è€ƒ<a href=https://sourceware.org/gdb/current/onlinedocs/gdb.html/Auto_002dloading-extensions.html#Auto_002dloading-extensions target=_blank>å®˜æ–¹æ–‡æ¡£</a>
ï¼Œè¿™é‡Œä¸å¤šèµ˜è¿°ï¼Œé‡ç‚¹æ€»ç»“ä¸‹</p><ol><li><p>auto-load è„šæœ¬çš„åç§°ï¼Œéœ€è¦åŒ¹é…ä½ æƒ³åŠ¨æ€åŠ è½½çš„æ–‡ä»¶çš„åç§°ï¼Œä¾‹å¦‚çš„ <code>libstdc++.so.6.0.31</code> æ–‡ä»¶ï¼ŒåŒ¹é…çš„æ–‡ä»¶åç§°ä¸º <code>libstdc++.so.6.0.31-gdb.py</code>ã€‚å½“ç„¶ç”±äº gdb çš„è„šæœ¬æ–‡ä»¶ä¸ä»…ä»…åªæ”¯æŒ pythonï¼Œ æ‰€ä»¥ auto-load ä¹Ÿè¿›è¡Œæ–‡ä»¶åçš„åŒºåˆ†ï¼Œå…·ä½“åŠ è½½ä»€ä¹ˆå–å†³äºä½ æä¾›çš„æ–‡ä»¶ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ª gdb åŠ è½½ libstdc++.so.6.0.32-gdb.py çš„ trace</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr&#34;</span>, 0x7ffd8c8eb4d0, 1023<span style=color:#f92672>)</span>  <span style=color:#f92672>=</span> -1 EINVAL <span style=color:#f92672>(</span>Invalid argument<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr/lib&#34;</span>, 0x7ffd8c8eb4d0, 1023<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 EINVAL <span style=color:#f92672>(</span>Invalid argument<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr/lib/x86_64-linux-gnu&#34;</span>, 0x7ffd8c8eb4d0, 1023<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 EINVAL <span style=color:#f92672>(</span>Invalid argument<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr/lib/x86_64-linux-gnu/libstdc++.so.6&#34;</span>, <span style=color:#e6db74>&#34;libstdc++.so.6.0.32&#34;</span>, 1023<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>19</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.32&#34;</span>, 0x7ffd8c8eb4d0, 1023<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 EINVAL <span style=color:#f92672>(</span>Invalid argument<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>openat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.32-gdb.gdb&#34;</span>, O_RDONLY|O_CLOEXEC<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 ENOENT <span style=color:#f92672>(</span>No such file or directory<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>openat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/usr/lib/debug/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.32-gdb.gdb&#34;</span>, O_RDONLY|O_CLOEXEC<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 ENOENT <span style=color:#f92672>(</span>No such file or directory<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>openat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/usr/share/gdb/auto-load/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.32-gdb.gdb&#34;</span>, O_RDONLY|O_CLOEXEC<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 ENOENT <span style=color:#f92672>(</span>No such file or directory<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/lib&#34;</span>, <span style=color:#e6db74>&#34;usr/lib&#34;</span>, 1023<span style=color:#f92672>)</span>       <span style=color:#f92672>=</span> <span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr&#34;</span>, 0x7ffd8c8eb4d0, 1023<span style=color:#f92672>)</span>  <span style=color:#f92672>=</span> -1 EINVAL <span style=color:#f92672>(</span>Invalid argument<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr/lib&#34;</span>, 0x7ffd8c8eb4d0, 1023<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 EINVAL <span style=color:#f92672>(</span>Invalid argument<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr/lib/x86_64-linux-gnu&#34;</span>, 0x7ffd8c8eb4d0, 1023<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 EINVAL <span style=color:#f92672>(</span>Invalid argument<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr/lib/x86_64-linux-gnu/libstdc++.so.6&#34;</span>, <span style=color:#e6db74>&#34;libstdc++.so.6.0.32&#34;</span>, 1023<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>19</span>
</span></span><span style=display:flex><span>readlink<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.32&#34;</span>, 0x7ffd8c8eb4d0, 1023<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 EINVAL <span style=color:#f92672>(</span>Invalid argument<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>openat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.32-gdb.py&#34;</span>, O_RDONLY|O_CLOEXEC<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 ENOENT <span style=color:#f92672>(</span>No such file or directory<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>openat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/usr/lib/debug/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.32-gdb.py&#34;</span>, O_RDONLY|O_CLOEXEC<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> -1 ENOENT <span style=color:#f92672>(</span>No such file or directory<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>openat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/usr/share/gdb/auto-load/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.32-gdb.py&#34;</span>, O_RDONLY|O_CLOEXEC<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>16</span>
</span></span></code></pre></div></li><li><p>auto-load è„šæœ¬çš„è·¯å¾„ä¸€èˆ¬åœ¨ <code>/usr/share/gdb/auto-load/</code> å’Œ <code>/usr/lib/debug</code> ç›®å½•ä¸‹ï¼Œåœ¨æ­¤ç›®å½•ä¸‹å»ºç«‹ä¸€ä¸ªä½ éœ€è¦åŠ¨æ€åŠ è½½çš„æ–‡ä»¶çš„å…¨ç›®å½•ç±»ä¼¼çš„ç›®å½•ç»“æ„ï¼Œä¾‹å¦‚ <code>usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.31-gdb.py</code> ï¼Œæ­¤æ—¶ä½ çš„æ–‡ä»¶çš„å…¨è·¯å¾„å°±æ˜¯ <code>/usr/share/gdb/auto-load/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.32-gdb.py</code> ï¼Œä¸€èˆ¬ç³»ç»Ÿä¸‹è¿˜æœ‰å…¶ä»–æ–‡ä»¶ï¼Œå¯ä»¥è‡ªè¡Œæµ‹è¯•</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>â¯ tree
</span></span><span style=display:flex><span>.
</span></span><span style=display:flex><span>â”œâ”€â”€ lib
</span></span><span style=display:flex><span>â”‚Â Â  â””â”€â”€ x86_64-linux-gnu
</span></span><span style=display:flex><span>â”‚Â Â      â””â”€â”€ libpthread-2.35.so-gdb.py
</span></span><span style=display:flex><span>â””â”€â”€ usr
</span></span><span style=display:flex><span>    â”œâ”€â”€ lib
</span></span><span style=display:flex><span>    â”‚Â Â  â””â”€â”€ x86_64-linux-gnu
</span></span><span style=display:flex><span>    â”‚Â Â      â”œâ”€â”€ libisl.so.23.1.0-gdb.py
</span></span><span style=display:flex><span>    â”‚Â Â      â””â”€â”€ libstdc++.so.6.0.32-gdb.py
</span></span><span style=display:flex><span>    â””â”€â”€ lib32
</span></span><span style=display:flex><span>        â””â”€â”€ libstdc++.so.6.0.32-gdb.py
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>6</span> directories, <span style=color:#ae81ff>4</span> files
</span></span><span style=display:flex><span>/usr/share/gdb/auto-load â¯
</span></span></code></pre></div></li><li><p>æ­¤å¤–ï¼Œè„šæœ¬æ–‡ä»¶ä¹Ÿå¯ä»¥æ”¾åœ¨ä½ è°ƒè¯•æ–‡ä»¶çš„ç›®å½•ä¸‹ï¼Œæ­¤æ—¶åªè¦åŠ è½½åˆ°æ­¤æ–‡ä»¶ï¼Œåˆ™ä¹Ÿä¼šåŒæ—¶åŠ è½½æ­¤æ–‡ä»¶ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯éœ€è¦åœ¨ <code>.gdbinit</code> ä¸­æ·»åŠ  <code>add-auto-load-safe-path {your_path}</code> , å¦åˆ™ gdb ä¼šæç¤º <code>auto-loading has been declined by your `auto-load safe-path' set to "$debugdir:$datadir/auto-load".</code>ï¼ŒåŠ è½½ä¹‹åï¼ŒæŸ¥çœ‹ <code>auto-load safe-path</code> å¦‚ä¸‹</p><pre tabindex=0><code>(gdb) show auto-load safe-path
List of directories from which it is safe to auto-load files is $debugdir:$datadir/auto-load:/home/asky/.build/bin.
</code></pre></li><li><p>æ­¤æ—¶ gdb å¯åŠ¨ä¹‹åï¼Œå†æŸ¥çœ‹ pretty printerï¼Œä¼šçœ‹è§ pretty printer ä¸åœ¨ global pretty-printers ä¸‹é¢äº†ï¼Œè€Œæ˜¯å’Œæ–‡ä»¶å…³è”åœ¨ä¸€èµ·</p><pre tabindex=0><code>global pretty-printers:
  builtin
    mpx_bound128
objfile /home/asky/.build/bin/postgres pretty-printers:
  REL_16_STABLE
    (Node|Expr)
    A_ArrayExpr
    A_Const
    A_Expr
    A_Indices
    A_Indirection
    A_Star
    AccessPriv
    Agg
    AggInfo
    AggPath
</code></pre></li></ol><p>ä¸ä»…ä»…åªæ˜¯ pretty printer ï¼Œå…¶ä»–çš„è„šæœ¬æ–‡ä»¶ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„æ–¹æ³•å’Œç¨‹åºç»‘å®šåœ¨ä¸€èµ·ï¼Œé¿å…äº†ä¸åŒç¨‹åºä¹‹é—´ç›¸äº’å¹²æ‰°çš„é—®é¢˜</p><h2 id=checkpoint>checkpoint</h2><ul><li><p>parse_and_eval å¯ä»¥è¿ç®—è¡¨è¾¾å¼ï¼Œç„¶åä¿å­˜ä¸º python å†…ç½®å˜é‡ï¼Œè¿ç”¨èŒƒå›´æå¹¿</p></li><li><p>vscode ä¹Ÿå¯ä»¥ä½¿ç”¨ pretty printerï¼Œåªéœ€è¦æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤å®ç°è‡ªå®šä¹‰çš„ printerï¼Œ ç„¶åè®¾ç½® auto load å³å¯</p><ol><li>vscode çª—å£ä¸­æ˜¾ç¤ºå˜é‡å€¼éœ€è¦è¦æ±‚æ˜¯å¯¹è±¡ï¼Œè€Œä¸èƒ½æ˜¯æŒ‡é’ˆ</li><li>çª—å£ä¸­æ˜¾ç¤ºçš„å€¼éœ€è¦åœ¨ children ä¸­è¿”å›æ‰æ˜¾ç¤ºï¼Œ to_string æ˜¾ç¤ºçš„å€¼çª—å£æ˜¯ä¸ä¼šæ˜¾ç¤ºçš„ï¼Œä¾‹å¦‚ vector gdb ä¸­æ˜¾ç¤ºçš„æ˜¯ <code>$1 = std::vector of length 4, capacity 4 = {"hello", "world", "c++", "python"}</code>ï¼Œè€Œçª—å£ä¸­åªæ˜¾ç¤ºå®é™…çš„å†…å®¹ <code>{"hello", "world", "c++", "python"}</code>ï¼Œto_string æ›´ç±»ä¼¼æ˜¯ä¸€ä¸ª prompt</li><li>æ‰€ä»¥è‡ªå®šä¹‰çš„ printer å®ç°çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä»€ä¹ˆæ˜¯é‡ç‚¹ï¼Œ ä»€ä¹ˆæ˜¯å¯ä»¥å¿½ç•¥çš„ï¼Œæ‰“å°ä¸»ä½“éœ€è¦æ”¾åœ¨ children ä¸­</li></ol></li><li><p>å¯ä»¥ä½¿ç”¨ python ç›´æ¥ä»ç¨‹åºä¸­è§£æç»“æ„ä½“ï¼Œç„¶åæ„é€  printer ï¼Œç†è®ºå¯è¡Œï¼Œä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹å®Œå…¨ä¸å¯æ§ï¼Œä¸”éš¾ä»¥å®ç°</p></li></ul><pre tabindex=0><code>(gdb) b planner
Breakpoint 1 at 0x55a0564fc233: file /workspaces/postgres/src/backend/optimizer/plan/planner.c, line 397.
(gdb) c
Continuing.

Breakpoint 1, planner (parse=0x55a05825e918, ...) at /workspaces/postgres/src/backend/optimizer/plan/planner.c:397
397             if (planner_hook)
(gdb) python v = gdb.parse_and_eval(&#39;parse&#39;)
(gdb) python print(gdb.types.get_basic_type(v.dereference().type).fields())
[&lt;gdb.Field object at 0x7fea1ad730b0&gt;, &lt;gdb.Field object at 0x7fea1ad73730&gt;, &lt;gdb.Field object at 0x7fea1ad71970&gt;, &lt;gdb.Field object at 0x7fea1ad731d0&gt;, &lt;gdb.Field object at 0x7fea1ad72bf0&gt;, &lt;gdb.Field object at 0x7fea1ad71f90&gt;, &lt;gdb.Field object at 0x7fea1ad71ed0&gt;, &lt;gdb.Field object at 0x7fea1ad734d0&gt;, &lt;gdb.Field object at 0x7fea1ad73950&gt;, &lt;gdb.Field object at 0x7fea1ad70cd0&gt;, &lt;gdb.Field object at 0x7fea1ad72e70&gt;, &lt;gdb.Field object at 0x7fea1ad72ff0&gt;, &lt;gdb.Field object at 0x7fea1ad73070&gt;, &lt;gdb.Field object at 0x7fea1ad73db0&gt;, &lt;gdb.Field object at 0x7fea1ad72370&gt;, &lt;gdb.Field object at 0x7fea1ad71f70&gt;, &lt;gdb.Field object at 0x7fea1ad72b30&gt;, &lt;gdb.Field object at 0x7fea1ad73eb0&gt;, &lt;gdb.Field object at 0x7fea1ad71630&gt;, &lt;gdb.Field object at 0x7fea1ad70e50&gt;, &lt;gdb.Field object at 0x7fea1ad70cb0&gt;, &lt;gdb.Field object at 0x7fea1ad70db0&gt;, &lt;gdb.Field object at 0x7fea1ad73590&gt;, &lt;gdb.Field object at 0x7fea1ad70950&gt;, &lt;gdb.Field object at 0x7fea1ad726f0&gt;, &lt;gdb.Field object at 0x7fea1ad72950&gt;, &lt;gdb.Field object at 0x7fea1ad73470&gt;, &lt;gdb.Field object at 0x7fea1ad72e30&gt;, &lt;gdb.Field object at 0x7fea1ad71b10&gt;, &lt;gdb.Field object at 0x7fea1ad71c70&gt;, &lt;gdb.Field object at 0x7fea1ad73150&gt;, &lt;gdb.Field object at 0x7fea1ad72830&gt;, &lt;gdb.Field object at 0x7fea1ad71710&gt;, &lt;gdb.Field object at 0x7fea1ad72890&gt;, &lt;gdb.Field object at 0x7fea1ad72850&gt;, &lt;gdb.Field object at 0x7fea1ad719f0&gt;, &lt;gdb.Field object at 0x7fea1ad72530&gt;, &lt;gdb.Field object at 0x7fea1ad736b0&gt;, &lt;gdb.Field object at 0x7fea1ad71590&gt;, &lt;gdb.Field object at 0x7fea1ad72670&gt;, &lt;gdb.Field object at 0x7fea1ad713b0&gt;, &lt;gdb.Field object at 0x7fea1ad739f0&gt;, &lt;gdb.Field object at 0x7fea1ad71750&gt;, &lt;gdb.Field object at 0x7fea1ad73a10&gt;]
(gdb) python print(gdb.types.get_basic_type(v.dereference().type).fields()[0].type)
NodeTag
(gdb) python print(gdb.types.get_basic_type(v.dereference().type).fields()[1].type)
CmdType
(gdb)
</code></pre><ul><li>å¯ä»¥æŠŠå¤æ‚é€»è¾‘äº¤ç»™ç¨‹åºå®ç°ï¼Œç„¶åæä¾›å‡½æ•°æ¥å£ç»™ pythonï¼Œ python ç›´æ¥è°ƒç”¨å‡½æ•°æ‰“å°å¯¹è±¡ï¼Œä¾‹å¦‚å¯ä»¥å®ç°ä¸€ä¸ª pg çš„æ’ä»¶ï¼Œprint çš„åœ¨æ’ä»¶ä¸­å®ç°ã€‚</li></ul><h2 id=i-am-stupid>i am stupid</h2><p>å½“å‰çš„å®ç°å­˜åœ¨å·¨å¤§é—®é¢˜ï¼Œæ‰€æœ‰çš„pinter èšåœ¨ä¸€èµ·ï¼Œ å‡ºäº†é—®é¢˜æ ¹æœ¬æ— æ³•å®šä½æ˜¯é‚£ä¸ªprinterçš„é”…ï¼ŒæŠŠç¯å¢ƒä» Ubuntu 22 å‡çº§åˆ° Ubuntu 24 ä¹‹åï¼Œ æ•´ä¸ªå°±å‡ ä¹ gg äº†
åç»­è€ƒè™‘æ˜¾å¼å®ç°æ¯ä¸€ä¸ªç±»å‹çš„printerï¼Œå½“ç„¶ä¸èƒ½æ‰‹å†™ï¼Œæ‰“ç®—å†™ä¸ªæ’ä»¶å®ç°ã€‚printer gennerator å°±ä¸åº”è¯¥äº¤ç»™ python è¿™ç§è¯­è¨€ï¼Œå¼±ç±»å‹ï¼Œå¤ªè‡ªç”±äº†</p></section><div class=divider></div><div class="flex flex-col md:flex-row justify-between gap-4 py-4"><a role=button class="btn btn-outline h-12" href=/posts/others/cmake/ title="cmake é€ŸæŸ¥æ¨¡æ¿"><ion-icon name=chevron-back></ion-icon><div class="inline-flex flex-col items-start"><span class="text-base-content/60 text-xs font-normal">Previous page</span>
<span class="max-w-48 truncate">cmake é€ŸæŸ¥æ¨¡æ¿</span></div></a><a role=button class="btn btn-outline h-12" href=/posts/postgres/optimizer/ title="Postgres æŠ€æœ¯å†…å¹•ï¼ŒOptimizerè¿‡ç¨‹åˆ†æ"><div class="inline-flex flex-col items-end"><span class="text-base-content/60 text-xs font-normal">Next page</span>
<span class="max-w-48 truncate">Postgres æŠ€æœ¯å†…å¹•ï¼ŒOptimizerè¿‡ç¨‹åˆ†æ</span></div><ion-icon name=chevron-forward></ion-icon></a></div></article></div><div x-data=tocHighlighter() @scroll.window=debouncedScroll class="hidden lg:flex lg:flex-col lg:items-end lg:self-start"><nav id=TableOfContents><ul><li><a href=#é…ç½®>é…ç½®</a></li><li><a href=#python-è„šæœ¬>python è„šæœ¬</a><ul><li><a href=#gdb-python-äº¤äº’>gdb python äº¤äº’</a></li><li><a href=#é‡ç‚¹-api>é‡ç‚¹ API</a></li><li><a href=#è‡ªå®šä¹‰å‘½ä»¤>è‡ªå®šä¹‰å‘½ä»¤</a></li><li><a href=#pretty-printer>pretty printer</a></li><li><a href=#auto-load>auto load</a></li></ul></li><li><a href=#checkpoint>checkpoint</a></li><li><a href=#i-am-stupid>i am stupid</a></li></ul></nav></div></div><footer class="flex justify-between items-center gap-2 px-4 py-12"><div><p>Â© 2016 - 2025 Askyx's Blog</p><p class=text-sm>ğŸŒ±
<span class=text-base-content/60>Powered by <a class=hover:underline href=https://gohugo.io/ target=_blank>Hugo</a> with theme
<a class=hover:underline href=https://github.com/g1eny0ung/hugo-theme-dream target=_blank>Dream</a>.</span></p></div><div x-data="{ icons: [
    { name: 'sunny', status: 'n' },
    { name: 'moon', status: 'y' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center gap-2 h-[32px] px-2 bg-base-100 border border-base-content/30 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div><div class=back><div class=container><div class="dream-grid dream-grid-about"><div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column"><article class="card bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"><div class=card-body><div class=card-title>About Me</div><div class="prose dark:prose-invert"><p>Hi, my name is Yue Yang.</p><p>This is my blog.</p><h2 id=ãƒ¾Ï‰o>ãƒ¾(â€¢Ï‰â€¢`)o</h2><p>æ¯”è¾ƒèƒ†å°ï¼Œå‡ºé—¨éƒ½å¾—è´´å¢™èµ°</p></div></div></article></div></div><footer class="flex justify-between items-center gap-2 px-4 py-12"><div><p>Â© 2016 - 2025 Askyx's Blog</p><p class=text-sm>ğŸŒ±
<span class=text-base-content/60>Powered by <a class=hover:underline href=https://gohugo.io/ target=_blank>Hugo</a> with theme
<a class=hover:underline href=https://github.com/g1eny0ung/hugo-theme-dream target=_blank>Dream</a>.</span></p></div><div x-data="{ icons: [
    { name: 'sunny', status: 'n' },
    { name: 'moon', status: 'y' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center gap-2 h-[32px] px-2 bg-base-100 border border-base-content/30 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div></div></div><script>window.lightTheme="emerald",window.darkTheme="forest"</script><script src=https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin=anonymous></script><script src=/js/grid.min.js></script><script src=/js/main.min.js></script><script src=https://cdn.jsdelivr.net/npm/luxon@1.26.0 integrity="sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0=" crossorigin=anonymous></script><script>format();function format(){document.querySelectorAll('span[data-format="luxon"]').forEach(e=>{const t=e.textContent;e.textContent=luxon.DateTime.fromISO(t,{locale:"en"}).toFormat("yyyyå¹´MMæœˆddæ—¥")})}</script><script src=/js/toc.min.js></script><script type=module>
      import mediumZoom from 'https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/+esm';
      mediumZoom('#dream-single-post-content img', {
        background: 'oklch(var(--b1))',
        margin: 24,
      })
    </script><script type=module src=https://cdn.jsdelivr.net/npm/ionicons@7.4.0/dist/ionicons/ionicons.esm.js integrity="sha256-/IFmi82bIhdYWctu0UddSlJqpnzWm7Vh2C4CM32wF/k=" crossorigin=anonymous></script><script nomodule src=https://cdn.jsdelivr.net/npm/ionicons@7.4.0/dist/ionicons/ionicons.js integrity="sha256-mr7eJMX3VC3F7G32mk4oWp1C6a2tlMYxUdptfT7uKI8=" crossorigin=anonymous></script></body></html>