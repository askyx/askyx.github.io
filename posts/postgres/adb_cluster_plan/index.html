<!doctype html><html lang=zh-Hans x-data :class=$store.darkMode.class() :data-theme=$store.darkMode.theme()><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>| Askyx's Blog</title><link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%2210 0 100 100%22><text y=%22.90em%22 font-size=%2290%22>ðŸŒ±</text></svg>"></link>
<link rel=canonical href=https://askyx.github.io/posts/postgres/adb_cluster_plan/><meta name=author content="Askyx"><meta name=description content="æ‰§è¡Œè®¡åˆ’ set enable_mergejoin=off; set enable_nestloop=off; select s_acctbal, s_name, n_name, p_partkey, p_mfgr, s_address, s_phone, s_comment from part, supplier, partsupp, nation, region where p_partkey = ps_partkey and s_suppkey = ps_suppkey and p_size = 15 and p_type like '%BRASS' and s_nationkey = n_nationkey and n_regionkey = r_regionkey and r_name = 'EUROPE' and ps_supplycost = ( select min(ps_supplycost) from partsupp, supplier, nation, region where p_partkey = ps_partkey and s_suppkey = ps_suppkey and s_nationkey = n_nationkey and n_regionkey = r_regionkey and r_name = 'EUROPE' ) order by s_acctbal desc, n_name, s_name, p_partkey limit 100; QUERY PLAN ----------------------------------------------------------------------------------------------------------------------------------------------------------- Limit (cost=3351813.70..3351813.71 rows=5 width=0) -> Cluster Merge Gather (cost=3351813.70..3351813.71 rows=5 width=0) Sort Key: supplier.s_acctbal DESC, nation.n_name, supplier.s_name, part.p_partkey -> Limit (cost=3350813.60..3350813.61 rows=1 width=193) -> Sort (cost=3350813.60..3350813.61 rows=0 width=193) Sort Key: supplier.s_acctbal DESC, nation.n_name, supplier.s_name, part.p_partkey -> Hash Join (cost=745359.38..3350813.59 rows=0 width=193) Hash Cond: ((partsupp.ps_partkey = part.p_partkey) AND (partsupp.ps_supplycost = (SubPlan 1))) -> Hash Join (cost=35483.36..2640803.16 rows=25603 width=173) Hash Cond: (partsupp.ps_suppkey = supplier.s_suppkey) -> Seq Scan on partsupp (cost=0.00..2544033.48 rows=16001650 width=14) -> Hash (cost=35383.36..35383.36 rows=8000 width=167) -> Cluster Reduce (cost=3.36..35383.36 rows=8000 width=167) -> Hash Join (cost=2.36..33012.36 rows=1600 width=167) Hash Cond: (supplier.s_nationkey = nation.n_nationkey) -> Seq Scan on supplier (cost=0.00..32180.00 rows=200000 width=145) -> Hash (cost=2.35..2.35 rows=1 width=30) -> Hash Join (cost=1.07..2.35 rows=1 width=30) Hash Cond: (nation.n_regionkey = region.r_regionkey) -> Seq Scan on nation (cost=0.00..1.25 rows=5 width=34) -> Hash (cost=1.06..1.06 rows=1 width=4) -> Seq Scan on region (cost=0.00..1.06 rows=1 width=4) Filter: (r_name = 'EUROPE'::bpchar) -> Hash (cost=709609.29..709609.29 rows=17782 width=30) -> Seq Scan on part (cost=0.00..709609.29 rows=17782 width=30) Filter: (((p_type)::text ~~ '%BRASS'::text) AND (p_size = 15)) SubPlan 1 -> Materialize (cost=28851255.69..28851255.71 rows=1 width=32) -> Aggregate (cost=28851255.69..28851255.70 rows=1 width=32) -> Hash Join (cost=35610.36..28851255.69 rows=1 width=6) Hash Cond: (partsupp_1.ps_suppkey = supplier_1.s_suppkey) -> Reduce Scan (cost=1.00..28509214.73 rows=80008250 width=10) Filter: (part.p_partkey = ps_partkey) -> Cluster Reduce (cost=1.00..27718507.48 rows=80008250 width=14) -> Seq Scan on partsupp partsupp_1 (cost=0.00..2544033.48 rows=16001650 width=14) -> Hash (cost=35509.36..35509.36 rows=8000 width=4) -> Cluster Reduce (cost=3.36..35509.36 rows=8000 width=4) -> Hash Join (cost=2.36..33012.36 rows=1600 width=4) Hash Cond: (supplier_1.s_nationkey = nation_1.n_nationkey) -> Seq Scan on supplier supplier_1 (cost=0.00..32180.00 rows=200000 width=8) -> Hash (cost=2.35..2.35 rows=1 width=4) -> Hash Join (cost=1.07..2.35 rows=1 width=4) Hash Cond: (nation_1.n_regionkey = region_1.r_regionkey) -> Seq Scan on nation nation_1 (cost=0.00..1.25 rows=5 width=8) -> Hash (cost=1.06..1.06 rows=1 width=4) -> Seq Scan on region region_1 (cost=0.00..1.06 rows=1 width=4) Filter: (r_name = 'EUROPE'::bpchar) (47 rows) QUERY PLAN ----------------------------------------------------------------------------------------------------------------------------- Limit (cost=85.86..85.87 rows=1 width=716) -> Sort (cost=85.86..85.87 rows=1 width=716) Sort Key: supplier.s_acctbal DESC, nation.n_name, supplier.s_name, part.p_partkey -> Hash Join (cost=48.95..85.73 rows=1 width=716) Hash Cond: ((part.p_partkey = partsupp.ps_partkey) AND ((SubPlan 1) = partsupp.ps_supplycost)) -> Seq Scan on part (cost=0.00..12.40 rows=1 width=108) Filter: (((p_type)::text ~~ '%BRASS'::text) AND (p_size = 15)) -> Hash (cost=48.93..48.93 rows=1 width=630) -> Hash Join (cost=36.58..48.93 rows=1 width=630) Hash Cond: (partsupp.ps_suppkey = supplier.s_suppkey) -> Seq Scan on partsupp (cost=0.00..11.70 rows=170 width=26) -> Hash (cost=36.57..36.57 rows=1 width=612) -> Hash Join (cost=24.50..36.57 rows=1 width=612) Hash Cond: (supplier.s_nationkey = nation.n_nationkey) -> Seq Scan on supplier (cost=0.00..11.50 rows=150 width=512) -> Hash (cost=24.48..24.48 rows=1 width=108) -> Hash Join (cost=12.14..24.48 rows=1 width=108) Hash Cond: (nation.n_regionkey = region.r_regionkey) -> Seq Scan on nation (cost=0.00..11.70 rows=170 width=112) -> Hash (cost=12.12..12.12 rows=1 width=4) -> Seq Scan on region (cost=0.00..12.12 rows=1 width=4) Filter: (r_name = 'EUROPE'::bpchar) SubPlan 1 -> Aggregate (cost=48.72..48.73 rows=1 width=32) -> Hash Join (cost=36.36..48.72 rows=1 width=18) Hash Cond: (nation_1.n_regionkey = region_1.r_regionkey) -> Hash Join (cost=24.22..36.57 rows=1 width=22) Hash Cond: (nation_1.n_nationkey = supplier_1.s_nationkey) -> Seq Scan on nation nation_1 (cost=0.00..11.70 rows=170 width=8) -> Hash (cost=24.21..24.21 rows=1 width=22) -> Hash Join (cost=12.14..24.21 rows=1 width=22) Hash Cond: (supplier_1.s_suppkey = partsupp_1.ps_suppkey) -> Seq Scan on supplier supplier_1 (cost=0.00..11.50 rows=150 width=8) -> Hash (cost=12.12..12.12 rows=1 width=22) -> Seq Scan on partsupp partsupp_1 (cost=0.00..12.12 rows=1 width=22) Filter: (part.p_partkey = ps_partkey) -> Hash (cost=12.12..12.12 rows=1 width=4) -> Seq Scan on region region_1 (cost=0.00..12.12 rows=1 width=4) Filter: (r_name = 'EUROPE'::bpchar) (39 rows) pgå•æœºæ‰§è¡Œè®¡åˆ’å’Œantdbåˆ†å¸ƒå¼æ‰§è¡Œè®¡åˆ’å¤§è‡´ä¸€æ ·ï¼Œå’Œä¹‹å‰gpçš„ç»“è®ºæœ‰
"><meta name=keywords content><meta name=generator content="Hugo 0.148.1"><meta property="og:url" content="https://askyx.github.io/posts/postgres/adb_cluster_plan/"><meta property="og:site_name" content="Askyx's Blog"><meta property="og:title" content="Askyx's Blog"><meta property="og:description" content="æ‰§è¡Œè®¡åˆ’ set enable_mergejoin=off; set enable_nestloop=off; select s_acctbal, s_name, n_name, p_partkey, p_mfgr, s_address, s_phone, s_comment from part, supplier, partsupp, nation, region where p_partkey = ps_partkey and s_suppkey = ps_suppkey and p_size = 15 and p_type like '%BRASS' and s_nationkey = n_nationkey and n_regionkey = r_regionkey and r_name = 'EUROPE' and ps_supplycost = ( select min(ps_supplycost) from partsupp, supplier, nation, region where p_partkey = ps_partkey and s_suppkey = ps_suppkey and s_nationkey = n_nationkey and n_regionkey = r_regionkey and r_name = 'EUROPE' ) order by s_acctbal desc, n_name, s_name, p_partkey limit 100; QUERY PLAN ----------------------------------------------------------------------------------------------------------------------------------------------------------- Limit (cost=3351813.70..3351813.71 rows=5 width=0) -> Cluster Merge Gather (cost=3351813.70..3351813.71 rows=5 width=0) Sort Key: supplier.s_acctbal DESC, nation.n_name, supplier.s_name, part.p_partkey -> Limit (cost=3350813.60..3350813.61 rows=1 width=193) -> Sort (cost=3350813.60..3350813.61 rows=0 width=193) Sort Key: supplier.s_acctbal DESC, nation.n_name, supplier.s_name, part.p_partkey -> Hash Join (cost=745359.38..3350813.59 rows=0 width=193) Hash Cond: ((partsupp.ps_partkey = part.p_partkey) AND (partsupp.ps_supplycost = (SubPlan 1))) -> Hash Join (cost=35483.36..2640803.16 rows=25603 width=173) Hash Cond: (partsupp.ps_suppkey = supplier.s_suppkey) -> Seq Scan on partsupp (cost=0.00..2544033.48 rows=16001650 width=14) -> Hash (cost=35383.36..35383.36 rows=8000 width=167) -> Cluster Reduce (cost=3.36..35383.36 rows=8000 width=167) -> Hash Join (cost=2.36..33012.36 rows=1600 width=167) Hash Cond: (supplier.s_nationkey = nation.n_nationkey) -> Seq Scan on supplier (cost=0.00..32180.00 rows=200000 width=145) -> Hash (cost=2.35..2.35 rows=1 width=30) -> Hash Join (cost=1.07..2.35 rows=1 width=30) Hash Cond: (nation.n_regionkey = region.r_regionkey) -> Seq Scan on nation (cost=0.00..1.25 rows=5 width=34) -> Hash (cost=1.06..1.06 rows=1 width=4) -> Seq Scan on region (cost=0.00..1.06 rows=1 width=4) Filter: (r_name = 'EUROPE'::bpchar) -> Hash (cost=709609.29..709609.29 rows=17782 width=30) -> Seq Scan on part (cost=0.00..709609.29 rows=17782 width=30) Filter: (((p_type)::text ~~ '%BRASS'::text) AND (p_size = 15)) SubPlan 1 -> Materialize (cost=28851255.69..28851255.71 rows=1 width=32) -> Aggregate (cost=28851255.69..28851255.70 rows=1 width=32) -> Hash Join (cost=35610.36..28851255.69 rows=1 width=6) Hash Cond: (partsupp_1.ps_suppkey = supplier_1.s_suppkey) -> Reduce Scan (cost=1.00..28509214.73 rows=80008250 width=10) Filter: (part.p_partkey = ps_partkey) -> Cluster Reduce (cost=1.00..27718507.48 rows=80008250 width=14) -> Seq Scan on partsupp partsupp_1 (cost=0.00..2544033.48 rows=16001650 width=14) -> Hash (cost=35509.36..35509.36 rows=8000 width=4) -> Cluster Reduce (cost=3.36..35509.36 rows=8000 width=4) -> Hash Join (cost=2.36..33012.36 rows=1600 width=4) Hash Cond: (supplier_1.s_nationkey = nation_1.n_nationkey) -> Seq Scan on supplier supplier_1 (cost=0.00..32180.00 rows=200000 width=8) -> Hash (cost=2.35..2.35 rows=1 width=4) -> Hash Join (cost=1.07..2.35 rows=1 width=4) Hash Cond: (nation_1.n_regionkey = region_1.r_regionkey) -> Seq Scan on nation nation_1 (cost=0.00..1.25 rows=5 width=8) -> Hash (cost=1.06..1.06 rows=1 width=4) -> Seq Scan on region region_1 (cost=0.00..1.06 rows=1 width=4) Filter: (r_name = 'EUROPE'::bpchar) (47 rows) QUERY PLAN ----------------------------------------------------------------------------------------------------------------------------- Limit (cost=85.86..85.87 rows=1 width=716) -> Sort (cost=85.86..85.87 rows=1 width=716) Sort Key: supplier.s_acctbal DESC, nation.n_name, supplier.s_name, part.p_partkey -> Hash Join (cost=48.95..85.73 rows=1 width=716) Hash Cond: ((part.p_partkey = partsupp.ps_partkey) AND ((SubPlan 1) = partsupp.ps_supplycost)) -> Seq Scan on part (cost=0.00..12.40 rows=1 width=108) Filter: (((p_type)::text ~~ '%BRASS'::text) AND (p_size = 15)) -> Hash (cost=48.93..48.93 rows=1 width=630) -> Hash Join (cost=36.58..48.93 rows=1 width=630) Hash Cond: (partsupp.ps_suppkey = supplier.s_suppkey) -> Seq Scan on partsupp (cost=0.00..11.70 rows=170 width=26) -> Hash (cost=36.57..36.57 rows=1 width=612) -> Hash Join (cost=24.50..36.57 rows=1 width=612) Hash Cond: (supplier.s_nationkey = nation.n_nationkey) -> Seq Scan on supplier (cost=0.00..11.50 rows=150 width=512) -> Hash (cost=24.48..24.48 rows=1 width=108) -> Hash Join (cost=12.14..24.48 rows=1 width=108) Hash Cond: (nation.n_regionkey = region.r_regionkey) -> Seq Scan on nation (cost=0.00..11.70 rows=170 width=112) -> Hash (cost=12.12..12.12 rows=1 width=4) -> Seq Scan on region (cost=0.00..12.12 rows=1 width=4) Filter: (r_name = 'EUROPE'::bpchar) SubPlan 1 -> Aggregate (cost=48.72..48.73 rows=1 width=32) -> Hash Join (cost=36.36..48.72 rows=1 width=18) Hash Cond: (nation_1.n_regionkey = region_1.r_regionkey) -> Hash Join (cost=24.22..36.57 rows=1 width=22) Hash Cond: (nation_1.n_nationkey = supplier_1.s_nationkey) -> Seq Scan on nation nation_1 (cost=0.00..11.70 rows=170 width=8) -> Hash (cost=24.21..24.21 rows=1 width=22) -> Hash Join (cost=12.14..24.21 rows=1 width=22) Hash Cond: (supplier_1.s_suppkey = partsupp_1.ps_suppkey) -> Seq Scan on supplier supplier_1 (cost=0.00..11.50 rows=150 width=8) -> Hash (cost=12.12..12.12 rows=1 width=22) -> Seq Scan on partsupp partsupp_1 (cost=0.00..12.12 rows=1 width=22) Filter: (part.p_partkey = ps_partkey) -> Hash (cost=12.12..12.12 rows=1 width=4) -> Seq Scan on region region_1 (cost=0.00..12.12 rows=1 width=4) Filter: (r_name = 'EUROPE'::bpchar) (39 rows) pgå•æœºæ‰§è¡Œè®¡åˆ’å’Œantdbåˆ†å¸ƒå¼æ‰§è¡Œè®¡åˆ’å¤§è‡´ä¸€æ ·ï¼Œå’Œä¹‹å‰gpçš„ç»“è®ºæœ‰"><meta property="og:locale" content="zh_Hans"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:modified_time" content="2025-07-21T18:54:45+08:00"><meta property="og:image" content="https://askyx.github.io/img/global-background.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://askyx.github.io/img/global-background.jpg"><meta name=twitter:title content="Askyx's Blog"><meta name=twitter:description content="æ‰§è¡Œè®¡åˆ’ set enable_mergejoin=off; set enable_nestloop=off; select s_acctbal, s_name, n_name, p_partkey, p_mfgr, s_address, s_phone, s_comment from part, supplier, partsupp, nation, region where p_partkey = ps_partkey and s_suppkey = ps_suppkey and p_size = 15 and p_type like '%BRASS' and s_nationkey = n_nationkey and n_regionkey = r_regionkey and r_name = 'EUROPE' and ps_supplycost = ( select min(ps_supplycost) from partsupp, supplier, nation, region where p_partkey = ps_partkey and s_suppkey = ps_suppkey and s_nationkey = n_nationkey and n_regionkey = r_regionkey and r_name = 'EUROPE' ) order by s_acctbal desc, n_name, s_name, p_partkey limit 100; QUERY PLAN ----------------------------------------------------------------------------------------------------------------------------------------------------------- Limit (cost=3351813.70..3351813.71 rows=5 width=0) -> Cluster Merge Gather (cost=3351813.70..3351813.71 rows=5 width=0) Sort Key: supplier.s_acctbal DESC, nation.n_name, supplier.s_name, part.p_partkey -> Limit (cost=3350813.60..3350813.61 rows=1 width=193) -> Sort (cost=3350813.60..3350813.61 rows=0 width=193) Sort Key: supplier.s_acctbal DESC, nation.n_name, supplier.s_name, part.p_partkey -> Hash Join (cost=745359.38..3350813.59 rows=0 width=193) Hash Cond: ((partsupp.ps_partkey = part.p_partkey) AND (partsupp.ps_supplycost = (SubPlan 1))) -> Hash Join (cost=35483.36..2640803.16 rows=25603 width=173) Hash Cond: (partsupp.ps_suppkey = supplier.s_suppkey) -> Seq Scan on partsupp (cost=0.00..2544033.48 rows=16001650 width=14) -> Hash (cost=35383.36..35383.36 rows=8000 width=167) -> Cluster Reduce (cost=3.36..35383.36 rows=8000 width=167) -> Hash Join (cost=2.36..33012.36 rows=1600 width=167) Hash Cond: (supplier.s_nationkey = nation.n_nationkey) -> Seq Scan on supplier (cost=0.00..32180.00 rows=200000 width=145) -> Hash (cost=2.35..2.35 rows=1 width=30) -> Hash Join (cost=1.07..2.35 rows=1 width=30) Hash Cond: (nation.n_regionkey = region.r_regionkey) -> Seq Scan on nation (cost=0.00..1.25 rows=5 width=34) -> Hash (cost=1.06..1.06 rows=1 width=4) -> Seq Scan on region (cost=0.00..1.06 rows=1 width=4) Filter: (r_name = 'EUROPE'::bpchar) -> Hash (cost=709609.29..709609.29 rows=17782 width=30) -> Seq Scan on part (cost=0.00..709609.29 rows=17782 width=30) Filter: (((p_type)::text ~~ '%BRASS'::text) AND (p_size = 15)) SubPlan 1 -> Materialize (cost=28851255.69..28851255.71 rows=1 width=32) -> Aggregate (cost=28851255.69..28851255.70 rows=1 width=32) -> Hash Join (cost=35610.36..28851255.69 rows=1 width=6) Hash Cond: (partsupp_1.ps_suppkey = supplier_1.s_suppkey) -> Reduce Scan (cost=1.00..28509214.73 rows=80008250 width=10) Filter: (part.p_partkey = ps_partkey) -> Cluster Reduce (cost=1.00..27718507.48 rows=80008250 width=14) -> Seq Scan on partsupp partsupp_1 (cost=0.00..2544033.48 rows=16001650 width=14) -> Hash (cost=35509.36..35509.36 rows=8000 width=4) -> Cluster Reduce (cost=3.36..35509.36 rows=8000 width=4) -> Hash Join (cost=2.36..33012.36 rows=1600 width=4) Hash Cond: (supplier_1.s_nationkey = nation_1.n_nationkey) -> Seq Scan on supplier supplier_1 (cost=0.00..32180.00 rows=200000 width=8) -> Hash (cost=2.35..2.35 rows=1 width=4) -> Hash Join (cost=1.07..2.35 rows=1 width=4) Hash Cond: (nation_1.n_regionkey = region_1.r_regionkey) -> Seq Scan on nation nation_1 (cost=0.00..1.25 rows=5 width=8) -> Hash (cost=1.06..1.06 rows=1 width=4) -> Seq Scan on region region_1 (cost=0.00..1.06 rows=1 width=4) Filter: (r_name = 'EUROPE'::bpchar) (47 rows) QUERY PLAN ----------------------------------------------------------------------------------------------------------------------------- Limit (cost=85.86..85.87 rows=1 width=716) -> Sort (cost=85.86..85.87 rows=1 width=716) Sort Key: supplier.s_acctbal DESC, nation.n_name, supplier.s_name, part.p_partkey -> Hash Join (cost=48.95..85.73 rows=1 width=716) Hash Cond: ((part.p_partkey = partsupp.ps_partkey) AND ((SubPlan 1) = partsupp.ps_supplycost)) -> Seq Scan on part (cost=0.00..12.40 rows=1 width=108) Filter: (((p_type)::text ~~ '%BRASS'::text) AND (p_size = 15)) -> Hash (cost=48.93..48.93 rows=1 width=630) -> Hash Join (cost=36.58..48.93 rows=1 width=630) Hash Cond: (partsupp.ps_suppkey = supplier.s_suppkey) -> Seq Scan on partsupp (cost=0.00..11.70 rows=170 width=26) -> Hash (cost=36.57..36.57 rows=1 width=612) -> Hash Join (cost=24.50..36.57 rows=1 width=612) Hash Cond: (supplier.s_nationkey = nation.n_nationkey) -> Seq Scan on supplier (cost=0.00..11.50 rows=150 width=512) -> Hash (cost=24.48..24.48 rows=1 width=108) -> Hash Join (cost=12.14..24.48 rows=1 width=108) Hash Cond: (nation.n_regionkey = region.r_regionkey) -> Seq Scan on nation (cost=0.00..11.70 rows=170 width=112) -> Hash (cost=12.12..12.12 rows=1 width=4) -> Seq Scan on region (cost=0.00..12.12 rows=1 width=4) Filter: (r_name = 'EUROPE'::bpchar) SubPlan 1 -> Aggregate (cost=48.72..48.73 rows=1 width=32) -> Hash Join (cost=36.36..48.72 rows=1 width=18) Hash Cond: (nation_1.n_regionkey = region_1.r_regionkey) -> Hash Join (cost=24.22..36.57 rows=1 width=22) Hash Cond: (nation_1.n_nationkey = supplier_1.s_nationkey) -> Seq Scan on nation nation_1 (cost=0.00..11.70 rows=170 width=8) -> Hash (cost=24.21..24.21 rows=1 width=22) -> Hash Join (cost=12.14..24.21 rows=1 width=22) Hash Cond: (supplier_1.s_suppkey = partsupp_1.ps_suppkey) -> Seq Scan on supplier supplier_1 (cost=0.00..11.50 rows=150 width=8) -> Hash (cost=12.12..12.12 rows=1 width=22) -> Seq Scan on partsupp partsupp_1 (cost=0.00..12.12 rows=1 width=22) Filter: (part.p_partkey = ps_partkey) -> Hash (cost=12.12..12.12 rows=1 width=4) -> Seq Scan on region region_1 (cost=0.00..12.12 rows=1 width=4) Filter: (r_name = 'EUROPE'::bpchar) (39 rows) pgå•æœºæ‰§è¡Œè®¡åˆ’å’Œantdbåˆ†å¸ƒå¼æ‰§è¡Œè®¡åˆ’å¤§è‡´ä¸€æ ·ï¼Œå’Œä¹‹å‰gpçš„ç»“è®ºæœ‰"><link rel=stylesheet href=/css/output.min.css><style>pre{padding:1em;overflow:auto}</style><link rel=stylesheet href=/css/custom.css><script defer src=https://cdn.jsdelivr.net/npm/alpinejs@3/dist/cdn.min.js integrity="sha256-PtHu0lJIiSHfZeNj1nFd6wTX+Squ255SGZ/fc8seCtM=" crossorigin=anonymous></script></head><body x-data="{
    flip: false,
  }"><div id=dream-global-bg></div><nav x-data="{ isSticky: false }" x-init="window.addEventListener('scroll', () => { isSticky = window.scrollY > 30 })" class="sticky top-0 z-30 mt-4 lg:mt-8 py-4" :class="{ 'bg-base-100 shadow-lg dark:border-b dark:border-base-content/30': isSticky }"><div class="container flex justify-between px-4"><section class="flex items-center gap-4"><div class="avatar cursor-pointer hover:avatar-online" @click="flip = !flip" title="Flip it!"><div class="h-10 rounded-full"><img src=/img/personal/avatar.jpg alt="Askyx's Blog"></div></div><div><a href=https://askyx.github.io/ class="text-lg font-semibold cursor-pointer">Askyx's Blog</a><div class="text-base-content/60 text-sm">life is short, use Python</div></div></section><div class="dropdown dropdown-end sm:hidden"><div tabindex=0 role=button class="btn btn-ghost btn-square" aria-label="Select an option"><ion-icon name=menu class=text-2xl></ion-icon></div><ul tabindex=0 class="dropdown-content menu w-36 bg-base-100 rounded-box z-1 shadow-md"><li><div role=link tabindex=0 class="inline-flex items-center p-2 cursor-pointer" @click="flip = !flip" title=About><ion-icon name=information-circle></ion-icon>About</div></li><li><a class="group inline-flex items-center p-2 cursor-pointer" href=/search title=Search><ion-icon name=search></ion-icon>Search</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=https://github.com/askyx target=_blank title=GitHub><ion-icon name=logo-github></ion-icon>GitHub</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/posts title=Archives><ion-icon name=archive></ion-icon>Archives</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/tags title="All Tags"><ion-icon name=pricetags></ion-icon>All Tags</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/index.xml title=RSS><ion-icon name=logo-rss></ion-icon>RSS</a></li></ul></div><section class="hidden sm:flex sm:items-center sm:gap-2 md:gap-4"><div role=link tabindex=0 class="text-sm font-semibold cursor-pointer hover:underline" @click="flip = !flip" title=About>About</div><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/search title=Search><ion-icon class=group-hover:text-primary-content name=search></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=https://github.com/askyx target=_blank title=GitHub><ion-icon class=group-hover:text-primary-content name=logo-github></ion-icon></a><div class="dropdown dropdown-end dropdown-hover"><div tabindex=0 role=button class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" aria-label="Select an option"><ion-icon class="group-hover:text-primary-content text-xl" name=menu></ion-icon></div><ul tabindex=0 class="dropdown-content menu w-36 bg-base-100 rounded-box z-1 shadow-xl"><li><a class="inline-flex items-center p-2 cursor-pointer" href=/posts title=Archives><ion-icon name=archive></ion-icon>Archives</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/tags title="All Tags"><ion-icon name=pricetags></ion-icon>All Tags</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/index.xml title=RSS><ion-icon name=logo-rss></ion-icon>RSS</a></li></ul></div></section></div></nav><div class=flip-container :class="{ 'flip-it': flip }"><div class=flipper><div class=front><div class=container><div class="lg:grid lg:grid-cols-4 gap-4 mt-4 px-4"><div class="hidden lg:block"></div><div class=lg:col-span-2><article class="mx-auto prose prose-quoteless dark:prose-invert" id=dream-single-post-main itemscope itemtype=http://schema.org/Article><meta itemprop=name content="Askyx's Blog"><meta itemprop=description content="æ‰§è¡Œè®¡åˆ’ set enable_mergejoin=off; set enable_nestloop=off; select s_acctbal, s_name, n_name, p_partkey, p_mfgr, s_address, s_phone, s_comment from part, supplier, partsupp, nation, region where p_partkey = ps_partkey and s_suppkey = ps_suppkey and p_size = 15 and p_type like '%BRASS' and s_nationkey = n_nationkey and n_regionkey = r_regionkey and r_name = 'EUROPE' and ps_supplycost = ( select min(ps_supplycost) from partsupp, supplier, nation, region where p_partkey = ps_partkey and s_suppkey = ps_suppkey and s_nationkey = n_nationkey and n_regionkey = r_regionkey and r_name = 'EUROPE' ) order by s_acctbal desc, n_name, s_name, p_partkey limit 100; QUERY PLAN ----------------------------------------------------------------------------------------------------------------------------------------------------------- Limit (cost=3351813.70..3351813.71 rows=5 width=0) -> Cluster Merge Gather (cost=3351813.70..3351813.71 rows=5 width=0) Sort Key: supplier.s_acctbal DESC, nation.n_name, supplier.s_name, part.p_partkey -> Limit (cost=3350813.60..3350813.61 rows=1 width=193) -> Sort (cost=3350813.60..3350813.61 rows=0 width=193) Sort Key: supplier.s_acctbal DESC, nation.n_name, supplier.s_name, part.p_partkey -> Hash Join (cost=745359.38..3350813.59 rows=0 width=193) Hash Cond: ((partsupp.ps_partkey = part.p_partkey) AND (partsupp.ps_supplycost = (SubPlan 1))) -> Hash Join (cost=35483.36..2640803.16 rows=25603 width=173) Hash Cond: (partsupp.ps_suppkey = supplier.s_suppkey) -> Seq Scan on partsupp (cost=0.00..2544033.48 rows=16001650 width=14) -> Hash (cost=35383.36..35383.36 rows=8000 width=167) -> Cluster Reduce (cost=3.36..35383.36 rows=8000 width=167) -> Hash Join (cost=2.36..33012.36 rows=1600 width=167) Hash Cond: (supplier.s_nationkey = nation.n_nationkey) -> Seq Scan on supplier (cost=0.00..32180.00 rows=200000 width=145) -> Hash (cost=2.35..2.35 rows=1 width=30) -> Hash Join (cost=1.07..2.35 rows=1 width=30) Hash Cond: (nation.n_regionkey = region.r_regionkey) -> Seq Scan on nation (cost=0.00..1.25 rows=5 width=34) -> Hash (cost=1.06..1.06 rows=1 width=4) -> Seq Scan on region (cost=0.00..1.06 rows=1 width=4) Filter: (r_name = 'EUROPE'::bpchar) -> Hash (cost=709609.29..709609.29 rows=17782 width=30) -> Seq Scan on part (cost=0.00..709609.29 rows=17782 width=30) Filter: (((p_type)::text ~~ '%BRASS'::text) AND (p_size = 15)) SubPlan 1 -> Materialize (cost=28851255.69..28851255.71 rows=1 width=32) -> Aggregate (cost=28851255.69..28851255.70 rows=1 width=32) -> Hash Join (cost=35610.36..28851255.69 rows=1 width=6) Hash Cond: (partsupp_1.ps_suppkey = supplier_1.s_suppkey) -> Reduce Scan (cost=1.00..28509214.73 rows=80008250 width=10) Filter: (part.p_partkey = ps_partkey) -> Cluster Reduce (cost=1.00..27718507.48 rows=80008250 width=14) -> Seq Scan on partsupp partsupp_1 (cost=0.00..2544033.48 rows=16001650 width=14) -> Hash (cost=35509.36..35509.36 rows=8000 width=4) -> Cluster Reduce (cost=3.36..35509.36 rows=8000 width=4) -> Hash Join (cost=2.36..33012.36 rows=1600 width=4) Hash Cond: (supplier_1.s_nationkey = nation_1.n_nationkey) -> Seq Scan on supplier supplier_1 (cost=0.00..32180.00 rows=200000 width=8) -> Hash (cost=2.35..2.35 rows=1 width=4) -> Hash Join (cost=1.07..2.35 rows=1 width=4) Hash Cond: (nation_1.n_regionkey = region_1.r_regionkey) -> Seq Scan on nation nation_1 (cost=0.00..1.25 rows=5 width=8) -> Hash (cost=1.06..1.06 rows=1 width=4) -> Seq Scan on region region_1 (cost=0.00..1.06 rows=1 width=4) Filter: (r_name = 'EUROPE'::bpchar) (47 rows) QUERY PLAN ----------------------------------------------------------------------------------------------------------------------------- Limit (cost=85.86..85.87 rows=1 width=716) -> Sort (cost=85.86..85.87 rows=1 width=716) Sort Key: supplier.s_acctbal DESC, nation.n_name, supplier.s_name, part.p_partkey -> Hash Join (cost=48.95..85.73 rows=1 width=716) Hash Cond: ((part.p_partkey = partsupp.ps_partkey) AND ((SubPlan 1) = partsupp.ps_supplycost)) -> Seq Scan on part (cost=0.00..12.40 rows=1 width=108) Filter: (((p_type)::text ~~ '%BRASS'::text) AND (p_size = 15)) -> Hash (cost=48.93..48.93 rows=1 width=630) -> Hash Join (cost=36.58..48.93 rows=1 width=630) Hash Cond: (partsupp.ps_suppkey = supplier.s_suppkey) -> Seq Scan on partsupp (cost=0.00..11.70 rows=170 width=26) -> Hash (cost=36.57..36.57 rows=1 width=612) -> Hash Join (cost=24.50..36.57 rows=1 width=612) Hash Cond: (supplier.s_nationkey = nation.n_nationkey) -> Seq Scan on supplier (cost=0.00..11.50 rows=150 width=512) -> Hash (cost=24.48..24.48 rows=1 width=108) -> Hash Join (cost=12.14..24.48 rows=1 width=108) Hash Cond: (nation.n_regionkey = region.r_regionkey) -> Seq Scan on nation (cost=0.00..11.70 rows=170 width=112) -> Hash (cost=12.12..12.12 rows=1 width=4) -> Seq Scan on region (cost=0.00..12.12 rows=1 width=4) Filter: (r_name = 'EUROPE'::bpchar) SubPlan 1 -> Aggregate (cost=48.72..48.73 rows=1 width=32) -> Hash Join (cost=36.36..48.72 rows=1 width=18) Hash Cond: (nation_1.n_regionkey = region_1.r_regionkey) -> Hash Join (cost=24.22..36.57 rows=1 width=22) Hash Cond: (nation_1.n_nationkey = supplier_1.s_nationkey) -> Seq Scan on nation nation_1 (cost=0.00..11.70 rows=170 width=8) -> Hash (cost=24.21..24.21 rows=1 width=22) -> Hash Join (cost=12.14..24.21 rows=1 width=22) Hash Cond: (supplier_1.s_suppkey = partsupp_1.ps_suppkey) -> Seq Scan on supplier supplier_1 (cost=0.00..11.50 rows=150 width=8) -> Hash (cost=12.12..12.12 rows=1 width=22) -> Seq Scan on partsupp partsupp_1 (cost=0.00..12.12 rows=1 width=22) Filter: (part.p_partkey = ps_partkey) -> Hash (cost=12.12..12.12 rows=1 width=4) -> Seq Scan on region region_1 (cost=0.00..12.12 rows=1 width=4) Filter: (r_name = 'EUROPE'::bpchar) (39 rows) pgå•æœºæ‰§è¡Œè®¡åˆ’å’Œantdbåˆ†å¸ƒå¼æ‰§è¡Œè®¡åˆ’å¤§è‡´ä¸€æ ·ï¼Œå’Œä¹‹å‰gpçš„ç»“è®ºæœ‰"><meta itemprop=dateModified content="2025-07-21T18:54:45+08:00"><meta itemprop=wordCount content="7171"><meta itemprop=image content="https://askyx.github.io/img/global-background.jpg"><header><h1 itemprop=headline></h1><p class=text-sm><span data-format=luxon>0001-01-01T00:00:00Z</span>
| <span>15 minute read</span>
| <span>Updated at
<span data-format=luxon>2025-07-21T18:54:45+08:00</span></span></p></header><section id=dream-single-post-content itemprop=articleBody><h1 id=æ‰§è¡Œè®¡åˆ’>æ‰§è¡Œè®¡åˆ’</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>set</span> enable_mergejoin<span style=color:#f92672>=</span><span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>set</span> enable_nestloop<span style=color:#f92672>=</span><span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span>
</span></span><span style=display:flex><span>  s_acctbal,
</span></span><span style=display:flex><span>  s_name,
</span></span><span style=display:flex><span>  n_name,
</span></span><span style=display:flex><span>  p_partkey,
</span></span><span style=display:flex><span>  p_mfgr,
</span></span><span style=display:flex><span>  s_address,
</span></span><span style=display:flex><span>  s_phone,
</span></span><span style=display:flex><span>  s_comment
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span>
</span></span><span style=display:flex><span>  part,
</span></span><span style=display:flex><span>  supplier,
</span></span><span style=display:flex><span>  partsupp,
</span></span><span style=display:flex><span>  nation,
</span></span><span style=display:flex><span>  region
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span>
</span></span><span style=display:flex><span>  p_partkey <span style=color:#f92672>=</span> ps_partkey
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>and</span> s_suppkey <span style=color:#f92672>=</span> ps_suppkey
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>and</span> p_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>15</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>and</span> p_type <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;%BRASS&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>and</span> s_nationkey <span style=color:#f92672>=</span> n_nationkey
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>and</span> n_regionkey <span style=color:#f92672>=</span> r_regionkey
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>and</span> r_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;EUROPE&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>and</span> ps_supplycost <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>select</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>min</span>(ps_supplycost)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>from</span>
</span></span><span style=display:flex><span>      partsupp,
</span></span><span style=display:flex><span>      supplier,
</span></span><span style=display:flex><span>      nation,
</span></span><span style=display:flex><span>      region
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>where</span>
</span></span><span style=display:flex><span>      p_partkey <span style=color:#f92672>=</span> ps_partkey
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>and</span> s_suppkey <span style=color:#f92672>=</span> ps_suppkey
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>and</span> s_nationkey <span style=color:#f92672>=</span> n_nationkey
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>and</span> n_regionkey <span style=color:#f92672>=</span> r_regionkey
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>and</span> r_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;EUROPE&#39;</span>
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span><span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span>
</span></span><span style=display:flex><span>  s_acctbal <span style=color:#66d9ef>desc</span>,
</span></span><span style=display:flex><span>  n_name,
</span></span><span style=display:flex><span>  s_name,
</span></span><span style=display:flex><span>  p_partkey <span style=color:#66d9ef>limit</span> <span style=color:#ae81ff>100</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                                                        QUERY PLAN                                                                         
</span></span><span style=display:flex><span><span style=color:#75715e>-----------------------------------------------------------------------------------------------------------------------------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#66d9ef>Limit</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>3351813</span>.<span style=color:#ae81ff>70</span>..<span style=color:#ae81ff>3351813</span>.<span style=color:#ae81ff>71</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>   <span style=color:#f92672>-&gt;</span>  <span style=color:#66d9ef>Cluster</span> Merge Gather  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>3351813</span>.<span style=color:#ae81ff>70</span>..<span style=color:#ae81ff>3351813</span>.<span style=color:#ae81ff>71</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>         Sort <span style=color:#66d9ef>Key</span>: supplier.s_acctbal <span style=color:#66d9ef>DESC</span>, nation.n_name, supplier.s_name, part.p_partkey
</span></span><span style=display:flex><span>         <span style=color:#f92672>-&gt;</span>  <span style=color:#66d9ef>Limit</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>3350813</span>.<span style=color:#ae81ff>60</span>..<span style=color:#ae81ff>3350813</span>.<span style=color:#ae81ff>61</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>193</span>)
</span></span><span style=display:flex><span>               <span style=color:#f92672>-&gt;</span>  Sort  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>3350813</span>.<span style=color:#ae81ff>60</span>..<span style=color:#ae81ff>3350813</span>.<span style=color:#ae81ff>61</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>193</span>)
</span></span><span style=display:flex><span>                     Sort <span style=color:#66d9ef>Key</span>: supplier.s_acctbal <span style=color:#66d9ef>DESC</span>, nation.n_name, supplier.s_name, part.p_partkey
</span></span><span style=display:flex><span>                     <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>745359</span>.<span style=color:#ae81ff>38</span>..<span style=color:#ae81ff>3350813</span>.<span style=color:#ae81ff>59</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>193</span>)
</span></span><span style=display:flex><span>                           Hash Cond: ((partsupp.ps_partkey <span style=color:#f92672>=</span> part.p_partkey) <span style=color:#66d9ef>AND</span> (partsupp.ps_supplycost <span style=color:#f92672>=</span> (SubPlan <span style=color:#ae81ff>1</span>)))
</span></span><span style=display:flex><span>                           <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>35483</span>.<span style=color:#ae81ff>36</span>..<span style=color:#ae81ff>2640803</span>.<span style=color:#ae81ff>16</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>25603</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>173</span>)
</span></span><span style=display:flex><span>                                 Hash Cond: (partsupp.ps_suppkey <span style=color:#f92672>=</span> supplier.s_suppkey)
</span></span><span style=display:flex><span>                                 <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> partsupp  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>2544033</span>.<span style=color:#ae81ff>48</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>16001650</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>14</span>)
</span></span><span style=display:flex><span>                                 <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>35383</span>.<span style=color:#ae81ff>36</span>..<span style=color:#ae81ff>35383</span>.<span style=color:#ae81ff>36</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>8000</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>167</span>)
</span></span><span style=display:flex><span>                                       <span style=color:#f92672>-&gt;</span>  <span style=color:#66d9ef>Cluster</span> Reduce  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>.<span style=color:#ae81ff>36</span>..<span style=color:#ae81ff>35383</span>.<span style=color:#ae81ff>36</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>8000</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>167</span>)
</span></span><span style=display:flex><span>                                             <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>36</span>..<span style=color:#ae81ff>33012</span>.<span style=color:#ae81ff>36</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1600</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>167</span>)
</span></span><span style=display:flex><span>                                                   Hash Cond: (supplier.s_nationkey <span style=color:#f92672>=</span> nation.n_nationkey)
</span></span><span style=display:flex><span>                                                   <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> supplier  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>32180</span>.<span style=color:#ae81ff>00</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>200000</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>145</span>)
</span></span><span style=display:flex><span>                                                   <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>35</span>..<span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>35</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>)
</span></span><span style=display:flex><span>                                                         <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>07</span>..<span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>35</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>)
</span></span><span style=display:flex><span>                                                               Hash Cond: (nation.n_regionkey <span style=color:#f92672>=</span> region.r_regionkey)
</span></span><span style=display:flex><span>                                                               <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> nation  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>25</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>34</span>)
</span></span><span style=display:flex><span>                                                               <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>06</span>..<span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>06</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>                                                                     <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> region  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>06</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>                                                                           Filter: (r_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;EUROPE&#39;</span>::bpchar)
</span></span><span style=display:flex><span>                           <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>709609</span>.<span style=color:#ae81ff>29</span>..<span style=color:#ae81ff>709609</span>.<span style=color:#ae81ff>29</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>17782</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>)
</span></span><span style=display:flex><span>                                 <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> part  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>709609</span>.<span style=color:#ae81ff>29</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>17782</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>)
</span></span><span style=display:flex><span>                                       Filter: (((p_type)::text <span style=color:#f92672>~~</span> <span style=color:#e6db74>&#39;%BRASS&#39;</span>::text) <span style=color:#66d9ef>AND</span> (p_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>15</span>))
</span></span><span style=display:flex><span>                                 SubPlan <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                                   <span style=color:#f92672>-&gt;</span>  Materialize  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>28851255</span>.<span style=color:#ae81ff>69</span>..<span style=color:#ae81ff>28851255</span>.<span style=color:#ae81ff>71</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>32</span>)
</span></span><span style=display:flex><span>                                         <span style=color:#f92672>-&gt;</span>  <span style=color:#66d9ef>Aggregate</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>28851255</span>.<span style=color:#ae81ff>69</span>..<span style=color:#ae81ff>28851255</span>.<span style=color:#ae81ff>70</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>32</span>)
</span></span><span style=display:flex><span>                                               <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>35610</span>.<span style=color:#ae81ff>36</span>..<span style=color:#ae81ff>28851255</span>.<span style=color:#ae81ff>69</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span>)
</span></span><span style=display:flex><span>                                                     Hash Cond: (partsupp_1.ps_suppkey <span style=color:#f92672>=</span> supplier_1.s_suppkey)
</span></span><span style=display:flex><span>                                                     <span style=color:#f92672>-&gt;</span>  Reduce Scan  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>28509214</span>.<span style=color:#ae81ff>73</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>80008250</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>                                                           Filter: (part.p_partkey <span style=color:#f92672>=</span> ps_partkey)
</span></span><span style=display:flex><span>                                                           <span style=color:#f92672>-&gt;</span>  <span style=color:#66d9ef>Cluster</span> Reduce  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>27718507</span>.<span style=color:#ae81ff>48</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>80008250</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>14</span>)
</span></span><span style=display:flex><span>                                                                 <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> partsupp partsupp_1  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>2544033</span>.<span style=color:#ae81ff>48</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>16001650</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>14</span>)
</span></span><span style=display:flex><span>                                                     <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>35509</span>.<span style=color:#ae81ff>36</span>..<span style=color:#ae81ff>35509</span>.<span style=color:#ae81ff>36</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>8000</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>                                                           <span style=color:#f92672>-&gt;</span>  <span style=color:#66d9ef>Cluster</span> Reduce  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>.<span style=color:#ae81ff>36</span>..<span style=color:#ae81ff>35509</span>.<span style=color:#ae81ff>36</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>8000</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>                                                                 <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>36</span>..<span style=color:#ae81ff>33012</span>.<span style=color:#ae81ff>36</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1600</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>                                                                       Hash Cond: (supplier_1.s_nationkey <span style=color:#f92672>=</span> nation_1.n_nationkey)
</span></span><span style=display:flex><span>                                                                       <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> supplier supplier_1  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>32180</span>.<span style=color:#ae81ff>00</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>200000</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
</span></span><span style=display:flex><span>                                                                       <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>35</span>..<span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>35</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>                                                                             <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>07</span>..<span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>35</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>                                                                                   Hash Cond: (nation_1.n_regionkey <span style=color:#f92672>=</span> region_1.r_regionkey)
</span></span><span style=display:flex><span>                                                                                   <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> nation nation_1  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>25</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
</span></span><span style=display:flex><span>                                                                                   <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>06</span>..<span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>06</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>                                                                                         <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> region region_1  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>06</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>                                                                                               Filter: (r_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;EUROPE&#39;</span>::bpchar)
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>47</span> <span style=color:#66d9ef>rows</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                                         QUERY PLAN
</span></span><span style=display:flex><span><span style=color:#75715e>-----------------------------------------------------------------------------------------------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#66d9ef>Limit</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>85</span>.<span style=color:#ae81ff>86</span>..<span style=color:#ae81ff>85</span>.<span style=color:#ae81ff>87</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>716</span>)
</span></span><span style=display:flex><span>   <span style=color:#f92672>-&gt;</span>  Sort  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>85</span>.<span style=color:#ae81ff>86</span>..<span style=color:#ae81ff>85</span>.<span style=color:#ae81ff>87</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>716</span>)
</span></span><span style=display:flex><span>         Sort <span style=color:#66d9ef>Key</span>: supplier.s_acctbal <span style=color:#66d9ef>DESC</span>, nation.n_name, supplier.s_name, part.p_partkey
</span></span><span style=display:flex><span>         <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>48</span>.<span style=color:#ae81ff>95</span>..<span style=color:#ae81ff>85</span>.<span style=color:#ae81ff>73</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>716</span>)
</span></span><span style=display:flex><span>               Hash Cond: ((part.p_partkey <span style=color:#f92672>=</span> partsupp.ps_partkey) <span style=color:#66d9ef>AND</span> ((SubPlan <span style=color:#ae81ff>1</span>) <span style=color:#f92672>=</span> partsupp.ps_supplycost))
</span></span><span style=display:flex><span>               <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> part  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>12</span>.<span style=color:#ae81ff>40</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>108</span>)
</span></span><span style=display:flex><span>                     Filter: (((p_type)::text <span style=color:#f92672>~~</span> <span style=color:#e6db74>&#39;%BRASS&#39;</span>::text) <span style=color:#66d9ef>AND</span> (p_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>15</span>))
</span></span><span style=display:flex><span>               <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>48</span>.<span style=color:#ae81ff>93</span>..<span style=color:#ae81ff>48</span>.<span style=color:#ae81ff>93</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>630</span>)
</span></span><span style=display:flex><span>                     <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>36</span>.<span style=color:#ae81ff>58</span>..<span style=color:#ae81ff>48</span>.<span style=color:#ae81ff>93</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>630</span>)
</span></span><span style=display:flex><span>                           Hash Cond: (partsupp.ps_suppkey <span style=color:#f92672>=</span> supplier.s_suppkey)
</span></span><span style=display:flex><span>                           <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> partsupp  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>11</span>.<span style=color:#ae81ff>70</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>170</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>26</span>)
</span></span><span style=display:flex><span>                           <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>36</span>.<span style=color:#ae81ff>57</span>..<span style=color:#ae81ff>36</span>.<span style=color:#ae81ff>57</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>612</span>)
</span></span><span style=display:flex><span>                                 <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>24</span>.<span style=color:#ae81ff>50</span>..<span style=color:#ae81ff>36</span>.<span style=color:#ae81ff>57</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>612</span>)
</span></span><span style=display:flex><span>                                       Hash Cond: (supplier.s_nationkey <span style=color:#f92672>=</span> nation.n_nationkey)
</span></span><span style=display:flex><span>                                       <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> supplier  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>11</span>.<span style=color:#ae81ff>50</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>150</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>512</span>)
</span></span><span style=display:flex><span>                                       <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>24</span>.<span style=color:#ae81ff>48</span>..<span style=color:#ae81ff>24</span>.<span style=color:#ae81ff>48</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>108</span>)
</span></span><span style=display:flex><span>                                             <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>.<span style=color:#ae81ff>14</span>..<span style=color:#ae81ff>24</span>.<span style=color:#ae81ff>48</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>108</span>)
</span></span><span style=display:flex><span>                                                   Hash Cond: (nation.n_regionkey <span style=color:#f92672>=</span> region.r_regionkey)
</span></span><span style=display:flex><span>                                                   <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> nation  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>11</span>.<span style=color:#ae81ff>70</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>170</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>112</span>)
</span></span><span style=display:flex><span>                                                   <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>.<span style=color:#ae81ff>12</span>..<span style=color:#ae81ff>12</span>.<span style=color:#ae81ff>12</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>                                                         <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> region  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>12</span>.<span style=color:#ae81ff>12</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>                                                               Filter: (r_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;EUROPE&#39;</span>::bpchar)
</span></span><span style=display:flex><span>               SubPlan <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                 <span style=color:#f92672>-&gt;</span>  <span style=color:#66d9ef>Aggregate</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>48</span>.<span style=color:#ae81ff>72</span>..<span style=color:#ae81ff>48</span>.<span style=color:#ae81ff>73</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>32</span>)
</span></span><span style=display:flex><span>                       <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>36</span>.<span style=color:#ae81ff>36</span>..<span style=color:#ae81ff>48</span>.<span style=color:#ae81ff>72</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>18</span>)
</span></span><span style=display:flex><span>                             Hash Cond: (nation_1.n_regionkey <span style=color:#f92672>=</span> region_1.r_regionkey)
</span></span><span style=display:flex><span>                             <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>24</span>.<span style=color:#ae81ff>22</span>..<span style=color:#ae81ff>36</span>.<span style=color:#ae81ff>57</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>22</span>)
</span></span><span style=display:flex><span>                                   Hash Cond: (nation_1.n_nationkey <span style=color:#f92672>=</span> supplier_1.s_nationkey)
</span></span><span style=display:flex><span>                                   <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> nation nation_1  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>11</span>.<span style=color:#ae81ff>70</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>170</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
</span></span><span style=display:flex><span>                                   <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>24</span>.<span style=color:#ae81ff>21</span>..<span style=color:#ae81ff>24</span>.<span style=color:#ae81ff>21</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>22</span>)
</span></span><span style=display:flex><span>                                         <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>.<span style=color:#ae81ff>14</span>..<span style=color:#ae81ff>24</span>.<span style=color:#ae81ff>21</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>22</span>)
</span></span><span style=display:flex><span>                                               Hash Cond: (supplier_1.s_suppkey <span style=color:#f92672>=</span> partsupp_1.ps_suppkey)
</span></span><span style=display:flex><span>                                               <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> supplier supplier_1  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>11</span>.<span style=color:#ae81ff>50</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>150</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
</span></span><span style=display:flex><span>                                               <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>.<span style=color:#ae81ff>12</span>..<span style=color:#ae81ff>12</span>.<span style=color:#ae81ff>12</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>22</span>)
</span></span><span style=display:flex><span>                                                     <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> partsupp partsupp_1  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>12</span>.<span style=color:#ae81ff>12</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>22</span>)
</span></span><span style=display:flex><span>                                                           Filter: (part.p_partkey <span style=color:#f92672>=</span> ps_partkey)
</span></span><span style=display:flex><span>                             <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>.<span style=color:#ae81ff>12</span>..<span style=color:#ae81ff>12</span>.<span style=color:#ae81ff>12</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>                                   <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> region region_1  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>12</span>.<span style=color:#ae81ff>12</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>                                         Filter: (r_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;EUROPE&#39;</span>::bpchar)
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>39</span> <span style=color:#66d9ef>rows</span>)
</span></span></code></pre></div><p>pgå•æœºæ‰§è¡Œè®¡åˆ’å’Œantdbåˆ†å¸ƒå¼æ‰§è¡Œè®¡åˆ’å¤§è‡´ä¸€æ ·ï¼Œå’Œä¹‹å‰gpçš„ç»“è®ºæœ‰</p><ul><li>joinä¸¤è¾¹çš„å­—æ®µéƒ½æ˜¯åˆ†å¸ƒé”®ï¼Œæ²¡æœ‰æ•°æ®é‡åˆ†å¸ƒæ“ä½œ<ol><li>å¦‚æžœä½¿ç”¨æ¡ä»¶ï¼Œåˆ™å¯¹è¡¨è¾¾å¼è¿›è¡Œhashè®¡ç®—æ‰§è¡ŒèŠ‚ç‚¹ï¼Œå¦‚æžœèƒ½è®¡ç®—åˆ°ä¸€ä¸ªæ‰§è¡ŒèŠ‚ç‚¹ï¼Œåˆ™é™å®šä¸€ä¸ªèŠ‚ç‚¹æ‰§è¡Œ</li></ol></li><li>å¤§è¡¨joinå¤§è¡¨<ol><li>å…¶ä¸­ä¸€ä¸ªjoinå­—æ®µæ˜¯åˆ†å¸ƒé”®ï¼Œå¦ä¸€ä¸ªä¸æ˜¯ï¼Œæ­¤æ—¶éžåˆ†å¸ƒé”®çš„è¡¨ä¼šè¢«é‡åˆ†å¸ƒã€‚</li><li>éƒ½ä¸æ˜¯åˆ†åŒºé”®ï¼Œä¸¤è¡¨éƒ½éœ€è¦é‡åˆ†å¸ƒ</li><li>å¦‚æžœjoinå­—æ®µä½¿ç”¨æ¡ä»¶ï¼Œåˆ™å¯¹è¡¨è¾¾å¼è¿›è¡Œhashè®¡ç®—æ‰§è¡ŒèŠ‚ç‚¹ï¼Œå¦‚æžœèƒ½è®¡ç®—åˆ°ä¸€ä¸ªæ‰§è¡ŒèŠ‚ç‚¹ï¼Œåˆ™é™å®šä¸€ä¸ªèŠ‚ç‚¹æ‰§è¡Œï¼Œé‡åˆ†å¸ƒçš„motionè¿˜æ˜¯ç»§ç»­åœ¨å¤šä¸ªèŠ‚ç‚¹æ‰§è¡Œ</li></ol></li><li>å°è¡¨joinå¤§è¡¨<ol><li>å°è¡¨ç”¨äº†åˆ†å¸ƒé”®ï¼Œå°è¡¨å¹¿æ’­</li><li>å¤§è¡¨ç”¨äº†åˆ†å¸ƒé”®ï¼Œå°è¡¨é‡åˆ†å¸ƒ</li><li>éƒ½ä¸æ˜¯åˆ†å¸ƒé”®ï¼Œå°è¡¨å¹¿æ’­</li><li>å¦‚æžœjoinå­—æ®µä½¿ç”¨æ¡ä»¶ï¼Œåˆ™å¯¹è¡¨è¾¾å¼è¿›è¡Œhashè®¡ç®—æ‰§è¡ŒèŠ‚ç‚¹ï¼Œå¦‚æžœèƒ½è®¡ç®—åˆ°ä¸€ä¸ªæ‰§è¡ŒèŠ‚ç‚¹ï¼Œåˆ™é™å®šä¸€ä¸ªèŠ‚ç‚¹æ‰§è¡Œï¼Œé‡åˆ†å¸ƒçš„motionè¿˜æ˜¯ç»§ç»­åœ¨å¤šä¸ªèŠ‚ç‚¹æ‰§è¡Œï¼Œè¿™é‡Œéœ€è¦è€ƒè™‘å¤§è¡¨ã€‚</li></ol></li></ul><p>å¯¹äºŽantdbçš„æ•°æ®é‡åˆ†å¸ƒï¼Œåˆ†ä¸ºä¸‹é¢å‡ ç§</p><ol><li>é‡åˆ†å¸ƒ</li><li>èšé›†</li></ol><p>å¯¹äºŽé‡åˆ†å¸ƒï¼Œä¸»è¦æ˜¯ä½¿ç”¨ <code>Cluster Reduce</code> ç®—å­ï¼ŒæŒ‰åŠŸèƒ½å¯ä»¥ç»†åˆ†ä¸º</p><ol><li>å¹¿æ’­
æ‰§è¡Œè®¡åˆ’ä¸­ç®—å­è¡¨çŽ°ä¸º <code>Reduce: unnest('[0:1]={16386,16387}'::oid[])</code></li><li>hashé‡åˆ†å¸ƒ
æ‰§è¡Œè®¡åˆ’ä¸­ç®—å­è¡¨çŽ°ä¸º <code>Reduce: ('[0:1]={16386,16387}'::oid[])[COALESCE(hash_combin_mod(2, hashint4(t2.c2)), 0)]</code></li></ol><p>å¯¹äºŽèšé›†ï¼Œä¸»è¦ä½¿ç”¨ <code>Cluster Gather</code> ç®—å­ï¼Œå¯ä»¥ç»†åˆ†ä¸º</p><ol><li>éžæŽ’åºèšé›†
æ‰§è¡Œè®¡åˆ’ä¸­ç®—å­è¡¨çŽ°ä¸º <code>Cluster Gather</code> ï¼Œä¸»è¦æ˜¯æ•°æ®å‘cnèšé›†</li><li>æŽ’åºèšé›†
æ‰§è¡Œè®¡åˆ’ä¸­ç®—å­è¡¨çŽ°ä¸º <code>Cluster Merge Gather</code>ï¼Œä¸»è¦æ˜¯æ•°æ®å‘cnèšé›†ï¼Œä½†æ˜¯èšé›†çš„æ•°æ®è¦æ±‚æœ‰åºï¼Œè¾“å‡ºçš„æ•°æ®ä¹Ÿæ˜¯æœ‰åºçš„</li></ol><p>è¿˜æœ‰ä¸€ç§ç‹¬ç«‹äºŽä¸Šé¢ä¸¤ç§çš„ç®—å­ <code>Reduce Scan</code>ï¼Œå…·å¤‡é‡åˆ†å¸ƒå’Œèšé›†æ“ä½œ</p><h2 id=æ‰§è¡Œè®¡åˆ’çš„å®žçŽ°>æ‰§è¡Œè®¡åˆ’çš„å®žçŽ°</h2><p>ç›¸æ¯”äºŽå•æœºï¼Œåˆ†å¸ƒå¼å°±æ˜¯éœ€è¦æŠŠæ•°æ®æŒ‰ç…§è¯­å¥çš„è¯­ä¹‰è¿›è¡Œæ•°æ®é‡åˆ†å¸ƒ</p><h1 id=æ‰§è¡Œå™¨>æ‰§è¡Œå™¨</h1><p>pg_plan_query æ‰§è¡Œè®¡åˆ’å…¥å£</p><p>planner å®žé™…æ‰§è¡Œè®¡åˆ’è°ƒç”¨
è¿™é‡Œæä¾›ä¸€ä¸ªplanner_hookï¼Œä»¥ä¾›è‡ªå®šä¹‰æ‰§è¡Œè®¡åˆ’ä½¿ç”¨</p><p>standard_planner é»˜è®¤planner hook
å…¥å£å¤„ï¼Œåˆ¤æ–­SQLæ˜¯å¦æ˜¯å¯ä»¥å¹¶è¡ŒæŸ¥è¯¢çš„
åˆ¤æ–­æ¡ä»¶
(cursorOptions & CURSOR_OPT_PARALLEL_OK) != 0 && å½“å‰æ¸¸æ ‡å…è®¸å¹¶è¡ŒæŸ¥è¯¢
IsUnderPostmaster && å½“å‰æ˜¯ç›´æŽ¥è°ƒç”¨çš„ç”¨æˆ·è¿›ç¨‹ï¼ˆpostmasterçš„å­è¿›ç¨‹ï¼‰ï¼Œ
parse->commandType == CMD_SELECT && å½“å‰æ˜¯select
!parse->hasModifyingCTE && å½“å‰CTEæ˜¯ä¸å¯å˜é›†åˆ
max_parallel_workers_per_gather > 0 && parallel worker è®¾ç½®å¤§äºŽ0
!IsParallelWorker() å½“å‰ä¸æ˜¯workerçš„æ‰§è¡Œè¿›ç¨‹</p><pre><code>ä¹‹åŽåˆ¤å®š glob-&gt;parallelModeNeeded = glob-&gt;parallelModeOK &amp;&amp;
(force_parallel_mode != FORCE_PARALLEL_OFF);
å¦‚æžœå¯ç”¨äº†force_parallel_modeï¼Œä½†æŸ¥è¯¢ä¸æ”¯æŒå¹¶è¡ŒæŸ¥è¯¢ï¼Œåˆ™ä¾ç„¶ä¸ä½¿ç”¨å¹¶è¡ŒæŸ¥è¯¢
å¦‚æžœä½¿ç”¨äº†CURSOR_OPT_FAST_PLAN
  å¤„ç† tuple_fraction
  å¦‚æžœtuple_fraction&gt;= 1 åˆ™è®¾ç½®ä¸º0
  å¦‚æžœtuple_fraction &lt;=0 è®¾ç½®ä¸º 1e-10;
å¦åˆ™ tuple_fraction=0

ä¹‹åŽæ‰§è¡Œsubquery_planner èŽ·å–æ‰§è¡Œè®¡åˆ’

fetch_upper_rel èŽ·å–ä¸Šå±‚releation
get_cheapest_fractional_path  é€‰å–æœ€ä½³æ‰§è¡Œè·¯å¾„
create_plan åˆ›å»ºæ‰§è¡Œè®¡åˆ’

å¯¹äºŽCURSOR_OPT_SCROLL
  å¦‚æžœä¸æ”¯æŒåŽå°æ‰§è¡ŒExecSupportsBackwardScan
  åˆ™é™„åŠ ä¸€ä¸ªç‰©åŒ–æŸ¥è¯¢è®¡åˆ’ materialize_finished_plan

å¯¹äºŽå¯ä»¥å¹¶è¡Œçš„æŸ¥è¯¢ï¼Œè¿™é‡Œå¤„ç†gatherè¿›è¡Œå¯è¡Œæ€§æµ‹è¯•ï¼ˆä¸å®žé™…æ‰§è¡Œï¼Œä½†éœ€è¦éªŒè¯gatherå¯ä»¥åˆ›å»ºï¼‰
  åˆ›å»ºgather
    æ‰§è¡Œåˆ—è¡¨
    workeræ•°é‡
    å¹¶è¡Œæ‰§è¡Œè®¡åˆ’
    gather-&gt;plan.startup_cost = top_plan-&gt;startup_cost + parallel_setup_cost;
    gather-&gt;plan.total_cost = top_plan-&gt;total_cost + parallel_setup_cost + parallel_tuple_cost * top_plan-&gt;plan_rows;
    æ‰§è¡Œä»£ä»·è®¡ç®—
æœ€åŽæ‰§è¡Œä¸€ç³»åˆ—èµ‹å€¼ï¼Œå®Œæˆplan
</code></pre><p>subquery_planner
å­æŸ¥è¯¢è®¡åˆ’ï¼Œæ‰€æœ‰æŸ¥è¯¢éƒ½æ˜¯å­æŸ¥è¯¢è¿­ä»£ï¼Œè¿™ä¸ªå‡½æ•°å¤„ç†å®žé™…çš„plan</p><pre><code>å¦‚æžœå­˜åœ¨cteå®šä¹‰ï¼Œåˆ™è®¾ç½®å…¥SS_process_ctes
å¦‚æžœæ²¡æœ‰fromå®šä¹‰ï¼Œä½¿ç”¨replace_empty_jointreeè®¾ç½®ä¸€ä¸ªç©ºå€¼
å¯¹äºŽANYä»¥åŠ EXISTS ï¼Œæ‰§è¡Œpull_up_sublinksï¼Œä¹Ÿå°±æ˜¯æ‰§è¡ŒæŸ¥è¯¢è€Œéžä¸‹æŽ¨åˆ°å­æŸ¥è¯¢
å¯¹äºŽå¯ä»¥é¢„å…ˆå¤„ç†çš„å‡½æ•°ï¼Œæ‰§è¡Œinline_set_returning_functions è®¾ç½®ä¸ºinlineçŠ¶æ€
æ£€æŸ¥å¹¶åˆå¹¶æ‰€æœ‰å¯ä»¥åˆå¹¶çš„å­æŸ¥è¯¢pull_up_subqueries
å¯¹äºŽunion allï¼Œæ‰§è¡Œflatten_simple_union_allåˆå¹¶åˆ°append relã€‚

å¤„ç†joinçš„æƒ…å†µï¼Œé€ä¸ªè¡¨è¿›è¡Œè¿­ä»£ï¼Œæ ¹æ®rtekindè¿›è¡Œåˆ¤æ–­
  RTE_RELATION
    å¦‚æžœè®¾ç½®äº†inhï¼Œæ£€æŸ¥æ˜¯å¦ä¸ºæœ‰å­æŸ¥è¯¢çš„é¡¹ç›®ï¼Œå¦‚æžœæ²¡æœ‰ï¼Œæ¸…ç†inhæ ‡è®°
  RTE_JOIN
    å¦‚æžœæ˜¯å¤–æŸ¥è¯¢ï¼Œåˆ™è®¾ç½®å¤–æŸ¥è¯¢æ ‡è®°
  RTE_RESULT
    å¦‚æžœæ˜¯ç»“æžœï¼Œè®¾ç½®hasResultRTEsä¸ºtrueï¼Œè¿™æ˜¯æ‰§è¡Œè®¡åˆ’å…¨å±€è®¾ç½®
  å¦‚æžœè®¾äº†lateralï¼Œåˆ™hasLateralRTEsä¸ºtrue
  
  æœ€åŽè®¾ç½®å®‰å…¨æŸ¥è¯¢çº§åˆ«

æ‰§è¡ŒRowMarkçš„å‰ç½®ä»»åŠ¡ preprocess_rowmarks

å¦‚æžœè®¾ç½®äº†having è®¾ç½®hasHavingQualæ ‡è®°

æ¸…ç†hasPseudoConstantQualsæ ‡è®°ï¼Œ
  
å¤„ç†preprocess_expressionè¡¨è¾¾å¼

å¯¹äºŽhasTargetSRFsé»˜è®¤ä¸ºtrue(å‡½æ•°ä¼šè¿”å›žä¸€ç»„è¿”å›žå€¼çš„æƒ…å†µï¼‰ï¼Œé€šè¿‡expression_returns_setè®¡ç®—å¾—åˆ°å…¶å®žé™…æ˜¯å¦å­˜åœ¨

å¯¹äºŽä½¿ç”¨äº†WITH CHECK OPTIONçš„æƒ…å†µï¼Œä½¿ç”¨WithCheckOptionå¤„ç†æ‰€æœ‰è¡¨è¾¾å¼çš„qualåˆ°withCheckOptions

è®¡ç®—returningListçš„è¿”å›žæƒ…å†µï¼Œç¡®å®šå…¶è¿”å›žå•å€¼è¿˜æ˜¯list

preprocess_qual_conditionsé€ä¸ªè®¡ç®—æ‰€æœ‰å­æŸ¥è¯¢çš„qualï¼ˆçº¦æŸï¼‰

preprocess_expressionè®¡ç®—å½“å‰æŸ¥è¯¢çš„havingQual

å¯¹äºŽæ‰€æœ‰çš„windowsè°ƒç”¨
  è®¾ç½®windowsèµ·ç‚¹
  è®¾ç½®windowç»ˆç‚¹

è®¾ç½®limitçš„offsetå’Œcount

å¯¹äºŽè®¾ç½®äº†onConflictçš„æƒ…å†µ
  å¤„ç†è®¾å®šçš„å¯èƒ½å†²çªçš„å‚æ•°ï¼Œå†²çªwhereæ¡ä»¶ï¼Œsetæ“ä½œï¼Œä»¥åŠsetå…³è”çš„whereæ¡ä»¶

åˆå§‹åŒ–append_rel_listï¼ˆæ ¹æ®å½“å‰append_rel_listé¢„è®¡ç®—è®¡ç®—è¡¨è¾¾å¼ï¼‰

å¤„ç†æ‰€æœ‰å­è¡¨çš„RTEè¡¨è¾¾å¼
  RTE_RELATION å¯¹è±¡æ˜¯è¡¨ è®¾ç½®ä¸ºç®€å•è¡¨æŸ¥è¯¢
  RTE_SUBQUERY å¯¹è±¡æ˜¯å­æŸ¥è¯¢ å¤„ç†å­æŸ¥è¯¢çš„åˆ«åé—®é¢˜
  RTE_FUNCTION å¯¹è±¡æ˜¯å‡½æ•° ç›´æŽ¥è°ƒç”¨preprocess_expressionå¤„ç†
  RTE_TABLEFUNC å¯¹è±¡æ˜¯è¡¨å‡½æ•°ï¼ˆåˆ—çš„åˆ—è¡¨ï¼‰ç›´æŽ¥è°ƒç”¨preprocess_expressionå¤„ç†
  RTE_VALUES å¯¹è±¡æ˜¯valuesåˆ—è¡¨ï¼Œä½¿ç”¨preprocess_expressionå¤„ç†
  
  æœ€åŽå¤„ç†å®‰å…¨è®¾ç½®rte-&gt;securityQuals

å¯¹äºŽå­˜åœ¨hasJoinRTEsçš„æƒ…å†µï¼Œæ¸…ç†æŽ‰æ‰€æœ‰joinaliasvarsï¼ˆå‰é¢å·²ç»é€šè¿‡è¡¨è¾¾å¼é¢„å¤„ç†å¤„ç†æŽ‰äº†åˆ«åçš„æƒ…å†µï¼‰

å°è¯•å¤„ç†havingæ“ä½œåˆ°whereæ¡ä»¶é‡Œé¢
  å¯¹äºŽ
    åŒ…å«å­æŸ¥è¯¢
    å­˜åœ¨group set
    å­˜åœ¨å‡½æ•°è®¡ç®—
    å­˜åœ¨ç»Ÿè®¡è®¡ç®—
  çš„æ¡ä»¶ï¼Œä¸å¤„ç†
  å¯¹äºŽæ²¡æœ‰group setçš„æƒ…å†µï¼Œå¤„ç†havingæ¡ä»¶åˆ°where 
  å…¶ä»–æ¡ä»¶havingå’Œwhereéƒ½å¤åˆ¶ä¸€ä»½

åŽ»æŽ‰ä¸å¿…è¦çš„groupingåˆ— remove_useless_groupby_columns

reduce_outer_joinså°è¯•åŽ»æŽ‰å¤–æŸ¥è¯¢ï¼Œå˜æˆå†…è”æŸ¥è¯¢
remove_useless_result_rtes å°è¯•åˆ é™¤æ²¡æœ‰è¢«ç”¨åˆ°çš„ç»“æžœè¡¨è¾¾å¼

å¯¹äºŽç»§æ‰¿è¡¨æ‰§è¡Œinheritance_planner
é»˜è®¤æ‰§è¡Œgrouping_planner

SS_identify_outer_paramsæ‰¾åˆ°æ‰€éœ€è¦å¤–å±‚ä¼ å…¥çš„å‚æ•°

SS_charge_for_initplans ä¿®æ”¹initè®¡åˆ’
  é‡æ–°è®¡ç®—initplan_costï¼š æ¯ä¸ªå­æŸ¥è¯¢çš„initsubplan-&gt;startup_cost + initsubplan-&gt;per_call_cost;
  å½“å‰path-&gt;startup_costï¼Œpath-&gt;total_costéƒ½ä¼šåŠ ä¸Šinitplan_cost
set_cheapest æœ€ç»ˆç¡®è®¤å½“å‰æ˜¯æœ€ä¼˜æ‰§è¡Œè®¡åˆ’
  é€ä¸ªæ£€æŸ¥æ‰€æœ‰æ‰§è¡Œè·¯å¾„ï¼Œæ¯”è¾ƒé€‰æ‹©å‡ºæ¥æœ€å°ä»£ä»·path
</code></pre><p>grouping_planner å®žé™…æ‰§è¡Œplannerçš„å†…éƒ¨
è®¾ç½®limitå’Œoffsetï¼Œå¯¹äºŽoffsetæ²¡æœ‰è®¾ç½®çš„è¯ï¼Œé»˜è®¤ä¸º0
å¯¹äºŽUNION/INTERSECT/EXCEPT
å¯¹äºŽsortClause å­˜åœ¨sortçš„æƒ…å†µï¼Œè®¾ç½®tuple_fraction=0.0</p><pre><code>  plan_set_operations
    ä½¿ç”¨æœ€å·¦ï¼ˆç¬¬ä¸€ä¸ªï¼‰æŸ¥è¯¢çš„åˆ—ä½œä¸ºé¡ºåº
    å¯¹äºŽé€’å½’union
      ç”Ÿæˆé€’å½’è·¯å¾„ generate_recursion_path ï¼Ÿ 
    é»˜è®¤æ‰§è¡Œ recurse_set_operationsï¼Ÿ
  æ£€æŸ¥æ˜¯å¦å¯ä»¥å¹¶è¡Œis_parallel_safe(root, (Node *) final_target-&gt;exprs);
  è¿™é‡Œå†æ¬¡æ£€æŸ¥ä¸å…è®¸ä½¿ç”¨for updateï¼Œfor shareå…³é”®å­—ï¼ˆè¯­æ³•å±‚å·²ç»æ£€æŸ¥ï¼Œè¿™é‡Œå†æ£€æŸ¥ä¸€éï¼‰
  æœ€åŽè®¾ç½®æŽ’åºçš„é¡ºåºmake_pathkeys_for_sortclauses
å¯¹äºŽgroupingè®¾ç½®äº†setsçš„æƒ…å†µ
  æ‰§è¡Œpreprocess_grouping_setsé¢„å…ˆå¤„ç†
å¦åˆ™æ­£å¸¸å¤„ç†groupè¯­æ³• preprocess_groupclause

è®¾ç½®æŸ¥è¯¢ç›®æ ‡åˆ—è¡¨ï¼Œæ–¹ä¾¿ä¸Šå±‚ä½¿ç”¨ preprocess_targetlist

å¤„ç†æ‰§è¡Œä»£ä»·
  get_agg_clause_costs

å¯¹äºŽwindowså‡½æ•°
  find_window_functionsæ‰¾åˆ°æ‰€æœ‰å‡½æ•°ï¼Œä¹‹åŽselect_active_windowsè®¾ç½®åˆ°activeWindows

å¯¹äºŽmaxï¼Œminè®¡ç®—ï¼Œæ‰§è¡Œpreprocess_minmax_aggregates ï¼ˆè¿™é‡Œä»£ç ä¸Žquery_planneré‡å¤ï¼Œå¦‚æžœéœ€è¦å˜æ›´minã€maxé€»è¾‘ï¼Œåˆ™éœ€è¦ä¸¤è¾¹ä¸€èµ·æ”¹ï¼‰

ç¡®è®¤æ˜¯å¦æœ‰å†™æ­»çš„limit_tuplesä»¥åŠéžä¾‹å¤–ï¼Œå¦‚æžœæœ‰ï¼Œé‡‡ç”¨å†™æ­»çš„limit_tuplesï¼ˆä¾‹å¤–ä¸ºè¿™äº›ï¼š groupï¼Œgroup setï¼Œdistinctï¼Œaggregationï¼ˆèšåˆæ“ä½œï¼‰ï¼Œwindowså‡½æ•°ï¼Œhavingæ¡ä»¶ï¼Œå‡½æ•°è°ƒç”¨     è®¾ç½®root-&gt;limit_tuples = -1.0ï¼‰

è®¾ç½®windowså›žè°ƒactiveWindowsä»¥åŠgroupå›žè°ƒgroupClauseï¼ŒåŒ…æ‹¬rollups

æ‰§è¡Œquery_planner standard_qp_callback å¤„ç†æ‰§è¡Œè·¯å¾„ï¼Œå¹¶å¤„ç†sortï¼Œdistinctçš„æƒ…å†µ

è½¬æ¢processed_tliståˆ°final_target create_pathtarget

å¯¹äºŽorder byåˆ¤æ–­æ˜¯å¦å¯ä»¥è·³è¿‡æŽ’åºé˜¶æ®µ make_sort_input_target
  æ¯”å¦‚distinctï¼Œunionçš„æƒ…å†µ
å¯¹äºŽwindowså‡½æ•°ï¼Œåˆ¤æ–­æ˜¯å¦å¯ä»¥è·³è¿‡groupèšåˆæ“ä½œ make_window_input_target
  å¦‚æžœå·²ç»æœ‰é¢„å…ˆçš„å¤„ç†
å¯¹äºŽhaving groupï¼ˆåŒ…æ‹¬havingï¼Œgroupï¼Œèšåˆå‡½æ•°ï¼Œgroup setçš„æƒ…å†µï¼‰
  è§„åˆ’æ˜¯å¦éœ€è¦è®¡ç®—
å¯¹äºŽè¿”å›žé›†åˆçš„å‡½æ•° SRF set-returning functions
  åˆ‡å‰²å‡ºæ¥stfs split_pathtarget_at_srfs
    final_target
    sort_input_target
    grouping_target
    scanjoin_target
apply_scanjoin_target_to_paths å¤„ç†æ‰€æœ‰scanï¼Œjoin è¡¨ï¼Œå¹¶éåŽ†å…¶å­ä»£ç”Ÿæˆæœ€ç»ˆçš„æ‰«æç›®æ ‡

ä¿å­˜å¯¹è±¡ä¿¡æ¯
  root-&gt;upper_targets[UPPERREL_FINAL] = final_target;
  root-&gt;upper_targets[UPPERREL_ORDERED] = final_target;
  root-&gt;upper_targets[UPPERREL_DISTINCT] = sort_input_target;
  root-&gt;upper_targets[UPPERREL_WINDOW] = sort_input_target;
  root-&gt;upper_targets[UPPERREL_GROUP_AGG] = grouping_target;

create_grouping_pathsåˆ›å»ºgroupingè·¯å¾„ï¼Œå¯¹äºŽSRFå•ç‹¬å¤„ç†adjust_paths_for_srfs

create_window_pathsåˆ›å»ºwindowsæ‰§è¡Œè·¯å¾„ï¼Œå¯¹äºŽSRFå•ç‹¬å¤„ç†adjust_paths_for_srfs

create_distinct_pathsåˆ›å»ºdistinctæ‰§è¡Œè·¯å¾„ï¼Œå¯¹äºŽsrfå•ç‹¬å¤„ç†adjust_paths_for_srfs

create_ordered_pathsåˆ›å»ºorder byæ‰§è¡Œè·¯å¾„ï¼Œå¯¹äºŽsrfå•ç‹¬å¤„ç†adjust_paths_for_srfs

èŽ·å–ä¸Šå±‚rel fetch_upper_rel
  å¦‚æžœä¸Šå±‚å…è®¸å¹¶è¡Œï¼Œåˆ™æ­¤å¤„å…è®¸å¹¶è¡Œ
  final_rel-&gt;consider_parallel = true;
å¼€å§‹å¤„ç†æœ€ç»ˆæŸ¥è¯¢ éåŽ†å½“å‰æ‰€æœ‰path
  å¯¹äºŽfor updateï¼Œshare åˆ›å»ºcreate_lockrows_path
  è®¾ç½®limit create_limit_path
  å¯¹äºŽéžselectï¼ˆinsertï¼Œupdateï¼Œdeleteï¼‰æ–°å¢žModifyTableèŠ‚ç‚¹ parse-&gt;commandType != CMD_SELECT &amp;&amp; !inheritance_update
    ä½¿ç”¨ç´¢å¼•
    æ£€æŸ¥check option withCheckOptionLists
    è¿”å›žåˆ—è¡¨ returningLists
    è¡Œæ ‡è®°ï¼ˆåŠ é”ï¼‰ rowMarks
    å¯¹äºŽåˆ†åŒºè¡¨å•ç‹¬æ ‡è®° rootRelation

    åˆ›å»ºcreate_modifytable_path æ–°å¢žModifyTableèŠ‚ç‚¹

    æ–°å¢žåˆ°æ‰§è¡Œpath
å¤„ç†partial add_partial_path
  å¯¹äºŽå¹¶è¡ŒæŸ¥è¯¢è®¤ä¸ºå¹¶ä¸å®‰å…¨ï¼Œå•ç‹¬å¤„ç†

è®°å½•é¢å¤–ä¿¡æ¯
  extra.limit_needed = limit_needed(parse);
  extra.limit_tuples = limit_tuples;
  extra.count_est = count_est;
  extra.offset_est = offset_est;

å¯¹äºŽfdw
  GetForeignUpperPaths æ–°å¢žfdwæ‰§è¡Œè·¯å¾„

create_upper_paths_hook
  æœ€åŽæ‰§è¡Œå…¶ä»–hook
</code></pre><p>is_parallel_safe å¹¶è¡Œæ˜¯å¦å®‰å…¨
å¯¹äºŽå‚æ•°æ¥æºä¸ºæœ¬æŸ¥è¯¢ï¼Œæˆ–è€…ä¸Šå±‚æŸ¥è¯¢çš„æƒ…å†µï¼Œè®¤ä¸ºå¯ä»¥å¹¶è¡ŒæŸ¥è¯¢
max_parallel_hazard_walker
è°ƒç”¨å‡½æ•°æ˜¯è‡ªå·±èŠ‚ç‚¹ä¸Šçš„ï¼Œå®‰å…¨
å¯¹äºŽmax minæ¥è¯´ï¼Œå¹¶è¡ŒæŸ¥è¯¢æ˜¯å®‰å…¨çš„
proparallel
PROPARALLEL_SAFEï¼šfalse
PROPARALLEL_RESTRICTED è¿”å›ž context->max_interesting == proparallel
PROPARALLEL_UNSAFE false context->max_hazard = proparallel;
CoerceToDomainå…è®¸å¹¶è¡Œ domainç±»åž‹ä¸å»ºè®®ä½¿ç”¨ä¸å¯å¹¶è¡ŒåŒ–çš„å‡½æ•°
å¯¹äºŽèŽ·å–åºåˆ—ä¸‹ä¸€ä¸ªå·çš„æƒ…å†µï¼Œè®¤ä¸ºä¸å®‰å…¨
windowså‡½æ•°è®¤ä¸ºæ˜¯å®‰å…¨çš„
SubLinkï¼ˆanyä¹‹ç±»ï¼‰å®‰å…¨ //ç›®å‰åº”è¯¥ä¸ä¼šæœ‰è¿™ä¸ªæ‰§è¡Œè·¯å¾„
å¯¹äºŽå­æŸ¥è¯¢ï¼Œåªæœ‰å®‰å…¨çš„å­æŸ¥è¯¢æ‰ä¼šè¢«æ ‡è®°ä¸ºå¯å¹¶è¡Œ
å‚æ•°æ¥è‡ªæœ¬æŸ¥è¯¢ï¼Œè®¤ä¸ºå®‰å…¨ï¼Œå¦‚æžœæ˜¯ä¸å¯æŽ§ï¼Œè®¤ä¸ºä¸å®‰å…¨
for updateã€share è®¤ä¸ºä¸å®‰å…¨
å¦‚æžœä»¥ä¸Šæƒ…å†µéƒ½æœªå‘½ä¸­ï¼Œè¿­ä»£æ£€æŸ¥å­æŸ¥è¯¢ï¼Œä»¥åŠå‚æ•°</p><p>apply_scanjoin_target_to_paths
å¤„ç†æ‰€æœ‰scanï¼Œjoin è¡¨ï¼Œå¹¶éåŽ†å…¶å­ä»£ç”Ÿæˆæœ€ç»ˆçš„æ‰«æç›®æ ‡
å¯¹äºŽåˆ†åŒºè¡¨ï¼Œé‡æ–°ç”Ÿæˆæ‰«æå¯¹è±¡
å¯¹äºŽä¸å¯ä»¥å¹¶è¡Œçš„æŸ¥è¯¢ï¼Œå…³é—­å¹¶è¡ŒæŸ¥è¯¢
é€ä¸ªå¤„ç†ä¸æ¶‰åŠSRFçš„æ‰«æ
å¯¹äºŽtlist_same_exprsï¼ˆè¡¨è¾¾å¼åº”ç”¨äºŽå½“å‰å¯¹è±¡ï¼‰
ä»…å¢žåŠ sort group é¿å…é¢å¤–çš„æ‰§è¡Œè®¡åˆ’åˆ›å»ºä»£ä»·
å¦åˆ™ create_projection_path
åˆ›å»ºä¸€ä¸ªé¢„æµ‹æ‰§è¡Œpathï¼Œ
å¯¹äºŽpartialè¿›è¡ŒåŒæ ·å¤„ç†
å¯¹äºŽsrfï¼Œé€ä¸ªå¤„ç†adjust_paths_for_srfs
è®¾ç½®å½“å‰å¯¹è±¡ä¸ºæœ€ç»ˆçš„scan/joinç›®æ ‡ï¼ˆå³ä¾¿æ˜¯SRFï¼‰</p><pre><code>å¯¹äºŽåˆ†åŒºè¡¨
  ç”ŸæˆAppend scanã€joinå‘ç”Ÿåœ¨appendä¸‹è€Œéžå…¶ä¸Šï¼Œæœ€ç»ˆèšåˆåˆ°å•ç‹¬çš„resultå¤„ç†
  é€ä¸ªåˆ†åŒºéåŽ†
    æŠŠæ¯ä¸ªåˆ†åŒºçš„æ‰«æè·¯å¾„è®¾ç½®ä¸ºåˆ†åŒºè·¯å¾„è€Œéžè¡¨è·¯å¾„
      PathTarget *target = lfirst_node(PathTarget, lc);
      target = copy_pathtarget(target);
    é™„åŠ æ‰«æç‚¹åˆ°child_scanjoin_targets
    apply_scanjoin_target_to_pathsæ›¿æ¢åŽŸå…ˆçš„æ‰§è¡Œè·¯å¾„
    add_paths_to_append_relæ–°å¢žæ‰§è¡Œè·¯å¾„
    apply_scanjoin_target_to_pathsæ­¤å¤„å‘å†…è¿­ä»£
    live_children ä»…å¤„ç†å®žé™…å­˜åœ¨çš„å­åˆ†åŒºï¼ˆæœ‰å¯èƒ½æ˜¯dummyå¯¹è±¡ï¼‰
å¯¹äºŽå¯ä»¥å¹¶è¡Œçš„æŸ¥è¯¢ï¼ˆå¯¹è±¡ä¸æ˜¯å¤–æŸ¥è¯¢å¯¹è±¡ï¼‰
  generate_gather_pathsç”Ÿæˆå¹¶è¡ŒæŸ¥è¯¢è®¡åˆ’
    create_gather_pathç”Ÿæˆsimple_gather_path
    å¯¹äºŽæ¯ä¸ªpathå†…çš„åˆ—è¡¨
      ç”Ÿæˆcreate_gather_merge_path
æœ€åŽé‡æ–°é€‰å–ä»£ä»·æœ€ä½Žçš„æ‰§è¡Œè®¡åˆ’
  set_cheapest
</code></pre><p>query_planner
å¤„ç†æ‰§è¡Œè·¯å¾„
create_pathtarget
åˆ›å»ºæ‰§è¡Œè·¯å¾„
get_agg_clause_costs è®¡ç®—èšåˆä»£ä»·
create_projection_path åˆ›å»ºæ‰§è¡Œé¢„æµ‹path
make_sort_input_target åˆ¤æ–­æ˜¯å¦å¯ä»¥è·³è¿‡sort
make_window_input_target åˆ¤æ–­æ˜¯å¦å¯ä»¥è·³è¿‡groupingæ“ä½œ</p><p>æ–°å»ºèŠ‚ç‚¹å’Œå·²æœ‰èŠ‚ç‚¹ï¼Œå…¶ä¸­ä¸€æ–¹å¯åŠ¨æˆæœ¬å’Œæ€»æˆæœ¬éƒ½æ›´ä¼˜ï¼Œä¸”å…¶pathkeysä¹Ÿæ›´ä¼˜ï¼Œé‚£ä¹ˆåˆ é™¤å¦å¤–ä¸€ä¸ª</p><p>æ–°å»ºèŠ‚ç‚¹å’Œæ‰€æœ‰å·²æœ‰èŠ‚ç‚¹çš„å¯åŠ¨æˆæœ¬å’Œæ€»æˆæœ¬ä¸¤æ–¹é¢çš„å¯¹æ¯”ä¸ä¸€è‡´ï¼ˆå¦‚æ€»æˆæœ¬é«˜ä½†å¯åŠ¨æˆæœ¬è¾ƒä½Žï¼Œæˆ–åè¿‡æ¥ï¼‰ï¼Œä¸”æ–°å»ºèŠ‚ç‚¹æ€»æˆæœ¬è¾ƒä½Žï¼Œåˆ™ä¼šå…¨éƒ¨ä¿ç•™å¹¶æ·»åŠ åˆ°RelOptInfo->pathlistä¸­ã€‚</p><p>æ–°èŠ‚ç‚¹å’Œå·²æœ‰èŠ‚ç‚¹ï¼Œå…¶ä¸­ä¸€æ–¹å¯åŠ¨æˆå’Œæ€»æˆæœ¬éƒ½æ›´ä¼˜ï¼Œä½†å…¶pathkeysä¸å¤Ÿï¼Œåˆ™ä¸¤è€…éƒ½ä¿ç•™ï¼Œç”±ä¸Šå±‚PathèŠ‚ç‚¹æ¥åˆ¤æ–­</p><p>å½“æ–°å»ºèŠ‚ç‚¹å’Œå·²æœ‰èŠ‚ç‚¹æˆæœ¬ç›¸åŒæ—¶ï¼Œåˆ™å¯¹æ¯”ä¸¤è€…çš„pathkeysï¼Œé€‰æ‹©ä¿ç•™æ›´ä¼˜pathkeysçš„èŠ‚ç‚¹</p><p>pathkeysï¼š
æŽ’åºå±žæ€§ï¼Œè¯­å¥ä¸­ï¼Œå¦‚æžœæŸ¥è¯¢éœ€è¦æœ‰åºï¼Œåˆ™åœ¨å¤§å¤šæ•°æ—¶å€™ï¼ŒæŸ¥è¯¢keyæ˜¯å¦æœ‰åºä¹Ÿæ˜¯éœ€è¦è€ƒè™‘çš„ç»´åº¦ä¹‹ä¸€
<a href=https://www.bookstack.cn/read/aliyun-rds-core/4db84d3c10fdb1b8.md target=_blank>https://www.bookstack.cn/read/aliyun-rds-core/4db84d3c10fdb1b8.md</a></p><p><a href=https://www.bookstack.cn/read/aliyun-rds-core/c3e73d0a666188d4.md target=_blank>https://www.bookstack.cn/read/aliyun-rds-core/c3e73d0a666188d4.md</a>
æ— é”ç®—æ³•æ˜¯åˆ©ç”¨CPUçš„åŽŸå­æ“ä½œå®žçŽ°çš„æ•°æ®ç»“æž„å’Œç®—æ³•æ¥è§£å†³åŽŸæ¥åªèƒ½ç”¨é”æ‰èƒ½è§£å†³çš„å¹¶å‘æŽ§åˆ¶é—®é¢˜</p><ul><li>CAS</li><li>Fetch-and-add</li><li>Test-and-set</li></ul><p>å†…å­˜å±éšœ</p><p>å†…å­˜å±éšœç›¸å…³å‡½æ•°ï¼ŒåŒ…æ‹¬ compiler barrier å’Œ read/write barrier
è¯­ä¹‰ä¸Šçš„å¸ƒå°”å€¼ï¼ˆPGä»£ç é‡Œå«flagï¼Œå…·ä½“å®žçŽ°ä¸Šå¯èƒ½æ˜ å°„åˆ°ä¸€ä¸ªå­—èŠ‚ï¼Œæˆ–ä¸€ä¸ªæ•´æ•°ï¼‰çš„åŽŸå­æ“ä½œï¼ŒåŒ…æ‹¬ï¼š
pg_atomic_init_flagï¼Œåˆå§‹åŒ–ä¸€ä¸ªflag
pg_atomic_test_set_flag, Test-And-Setï¼Œè¿™ä¹Ÿæ˜¯flagçš„å”¯ä¸€æ”¯æŒçš„åŽŸå­ æ“ä½œå‡½æ•°
pg_atomic_unlocked_test_flagï¼Œæ£€æŸ¥flagæ˜¯å¦æ²¡æœ‰è¢«è®¾ç½®
pg_atomic_clear_flagï¼Œæ¸…é™¤å·²è®¾ç½®çš„flag
32ä½æ— ç¬¦å·æ•´æ•°çš„åŽŸå­æ“ä½œï¼ŒåŒ…æ‹¬ï¼š
pg_atomic_init_u32, pg_atomic_read_u32, pg_atomic_write_u32ï¼Œåˆå§‹åŒ–ã€è¯»ã€å†™æ“ä½œ
pg_atomic_exchange_u32ï¼Œç»™åŽŸå­å˜é‡èµ‹å€¼å¹¶è¿”å›žåŽŸå€¼
pg_atomic_compare_exchange_u32, 32ä½æ— ç¬¦å·æ•´æ•°çš„CASæ“ä½œï¼Œæ¯”è¾ƒåŽŸå­å˜é‡å’Œå¦ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œ å¦‚æžœç›¸ç­‰å°±èµ‹ä¸€ä¸ªæ–°å€¼åˆ°åŽŸå­å˜é‡é‡Œï¼Œè¿”å›žä¸€ä¸ªå¸ƒå°”å€¼æ ‡è¯†æ˜¯å¦è¿›è¡Œäº†èµ‹å€¼æ“ä½œ
pg_atomic_fetch_add_u32, pg_atomic_fetch_sub_u32, pg_atomic_fetch_and_u32, pg_atomic_fetch_or_u32 å¯¹æŸä¸ªåŽŸå­å˜é‡è¿›è¡ŒåŠ ã€å‡ã€ä¸Žã€æˆ–æ“ä½œï¼Œå¹¶è¿”å›žå˜é‡æ”¹å˜ä¹‹å‰çš„å€¼
pg_atomic_add_fetch_u32, pg_atomic_sub_fetch_u32 å¯¹æŸä¸ªåŽŸå­å˜é‡è¿›è¡ŒåŠ ã€å‡æ“ä½œï¼Œå¹¶è¿”å›žå˜é‡æ”¹å˜ä¹‹åŽçš„å€¼
64ä½æ— ç¬¦å·æ•´æ•°çš„åŽŸå­æ“ä½œï¼Œä¸Ž32ä½çš„å®žçŽ°çš„æ“ä½œå‡½æ•°ç›¸ä¼¼ï¼Œåªæ˜¯å®žçŽ°çš„æ˜¯64ä½ç‰ˆæœ¬ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ 64ä½ç‰ˆæœ¬å¹¶ä¸ä¿è¯æ‰€æœ‰å¹³å°çš„éƒ½æ”¯æŒï¼Œç›®å‰åœ¨PostgreSQLçš„æºä»£ç ä¸­è¿˜æ²¡æœ‰è¢«ä½¿ç”¨ã€‚</p><p>å®žé™…æ¡ˆä¾‹ï¼š
pgä¸­äº‹åŠ¡åœ¨ç»“æŸä¹‹åŽï¼Œéœ€è¦è®¾ç½® PGPROC ä¸­çš„äº‹åŠ¡idï¼Œæ­¤æ—¶ä¼šä½¿ç”¨ ProcArrayLock å°è¯•å¯¹ ProcArray åŠ æŽ’ä»–é”ï¼Œæ­¤æ—¶é”ç«žäº‰ä¸¥é‡ï¼ŒåŽæ¥å¯¹æ­¤è¿›è¡Œä¼˜åŒ–ï¼Œä½¿ç”¨æ— é”ç¼–ç¨‹æŠ€æœ¯ï¼Œæ‰¹é‡è¿›è¡Œxidçš„é‡ç½®ï¼Œå…·ä½“å‡½æ•°ä¸º ProcArrayEndTransaction ProcArrayGroupClearXid
å¤§æ„ä¸º:
å¦‚æžœç«žäº‰é”å¤±è´¥ï¼Œåˆ™æŠŠ xid åŠ å…¥ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œæœ‰ leader è¿›è¡Œæ­¤æ•°ç»„çš„ xid çš„é‡ç½®å·¥ä½œï¼Œæ­¤è¿‡ç¨‹æ²¡æœ‰åŠ é”</p><p><a href=https://blog.csdn.net/jackgo73/article/details/121628739 target=_blank>PGPROCæ•°æ®ç»“æž„</a></p><p><a href=https://github.com/xitu/gold-miner/blob/master/TODO/postgres-atomicity.md target=_blank>https://github.com/xitu/gold-miner/blob/master/TODO/postgres-atomicity.md</a></p><pre tabindex=0><code>(gdb) p * arrayP
$35 = {
  numProcs = 3,
  maxProcs = 122,
  maxKnownAssignedXids = 7930,
  numKnownAssignedXids = 0,
  tailKnownAssignedXids = 0,
  headKnownAssignedXids = 0,
  known_assigned_xids_lck = 0 &#39;\000&#39;,
  lastOverflowedXid = 0,
  replication_slot_xmin = 0,
  replication_slot_catalog_xmin = 0,
  pgprocnos = 0x7fe4b541c928
}
(gdb) p  arrayP-&gt;pgprocnos[0]
$36 = 99
(gdb) p  arrayP-&gt;pgprocnos[1]
$37 = 103
(gdb) p  arrayP-&gt;pgprocnos[2]
$38 = 111
(gdb) p allProcs[99]
$40 = {
  links = {
    prev = 0x0,
    next = 0x0
  },
  procgloballist = 0x7fe4b5400fa8,
  sem = 0x7fe4ac86d1b8,
  waitStatus = PROC_WAIT_STATUS_OK,
  procLatch = {
    is_set = 0,
    maybe_sleeping = 0,
    is_shared = true,
    owner_pid = 6629
  },
  xid = 0,
  xmin = 0,
  lxid = 92,
  pid = 6629,
  pgxactoff = 0,
  pgprocno = 99,
  backendId = 3,
  databaseId = 16384,
  roleId = 10,
  tempNamespaceId = 0,
  isBackgroundWorker = false,
  recoveryConflictPending = false,
  lwWaiting = false,
  lwWaitMode = 0 &#39;\000&#39;,
</code></pre><p><a href=https://www.modb.pro/db/91753 target=_blank>https://www.modb.pro/db/91753</a></p><ol><li>æºç ç¼–è¯‘å®‰è£…</li><li>apt yum ç­‰ç›´æŽ¥å®‰è£…</li><li>dep rpm ç­‰å®‰è£…</li><li>opengause å’Œ pg å®˜ç½‘ ä½¿ç”¨æºç å®‰è£…ï¼Œæ²¡æœ‰æ‰¾åˆ°å·²ç»ç¼–è¯‘å¥½çš„åŒ…</li><li>mysql ä½¿ç”¨å®‰è£…åŒ…å®‰è£…</li></ol></section><div class=divider></div><div class="flex flex-col md:flex-row justify-between gap-4 py-4"><a role=button class="btn btn-outline h-12" href=/posts/personal/%E7%AE%80%E5%8E%86/ title><ion-icon name=chevron-back></ion-icon><div class="inline-flex flex-col items-start"><span class="text-base-content/60 text-xs font-normal">Previous page</span>
<span class="max-w-48 truncate"></span></div></a><a role=button class="btn btn-outline h-12" href=/posts/postgres/sublink/ title><div class="inline-flex flex-col items-end"><span class="text-base-content/60 text-xs font-normal">Next page</span>
<span class="max-w-48 truncate"></span></div><ion-icon name=chevron-forward></ion-icon></a></div></article></div><div x-data=tocHighlighter() @scroll.window=debouncedScroll class="hidden lg:flex lg:flex-col lg:items-end lg:self-start"><nav id=TableOfContents><ul><li><a href=#æ‰§è¡Œè®¡åˆ’çš„å®žçŽ°>æ‰§è¡Œè®¡åˆ’çš„å®žçŽ°</a></li></ul></nav></div></div><footer class="flex justify-between items-center gap-2 px-4 py-12"><div><p>Â© 2016 - 2025 Askyx's Blog</p><p class=text-sm>ðŸŒ±
<span class=text-base-content/60>Powered by <a class=hover:underline href=https://gohugo.io/ target=_blank>Hugo</a> with theme
<a class=hover:underline href=https://github.com/g1eny0ung/hugo-theme-dream target=_blank>Dream</a>.</span></p></div><div x-data="{ icons: [
    { name: 'sunny', status: 'n' },
    { name: 'moon', status: 'y' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center gap-2 h-[32px] px-2 bg-base-100 border border-base-content/30 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div><div class=back><div class=container><div class="dream-grid dream-grid-about"><div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column"><article class="card bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"><div class=card-body><div class=card-title>About Me</div><div class="prose dark:prose-invert"><p>Hi, my name is Yue Yang.</p><p>This is my blog.</p><h2 id=ãƒ¾Ï‰o>ãƒ¾(â€¢Ï‰â€¢`)o</h2><p>æ¯”è¾ƒèƒ†å°ï¼Œå‡ºé—¨éƒ½å¾—è´´å¢™èµ°</p></div></div></article></div></div><footer class="flex justify-between items-center gap-2 px-4 py-12"><div><p>Â© 2016 - 2025 Askyx's Blog</p><p class=text-sm>ðŸŒ±
<span class=text-base-content/60>Powered by <a class=hover:underline href=https://gohugo.io/ target=_blank>Hugo</a> with theme
<a class=hover:underline href=https://github.com/g1eny0ung/hugo-theme-dream target=_blank>Dream</a>.</span></p></div><div x-data="{ icons: [
    { name: 'sunny', status: 'n' },
    { name: 'moon', status: 'y' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center gap-2 h-[32px] px-2 bg-base-100 border border-base-content/30 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div></div></div><script>window.lightTheme="emerald",window.darkTheme="forest"</script><script src=https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin=anonymous></script><script src=/js/grid.min.js></script><script src=/js/main.min.js></script><script src=https://cdn.jsdelivr.net/npm/luxon@1.26.0 integrity="sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0=" crossorigin=anonymous></script><script>format();function format(){document.querySelectorAll('span[data-format="luxon"]').forEach(e=>{const t=e.textContent;e.textContent=luxon.DateTime.fromISO(t,{locale:"en"}).toFormat("yyyyå¹´MMæœˆddæ—¥")})}</script><script src=/js/toc.min.js></script><script type=module>
      import mediumZoom from 'https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/+esm';
      mediumZoom('#dream-single-post-content img', {
        background: 'oklch(var(--b1))',
        margin: 24,
      })
    </script><script type=module src=https://cdn.jsdelivr.net/npm/ionicons@7.4.0/dist/ionicons/ionicons.esm.js integrity="sha256-/IFmi82bIhdYWctu0UddSlJqpnzWm7Vh2C4CM32wF/k=" crossorigin=anonymous></script><script nomodule src=https://cdn.jsdelivr.net/npm/ionicons@7.4.0/dist/ionicons/ionicons.js integrity="sha256-mr7eJMX3VC3F7G32mk4oWp1C6a2tlMYxUdptfT7uKI8=" crossorigin=anonymous></script></body></html>