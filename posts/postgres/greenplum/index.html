<!doctype html><html lang=en>
<head>
<title>
Greenplum ::
Esoye â€” My note blog
</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="æºç ç¼–è¯‘ #  è¯¦ç»†ç¼–è¯‘è¿‡ç¨‹è§è¿™é‡Œ
èµ·æºä¸å‘å±•ä¸æ¶æ„ #  1. èµ·æºå‘å±• #   æ•°æ®çˆ†ç‚¸å¼å¢é•¿ï¼Œæ•°æ®å¤„ç†è¿›å…¥å¤§æ•°æ®æ—¶ä»£ ä¼ ç»Ÿæ•°æ®å¤„ç†æ¨¡å¼çš„çºµå‘å¢é•¿é€Ÿåº¦éš¾ä»¥æ›´ä¸Šæ•°æ®çš„å¢é•¿é€Ÿåº¦ ä¸ºäº†è§£å†³å¤§æ•°æ®åœºæ™¯ä¸‹çš„æ•°æ®å¤„ç†ï¼Œä¸»è¦æ€è·¯æ˜¯æ•°æ®å­˜å‚¨å’Œæ•°æ®è®¡ç®—çš„æ¨ªå‘æ‰©å±• åˆ†å¸ƒå¼å­˜å‚¨å’Œåˆ†å¸ƒå¼è¿ç®—çš„å®é™…æˆæœï¼ŒGoogleçš„ä¸‰é©¾é©¬è½¦  GPåœ¨è¿™ä¸ªèƒŒæ™¯ä¸‹ï¼Œé€‰æ‹©PGæ­å»ºMPPæ¶æ„çš„OLAPçš„æ•°æ®åº“ï¼Œä¸”å†…æ ¸æ˜¯PGï¼Œæ‰€ä»¥å¤©ç„¶å…·æœ‰éå¸¸ä¸°å¯Œçš„ç‰¹æ€§ï¼Œç›¸æ¯”å…¶ä»–çš„OLAPæ•°æ®åº“ï¼Œä»–çš„åŠŸèƒ½æ”¯æŒæ˜¯æ¯”è¾ƒå®Œå–„çš„ã€‚
 æ”¯æŒå®Œæ•´çš„ANSI SQLæ ‡å‡† åˆ†å¸ƒå¼äº‹åŠ¡ MPPèµ‹äºˆä»–è‰¯å¥½çš„çº¿æ€§æ‰©å±•èƒ½åŠ› å®Œå–„çš„ç”Ÿæ€ç³»ç»Ÿ   Greenplum å…¬å¸æˆç«‹äº 2003 å¹´ï¼Œ2008 å¹´å‘å¸ƒ Greenplum æ•°æ®åº“äº§å“ã€‚2010 å¹´ Greenplum è¢« é«˜ç«¯å­˜å‚¨é¢†åŸŸå·¨å¤´ EMC æ”¶è´­ï¼ŒåŒå¹´ Greenplum å€ŸåŠ© EMC ä¸­å›½å“è¶Šç ”å‘é›†å›¢è¿›å…¥ä¸­å›½ï¼Œå¹¶åˆ›å»º Greenplum ä¸­å›½ç ”å‘å›¢é˜Ÿã€‚2014 å¹´ Greenplum ä» EMC ç‹¬ç«‹å‡ºæ¥åˆ›ç«‹ Pivotalï¼Œå¹¶è·å¾—é€šç”¨ç”µæ°”ã€ ç¦ç‰¹æ±½è½¦å’Œå¾®è½¯çš„æŠ•èµ„ã€‚2018 å¹´ 4 æœˆ Pivotal åœ¨çº½çº¦è¯åˆ¸äº¤æ˜“æ‰€ä¸Šå¸‚ï¼Œç›®å‰å¸‚å€¼ 60 å¤šäº¿ç¾å…ƒ
 2. æ¶æ„ #  MPPæ¶æ„ï¼Œç”±Master Severså’ŒSegment Seversé€šè¿‡Interconnectäº’è”ç»„æˆ
  MasterèŠ‚ç‚¹">
<meta name=keywords content="æ•°æ®åº“">
<meta name=robots content="noodp">
<link rel=canonical href=https://Esoye.github.io/posts/postgres/greenplum/>
<link rel=stylesheet href=https://Esoye.github.io/assets/style.css>
<link rel=stylesheet href=https://Esoye.github.io/style.css>
<link rel=apple-touch-icon-precomposed sizes=144x144 href=https://Esoye.github.io/img/apple-touch-icon-144-precomposed.png>
<link rel="shortcut icon" href=https://Esoye.github.io/img/favicon.png>
<link href=https://Esoye.github.io/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://Esoye.github.io/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://Esoye.github.io/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://Esoye.github.io/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://Esoye.github.io/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://Esoye.github.io/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Greenplum">
<meta name=twitter:description content="GreenPlumä¼˜åŒ–å™¨å’Œæ‰§è¡Œå™¨çš„æºç è°ƒç ”">
<meta property="og:title" content="Greenplum">
<meta property="og:description" content="GreenPlumä¼˜åŒ–å™¨å’Œæ‰§è¡Œå™¨çš„æºç è°ƒç ”">
<meta property="og:type" content="article">
<meta property="og:url" content="https://Esoye.github.io/posts/postgres/greenplum/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-08-10T20:22:49+08:00">
<meta property="article:modified_time" content="2022-08-10T20:22:49+08:00"><meta property="og:site_name" content="Esoye">
</head>
<body class=light-theme>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/ class=logo style=text-decoration:none>
<span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span>
<span class=logo__text>Esoye</span>
<span class=logo__cursor></span>
</a>
<span class=header__right>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/archive>Archive</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/archive>Archive</a></li>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
<span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg>
</span>
</span>
</span>
</header>
<div class=content>
<div class=post>
<h1 class=post-title>Greenplum</h1>
<div class=post-meta>
<span class=post-date>
2022-08-10
</span>
</div>
<span class=post-tags>
<a href=https://Esoye.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/>#æ•°æ®åº“</a>&nbsp;
<a href=https://Esoye.github.io/tags/postgres/>#Postgres</a>&nbsp;
<a href=https://Esoye.github.io/tags/greenplum/>#GreenPlum</a>&nbsp;
</span>
<div class=post-content>
<h2>Table of Contents</h2>
<aside class=table-of-contents><nav id=TableOfContents>
<ul>
<li><a href=#æºç ç¼–è¯‘>æºç ç¼–è¯‘</a></li>
<li><a href=#èµ·æºä¸å‘å±•ä¸æ¶æ„>èµ·æºä¸å‘å±•ä¸æ¶æ„</a>
<ul>
<li><a href=#1-èµ·æºå‘å±•>1. èµ·æºå‘å±•</a></li>
<li><a href=#2-æ¶æ„>2. æ¶æ„</a></li>
</ul>
</li>
<li><a href=#æºç åˆ†æ>æºç åˆ†æ</a>
<ul>
<li><a href=#æ‰§è¡Œè®¡åˆ’>æ‰§è¡Œè®¡åˆ’</a></li>
<li><a href=#æ‰§è¡Œè®¡åˆ’çš„ç”Ÿæˆ>æ‰§è¡Œè®¡åˆ’çš„ç”Ÿæˆ</a></li>
<li><a href=#antdb-vs-greenplum>AntDB VS GreenPlum</a></li>
</ul>
</li>
<li><a href=#ç®€å•çš„æ€§èƒ½å¯¹æ¯”>ç®€å•çš„æ€§èƒ½å¯¹æ¯”</a></li>
<li><a href=#æ€»ç»“>æ€»ç»“</a>
<ul>
<li></li>
</ul>
</li>
</ul>
</nav></aside>
<h2 id=æºç ç¼–è¯‘>
æºç ç¼–è¯‘
<a href=#%e6%ba%90%e7%a0%81%e7%bc%96%e8%af%91 class=h-anchor aria-hidden=true>#</a>
</h2>
<p>è¯¦ç»†ç¼–è¯‘è¿‡ç¨‹è§<a href=https://esoye.github.io/posts/postgres/pgenvbuild>è¿™é‡Œ</a></p>
<h2 id=èµ·æºä¸å‘å±•ä¸æ¶æ„>
èµ·æºä¸å‘å±•ä¸æ¶æ„
<a href=#%e8%b5%b7%e6%ba%90%e4%b8%8e%e5%8f%91%e5%b1%95%e4%b8%8e%e6%9e%b6%e6%9e%84 class=h-anchor aria-hidden=true>#</a>
</h2>
<h3 id=1-èµ·æºå‘å±•>
1. èµ·æºå‘å±•
<a href=#1-%e8%b5%b7%e6%ba%90%e5%8f%91%e5%b1%95 class=h-anchor aria-hidden=true>#</a>
</h3>
<ul>
<li>æ•°æ®çˆ†ç‚¸å¼å¢é•¿ï¼Œæ•°æ®å¤„ç†è¿›å…¥å¤§æ•°æ®æ—¶ä»£</li>
<li>ä¼ ç»Ÿæ•°æ®å¤„ç†æ¨¡å¼çš„çºµå‘å¢é•¿é€Ÿåº¦éš¾ä»¥æ›´ä¸Šæ•°æ®çš„å¢é•¿é€Ÿåº¦</li>
<li>ä¸ºäº†è§£å†³å¤§æ•°æ®åœºæ™¯ä¸‹çš„æ•°æ®å¤„ç†ï¼Œä¸»è¦æ€è·¯æ˜¯æ•°æ®å­˜å‚¨å’Œæ•°æ®è®¡ç®—çš„æ¨ªå‘æ‰©å±•</li>
<li>åˆ†å¸ƒå¼å­˜å‚¨å’Œåˆ†å¸ƒå¼è¿ç®—çš„å®é™…æˆæœï¼ŒGoogleçš„ä¸‰é©¾é©¬è½¦</li>
</ul>
<p>GPåœ¨è¿™ä¸ªèƒŒæ™¯ä¸‹ï¼Œé€‰æ‹©PGæ­å»ºMPPæ¶æ„çš„OLAPçš„æ•°æ®åº“ï¼Œä¸”å†…æ ¸æ˜¯PGï¼Œæ‰€ä»¥å¤©ç„¶å…·æœ‰éå¸¸ä¸°å¯Œçš„ç‰¹æ€§ï¼Œç›¸æ¯”å…¶ä»–çš„OLAPæ•°æ®åº“ï¼Œä»–çš„åŠŸèƒ½æ”¯æŒæ˜¯æ¯”è¾ƒå®Œå–„çš„ã€‚</p>
<ol>
<li>æ”¯æŒå®Œæ•´çš„ANSI SQLæ ‡å‡†</li>
<li>åˆ†å¸ƒå¼äº‹åŠ¡</li>
<li>MPPèµ‹äºˆä»–è‰¯å¥½çš„çº¿æ€§æ‰©å±•èƒ½åŠ›</li>
<li>å®Œå–„çš„ç”Ÿæ€ç³»ç»Ÿ</li>
</ol>
<blockquote>
<p>Greenplum å…¬å¸æˆç«‹äº 2003 å¹´ï¼Œ2008 å¹´å‘å¸ƒ Greenplum æ•°æ®åº“äº§å“ã€‚2010 å¹´ Greenplum è¢«
é«˜ç«¯å­˜å‚¨é¢†åŸŸå·¨å¤´ EMC æ”¶è´­ï¼ŒåŒå¹´ Greenplum å€ŸåŠ© EMC ä¸­å›½å“è¶Šç ”å‘é›†å›¢è¿›å…¥ä¸­å›½ï¼Œå¹¶åˆ›å»º
Greenplum ä¸­å›½ç ”å‘å›¢é˜Ÿã€‚2014 å¹´ Greenplum ä» EMC ç‹¬ç«‹å‡ºæ¥åˆ›ç«‹ Pivotalï¼Œå¹¶è·å¾—é€šç”¨ç”µæ°”ã€
ç¦ç‰¹æ±½è½¦å’Œå¾®è½¯çš„æŠ•èµ„ã€‚2018 å¹´ 4 æœˆ Pivotal åœ¨çº½çº¦è¯åˆ¸äº¤æ˜“æ‰€ä¸Šå¸‚ï¼Œç›®å‰å¸‚å€¼ 60 å¤šäº¿ç¾å…ƒ</p>
</blockquote>
<h3 id=2-æ¶æ„>
2. æ¶æ„
<a href=#2-%e6%9e%b6%e6%9e%84 class=h-anchor aria-hidden=true>#</a>
</h3>
<p>MPPæ¶æ„ï¼Œç”±<code>Master Severs</code>å’Œ<code>Segment Severs</code>é€šè¿‡Interconnectäº’è”ç»„æˆ</p>
<ul>
<li>
<p><code>Master</code>èŠ‚ç‚¹<br>
æ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ§åˆ¶ä¸­å¿ƒå’Œå¯¹å¤–çš„æœåŠ¡æ¥å…¥ç‚¹ï¼Œå®ƒè´Ÿè´£æ¥æ”¶ç”¨æˆ·SQLè¯·æ±‚ï¼Œå°†SQLç”ŸæˆæŸ¥è¯¢è®¡åˆ’å¹¶è¿›è¡Œå¹¶è¡Œå¤„ç†ä¼˜åŒ–ï¼Œç„¶åå°†æŸ¥è¯¢è®¡åˆ’åˆ†é…ï¼ˆdispatchï¼‰åˆ°æ‰€æœ‰çš„<code>segment</code>èŠ‚ç‚¹è¿›è¡Œå¹¶è¡Œå¤„ç†ï¼Œåè°ƒç»„ç»‡å„ä¸ª<code>segment</code>èŠ‚ç‚¹æŒ‰ç…§æŸ¥è¯¢è®¡åˆ’ä¸€æ­¥ä¸€æ­¥åœ°è¿›è¡Œå¹¶è¡Œå¤„ç†ï¼Œæœ€åè·å–åˆ°<code>segment</code>çš„è®¡ç®—ç»“æœï¼Œå†è¿”å›ç»™å®¢æˆ·ç«¯ï¼›ä»ç”¨æˆ·çš„è§’åº¦çœ‹Greenplumé›†ç¾¤ï¼Œçœ‹åˆ°çš„åªæ˜¯MasterèŠ‚ç‚¹,æ— éœ€å…³å¿ƒé›†ç¾¤å†…éƒ¨çš„æœºåˆ¶ï¼Œæ‰€æœ‰çš„å¹¶è¡Œå¤„ç†éƒ½æ˜¯åœ¨Masteræ§åˆ¶ä¸‹è‡ªåŠ¨å®Œæˆçš„ã€‚MasterèŠ‚ç‚¹ä¸€èˆ¬åªæœ‰ä¸€ä¸ªæˆ–ä¸¤ä¸ªï¼ˆäº’ä¸ºå¤‡ä»½ï¼‰ï¼›</p>
</li>
<li>
<p><code>segment</code>èŠ‚ç‚¹<br>
æ˜¯Greenplumæ‰§è¡Œå¹¶è¡Œä»»åŠ¡çš„å¹¶è¡Œè¿ç®—èŠ‚ç‚¹ï¼Œå®ƒæ¥æ”¶Masterçš„æŒ‡ä»¤è¿›è¡ŒMPPå¹¶è¡Œè®¡ç®—ï¼Œå› æ­¤æ‰€æœ‰<code>segment</code>èŠ‚ç‚¹çš„è®¡ç®—æ€§èƒ½æ€»å’Œå°±æ˜¯æ•´ä¸ªé›†ç¾¤çš„æ€§èƒ½ï¼Œé€šè¿‡å¢åŠ <code>segment</code>èŠ‚ç‚¹ï¼Œå¯ä»¥çº¿æ€§åŒ–å¾—å¢åŠ é›†ç¾¤çš„å¤„ç†æ€§èƒ½å’Œå­˜å‚¨å®¹é‡ï¼Œ<code>segment</code>èŠ‚ç‚¹å¯ä»¥æ˜¯1~10000ä¸ªèŠ‚ç‚¹ï¼›</p>
</li>
<li>
<p><code>Interconnect</code><br>
æ˜¯MasterèŠ‚ç‚¹ä¸<code>segment</code>èŠ‚ç‚¹ã€<code>segment</code>èŠ‚ç‚¹ä¸<code>segment</code>èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®ä¼ è¾“ç»„ä»¶ï¼Œå®ƒåŸºäºåƒå…†äº¤æ¢æœºæˆ–ä¸‡å…†äº¤æ¢æœºå®ç°æ•°æ®åœ¨èŠ‚ç‚¹é—´çš„é«˜é€Ÿä¼ è¾“ã€‚åŸæ¥pgä¸­çš„libpqç”¨äºæ§åˆ¶ä¿¡æ¯çš„ä¼ è¾“</p>
</li>
</ul>
<p><img src=/posts/postgres/images/%E6%9E%B6%E6%9E%84%E5%9B%BE.png alt=æ¶æ„></p>
<blockquote>
<p>MPP: (Massively Parallel Processing)<br>
ç±»ä¼¼MapReduce ,Impalaã€ClickHouseã€Druidã€Dorisç­‰éƒ½æ˜¯MPPæ¶æ„ã€‚<br>
<a href=https://zhuanlan.zhihu.com/p/395519072>MPPå¤§è§„æ¨¡å¹¶è¡Œå¤„ç†æ¶æ„è¯¦è§£</a><br>
<a href=https://blog.csdn.net/yimenglin/article/details/90510134>MPP ä¸ Hadoopæ˜¯ä»€ä¹ˆå…³ç³»</a>
<a href=https://0x0fff.com/apache-spark-future/>è¯„è®ºåŒºå¤§ä½¬å‘è¨€</a></p>
</blockquote>
<p>â— ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ;<br>
â— æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨(æœ¬åœ°åŒ–);</p>
<ul>
<li>hashåˆ†å¸ƒ</li>
<li>éšæœºåˆ†å¸ƒ</li>
<li>å¤åˆ¶è¡¨<br>
â— å¤šæ€å­˜å‚¨ï¼Œå®ç°ç±»ä¼¼å†·çƒ­æ•°æ®çš„å¼‚æ„å­˜å‚¨
â— åˆ†å¸ƒå¼è®¡ç®—;<br>
â— æ¨ªå‘æ‰©å±•;<br>
â— Shared Nothingæ¶æ„ã€‚</li>
</ul>
<blockquote>
<p>RE-READ: <a href="https://cs-people.bu.edu/mathan/reading-groups/papers-classics/volcano.pdf#:~:text=Volcano-An%20Extensible%20and%20Parallel%20Query%20Evaluation%20System%20Goetz,a%20new%20dataflow%20query%20execution%20system%20called%20Volcano.">Volcano-An Extensible and Parallel Query Evaluation System</a></p>
</blockquote>
<hr>
<h2 id=æºç åˆ†æ>
æºç åˆ†æ
<a href=#%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90 class=h-anchor aria-hidden=true>#</a>
</h2>
<p>è¿™é‡Œå¸Œæœ›å¯ä»¥è®©å¤§å®¶çŸ¥é“ä¸‹é¢çš„å‡ ä¸ªé—®é¢˜</p>
<ol>
<li>remoteæ‰§è¡Œè®¡åˆ’æ€ä¹ˆè§£è¯»</li>
<li>remoteå¦‚ä½•æ‰§è¡Œ</li>
<li>remoteæ‰§è¡Œè®¡åˆ’æ€ä¹ˆç”Ÿæˆ</li>
<li>AntDBå’ŒGPæœ‰å…³remoteçš„åŒºåˆ«</li>
</ol>
<h3 id=æ‰§è¡Œè®¡åˆ’>
æ‰§è¡Œè®¡åˆ’
<a href=#%e6%89%a7%e8%a1%8c%e8%ae%a1%e5%88%92 class=h-anchor aria-hidden=true>#</a>
</h3>
<p>ä¸ºäº†æ›´å¥½çš„ç†è§£è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå…ˆäº†è§£ä¸‹GPçš„æ‰§è¡Œè®¡åˆ’ï¼Œä»¥ä¸‹é¢çš„è¯­å¥ä¸ºä¾‹ï¼Œä¸¤è¡¨æ•°æ®ä¸€æ ·ï¼Œè¿›è¡Œjoinï¼Œæ¡ä»¶åªæ˜¯æ™®é€šåˆ—ï¼Œéä¸»é”®ï¼Œéåˆ†åŒºåˆ—ã€‚</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>prepare</span> s36(int, int) <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>select</span> a.no_o_id <span style=color:#66d9ef>from</span> bmsql_new_order a <span style=color:#66d9ef>join</span> bmsql_new_order_bak1 b <span style=color:#66d9ef>on</span>  a.no_o_id  <span style=color:#f92672>=</span> b.no_o_id ;
<span style=color:#66d9ef>explain</span> (<span style=color:#66d9ef>verbose</span>, <span style=color:#66d9ef>analyze</span>) <span style=color:#66d9ef>execute</span> s36(<span style=color:#ae81ff>4</span>,<span style=color:#ae81ff>1</span>); 
</code></pre></div><p>å…·ä½“çš„æ‰§è¡Œè®¡åˆ’å¦‚ä¸‹</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++>
benchmarksql<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>#</span> explain (verbose, analyze) execute s36(<span style=color:#ae81ff>4</span>,<span style=color:#ae81ff>1</span>); 
 Gather Motion <span style=color:#ae81ff>2</span><span style=color:#f92672>:</span><span style=color:#ae81ff>1</span>  (slice3; <span style=color:#960050;background-color:#1e0010>`</span>segment<span style=color:#960050;background-color:#1e0010>`</span>s: <span style=color:#ae81ff>2</span>)  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>1975.90</span>.<span style=color:#ae81ff>.29568.15</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>2243323</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>) (actual time<span style=color:#f92672>=</span><span style=color:#ae81ff>27.853</span>.<span style=color:#ae81ff>.1062.597</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>2249955</span> loops<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
   Output: a.no_o_id
   <span style=color:#f92672>-&gt;</span>  Hash Join  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>1975.90</span>.<span style=color:#ae81ff>.29568.15</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>1121662</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>) (actual time<span style=color:#f92672>=</span><span style=color:#ae81ff>27.156</span>.<span style=color:#ae81ff>.445.908</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>1177455</span> loops<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
         Output: a.no_o_id
         Hash Cond: (a.no_o_id <span style=color:#f92672>=</span> b.no_o_id)
         Executor Memory: <span style=color:#ae81ff>1408</span>kB  <span style=color:#960050;background-color:#1e0010>`</span>segment<span style=color:#960050;background-color:#1e0010>`</span>s: <span style=color:#ae81ff>2</span>  Max: <span style=color:#ae81ff>737</span>kB (<span style=color:#960050;background-color:#1e0010>`</span>segment<span style=color:#960050;background-color:#1e0010>`</span> <span style=color:#ae81ff>1</span>)
         work_mem: <span style=color:#ae81ff>1408</span>kB  <span style=color:#960050;background-color:#1e0010>`</span>segment<span style=color:#960050;background-color:#1e0010>`</span>s: <span style=color:#ae81ff>2</span>  Max: <span style=color:#ae81ff>737</span>kB (<span style=color:#960050;background-color:#1e0010>`</span>segment<span style=color:#960050;background-color:#1e0010>`</span> <span style=color:#ae81ff>1</span>)  Workfile: (<span style=color:#ae81ff>0</span> spilling)
         Extra Text: (seg1)   Hash chain length <span style=color:#ae81ff>49.6</span> avg, <span style=color:#ae81ff>50</span> max, <span style=color:#66d9ef>using</span> <span style=color:#ae81ff>475</span> of <span style=color:#ae81ff>524288</span> buckets.
         <span style=color:#f92672>-&gt;</span>  Redistribute Motion <span style=color:#ae81ff>2</span><span style=color:#f92672>:</span><span style=color:#ae81ff>2</span>  (slice1; <span style=color:#960050;background-color:#1e0010>`</span>segment<span style=color:#960050;background-color:#1e0010>`</span>s: <span style=color:#ae81ff>2</span>)  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0.00</span>.<span style=color:#ae81ff>.1412.99</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>22517</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>) (actual time<span style=color:#f92672>=</span><span style=color:#ae81ff>0.123</span>.<span style=color:#ae81ff>.10.948</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>23583</span> loops<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
               Output: a.no_o_id, a.no_w_id
               Hash Key: a.no_o_id
               <span style=color:#f92672>-&gt;</span>  Seq Scan on <span style=color:#66d9ef>public</span>.bmsql_new_order a  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0.00</span>.<span style=color:#ae81ff>.512.33</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>22517</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>) (actual time<span style=color:#f92672>=</span><span style=color:#ae81ff>0.014</span>.<span style=color:#ae81ff>.7.987</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>27017</span> loops<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
                     Output: a.no_o_id, a.no_w_id
         <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>1412.99</span>.<span style=color:#ae81ff>.1412.99</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>22517</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>) (actual time<span style=color:#f92672>=</span><span style=color:#ae81ff>25.454</span>.<span style=color:#ae81ff>.25.454</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>23583</span> loops<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
               Output: b.no_o_id, b.no_w_id
               <span style=color:#f92672>-&gt;</span>  Redistribute Motion <span style=color:#ae81ff>2</span><span style=color:#f92672>:</span><span style=color:#ae81ff>2</span>  (slice2; <span style=color:#960050;background-color:#1e0010>`</span>segment<span style=color:#960050;background-color:#1e0010>`</span>s: <span style=color:#ae81ff>2</span>)  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0.00</span>.<span style=color:#ae81ff>.1412.99</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>22517</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>) (actual time<span style=color:#f92672>=</span><span style=color:#ae81ff>1.616</span>.<span style=color:#ae81ff>.17.073</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>23583</span> loops<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
                     Output: b.no_o_id, b.no_w_id
                     Hash Key: b.no_o_id
                     <span style=color:#f92672>-&gt;</span>  Seq Scan on <span style=color:#66d9ef>public</span>.bmsql_new_order_bak1 b  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0.00</span>.<span style=color:#ae81ff>.512.33</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>22517</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>) (actual time<span style=color:#f92672>=</span><span style=color:#ae81ff>0.024</span>.<span style=color:#ae81ff>.8.003</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>27017</span> loops<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
                           Output: b.no_o_id, b.no_w_id
   (slice0)    Executor memory: <span style=color:#ae81ff>247</span>K bytes.
   (slice1)    Executor memory: <span style=color:#ae81ff>60</span>K bytes avg x <span style=color:#ae81ff>2</span> workers, <span style=color:#ae81ff>60</span>K bytes max (seg0).
   (slice2)    Executor memory: <span style=color:#ae81ff>44</span>K bytes avg x <span style=color:#ae81ff>2</span> workers, <span style=color:#ae81ff>44</span>K bytes max (seg0).
   (slice3)    Executor memory: <span style=color:#ae81ff>6328</span>K bytes avg x <span style=color:#ae81ff>2</span> workers, <span style=color:#ae81ff>6328</span>K bytes max (seg0).  Work_mem: <span style=color:#ae81ff>737</span>K bytes 
max.
 Memory used:  <span style=color:#ae81ff>128000</span>kB
 Optimizer: Postgres query optimizer
 Execution time: <span style=color:#ae81ff>1150.876</span> ms
(<span style=color:#ae81ff>27</span> rows)

Time: <span style=color:#ae81ff>1152.362</span> ms
</code></pre></div><p><img src=/posts/postgres/images/plan1.svg alt=plan1></p>
<p>å’Œæ™®é€šçš„PGçš„æ‰§è¡Œè®¡åˆ’ç±»ä¼¼ï¼Œå…¶ä¸­ç¨æœ‰åŒºåˆ«ï¼Œä¸»è¦åŒºåˆ«ä¸ºå…¶ä¸­æœ‰<code>Redistribute Motion 2:2 (slice2; segments: 2) </code>ç±»ä¼¼çš„ç®—å­ï¼Œè¿™æœ‰å‡ ä¸ªGPçš„æ‰§è¡Œå™¨çš„æ¦‚å¿µ</p>
<h4 id=1-motionç®—å­>
1. Motionç®—å­
<a href=#1-motion%e7%ae%97%e5%ad%90 class=h-anchor aria-hidden=true>#</a>
</h4>
<p>å®ç°å¹¶è¡Œæ“ä½œçš„ç®—å­ï¼Œæœ‰ä¸‰å¤§ç±»ï¼Œä¸»è¦è´Ÿè´£<code>segment</code>ä¹‹é—´æ•°æ®çš„ä¼ è¾“ï¼Œå…·ä½“ç±»å‹å¦‚ä¸‹</p>
<ul>
<li><code>Redistribute</code>
<ul>
<li><code>Redistribute Motion</code><br>
é‡åˆ†å¸ƒï¼ŒæŠŠä¸€ä¸ªèŠ‚ç‚¹çš„æ•°æ®ä½¿ç”¨hashé‡æ–°å‘é€åˆ°å…¶ä»–èŠ‚ç‚¹</li>
<li><code>Explicit Redistribute Motion</code><br>
æ˜¾ç¤ºé‡åˆ†å¸ƒï¼ŒæŒ‰ç…§segidç›´æ¥å‘é€æ•°æ®åˆ°æŒ‡å®šnode</li>
</ul>
</li>
<li><code>Broadcast</code>
<ul>
<li><code>Broadcast Motion</code><br>
å¹¿æ’­ï¼Œå°è¡¨å¹¿æ’­ï¼ŒæŠŠæ•°æ®å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹</li>
</ul>
</li>
<li><code>Gather</code>
<ul>
<li><code>Gather Motion</code><br>
æ•°æ®æ±‡æ€»ï¼Œæ”¶é›†èŠ‚ç‚¹åˆ°master</li>
<li><code>Explicit Gather Motion</code><br>
æ˜¾ç¤ºæ•°æ®æ±‡æ€»</li>
</ul>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=color:#66d9ef>typedef</span> <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>MotionType</span>
{
 MOTIONTYPE_HASH,     <span style=color:#75715e>// é‡é»æ˜¯hashï¼Œç›®æ¨™æœªçŸ¥
</span><span style=color:#75715e></span> MOTIONTYPE_FIXED,    <span style=color:#75715e>// é‡é»æ˜¯é™å®šæ¥æ”¶è€…ï¼Œç›®æ¨™å›ºå®š
</span><span style=color:#75715e></span> MOTIONTYPE_EXPLICIT  <span style=color:#75715e>// é‡é»æ˜¯ç›®æ¨™å·²çŸ¥ï¼Œä¸éœ€è¦hashè¨ˆç®—ï¼Œå‘é€å…ƒç»„ç»™å…¶ segid å­—æ®µæŒ‡å®šçš„ `segment`s
</span><span style=color:#75715e></span>} MotionType;

<span style=color:#66d9ef>case</span><span style=color:#f92672>:</span> MOTIONTYPE_HASH
  sname <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Redistribute Motion&#34;</span>;
<span style=color:#66d9ef>case</span><span style=color:#f92672>:</span> MOTIONTYPE_FIXED
  <span style=color:#66d9ef>if</span> (pMotion<span style=color:#f92672>-&gt;</span>isBroadcast)
    sname <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Broadcast Motion&#34;</span>;
  <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (plan<span style=color:#f92672>-&gt;</span>lefttree<span style=color:#f92672>-&gt;</span>flow<span style=color:#f92672>-&gt;</span>locustype <span style=color:#f92672>==</span> CdbLocusType_Replicated)
    sname <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Explicit Gather Motion&#34;</span>;
  <span style=color:#66d9ef>else</span>
    sname <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Gather Motion&#34;</span>;
<span style=color:#66d9ef>case</span> MOTIONTYPE_EXPLICIT:
  sname <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Explicit Redistribute Motion&#34;</span>;
</code></pre></div><p>ä¸€ä¸ªå®Œæ•´çš„motionç®—å­åˆ†ä¸º<code>execMotionSender</code>å’Œ<code>execMotionReceiver</code>ï¼ŒæŒ‰ç…§ä¸åŒçš„ç®—å­å¯ä»¥åˆ†ä¸ºä¸€å¯¹å¤šå’Œå¤šå¯¹å¤šä¸¤ç§ï¼Œ
ä»¥ä¸Šé¢çš„ä¾‹å­ä¸ºä¾‹ï¼Œæ€»å…±æœ‰2ä¸ª<code>segment</code>ï¼Œ<code>Gather Motion</code>åœ¨masterä¸Šæœ‰ä¸€ä¸ª<code>execMotionReceiver</code>è´Ÿè´£æ¥å—<code>segment</code>çš„æ•°æ®ï¼Œåœ¨æ¯ä¸ª<code>segment</code>ä¸Šï¼Œæœ‰ä¸ä¹‹å¯¹åº”çš„<code>execMotionSender</code>ï¼Œè´Ÿè´£å‘é€å¤„ç†ä¹‹åçš„æ•°æ®</p>
<p><img src=/posts/postgres/images/plan2.svg alt=plan2></p>
<p>master å’Œ<code>segment</code>ä¹‹é—´ä½¿ç”¨<code>Gather Motion</code>æ±‡æ€»æ•°æ®ï¼Œ<code>segment</code>ä¹‹é—´ä¹Ÿä½¿ç”¨ä¸åŒçš„motionç®—å­äº¤æ¢æ•°æ®ï¼Œè¿™é‡Œå’ŒAntDBçš„æ‰§è¡Œæµç¨‹ç±»ä¼¼ï¼Œ</p>
<h4 id=2-slice>
2. slice
<a href=#2-slice class=h-anchor aria-hidden=true>#</a>
</h4>
<p>GPæå‡æ€§èƒ½çš„å‡ºå‘ç‚¹æ˜¯å¹¶è¡Œï¼Œç†è®ºä¸Šå¹¶è¡Œå¯ä»¥è·å¾—æ­£åé¦ˆçš„æ“ä½œï¼Œä»–éƒ½å€¾å‘äºå®ç°å¯¹åº”çš„å¹¶è¡Œæ“ä½œï¼Œè¿™é‡Œä¸ºäº†æé«˜æŸ¥è¯¢æ‰§è¡Œå¹¶è¡Œåº¦å’Œæ•ˆç‡ï¼Œ
ä»–ä»¥motionç®—å­ä¸ºç•Œé™ï¼ŒæŠŠæ‰§è¡Œè®¡åˆ’åˆ†ä¸ºä¸åŒçš„sliceï¼Œç„¶åä¸åŒçš„sliceåˆ°ä¸åŒçš„<code>segment</code>ä¸Šæ‰§è¡Œï¼Œä¸Šé¢çš„ä¾‹å­æœ‰4ä¸ªsliceï¼Œåœ¨è¯­å¥è¿è¡Œä¹‹åï¼ŒæŸ¥çœ‹è¿è¡Œçš„è¿›ç¨‹ä¿¡æ¯ï¼Œå¯ä»¥çœ‹è§ä¸‹é¢çš„ä¿¡æ¯</p>
<pre tabindex=0><code>vscode   0:00 postgres:  5432, vscode benchmarksql [local] con35 cmd4 EXPLAIN
vscode   0:00 postgres: 40000, vscode benchmarksql 172.17.0.2(37002) con35 seg0 cmd5 slice3 MPPEXEC SELECT
vscode   0:00 postgres: 40001, vscode benchmarksql 172.17.0.2(46892) con35 seg1 cmd5 slice3 MPPEXEC SELECT
vscode   0:00 postgres: 40000, vscode benchmarksql 172.17.0.2(37006) con35 seg0 cmd5 slice1 MPPEXEC SELECT
vscode   0:00 postgres: 40001, vscode benchmarksql 172.17.0.2(46896) con35 seg1 cmd5 slice1 MPPEXEC SELECT
vscode   0:00 postgres: 40000, vscode benchmarksql 172.17.0.2(37010) con35 seg0 cmd5 slice2 MPPEXEC SELECT
vscode   0:00 postgres: 40001, vscode benchmarksql 172.17.0.2(46900) con35 seg1 cmd5 slice2 MPPEXEC SELECT
</code></pre><p>è¿™é‡Œè°ƒé«˜æ—¥å¿—ç­‰çº§ï¼ŒæŸ¥çœ‹ä¸åŒ<code>segment</code>çš„æ—¥å¿—è®°å½•å¦‚ä¸‹</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// master æ—¥å¿—
</span><span style=color:#75715e></span><span style=color:#a6e22e>Motion</span> <span style=color:#a6e22e>Node</span> <span style=color:#ae81ff>3</span> (<span style=color:#a6e22e>RECEIVER</span>) <span style=color:#a6e22e>Statistics</span><span style=color:#f92672>:</span>
<span style=color:#a6e22e>Timing</span><span style=color:#f92672>:</span>  
         <span style=color:#a6e22e>Time</span> <span style=color:#a6e22e>receiving</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>tuple</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1.138736</span> <span style=color:#a6e22e>sec</span>
<span style=color:#a6e22e>Counters</span><span style=color:#f92672>:</span> 
        <span style=color:#a6e22e>numTuplesFromChild</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>
        <span style=color:#a6e22e>numTuplesFromAMS</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2249955</span>
        <span style=color:#a6e22e>numTuplesToAMS</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>
        <span style=color:#a6e22e>numTuplesToParent</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2249955</span>
<span style=color:#e6db74>&#34;,,,,,,,0,,&#34;</span><span style=color:#a6e22e>nodeMotion</span>.<span style=color:#a6e22e>c</span><span style=color:#e6db74>&#34;,1270,
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>// `segment` æ—¥å¿—
</span><span style=color:#e6db74>Motion Node 3 (SENDER) Statistics:
</span><span style=color:#e6db74>Timing:  
</span><span style=color:#e6db74>         Time getting next tuple to send: 0.910967 sec 
</span><span style=color:#e6db74>         Time sending the tuple:          0.361539  sec
</span><span style=color:#e6db74>         Percentage of time sending:      28.41% 
</span><span style=color:#e6db74>Counters: 
</span><span style=color:#e6db74>        numTuplesFromChild: 1072500
</span><span style=color:#e6db74>        numTuplesToAMS: 1072500
</span><span style=color:#e6db74>&#34;</span>,,,,,,,<span style=color:#ae81ff>0</span>,,<span style=color:#e6db74>&#34;nodeMotion.c&#34;</span>,<span style=color:#ae81ff>1290</span>,
</code></pre></div><p>æ˜æ˜¾çš„å¯ä»¥çœ‹å‡ºä»–çš„æ‰§è¡Œæ–¹å¼ä»¥sliceåˆ’åˆ†ä¸ºä¸åŒçš„é˜¶æ®µï¼Œæ¯ä¸€ä¸ªsliceå®ä¾‹å°±æ˜¯å…·ä½“çš„sliceçš„taskï¼Œæ¯ä¸ªsliceå®ä¾‹æœ‰å…·ä½“çš„æ•°æ®è¾“å…¥ä¸è¾“å‡ºï¼Œç›¸åŒé˜¶æ®µä¸‹çš„sliceä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œåªå’Œä¸‹ä¸€ä¸ªé˜¶æ®µçš„sliceè¿›è¡Œæ•°æ®äº¤äº’</p>
<blockquote>
<p>çœ¼ç†Ÿï¼Œåªçœ‹æè¿°å’ŒMapReduceå‡ ä¹ä¸€æ ·ï¼Œç½‘ä¸Šä¹Ÿç¡®å®æœ‰è®¸å¤šå…³äºMPPå’ŒMPçš„è®¨è®ºï¼Œä¸ªäººè§‰å¾—ä»–ä»¬æ›´å¤šçš„æ˜¯åŒä¸€ä¸ªå¤„ç†æ¡†æ¶ä¸‹çš„é¢å¯¹ä¸åŒç»†èŠ‚åˆ’åˆ†çš„ç»“æœ</p>
</blockquote>
<p>æ¯ä¸ªmotionåœ¨ä¸åŒçš„<code>segment</code>ä¸Šè¿è¡Œæœ‰<code>RECEIVER</code>å’Œ<code>SENDER</code>ï¼ŒæŒ‰ç…§sliceç»†åˆ†æ‰§è¡Œè®¡åˆ’ï¼Œå¤§è‡´é€»è¾‘ä¸Šçš„å’Œpgæ‰§è¡Œæ­¥éª¤ç±»ä¼¼ï¼Œåªæ˜¯é’ˆå¯¹åˆ†å¸ƒå¼ï¼Œæ·»åŠ äº†motionç®—å­ï¼Œæ­¤æ—¶å…·ä½“çš„æ•°æ®æµåŠ¨å¦‚ä¸‹</p>
<p><img src=/posts/postgres/images/plan3.svg alt=plan3></p>
<p>æ¯ä¸€ä¸ªsliceéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä½¿ç”¨interconnetå’Œå…¶ä»–è¿›ç¨‹è¿›è¡Œæ•°æ®äº¤äº’ï¼Œæ•°æ®ç”±ä¸€ä¸ªæµå‘ä¸‹ä¸€ä¸ªsliceï¼Œåœ¨sliceä¸­è¿›è¡Œè¿ç®—ã€‚
å½“å‰å‘ç°çš„ç°è±¡æ˜¯å¯¹äºsliceï¼Œæ— è®ºæ•°æ®è§„æ¨¡å¤§å°ï¼Œåªè¦æ‰§è¡Œè®¡åˆ’é€‰æ‹©ä½¿ç”¨motionç®—å­ï¼Œåˆ™å°±ä¼šä»¥motionç®—å­ä¸ºè¾¹ç•Œï¼Œåˆ’åˆ†ä¸åŒçš„sliceï¼Œå¯èƒ½é€ æˆçš„é—®é¢˜æ˜¯å¯¹äºæ•°æ®è§„æ¨¡æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œåˆ›å»ºè¿›ç¨‹çš„ä»£ä»·è¿œå¤§äºæ•°æ®å¤„ç†çš„ä»£ä»·</p>
<blockquote>
<p>æ­¤é—®é¢˜ç»è¿‡è°ƒæŸ¥ç¡®å®å­˜åœ¨ï¼Œå°šä¸æ¸…æ¥šåç»­æ˜¯å¦æœ‰ä¼˜åŒ–</p>
</blockquote>
<h4 id=æºç >
æºç 
<a href=#%e6%ba%90%e7%a0%81 class=h-anchor aria-hidden=true>#</a>
</h4>
<p>motionsç®—å­çš„ä¸»è¦æ–‡ä»¶ä¸º<code>nodeMotion.h</code>å’Œ<code>nodeMotion.c</code>ï¼Œä¸»è¦æ‰§è¡Œæ–¹æ³•ä¸º</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++>MotionState <span style=color:#f92672>*</span>ExecInitMotion(Motion <span style=color:#f92672>*</span>node, EState <span style=color:#f92672>*</span>estate, <span style=color:#66d9ef>int</span> eflags)
TupleTableSlot <span style=color:#f92672>*</span>ExecMotion(MotionState <span style=color:#f92672>*</span>node)
<span style=color:#66d9ef>void</span> ExecEndMotion(MotionState <span style=color:#f92672>*</span>node)
</code></pre></div><p>å…·ä½“çš„è°ƒç”¨é€»è¾‘å¦‚ä¸‹</p>
<p><img src=/posts/postgres/images/execute1.svg alt=execute1></p>
<ul>
<li>QD Query Dispatch</li>
<li>QE Query Execute</li>
</ul>
<p>åœ¨masterä¸Šåˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨<code>CdbDispatchPlan</code>æ–¹æ³•åˆ†å‘æ‰§è¡Œè®¡åˆ’åˆ°å…·ä½“çš„<code>segment</code>ä¸Šï¼Œåˆ†å‘çš„æ‰§è¡Œè®¡åˆ’æ˜¯ä»¥sliceåˆ’åˆ†çš„æ‰§è¡Œç‰‡æ®µã€‚<code>segment</code>æ¥æ”¶åˆ°æ‰§è¡Œè®¡åˆ’ä½¿ç”¨<code>exec_mpp_query</code>æ‰§è¡Œå…·ä½“çš„æµç¨‹å’Œä¸Šå›¾ç±»ä¼¼ï¼Œä¹Ÿæ˜¯è¿›è¡Œæ‰§è¡Œè®¡åˆ’çš„åˆå§‹åŒ–ï¼Œæ‰§è¡Œï¼Œä»¥åŠé‡Šæ”¾èµ„æºç­‰ã€‚</p>
<blockquote>
<p>cdb ä»£è¡¨cluster databaseï¼Œé¡¹ç›®æ—©æœŸä½¿ç”¨çš„åå­—ï¼Œä¿ç•™åˆ°ç°åœ¨</p>
</blockquote>
<p>åœ¨ä»£ç å†…éƒ¨ï¼Œä»–ä½¿ç”¨<code>GpRoleValue</code>åŒºåˆ†ä¸åŒè§’è‰²ï¼ŒQEå’ŒQDæ‰§è¡Œçš„æ˜¯ä¸åŒçš„è·¯å¾„ï¼Œåœ¨QEä¸‹ï¼Œå†ä½¿ç”¨<code>MotionStateType</code>åŒºåˆ†æ˜¯<code>sender</code>è¿˜æ˜¯<code>recver</code>ï¼Œè®©ä»–ä»¬å†æ‰§è¡Œä¸åŒçš„é€»è¾‘</p>
<p>åœ¨<code>ExecInitMotion</code>åªæ˜¯è¿›è¡Œä¸€äº›åˆå§‹åŒ–ï¼Œmasterä¼šåˆå§‹åŒ–æ•´ä¸ªæ‰§è¡Œè®¡åˆ’ï¼Œç¡®å®šæ‰§è¡Œç®—å­çš„sliceå¹¶ä¸”æŠŠæ‰§è¡Œè®¡åˆ’åˆ‡åˆ†åˆ°ä¸åŒçš„<code>segment</code>ï¼Œç„¶åå‘é€æ‰§è¡Œè®¡åˆ’çš„ç‰‡æ®µåˆ°<code>segment</code>ï¼Œ<code>segment</code>åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä»<code>serder</code>å¼€å§‹ï¼Œå¦‚æœå½“å‰æ‰§è¡Œè®¡åˆ’æœ‰<code>recver</code>ï¼Œåˆ™ä¸€ç›´åˆå§‹åŒ–åˆ°<code>recver</code>ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆå§‹åŒ–æ•´æ£µæ ‘</p>
<p>è¿™é‡Œä¸»è¦å¯¹<code>ExecMotion</code>è¿›è¡Œåˆ†æ</p>
<p><img src=/posts/postgres/images/ExecMotion.svg alt=ExecMotion></p>
<p>æŒ‰ç…§typeè¿™é‡Œåˆ’åˆ†ä¸ºä¸¤æ¡æ‰§è¡Œè·¯å¾„</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=color:#66d9ef>if</span> (recver) {
  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>sorted) {
    execMotionUnsortedReceiver();
  } <span style=color:#66d9ef>else</span> {
    <span style=color:#66d9ef>if</span> (gp_enable_motion_mk_sort)
      execMotionSortedReceiver_mk();
    <span style=color:#66d9ef>else</span>
      <span style=color:#a6e22e>execMotionSortedReceiver</span>();
  }
} <span style=color:#66d9ef>else</span> (sender) {
  execMotionSender() {
    <span style=color:#66d9ef>while</span>(<span style=color:#f92672>!</span>done) {
      outerNode <span style=color:#f92672>=</span> outerPlanState(node);
      outerTupleSlot <span style=color:#f92672>=</span> ExecProcNode(outerNode);
      <span style=color:#75715e>// æ ¹æ®hashå€¼è®¡ç®—targetRoute
</span><span style=color:#75715e></span>      doSendTuple() {
        hval <span style=color:#f92672>=</span> evalHashKey();
        SendTuple();
      }
    }
  }
} <span style=color:#66d9ef>else</span> 
  error report
</code></pre></div><p>è¿™é‡Œçš„sortæœ€åˆä»¥ä¸ºæ˜¯å¯¹äºsortç®—å­çš„ä¼˜åŒ–ï¼Œä½†æ˜¯ä½¿ç”¨å‡ ä¸ªç®€å•çš„sortè¯­å¥æ²¡æœ‰æ„é€ å‡ºç†æƒ³ä¸­çš„æ‰§è¡Œè®¡åˆ’ï¼Œä¾‹å¦‚å¯¹äºè¯­å¥<code>select * from t1 order by c1</code><br>
æˆ‘ä»¥ä¸ºçš„æ‰§è¡Œè®¡åˆ’æ˜¯</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql> Gather Motion <span style=color:#ae81ff>2</span>:<span style=color:#ae81ff>1</span>  (slice1; <span style=color:#f92672>`</span>segment<span style=color:#f92672>`</span>s: <span style=color:#ae81ff>2</span>)  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>207</span>.<span style=color:#ae81ff>26</span>..<span style=color:#ae81ff>214</span>.<span style=color:#ae81ff>76</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>3000</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
   Merge <span style=color:#66d9ef>Key</span>: c1
      <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> t1  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>34</span>.<span style=color:#ae81ff>00</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1500</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
</code></pre></div><p>ä½†æ˜¯å®é™…çš„æ‰§è¡Œè®¡åˆ’è¿˜æ˜¯</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql> Gather Motion <span style=color:#ae81ff>2</span>:<span style=color:#ae81ff>1</span>  (slice1; <span style=color:#f92672>`</span>segment<span style=color:#f92672>`</span>s: <span style=color:#ae81ff>2</span>)  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>207</span>.<span style=color:#ae81ff>26</span>..<span style=color:#ae81ff>214</span>.<span style=color:#ae81ff>76</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>3000</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
   Merge <span style=color:#66d9ef>Key</span>: c1
   <span style=color:#f92672>-&gt;</span>  Sort  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>207</span>.<span style=color:#ae81ff>26</span>..<span style=color:#ae81ff>214</span>.<span style=color:#ae81ff>76</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1500</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
         Sort <span style=color:#66d9ef>Key</span>: c1
         <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> t1  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>34</span>.<span style=color:#ae81ff>00</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1500</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
</code></pre></div><p>è¿™é‡Œçš„sortè¿˜æ˜¯åœ¨<code>segment</code>ä¸Šè¿›è¡Œäº†sortï¼Œå†ç”±masterçš„recverè¿›è¡ŒäºŒæ¬¡æ’åºï¼Œä¸å…¨éƒ¨äº¤åˆ°masteræ’åºå¯èƒ½è¿˜æ˜¯åŸºäºå‡ä½masterçš„è´Ÿè½½æ¥è€ƒè™‘çš„å§ã€‚</p>
<hr>
<h3 id=æ‰§è¡Œè®¡åˆ’çš„ç”Ÿæˆ>
æ‰§è¡Œè®¡åˆ’çš„ç”Ÿæˆ
<a href=#%e6%89%a7%e8%a1%8c%e8%ae%a1%e5%88%92%e7%9a%84%e7%94%9f%e6%88%90 class=h-anchor aria-hidden=true>#</a>
</h3>
<p>è¿™é‡Œå°±è¿˜æ˜¯ä»¥å‰é¢çš„è¯­å¥ä¸ºä¾‹å­ï¼Œç›¸æ¯”äºæ™®é€šçš„pgï¼Œgpéœ€è¦é¢å¤–çš„é€»è¾‘å¤„ç†motionç®—å­çš„ç”Ÿæˆï¼Œæ˜¯å¦éœ€è¦ç”Ÿæˆmotionè·¯å¾„ï¼Œä¸»è¦çš„ä¿¡æ¯çš„æ˜¯æ•°æ®åˆ†å¸ƒï¼Œæ•°æ®çš„åˆ†å¸ƒä¿¡æ¯æ·»åŠ åœ¨pathç»“æ„ä½“ä¸­ï¼Œä½¿ç”¨<code>CdbPathLocus</code>æ¥è¡¨ç¤ºæ•°æ®çš„åˆ†å¸ƒï¼Œåç»­åœ¨<code>cdbpath_create_motion_path</code>ä¸­ï¼Œä½¿ç”¨æ­¤ä¿¡æ¯ç”Ÿæˆmotion pathã€‚</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=color:#66d9ef>typedef</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>CdbPathLocus</span>
{
 CdbLocusType locustype;
 List    <span style=color:#f92672>*</span>distkey;
 <span style=color:#66d9ef>int</span>   numsegments;
} CdbPathLocus;

<span style=color:#66d9ef>typedef</span> <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>CdbLocusType</span>
{
    CdbLocusType_Null,
    CdbLocusType_Entry,         <span style=color:#75715e>/* a single backend process on the entry db:
</span><span style=color:#75715e>                                 * usually the qDisp itself, but could be a
</span><span style=color:#75715e>                                 * qExec started by the entry postmaster.
</span><span style=color:#75715e>                                 */</span>
    CdbLocusType_SingleQE,      <span style=color:#75715e>/* a single backend process on any db: the
</span><span style=color:#75715e>                                 * qDisp itself, or a qExec started by a
</span><span style=color:#75715e>                                 * segment postmaster or the entry postmaster.
</span><span style=color:#75715e>                                 */</span>
    CdbLocusType_General,       <span style=color:#75715e>/* compatible with any locus (data is
</span><span style=color:#75715e>                                 * self-contained in the query plan or
</span><span style=color:#75715e>                                 * generally available in any qExec or qDisp) */</span>
    CdbLocusType_SegmentGeneral,<span style=color:#75715e>/* generally available in any qExec, but not
</span><span style=color:#75715e>				 * available in qDisp */</span>
    CdbLocusType_Replicated,    <span style=color:#75715e>/* replicated over all qExecs of an N-gang */</span>
    CdbLocusType_Hashed,        <span style=color:#75715e>/* hash partitioned over all qExecs of N-gang */</span>
    CdbLocusType_HashedOJ,      <span style=color:#75715e>/* result of hash partitioned outer join, NULLs can be anywhere */</span>
    CdbLocusType_Strewn,        <span style=color:#75715e>/* partitioned on no known function */</span>
    CdbLocusType_End            <span style=color:#75715e>/* = last valid CdbLocusType + 1 */</span>
} CdbLocusType;
</code></pre></div><p><code>CdbLocusType</code>å­—æ®µè¡¨ç¤ºçš„æ•°æ®çš„åˆ†å¸ƒä¿¡æ¯ï¼Œåç»­ä½¿ç”¨ä»–å‚ä¸æ‰§è¡Œè®¡åˆ’çš„ç”Ÿæˆã€‚<code>CdbPathLocus</code>æ˜¯åœ¨<code>set_plain_rel_pathlist</code>ä¸­å»ºç«‹base_rel_pathçš„æ—¶å€™ä½¿ç”¨<code>RelOptInfo</code>æ„å»ºçš„ï¼Œä»–å‚ä¸åç»­çš„ä¼˜åŒ–è¿‡ç¨‹ï¼Œä»¥joinä¸ºä¾‹ï¼Œå½“å‰gpä¸­join pathçš„ç”Ÿæˆè·¯å¾„çš„å…³é”®å‡½æ•°è°ƒç”¨å…³ç³»å¦‚ä¸‹</p>
<p><img src=/posts/postgres/images/join.svg alt=join></p>
<p>åœ¨<code>cdbpath_motion_for_join</code>ä¸­ï¼Œä¼šå¯¹joinèŠ‚ç‚¹çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ä»¥åŠå·¦å³å­èŠ‚ç‚¹çš„<code>CdbPathLocus</code>è¿›è¡Œå’Œ<code>join key</code>ç­‰ä¿¡æ¯ç»¼åˆåˆ¤æ–­ï¼Œä¾‹å¦‚å·¦èŠ‚ç‚¹çš„æ•°æ®åˆ†å¸ƒæ˜¯å¦å’Œå³èŠ‚ç‚¹çš„æ•°æ®åˆ†å¸ƒæ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœæ•°æ®åˆ†å¸ƒä¸€è‡´ï¼Œåˆ™æ­¤å·¦å³èŠ‚ç‚¹æ— éœ€åˆ›å»ºmotionï¼Œå¦‚æœå½“å‰æ•°æ®åˆ†å¸ƒå’Œä¸‹å±‚èŠ‚ç‚¹æ•°æ®åˆ†å¸ƒä¸ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦å•ä¸ªèŠ‚ç‚¹å¤„ç†ï¼Œä»€ä¹ˆæƒ…å†µä¸‹å¿…é¡»å¤šä¸ªèŠ‚ç‚¹å¤„ç†ï¼Œæ˜¯é€‰æ‹©åˆ›å»º<code>Redistribute Motion</code>è¿˜æ˜¯é€‰æ‹©åˆ›å»º<code>Broadcast Motion</code>ç­‰ï¼Œ</p>
<p>æœ€ç»ˆå¯¹äºéœ€è¦ç”Ÿæˆmotionç®—å­çš„èŠ‚ç‚¹ï¼Œåˆ™è°ƒç”¨<code>cdbpath_create_motion_path</code>ç”Ÿæˆmotionï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•ä¸æ˜¯åœ¨joinä¸­è°ƒç”¨çš„ï¼Œæ­¤å¤„ä¹Ÿä¼šä½¿ç”¨<code>CdbPathLocus</code>ä¿¡æ¯è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„åˆ¤æ–­ï¼Œå¦‚æœä¸éœ€è¦motionï¼Œä¸­é—´å°±ç›´æ¥è¿”å›äº†ï¼Œå¦‚æœéœ€è¦ï¼Œæœ€åç”ŸæˆmotionèŠ‚ç‚¹ã€‚æ­¤æ—¶ä¼šè®¡ç®—motionèŠ‚ç‚¹çš„costï¼Œå…·ä½“çš„costè®¡ç®—å‡½æ•°ä¸º<code>cdbpath_cost_motion</code>ï¼Œå…·ä½“çš„è®¡ç®—æ–¹æ³•ä¸º</p>
<p><img src=/posts/postgres/images/cost1.svg alt=cost></p>
<p>å¦‚æœæ˜¯å­èŠ‚ç‚¹éœ€è¦è¿›è¡Œå¹¿æ’­ï¼Œåˆ™é’ˆå¯¹ä¸€ä¸ªmotionæ¥è¯´ï¼Œä»–çš„<code>recvrows</code>æ•°æ®åˆ™ä¼šæ˜¯æ‰€æœ‰ä¸‹å±‚ç®—å­çš„æ•°æ®ï¼Œè€Œ<code>sendrows</code>ç”±äºä¸‹å±‚æ•°æ®äº’ä¸äº¤äº’ï¼Œæ‰€ä»¥ç›´æ¥å°±æ˜¯ä¸‹å±‚èŠ‚ç‚¹çš„æ•°æ®ï¼Œ <code>startup_cost</code>å’Œå­èŠ‚ç‚¹çš„<code>startup cost</code>ä¸€æ ·ï¼Œ<code>total_cost</code>ç­‰äº<code>motioncost</code>åŠ ä¸Šå­èŠ‚ç‚¹çš„<code>total_cost</code>ï¼Œåœ¨ä¸Šé¢çš„è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œ<code>gp_motion_cost_per_row</code>æ˜¯å¯ä»¥è‡ªè¡Œè®¾å®šçš„ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä½¿ç”¨<code>cpu_tuple_cost</code>è®¡ç®—ï¼Œå¹¶æ²¡æœ‰çœ‹è§ç½‘ç»œIOç­‰ä»£ä»·çš„è®¡ç®—ã€‚</p>
<p>ä¸Šé¢çš„æ“ä½œéƒ½æ˜¯åœ¨<code>query_planner</code>ä¸­ç”Ÿæˆçš„ï¼Œå±äºä¸€äº›åŸºç¡€ç®—å­å±‚é¢ä¼˜åŒ–ï¼Œå¯¹äºèšåˆå‡½æ•°ç­‰ä¼˜åŒ–ï¼Œæ¥ä¸‹æ¥ä¼šåœ¨<code>cdb_grouping_planner</code>ä¸­è¿›è¡ŒäºŒæ¬¡ä¼˜åŒ–ã€‚</p>
<p>æœ€ç»ˆç”Ÿæˆpathä¹‹åï¼Œä½¿ç”¨<code>create_plan</code>ç”Ÿæˆplanï¼Œåœ¨ç”Ÿæˆplançš„æ—¶å€™ï¼Œè¿˜ä¼šåœ¨planä¸­è°ƒç”¨<code>cdbpathtoplan_create_flow</code>ï¼Œä¸ºæ¯ä¸€ä¸ªnodeç”Ÿæˆä¸€ä¸ªflowä¿¡æ¯ï¼Œæ­¤ä¿¡æ¯ä¸»è¦ç”±å…ƒæ•°æ®ä¿¡æ¯ä»¥åŠä¸Šé¢çš„<code>Locus</code>ä¿¡æ¯ç”Ÿæˆï¼Œä¸»è¦æè¿°èŠ‚ç‚¹çš„æ•°æ®æµå‘ï¼Œç”¨äºåœ¨åé¢åˆ’åˆ†sliceçš„æ—¶å€™ä½¿ç”¨</p>
<p>ğŸˆ flowçš„ä½œç”¨ç±»ä¼¼AntDBä¸­è®¡ç®—exec_nodeï¼Œåªæ˜¯AntDBä¸­è¿™ä¸ªè¿‡ç¨‹ç´§å¯†çš„ç»“åˆåœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­ï¼Œè€ŒGPåœ¨ä¼˜åŒ–çš„æœ€åé˜¶æ®µï¼Œæ‰ç”Ÿæˆflowä¿¡æ¯ï¼Œæ‰§è¡Œå™¨æ ¹æ®flowä¿¡æ¯é€‰æ‹©æ‰§è¡Œæµç¨‹</p>
<blockquote>
<p><del>å¯¹äºmotionï¼ŒAntDBçš„ç±»ä¼¼æ“ä½œæ˜¯åœ¨<code>set_plain_rel_pathlist</code>ä¸­ç›´æ¥æ„å»º<code>cluster</code>çš„æ‰§è¡Œè®¡åˆ’ï¼Œç„¶ååœ¨joiné˜¶æ®µï¼Œå’ŒåŸæ¥çš„pgçš„è¿‡ç¨‹ç±»ä¼¼ï¼Œæ²¡æœ‰å¤ªç‰¹æ®Šçš„å¤„ç†ï¼Œåªæ˜¯æŠŠæœ€åçš„pathæ·»åŠ åˆ°cluster_pathä¸­å»ï¼Œåªæ˜¯è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç”±äºæœ‰æ›´å¤šçš„åŸºç¡€scanpathï¼Œæ‰€ä»¥åç»­çš„joinçš„æœç´¢ç©ºé—´ç†è®ºä¸Šä¼šæˆå€çš„å¢åŠ ï¼Œä¸”åœ¨joinçš„è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰å¯¹å·¦å³å­èŠ‚ç‚¹è¿›è¡Œkeyç›¸å…³çš„åˆ¤æ–­ï¼Œå¦‚æœæœ‰ç±»ä¼¼çš„æ“ä½œï¼Œé‚£ä¸ºä»€ä¹ˆä¸åœ¨è¿™é‡Œå‘¢</del></p>
</blockquote>
<blockquote>
<p>ğŸ‘´ AntDBåœ¨ç”Ÿæˆbase_pathçš„æ—¶å€™åŒæ—¶ç”Ÿæˆç”Ÿæˆcluster_pathï¼Œç„¶ååœ¨åç»­çš„æ“ä½œä¸­ï¼Œä¾‹å¦‚<code>make_join_rel</code>çš„æ—¶å€™ï¼Œé™¤äº†å¤„ç†å¸¸è§„çš„pathä¹‹å¤–ï¼Œè¿˜ä¼šä½¿ç”¨<code>add_cluster_paths_to_joinrel</code>å¤„ç†å‰é¢çš„cluster_pathï¼Œç”¨äºç”Ÿæˆreduce planï¼Œæ­¤æ–¹æ³•çš„é€»è¾‘å’Œå¤„ç†joinæ–¹æ³•ç±»ä¼¼ã€‚è€Œgpçš„æ­¤è¿‡ç¨‹æ—¶ç›´æ¥åµŒå…¥åˆ°åŸç”Ÿçš„pgå†…æ ¸ä¸­çš„ï¼Œå…·ä½“å¦‚ä¸Šæè¿°ï¼Œæ˜¯åœ¨å¤„ç†joinå·¦å³èŠ‚ç‚¹çš„æ—¶å€™ä½¿ç”¨<code>CdbPathLocus</code>ï¼Œè¿›è¡Œåˆ¤æ–­ã€‚ç›¸æ¯”èµ·æ¥ï¼Œgpçš„å¤„ç†é€»è¾‘æ¸…æ™°æ˜“æ‡‚</p>
</blockquote>
<blockquote>
<p>æ€€ç–‘æ˜¯ä¸æ˜¯å› ä¸ºè¿™ä¹ˆå®ç°çš„è¯ï¼Œåœ¨å‡çº§pgå†…æ ¸çš„æ—¶å€™ï¼Œéš¾åº¦ä¼šå°å¾ˆå¤šã€‚</p>
</blockquote>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=color:#66d9ef>typedef</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Flow</span> {
 NodeTag    type;     <span style=color:#75715e>// T_Flow 
</span><span style=color:#75715e></span><span style=color:#75715e>/*
</span><span style=color:#75715e>typedef enum FlowType
</span><span style=color:#75715e>{
</span><span style=color:#75715e> FLOW_UNDEFINED,    // used prior to calculation of type of derived flow 
</span><span style=color:#75715e> FLOW_SINGLETON,    // flow has single stream  å•å‘æµåŠ¨ï¼Œä¸»è¦æŒ‡çš„æ˜¯gather
</span><span style=color:#75715e> FLOW_REPLICATED,   // flow is replicated across IOPs  å¹¿æ’­
</span><span style=color:#75715e> FLOW_PARTITIONED,  // flow is partitioned across IOPs é‡åˆ†å¸ƒ
</span><span style=color:#75715e>} FlowType;
</span><span style=color:#75715e>*/</span> 
 FlowType flotype;        <span style=color:#75715e>// Type of flow produced by the plan. 
</span><span style=color:#75715e></span>
<span style=color:#75715e>// typedef enum Movement
</span><span style=color:#75715e>// {
</span><span style=color:#75715e>//  MOVEMENT_NONE,   /* No motion required. */
</span><span style=color:#75715e>//  MOVEMENT_FOCUS,   /* Fixed motion to a single segment. */
</span><span style=color:#75715e>//  MOVEMENT_BROADCAST,  /* Broadcast motion. */
</span><span style=color:#75715e>//  MOVEMENT_REPARTITION, /* Hash motion */
</span><span style=color:#75715e>//  MOVEMENT_LIM_RESTRUCT, /* Restructure a Limit node into three stages */
</span><span style=color:#75715e>//  MOVEMENT_EXPLICIT  /* Move tuples to the segments specified in the segid column */
</span><span style=color:#75715e>// } Movement;
</span><span style=color:#75715e></span> Movement req_move;       <span style=color:#75715e>// What motion (including none) should be applied to this Plan&#39;s output. 
</span><span style=color:#75715e></span>
 CdbLocusType locustype;  <span style=color:#75715e>// Locus type (optimizer flow characterization). è¡¨ç¤ºæ•°æ®çš„åˆ†å¸ƒæ–¹å¼ï¼Œç”¨äºç”Ÿæˆæ‰§è¡Œè®¡åˆ’æ˜¯ç¡®å®šmotionçš„èŠ‚ç‚¹
</span><span style=color:#75715e></span> <span style=color:#66d9ef>int</span>   segindex;          <span style=color:#75715e>// Segment index of singleton flow. 
</span><span style=color:#75715e></span> <span style=color:#66d9ef>int</span>   numsegments;
 List  <span style=color:#f92672>*</span>hashExprs;  
 List  <span style=color:#f92672>*</span>hashOpfamilies;
 AttrNumber segidColIdx;
 <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Flow</span>  <span style=color:#f92672>*</span>flow_before_req_move;
} Flow;
</code></pre></div><p>è¿™é‡Œåšä¸ªæ€»ç»“ï¼Œæ‰€æœ‰çš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼Œæ¶‰åŠåˆ°motionç®—å­çš„è·¯å¾„å¤§è‡´å¦‚ä¸‹å›¾</p>
<p><img src=/posts/postgres/images/planall.svg alt=planall></p>
<p>ä¸Šå›¾ä¸­ä½¿ç”¨é¢œè‰²æ ‡è®°çš„æ¨¡å—å°±æ˜¯gpçš„ä¸»è¦çš„æ”¹åŠ¨æ¨¡å—
å¯ä»¥çœ‹åˆ°ï¼Œç›¸æ¯”äºåŸç”Ÿpgï¼Œä»–åœ¨joinå’Œèšåˆç®—å­è¿™é‡Œä¸€ç±»çš„blockç®—å­çš„æ“ä½œä¸Šä¿®æ”¹çš„æ¯”è¾ƒå¤š</p>
<p>å…³äºæ‰§è¡Œè®¡åˆ’çš„ç”Ÿæˆï¼Œç®€å•çš„ç†è§£å¤§è‡´å°±æ˜¯éœ€è¦åœ¨blockç®—å­ä¸Šè¿›è¡Œåˆ†æï¼Œçœ‹æ˜¯å¦éœ€è¦æ·»åŠ é¢å¤–çš„æ•°æ®é‡åˆ†å¸ƒæ“ä½œï¼Œå¸¸è§çš„blockæ“ä½œæœ‰joinï¼Œsortï¼Œä»¥åŠä¸€äº›èšåˆæ“ä½œç­‰ï¼Œç„¶ååœ¨å…·ä½“çš„ç»†èŠ‚ä¸Šè¿›è¡Œåˆ†æï¼Œä¸”ä½¿ç”¨è®¡ç®—ä»£ä»·å’Œæ•°æ®åˆ†å¸ƒç­‰æ–¹å¼å†³å®šå…·ä½“çš„å¹¶å‘åº¦</p>
<ul>
<li>æ™®é€šè®¡åˆ’ç”Ÿæˆ</li>
<li>å¤„ç†blockç®—å­
<ol>
<li>è¯­ä¹‰åˆ†ææ˜¯å¦éœ€è¦å¹¶å‘</li>
<li>ä»£ä»·è®¡ç®—å¤šå°‘å¹¶å‘åº¦</li>
</ol>
</li>
</ul>
<h3 id=antdb-vs-greenplum>
AntDB VS GreenPlum
<a href=#antdb-vs-greenplum class=h-anchor aria-hidden=true>#</a>
</h3>
<p>ä¸Šé¢å¯¹ä¸€ä¸ªç¨å¾®å¤æ‚çš„è¯­å¥ä¸ºä¾‹ï¼Œå¯ä»¥å›ç­”äº†æ‰§è¡Œè®¡åˆ’æ€ä¹ˆè§£é‡Šï¼Œæ‰§è¡Œè®¡åˆ’æ€ä¹ˆæ‰§è¡Œï¼Œä»¥åŠæ‰§è¡Œè®¡åˆ’æ€ä¹ˆç”Ÿæˆ</p>
<p>â° å…³äºæ‰§è¡Œè®¡åˆ’çš„ç”Ÿæˆæ–¹å¼ï¼Œè¿˜æœ‰ç»†èŠ‚éœ€è¦è°ƒç ”</p>
<p>è¿™é‡Œä½¿ç”¨å‡ ä¸ªä¾‹å­ï¼Œå¯¹æ¯”ä¸‹AntDBå’ŒGreenPlumçš„å·®åˆ«</p>
<p>è¿™é‡Œä½¿ç”¨çš„ä¾‹å­éƒ½æ²¡æœ‰è¿›è¡Œç‰¹æ®Šçš„é…ç½®ï¼Œå…¶ä¸­AntDB<code>set pgxc_enable_remote_query=false;</code>ï¼Œè®°å½•çš„æ˜¯å‰5æ¬¡çš„æ‰§è¡Œè®¡åˆ’ï¼Œæ¢è¨€ä¹‹ï¼Œæ˜¯ä½¿ç”¨åˆ°<code>boundParams</code>çš„æ‰§è¡Œè®¡åˆ’ï¼Œè€Œä¸æ˜¯â€œæ™®éâ€çš„æ‰§è¡Œè®¡åˆ’ã€‚GreenPlumæ²¡æœ‰ä½¿ç”¨ORCAä¼˜åŒ–å™¨ï¼Œä½¿ç”¨çš„ä¼˜åŒ–å™¨æ˜¯PGçš„åŸç”Ÿä¼˜åŒ–å™¨ï¼Œå…·ä½“çš„ä¿¡æ¯å¦‚ä¸‹</p>
<table>
<thead>
<tr>
<th>AntDB</th>
<th>GreenPlum</th>
</tr>
</thead>
<tbody>
<tr>
<td>ADB6_2_STABLE</td>
<td>6X_STABLE</td>
</tr>
<tr>
<td>PostgreSQL 13.3</td>
<td>PostgreSQL 9.4.26</td>
</tr>
</tbody>
</table>
<blockquote>
<ol>
<li>éƒ¨åˆ†æ‰§è¡Œè®¡åˆ’ç”±äºpostgresçš„å†…æ ¸å·®å¼‚å¯èƒ½æœ‰æ‰€ä¸åŒ</li>
<li>GreenPlumçš„6X_STABLEæ˜¯ä¸Šä¸€ä¸ªå‘è¡Œæ—¶é—´æ˜¯2019-03-20</li>
</ol>
</blockquote>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>table</span> t1 <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>g</span> c1, <span style=color:#66d9ef>g</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>as</span> c2 <span style=color:#66d9ef>FROM</span> 
generate_series(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>3000</span>) <span style=color:#66d9ef>g</span> DISTRIBUTED <span style=color:#66d9ef>BY</span> (c1);  

<span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>table</span> t2 <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>g</span> c1, <span style=color:#66d9ef>g</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>as</span> c2 <span style=color:#66d9ef>FROM</span> 
generate_series(<span style=color:#ae81ff>500</span>, <span style=color:#ae81ff>3500</span>) <span style=color:#66d9ef>g</span> DISTRIBUTED <span style=color:#66d9ef>BY</span> (c1);  

                          <span style=color:#66d9ef>Table</span> <span style=color:#e6db74>&#34;public.t1&#34;</span>
 <span style=color:#66d9ef>Column</span> <span style=color:#f92672>|</span>  <span style=color:#66d9ef>Type</span>   <span style=color:#f92672>|</span> Modifiers <span style=color:#f92672>|</span> <span style=color:#66d9ef>Storage</span> <span style=color:#f92672>|</span> Stats target <span style=color:#f92672>|</span> Description 
<span style=color:#75715e>--------+---------+-----------+---------+--------------+-------------
</span><span style=color:#75715e></span> c1     <span style=color:#f92672>|</span> integer <span style=color:#f92672>|</span>           <span style=color:#f92672>|</span> plain   <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span> 
 c2     <span style=color:#f92672>|</span> integer <span style=color:#f92672>|</span>           <span style=color:#f92672>|</span> plain   <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span> 
Distributed <span style=color:#66d9ef>by</span>: (c1)
                                    <span style=color:#66d9ef>Table</span> <span style=color:#e6db74>&#34;public.t1&#34;</span>
 <span style=color:#66d9ef>Column</span> <span style=color:#f92672>|</span>  <span style=color:#66d9ef>Type</span>   <span style=color:#f92672>|</span> <span style=color:#66d9ef>Collation</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>Nullable</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>Default</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>Storage</span> <span style=color:#f92672>|</span> Stats target <span style=color:#f92672>|</span> Description 
<span style=color:#75715e>--------+---------+-----------+----------+---------+---------+--------------+-------------
</span><span style=color:#75715e></span> c1     <span style=color:#f92672>|</span> integer <span style=color:#f92672>|</span>           <span style=color:#f92672>|</span>          <span style=color:#f92672>|</span>         <span style=color:#f92672>|</span> plain   <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span> 
 c2     <span style=color:#f92672>|</span> integer <span style=color:#f92672>|</span>           <span style=color:#f92672>|</span>          <span style=color:#f92672>|</span>         <span style=color:#f92672>|</span> plain   <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span> 
DISTRIBUTE <span style=color:#66d9ef>BY</span> HASH(c1) <span style=color:#66d9ef>TO</span> NODE(dn1, dn2)
<span style=color:#66d9ef>Access</span> <span style=color:#66d9ef>method</span>: heap

<span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> t1 (c1 integer, c2 integer) DISTRIBUTE <span style=color:#66d9ef>BY</span> HASH(c1) <span style=color:#66d9ef>TO</span> NODE(dn1, dn2);  
<span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> t2 (c1 integer, c2 integer) DISTRIBUTE <span style=color:#66d9ef>BY</span> HASH(c1) <span style=color:#66d9ef>TO</span> NODE(dn1, dn2);  

<span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> t1 <span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>g</span> c1, <span style=color:#66d9ef>g</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>as</span> c2 <span style=color:#66d9ef>FROM</span> generate_series(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>3000</span>) <span style=color:#66d9ef>g</span> ;  
<span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> t2 <span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>g</span> c1, <span style=color:#66d9ef>g</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>as</span> c2 <span style=color:#66d9ef>FROM</span> generate_series(<span style=color:#ae81ff>500</span>, <span style=color:#ae81ff>3500</span>) <span style=color:#66d9ef>g</span> ;  
</code></pre></div><p>é¦–å…ˆåˆ†æç®€å•çš„SQLè¯­å¥ï¼Œè¿™é‡Œçš„gpé»˜è®¤ä½¿ç”¨hashåˆ†å¸ƒï¼Œä½†æ˜¯å’ŒAntDBä½¿ç”¨hashå‡½æ•°ä¸ä¸€æ ·ï¼Œæ‰€ä»¥åœ¨å…·ä½“çš„èŠ‚ç‚¹ä¸Šçš„æ•°æ®ä¸ä¸€æ ·ï¼Œä½†æ˜¯æ€»çš„æ•°æ®æ˜¯ä¸€æ ·çš„</p>
<h5 id=sql1-åˆ†åŒºé”®join>
SQL1 åˆ†åŒºé”®join
<a href=#sql1-%e5%88%86%e5%8c%ba%e9%94%aejoin class=h-anchor aria-hidden=true>#</a>
</h5>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> t1, t2 <span style=color:#66d9ef>where</span> t1.c1 <span style=color:#f92672>=</span> t2.c1;  

                               QUERY PLAN                               
<span style=color:#75715e>---------------------------------------------------------------------------------------
</span><span style=color:#75715e></span> <span style=color:#66d9ef>Cluster</span> Gather  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>179</span>.<span style=color:#ae81ff>81</span>..<span style=color:#ae81ff>2196</span>.<span style=color:#ae81ff>42</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>6384</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>)
   <span style=color:#f92672>-&gt;</span>  Merge <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>179</span>.<span style=color:#ae81ff>81</span>..<span style=color:#ae81ff>281</span>.<span style=color:#ae81ff>22</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>3192</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>)
         Merge Cond: (t1.c1 <span style=color:#f92672>=</span> t2.c1)
         <span style=color:#f92672>-&gt;</span>  Sort  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>89</span>.<span style=color:#ae81ff>90</span>..<span style=color:#ae81ff>92</span>.<span style=color:#ae81ff>73</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1130</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
               Sort <span style=color:#66d9ef>Key</span>: t1.c1
               <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> t1  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>32</span>.<span style=color:#ae81ff>60</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1130</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
         <span style=color:#f92672>-&gt;</span>  Sort  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>89</span>.<span style=color:#ae81ff>90</span>..<span style=color:#ae81ff>92</span>.<span style=color:#ae81ff>73</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1130</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
               Sort <span style=color:#66d9ef>Key</span>: t2.c1
               <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> t2  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>32</span>.<span style=color:#ae81ff>60</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1130</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
(<span style=color:#ae81ff>9</span> <span style=color:#66d9ef>rows</span>)

                                  QUERY PLAN                                  
<span style=color:#75715e>---------------------------------------------------------------------------------------
</span><span style=color:#75715e></span> Gather Motion <span style=color:#ae81ff>2</span>:<span style=color:#ae81ff>1</span>  (slice1; segments: <span style=color:#ae81ff>2</span>)  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>23</span>..<span style=color:#ae81ff>4</span>.<span style=color:#ae81ff>48</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>10</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>)
   <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>23</span>..<span style=color:#ae81ff>4</span>.<span style=color:#ae81ff>48</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>)
         Hash Cond: (t2.c1 <span style=color:#f92672>=</span> t1.c1)
         <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> t2  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>11</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>6</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
         <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>10</span>..<span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>10</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
               <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> t1  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>10</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
 Optimizer: Postgres query optimizer
(<span style=color:#ae81ff>7</span> <span style=color:#66d9ef>rows</span>)

</code></pre></div><p>åˆ†å¸ƒæ–¹å¼ä¸€æ ·çš„è¡¨ä½¿ç”¨åˆ†åŒºé”®è¿›è¡Œjoinï¼Œç›¸åŒçš„æ•°æ®éƒ½åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ‰€ä»¥é™¤äº†<code>Gather</code>ä¹‹å¤–ï¼Œä¸éœ€è¦é¢å¤–çš„<code>motion</code>æ“ä½œ</p>
<h5 id=sql2-åˆ†åŒºé”®joinéåˆ†åŒºé”®>
SQL2 åˆ†åŒºé”®joinéåˆ†åŒºé”®
<a href=#sql2-%e5%88%86%e5%8c%ba%e9%94%aejoin%e9%9d%9e%e5%88%86%e5%8c%ba%e9%94%ae class=h-anchor aria-hidden=true>#</a>
</h5>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> t1, t2 <span style=color:#66d9ef>where</span> t1.c1 <span style=color:#f92672>=</span> t2.c2;  

                                               QUERY PLAN      
<span style=color:#75715e>---------------------------------------------------------------------------------------
</span><span style=color:#75715e></span> <span style=color:#66d9ef>Cluster</span> Gather  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>1047</span>.<span style=color:#ae81ff>72</span>..<span style=color:#ae81ff>3575</span>.<span style=color:#ae81ff>80</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>6384</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>)
   Remote node: <span style=color:#ae81ff>16386</span>,<span style=color:#ae81ff>16387</span>
   <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>47</span>.<span style=color:#ae81ff>73</span>..<span style=color:#ae81ff>660</span>.<span style=color:#ae81ff>60</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>3192</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>)
         <span style=color:#66d9ef>Output</span>: t1.c1, t1.c2, t2.c1, t2.c2
         Hash Cond: (t2.c2 <span style=color:#f92672>=</span> t1.c1)
         <span style=color:#f92672>-&gt;</span>  <span style=color:#66d9ef>Cluster</span> Reduce  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>387</span>.<span style=color:#ae81ff>60</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1130</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
               Reduce: (<span style=color:#e6db74>&#39;[0:1]={16386,16387}&#39;</span>::oid[])[COALESCE(hash_combin_mod(<span style=color:#ae81ff>2</span>, hashint4(t2.c2)), <span style=color:#ae81ff>0</span>)]
               <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> <span style=color:#66d9ef>public</span>.t2  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>32</span>.<span style=color:#ae81ff>60</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1130</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
                     <span style=color:#66d9ef>Output</span>: t2.c1, t2.c2
                     Remote node: <span style=color:#ae81ff>16386</span>,<span style=color:#ae81ff>16387</span>
         <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>32</span>.<span style=color:#ae81ff>60</span>..<span style=color:#ae81ff>32</span>.<span style=color:#ae81ff>60</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1130</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
               <span style=color:#66d9ef>Output</span>: t1.c1, t1.c2
               <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> <span style=color:#66d9ef>public</span>.t1  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>32</span>.<span style=color:#ae81ff>60</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1130</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
                     <span style=color:#66d9ef>Output</span>: t1.c1, t1.c2
                     Remote node: <span style=color:#ae81ff>16386</span>,<span style=color:#ae81ff>16387</span>
(<span style=color:#ae81ff>15</span> <span style=color:#66d9ef>rows</span>)

                                          QUERY PLAN         
<span style=color:#75715e>---------------------------------------------------------------------------------------
</span><span style=color:#75715e></span> Gather Motion <span style=color:#ae81ff>2</span>:<span style=color:#ae81ff>1</span>  (slice2; segments: <span style=color:#ae81ff>2</span>)  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>23</span>..<span style=color:#ae81ff>4</span>.<span style=color:#ae81ff>70</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>10</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>)
   <span style=color:#66d9ef>Output</span>: t1.c1, t1.c2, t2.c1, t2.c2
   <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>23</span>..<span style=color:#ae81ff>4</span>.<span style=color:#ae81ff>70</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>)
         <span style=color:#66d9ef>Output</span>: t1.c1, t1.c2, t2.c1, t2.c2
         Hash Cond: (t2.c2 <span style=color:#f92672>=</span> t1.c1)
         <span style=color:#f92672>-&gt;</span>  Redistribute Motion <span style=color:#ae81ff>2</span>:<span style=color:#ae81ff>2</span>  (slice1; segments: <span style=color:#ae81ff>2</span>)  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>33</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>6</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
               <span style=color:#66d9ef>Output</span>: t2.c1, t2.c2
               Hash <span style=color:#66d9ef>Key</span>: t2.c2
               <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> <span style=color:#66d9ef>public</span>.t2  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>11</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>6</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
                     <span style=color:#66d9ef>Output</span>: t2.c1, t2.c2
         <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>10</span>..<span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>10</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
               <span style=color:#66d9ef>Output</span>: t1.c1, t1.c2
               <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> <span style=color:#66d9ef>public</span>.t1  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>10</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
                     <span style=color:#66d9ef>Output</span>: t1.c1, t1.c2
 Optimizer: Postgres query optimizer
(<span style=color:#ae81ff>15</span> <span style=color:#66d9ef>rows</span>)

</code></pre></div><p>åˆ†åŒºé”®joinéåˆ†åŒºé”®ï¼Œå¯¹äºä½¿ç”¨éåˆ†åŒºé”®çš„è¡¨ï¼Œéœ€è¦è¿›è¡Œæ•°æ®é‡åˆ†å¸ƒï¼Œä½¿å¾—æ¯ä¸ªèŠ‚ç‚¹ä¸Škeyæ•°æ®ç›¸åŒ</p>
<h5 id=sql3-éåˆ†åŒºé”®joinéåˆ†åŒºé”®>
SQL3 éåˆ†åŒºé”®joinéåˆ†åŒºé”®
<a href=#sql3-%e9%9d%9e%e5%88%86%e5%8c%ba%e9%94%aejoin%e9%9d%9e%e5%88%86%e5%8c%ba%e9%94%ae class=h-anchor aria-hidden=true>#</a>
</h5>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> t1, t2 <span style=color:#66d9ef>where</span> t1.c2 <span style=color:#f92672>=</span> t2.c2;  

                                         QUERY PLAN                               
<span style=color:#75715e>---------------------------------------------------------------------------------------
</span><span style=color:#75715e></span> Gather Motion <span style=color:#ae81ff>2</span>:<span style=color:#ae81ff>1</span>  (slice2; <span style=color:#f92672>`</span>segment<span style=color:#f92672>`</span>s: <span style=color:#ae81ff>2</span>)  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>25</span>..<span style=color:#ae81ff>4</span>.<span style=color:#ae81ff>82</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>10</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>)
   <span style=color:#66d9ef>Output</span>: t1.c1, t1.c2, t2.c1, t2.c2
   <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>25</span>..<span style=color:#ae81ff>4</span>.<span style=color:#ae81ff>82</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>)
         <span style=color:#66d9ef>Output</span>: t1.c1, t1.c2, t2.c1, t2.c2
         Hash Cond: (t1.c2 <span style=color:#f92672>=</span> t2.c2)
         <span style=color:#f92672>-&gt;</span>  Broadcast Motion <span style=color:#ae81ff>2</span>:<span style=color:#ae81ff>2</span>  (slice1; <span style=color:#f92672>`</span>segment<span style=color:#f92672>`</span>s: <span style=color:#ae81ff>2</span>)  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>40</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>10</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
               <span style=color:#66d9ef>Output</span>: t1.c1, t1.c2
               <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> <span style=color:#66d9ef>public</span>.t1  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>10</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
                     <span style=color:#66d9ef>Output</span>: t1.c1, t1.c2
         <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>11</span>..<span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>11</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>6</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
               <span style=color:#66d9ef>Output</span>: t2.c1, t2.c2
               <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> <span style=color:#66d9ef>public</span>.t2  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>11</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>6</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
                     <span style=color:#66d9ef>Output</span>: t2.c1, t2.c2
 Optimizer: Postgres query optimizer
(<span style=color:#ae81ff>14</span> <span style=color:#66d9ef>rows</span>)

                                  QUERY PLAN                               
<span style=color:#75715e>-------------------------------------------------------------------------------
</span><span style=color:#75715e></span> <span style=color:#66d9ef>Cluster</span> Gather  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>1047</span>.<span style=color:#ae81ff>72</span>..<span style=color:#ae81ff>3802</span>.<span style=color:#ae81ff>09</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>6384</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>)
   Remote node: <span style=color:#ae81ff>16386</span>,<span style=color:#ae81ff>16387</span>
   <span style=color:#f92672>-&gt;</span>  Hash <span style=color:#66d9ef>Join</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>47</span>.<span style=color:#ae81ff>73</span>..<span style=color:#ae81ff>886</span>.<span style=color:#ae81ff>89</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>3192</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>)
         <span style=color:#66d9ef>Output</span>: t1.c1, t1.c2, t2.c1, t2.c2
         Hash Cond: (t1.c2 <span style=color:#f92672>=</span> t2.c2)
         <span style=color:#f92672>-&gt;</span>  <span style=color:#66d9ef>Cluster</span> Reduce  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>387</span>.<span style=color:#ae81ff>60</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>2260</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
               Reduce: <span style=color:#66d9ef>unnest</span>(<span style=color:#e6db74>&#39;[0:1]={16386,16387}&#39;</span>::oid[])
               <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> <span style=color:#66d9ef>public</span>.t1  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>32</span>.<span style=color:#ae81ff>60</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1130</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
                     <span style=color:#66d9ef>Output</span>: t1.c1, t1.c2
                     Remote node: <span style=color:#ae81ff>16386</span>,<span style=color:#ae81ff>16387</span>
         <span style=color:#f92672>-&gt;</span>  Hash  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>32</span>.<span style=color:#ae81ff>60</span>..<span style=color:#ae81ff>32</span>.<span style=color:#ae81ff>60</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1130</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
               <span style=color:#66d9ef>Output</span>: t2.c1, t2.c2
               <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> <span style=color:#66d9ef>public</span>.t2  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>32</span>.<span style=color:#ae81ff>60</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1130</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
                     <span style=color:#66d9ef>Output</span>: t2.c1, t2.c2
                     Remote node: <span style=color:#ae81ff>16386</span>,<span style=color:#ae81ff>16387</span>
(<span style=color:#ae81ff>15</span> <span style=color:#66d9ef>rows</span>)
</code></pre></div><p>éåˆ†åŒºé”®joinéåˆ†åŒºé”®ï¼Œéœ€è¦åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šå¾—åˆ°ç›¸åŒçš„æ•°æ®ï¼Œè¦ä¹ˆä¸¤è¡¨ä½¿ç”¨ç›¸åŒçš„hashæ–¹å¼é‡åˆ†å¸ƒï¼Œè¦ä¹ˆä¸€ä¸ªè¡¨<code>å­˜åœ¨åœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Š</code>ï¼Œè¿™é‡Œé€‰æ‹©å¯¹t1è¿›è¡Œå¹¿æ’­ã€‚</p>
<h5 id=sql4-èšåˆæ“ä½œ>
SQL4 èšåˆæ“ä½œ
<a href=#sql4-%e8%81%9a%e5%90%88%e6%93%8d%e4%bd%9c class=h-anchor aria-hidden=true>#</a>
</h5>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>benchmarksql<span style=color:#f92672>=#</span> <span style=color:#66d9ef>explain</span> <span style=color:#66d9ef>select</span>  <span style=color:#66d9ef>sum</span>(c2) <span style=color:#66d9ef>from</span> t1 <span style=color:#66d9ef>group</span> <span style=color:#66d9ef>by</span> c2;
                                  QUERY PLAN                                  
<span style=color:#75715e>------------------------------------------------------------------------------
</span><span style=color:#75715e></span> Finalize GroupAggregate  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>183</span>.<span style=color:#ae81ff>13</span>..<span style=color:#ae81ff>239</span>.<span style=color:#ae81ff>38</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1500</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>)
   <span style=color:#66d9ef>Group</span> <span style=color:#66d9ef>Key</span>: c2
   <span style=color:#f92672>-&gt;</span>  <span style=color:#66d9ef>Cluster</span> Merge Gather  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>183</span>.<span style=color:#ae81ff>13</span>..<span style=color:#ae81ff>209</span>.<span style=color:#ae81ff>38</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>3000</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>)
         Sort <span style=color:#66d9ef>Key</span>: c2
         <span style=color:#f92672>-&gt;</span>  <span style=color:#66d9ef>Partial</span> GroupAggregate  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>123</span>.<span style=color:#ae81ff>13</span>..<span style=color:#ae81ff>149</span>.<span style=color:#ae81ff>38</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1500</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>)
               <span style=color:#66d9ef>Group</span> <span style=color:#66d9ef>Key</span>: c2
               <span style=color:#f92672>-&gt;</span>  Sort  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>123</span>.<span style=color:#ae81ff>13</span>..<span style=color:#ae81ff>126</span>.<span style=color:#ae81ff>88</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1500</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
                     Sort <span style=color:#66d9ef>Key</span>: c2
                     <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> t1  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>44</span>.<span style=color:#ae81ff>00</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1500</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)

                                             QUERY PLAN                                              
<span style=color:#75715e>-----------------------------------------------------------------------------------------------------
</span><span style=color:#75715e></span> Gather Motion <span style=color:#ae81ff>2</span>:<span style=color:#ae81ff>1</span>  (slice2; segments: <span style=color:#ae81ff>2</span>)  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>154</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>184</span>.<span style=color:#ae81ff>00</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>3000</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>)
   <span style=color:#f92672>-&gt;</span>  HashAggregate  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>154</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>184</span>.<span style=color:#ae81ff>00</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1500</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>)
         <span style=color:#66d9ef>Group</span> <span style=color:#66d9ef>Key</span>: t1.c2
         <span style=color:#f92672>-&gt;</span>  Redistribute Motion <span style=color:#ae81ff>2</span>:<span style=color:#ae81ff>2</span>  (slice1; segments: <span style=color:#ae81ff>2</span>)  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>49</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>109</span>.<span style=color:#ae81ff>00</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1500</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>)
               Hash <span style=color:#66d9ef>Key</span>: t1.c2
               <span style=color:#f92672>-&gt;</span>  HashAggregate  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>49</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>49</span>.<span style=color:#ae81ff>00</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1500</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>)
                     <span style=color:#66d9ef>Group</span> <span style=color:#66d9ef>Key</span>: t1.c2
                     <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> t1  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>34</span>.<span style=color:#ae81ff>00</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1500</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)

</code></pre></div><p>è¿™é‡Œçš„èšåˆæ“ä½œä¸¤è€…ä¹‹é—´æœ‰äº†æ˜æ˜¾çš„åŒºåˆ«ï¼ŒAntDBåœ¨æœ€åé€‰æ‹©æ•°æ®åœ¨masteræ±‡æ€»ï¼Œç„¶åå†è¿›è¡Œäº†<code>GroupAggregate</code>æ“ä½œï¼Œä½†æ˜¯GPåœ¨è¿™ä¹‹å‰ï¼Œ é€‰æ‹©ä½¿ç”¨<code>Redistribute Motion</code>æ“ä½œï¼ŒæŠŠæ•°æ®é‡åˆ†å¸ƒä¹‹åï¼Œè®¡ç®—ä¹‹åå†è¿›è¡Œæ±‡æ€»ï¼Œå‰é¢æåˆ°masterä¸Šåªæœ‰ä¸€ä¸ª<code>Gather</code>è¿™å°±æ˜¯ä¸€ä¸ªä½è¯ï¼Œmasterä¸Šçš„<code>Gather</code>æ“ä½œæœ€å¤šçš„æ“ä½œæ˜¯å¯¹æ”¶é›†çš„æ•°æ®è¿›è¡Œæ’åºï¼Œä¸”è¿™ä¸æ˜¯ä¸€ä¸ªæ˜¾ç¤ºçš„ç®—å­æ“ä½œ</p>
<p>è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œå¯¹äºæ‰§è¡Œè®¡åˆ’ï¼Œä¸¤è€…ä¹‹é—´åœ¨å…³é”®è·¯å¾„çš„é€‰æ‹©ä¸Šæ²¡æœ‰å¤ªå¤šçš„å·®åˆ«ï¼Œä½†æ˜¯ç”±äºåœ¨å…·ä½“çš„ç®—å­çš„å®ç°å·®å¼‚ï¼Œå¯¼è‡´æ‰§è¡Œè®¡åˆ’åœ¨ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒ</p>
<p>å¦å¤–ï¼Œè¿™é‡Œå¯¹joinçš„æ‰§è¡Œè®¡åˆ’å…³äºmotionè¿›è¡Œç®€å•çš„æ€»ç»“</p>
<ul>
<li>joinä¸¤è¾¹çš„å­—æ®µéƒ½æ˜¯åˆ†å¸ƒé”®ï¼Œæ²¡æœ‰motionæ“ä½œï¼Œ<code>FQSæ­¤æ—¶åº”è¯¥æ˜¯æŠŠè¯­å¥ç›´æ¥å‘é€åˆ°DNï¼Œè€Œä¸æ˜¯ä½¿ç”¨`_REMOTE_TABLE_QUERY_`æŠŠæ•°æ®è¯»åˆ°masterå†join </code>
<ol>
<li>å¦‚æœä½¿ç”¨æ¡ä»¶ï¼Œåˆ™å¯¹è¡¨è¾¾å¼è¿›è¡Œhashè®¡ç®—æ‰§è¡ŒèŠ‚ç‚¹ï¼Œå¦‚æœèƒ½è®¡ç®—åˆ°ä¸€ä¸ªæ‰§è¡ŒèŠ‚ç‚¹ï¼Œåˆ™é™å®šä¸€ä¸ªèŠ‚ç‚¹æ‰§è¡Œ</li>
</ol>
</li>
<li>å¤§è¡¨joinå¤§è¡¨
<ol>
<li>å…¶ä¸­ä¸€ä¸ªjoinå­—æ®µæ˜¯åˆ†å¸ƒé”®ï¼Œå¦ä¸€ä¸ªä¸æ˜¯ï¼Œæ­¤æ—¶éåˆ†å¸ƒé”®çš„è¡¨ä¼šè¢«é‡åˆ†å¸ƒã€‚</li>
<li>éƒ½ä¸æ˜¯åˆ†åŒºé”®ï¼Œä¸¤è¡¨éƒ½éœ€è¦é‡åˆ†å¸ƒ</li>
<li>å¦‚æœjoinå­—æ®µä½¿ç”¨æ¡ä»¶ï¼Œåˆ™å¯¹è¡¨è¾¾å¼è¿›è¡Œhashè®¡ç®—æ‰§è¡ŒèŠ‚ç‚¹ï¼Œå¦‚æœèƒ½è®¡ç®—åˆ°ä¸€ä¸ªæ‰§è¡ŒèŠ‚ç‚¹ï¼Œåˆ™é™å®šä¸€ä¸ªèŠ‚ç‚¹æ‰§è¡Œï¼Œé‡åˆ†å¸ƒçš„motionè¿˜æ˜¯ç»§ç»­åœ¨å¤šä¸ªèŠ‚ç‚¹æ‰§è¡Œ</li>
</ol>
</li>
<li>å°è¡¨joinå¤§è¡¨
<ol>
<li>å°è¡¨ç”¨äº†åˆ†å¸ƒé”®ï¼Œå°è¡¨å¹¿æ’­</li>
<li>å¤§è¡¨ç”¨äº†åˆ†å¸ƒé”®ï¼Œå°è¡¨é‡åˆ†å¸ƒ</li>
<li>éƒ½ä¸æ˜¯åˆ†å¸ƒé”®ï¼Œå°è¡¨å¹¿æ’­</li>
<li>å¦‚æœjoinå­—æ®µä½¿ç”¨æ¡ä»¶ï¼Œåˆ™å¯¹è¡¨è¾¾å¼è¿›è¡Œhashè®¡ç®—æ‰§è¡ŒèŠ‚ç‚¹ï¼Œå¦‚æœèƒ½è®¡ç®—åˆ°ä¸€ä¸ªæ‰§è¡ŒèŠ‚ç‚¹ï¼Œåˆ™é™å®šä¸€ä¸ªèŠ‚ç‚¹æ‰§è¡Œï¼Œé‡åˆ†å¸ƒçš„motionè¿˜æ˜¯ç»§ç»­åœ¨å¤šä¸ªèŠ‚ç‚¹æ‰§è¡Œï¼Œè¿™é‡Œéœ€è¦è€ƒè™‘å¤§è¡¨ã€‚</li>
</ol>
</li>
</ul>
<hr>
<h2 id=ç®€å•çš„æ€§èƒ½å¯¹æ¯”>
ç®€å•çš„æ€§èƒ½å¯¹æ¯”
<a href=#%e7%ae%80%e5%8d%95%e7%9a%84%e6%80%a7%e8%83%bd%e5%af%b9%e6%af%94 class=h-anchor aria-hidden=true>#</a>
</h2>
<p>AntDB<br>
å•æœºé›†ç¾¤ï¼Œ2dnï¼Œè™šæ‹Ÿæœº
GP
å•æœºé›†ç¾¤ï¼Œ2Segmentï¼Œè™šæ‹Ÿæœºä¸­çš„docker</p>
<ol>
<li>å‰é¢çš„ä¾‹å­ä¸­çš„è¯­å¥ï¼Œæ—¶é—´å¯¹æ¯”ä¸º<code>Execution Time: 3404.429 ms</code>å’Œ<code> Execution time: 1043.784 ms</code></li>
<li>æ¥è‡ªTIDBçš„<a href=https://www.bookstack.cn/read/tidb-5.0-zh/benchmark-v5.0-performance-benchmarking-with-tpch.md>æ€§èƒ½æµ‹è¯•</a>ï¼Œå¯¹æ¯”äº†gpå’ŒTiFlashå’Œsparkçš„æ€§èƒ½ï¼ŒGPåœ¨å¤šæ•°åœºæ™¯ä¸‹å¼±äºå…¶ä»–ä¸¤ä¸ª</li>
<li>[ClickBench] (<a href=https://benchmark.clickhouse.com/>https://benchmark.clickhouse.com/</a>)</li>
<li><a href=https://zhuanlan.zhihu.com/p/54907288>å¼€æºOLAPå¼•æ“å“ªä¸ªå¿«ï¼Ÿ (Prestoã€HAWQã€ClickHouseã€GreenPlum)</a></li>
</ol>
<h2 id=æ€»ç»“>
æ€»ç»“
<a href=#%e6%80%bb%e7%bb%93 class=h-anchor aria-hidden=true>#</a>
</h2>
<p>ğŸ¥ª ä¸¤è€…ä¹‹é—´æœ€ç»ˆç›®æ ‡ä¸€è‡´ï¼Œæ‰§è¡Œå™¨æ¡†æ¶ç±»ä¼¼<code>Volcano</code>ï¼Œä½†æ˜¯GPå®ç°çš„æ›´ä¼˜é›…ï¼Œç®€æ´<br>
ğŸ¥™ AntDBclusterç®—å­å®ç°å¤æ‚ï¼Œç‰¹åˆ«æ˜¯reduceæ“ä½œï¼Œåœ¨æ‰§è¡Œçš„æ—¶å€™ç”šè‡³ä¼šå¯åŠ¨é¢å¤–çš„è¿›ç¨‹<br>
ğŸš gpä»£ç ç›´æ¥åµŒå…¥åˆ°pgå†…æ ¸ä¸­ï¼Œä»£ç ç»“æ„æ¸…æ™°ï¼Œé€»è¾‘ç®€å•æ˜“æ‡‚ï¼Œå±‚æ¬¡åˆ†æ˜ã€‚ä½†æ˜¯å¯èƒ½å¯¹pgå†…æ ¸å‡çº§æœ‰ä¸€å®šçš„é˜»ç¢<br>
ğŸ™ AntDBä»£ç ä½¿ç”¨å®æ§åˆ¶ï¼Œå’Œpgçš„ä»£ç å…·æœ‰æ›´å¼ºçš„å‰²è£‚æ„Ÿï¼Œä¹Ÿè®¸æ˜¯å€Ÿé‰´çš„pg-xcï¼Œä¸ªäººæ„Ÿè§‰ç±»ä¼¼æ’ä»¶ï¼Œä¼˜ç‚¹æ˜¯å†…æ ¸å‡çº§ç¨å¾®ç®€å•ä¸€ç‚¹ç‚¹ <br>
ğŸ¥ GPä½¿ç”¨é¢å¤–çš„ç½‘ç»œæ¨¡å—æ¥è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œlibpqåªæ˜¯ç”¨æ¥ä¼ è¾“ä¸€äº›æ§åˆ¶ä¿¡æ¯ï¼Œä¸”å•ç‹¬çš„ç½‘ç»œæ¨¡å—ï¼Œå¯¹äºé—®é¢˜çš„æ’æŸ¥å®šä½åˆ†ææ›´æœ‰åˆ©<br>
ğŸ¥® AntDBä½¿ç”¨libpqè¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œä¸”ä¼ è¾“æ¨¡å—å’Œreduceç®—å­ç´§è€¦åˆï¼Œåˆ†æéš¾åº¦å¤§ï¼Œæš‚æ—¶æ²¡æœ‰æ·±å…¥åˆ†æ<br>
ğŸ± GPä¸»æ‰“APï¼Œåœ¨å½“å‰åˆ†æçš„ç‰ˆæœ¬ä¸­ï¼Œå¯¹äºAPè€Œè¨€ï¼Œè¿˜æœ‰æå‡çš„ç©ºé—´ï¼Œä¾‹å¦‚å‘é‡åŒ–ï¼Œcodegenç­‰<br>
ğŸ› GPé»˜è®¤ä¼˜åŒ–å™¨æ˜¯åŸºäºcascadesæ¡†æ¶çš„ORCAï¼Œå·ç§°æ˜¯æœ€å…ˆç»çš„æ‰§è¡Œå™¨<br>
ğŸ  AntDBä¸­FQSå¿«ï¼Œæˆ‘è§‰å¾—ä¸èƒ½è¯´ä»–å¥½ï¼Œåªèƒ½è¯´æˆ‘ä»¬Clusteråšçš„ä¸å¤Ÿå¥½ï¼Œä¾‹å¦‚æ›´ç²¾ç»†çš„æ‰§è¡Œè°ƒåº¦</p>
<p>è¶Šæ€»ç»“è¶Šè¿·ç³Šï¼Œä½†æ˜¯AntDBå¯ä»¥åœ¨GPä¸Šå€Ÿé‰´åˆ°è®¸å¤šä¸œè¥¿ï¼ŒGPçœ‹ä¸‹æ¥æ›´å¤šå¾—åªæ˜¯PGå¾—æ‰©å±•ï¼Œæˆ‘ä»¬åˆ™æ›´ç±»ä¼¼æ’ä»¶ï¼Œåªçœ‹æ‰§è¡Œå™¨å’Œä¼˜åŒ–å™¨å¾—è¯ï¼Œæ”¹åŠ¨å¾—ç›®æ ‡å¾ˆæ˜ç¡®ï¼Œä»£ç é‡ä¼°è®¡ä¹Ÿä¸å¤šï¼Œéº»çƒ¦å¾—æ˜¯å•ç‹¬å¾—ç½‘ç»œæ¨¡å—ï¼Œè¿™ä¸ªéœ€è¦ä»é›¶å¼€å§‹ï¼Œä½†æ˜¯æˆ‘è§‰å¾—æ˜¯æœ‰å¿…å¾—ï¼Œå› ä¸ºä»å•æœºåˆ°åˆ†å¸ƒå¼æ‰§è¡Œï¼Œæœ€å¤§å¾—ç“¶é¢ˆå°±æ˜¯ç½‘ç»œä¼ è¾“ï¼Œå¦‚æœæƒ³è¦æ€§èƒ½æå‡æˆ–è€…ä¸ºäº†ä»¥åæ”¯æŒæ›´å¤šå¾—åŠŸèƒ½ï¼Œè¿™ä¸ªå·¥ä½œæ˜¯å€¼å¾—çš„ï¼Œä½†æ˜¯ä¹Ÿæ˜¯è‰°éš¾çš„ï¼Œå› ä¸ºä¸çŸ¥é“åœ¨å“ªé‡Œçœ‹è§çš„è¯ï¼Œæœ‰äººæƒ³æ¨¡ä»¿GPï¼Œä½†æ˜¯åœ¨interconnetè¿™ä¸€æ­¥å¤±è´¥äº†ã€‚è¿™æ¬¡æ²¡æœ‰å¤ªæ·±å…¥è°ƒæŸ¥è¿™ä¸ªæ¨¡å—ï¼Œè¿™é‡Œä¸å‘è¡¨è¯„è®º~~~<br>
å¦å¤–è¿˜æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯AntDB çš„ PGå†…æ ¸ç‰ˆæœ¬é«˜ï¼Œæ¯”èµ·GPæœ‰æ›´é«˜çš„èµ·ç‚¹ï¼Œæœ‰éƒ¨åˆ†GPåœ¨è§„åˆ’ä¸­å¾—å®ç°ï¼ŒPGå·²ç»å®Œå…¨æ”¯æŒæˆ–è€…éƒ¨åˆ†æ”¯æŒï¼Œå…¸å‹å¾—å°±æ˜¯APå¾—å¤§æ€å™¨JIT</p>
<p><del>ä¸ªäººè§‰å¾—ä¸€ä¸ªé¡¹ç›®å¯¹äºæ€§èƒ½å¾—è¿½æ±‚æœ‰å‡ ä¸ªé‡ç‚¹ï¼Œä¸€æ˜¯ç¡®å®šæ–¹å‘ï¼Œç¡®å®šæ¶æ„çš„æ€§èƒ½ä¸Šé™ã€‚äºŒæ˜¯å®ç°è¿™ä¸ªæ¶æ„ï¼Œç„¶åè¾¾åˆ°æ¶æ„æ€§èƒ½ä¸Šé™ã€‚æ­¤æ—¶æœ‰ä¸¤ç§é€‰æ‹©ï¼Œè¦ä¹ˆåœ¨å•ç‚¹ä¸ŠæŒ£æ‰ï¼Œä»ç»†èŠ‚æŒ¤å‡ºæ—¶é—´ï¼Œè¿ç”¨ä¸€åˆ‡å¯èƒ½çš„æŠ€æœ¯ï¼Œä¾‹å¦‚å¯¹äºAPï¼Œä»€ä¹ˆå‘é‡åŒ–ï¼Œä»€ä¹ˆJITï¼Œèƒ½ç”¨å°±ç”¨ã€‚è¦ä¹ˆé‡æ–°å®¡è§†æ¶æ„ï¼Œç¡®å®šæ¶æ„æ˜¯å¦æœ‰æ”¹è¿›çš„å¯èƒ½ï¼Œæ¶æ„ä¸Šå¸¦æ¥çš„æ”¶ç›Šè‚¯å¯èƒ½æœ‰10ï¼Œè€Œå•ç‚¹ä¼˜åŒ–ï¼Œåˆ™æ›´å¤šçš„æ˜¯é’ˆå°–ä¸Šçš„é‚£ä¹ˆä¸€ç‚¹ç‚¹è€Œå·²</del></p>
<blockquote>
<p><a href=https://zhuanlan.zhihu.com/p/54907288>å¼€æºOLAPå¼•æ“å“ªä¸ªå¿«ï¼Ÿ (Prestoã€HAWQã€ClickHouseã€GreenPlum)</a><br>
<a href=https://cn.greenplum.org/greenplum-distributed-database-kernel-1/>Greenplum åˆ†å¸ƒå¼æ•°æ®åº“å†…æ ¸æ­ç§˜(ä¸Šç¯‡)</a><br>
<a href=https://cn.greenplum.org/greenplum-distributed-database-kernel-2/>Greenplum åˆ†å¸ƒå¼æ•°æ®åº“å†…æ ¸æ­ç§˜(ä¸‹ç¯‡)</a><br>
<a href=https://blog.csdn.net/chrisy521/article/details/122355490>èŠèŠGreenplumçš„é‚£äº›äº‹</a></p>
</blockquote>
<blockquote>
<p><a href="https://baijiahao.baidu.com/s?id=1707690199529405725">è¶…èåˆæ—¶åºæ•°æ®åº“ å®šä¹‰æœªæ¥è®°å¿†â€”â€”MatrixDB4.0å‘å¸ƒä¼šå®å½•</a></p>
</blockquote>
<hr>
<h4 id=some-qs>
Some QS
<a href=#some-qs class=h-anchor aria-hidden=true>#</a>
</h4>
<ol>
<li>MPPåšTPå¯è¡Œï¼ŸMPPåšTPä¸Šé™åœ¨å“ªé‡Œï¼Œå†æˆ–è€…è¶…èåˆï¼Ÿ</li>
<li>pgä¼˜åŒ–å™¨èƒ½å¦æœ‰ä¼˜åŒ–æ ‡å‡†ï¼ŒORCAçš„ç‰¹ç‚¹ä¹‹ä¸€å°±æ˜¯ä½¿ç”¨æ¨¡æ‹Ÿçš„ç»Ÿè®¡ä¿¡æ¯å’Œä»£ä»·æ¨¡å‹é‡åŒ–æ‰§è¡Œè®¡åˆ’ï¼Œä¿è¯æ¯ä¸€ä¸ªä»£ç æ”¹åŠ¨éƒ½èƒ½æœ€ä¼˜</li>
<li>æ˜¯å¦å¯ä»¥ä»¿ç…§GPè¿›è¡Œå†…æ ¸ä¼˜åŒ–ï¼Œå½“å‰è§‰å¾—reduceæ¨¡å—å¤ªå¤æ‚ï¼Œæ€§èƒ½ä¹Ÿä¸é«˜</li>
<li>GPå’ŒAntDBåœ¨å…³äºä»£ä»·è¿™ä¸€å—éƒ½æ²¡æœ‰å¤ªç»†èŠ‚çš„å¤„ç†ï¼Œclusteræˆ–è€…motionç®—å­çš„ä»£ä»·æ˜¯å¦éœ€è¦æ›´è¯¦ç»†çš„æ¨¡å‹</li>
<li>å…¶ä»–APæ‰§è¡Œå™¨çš„æŠ€æœ¯ç»†èŠ‚</li>
<li>æ›´å¤šçš„åŸºäºpgçš„äº§å“æœ‰å“ªäº›</li>
</ol>
<h4 id=some-todo>
Some TODO
<a href=#some-todo class=h-anchor aria-hidden=true>#</a>
</h4>
<p>[] äº‹åŠ¡<br>
[] å­˜å‚¨<br>
[] ORCA<br>
[] GPæ²¡åšçš„å…¶ä»–APåšäº†çš„ï¼Œæˆ–è€…GPæ¡†æ¶ä¸‹åšä¸äº†çš„
[] å¯¹pgçš„æ›´å¤šå¯è¡Œæ€§çš„æ¢ç©¶</p>
<p><del>æ•°æ®å¤„ç†è¿‡ç¨‹ä¸Šæ‹‰åˆ°è®¡ç®—å±‚</del>
<del>å…¨å±€æ­»é”æ£€æµ‹</del>
<del>å®¹å™¨åŒ–</del>
<del>å¤šæ€å­˜å‚¨</del>
<del>å‘é‡åŒ–</del>
<del>å¤šå‘¨è¾¹</del>
<del>è¿›ç¨‹æ± </del>
<del>æ‰§è¡Œè¿›ç¨‹å¤ç”¨</del></p>
</div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=https://Esoye.github.io/posts/postgres/remotequery/>
<span class=button__icon>â†</span>
<span class=button__text>Postgres RemoteQuery æ‰©å±•</span>
</a>
</span>
<span class="button next">
<a href=https://Esoye.github.io/posts/postgres/pgenvbuild/>
<span class=button__text>Postgres ç³»åˆ—æ•°æ®åº“æ­å»º</span>
<span class=button__icon>â†’</span>
</a>
</span>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<a href=/ class=logo style=text-decoration:none>
<span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span>
<span class=logo__text>Esoye</span>
<span class=logo__cursor></span>
</a>
<div class=copyright>
<span>Â© 2022 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span>
</div>
</div>
</footer>
<script src=https://Esoye.github.io/assets/main.js></script>
<script src=https://Esoye.github.io/assets/prism.js></script>
</div>
</body>
</html>