<!doctype html><html lang=en>
<head>
<title>
Motion 移植实验 ::
Esoye — My note blog
</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="目的 #   目的是为了知道如何把postgres扩展为一个mpp架构的数据库 通过具体的实验，了解具体的实现细节，探究他的实现原理 不一定有成果，也许慢慢的知道细节之后，会发现某些他实现当前源码的必要原因 只是笔记，不是设计概要  代码框架 #  网络模块
执行层模块
 发送 接收  任务分发模块
执行计划
其他
create_seqscan_path add cdbpathlocus_from_baserel step
 实现单表 实现执行模块 (2 %) 实现任务分发模块 (2 %) 优化器添加对应数据结构 (95 %) 实现优化器模块 1. 取消cluster和remote_query的path，生成原生path，或者在pathlist中添加原生的path 2. 在原生path中添加locus 3. 使用此path生成新的执行计划，之前的cluster的暂时不动 代码清洗 case select * from t1 实现join 实现聚合 实现网络模块 测试分析 优化  cheapest_total_path
(Path *) (list_head(final_rel-&amp;gt;pathlist))-&amp;gt;ptr_value
 尝试保留cluster的处理逻辑，同时添加motion，之后慢慢替换，实现性质的代码实现，上面的第一点 motion加在pathlist中不是一步替换remotequery，而是在后续的代价计算中淘汰remote 简单的例子的时候，语句生成root gather是在逻辑处理的最后了，和motion相近，也许可以尝试修改cluster，但是这样的话，就需要对cluster做侵入性的修改，在修改之后就没有回头的可能了  set_plain_rel_pathlist中
使用cluster相关的信息生成新的path，然后添加到cluster_pathlist中，然后接下来还会使用create_plainrel_rqpath尝试生成 remote_query，生成则添加到pathlist中 总结： 这里一定会生成一个cluster相关的cluster_pathlist和remote_query相关的pathlist，原生的pg逻辑几乎被屏蔽">
<meta name=keywords content="数据库">
<meta name=robots content="noodp">
<link rel=canonical href=https://Esoye.github.io/posts/postgres/motion/>
<link rel=stylesheet href=https://Esoye.github.io/assets/style.css>
<link rel=stylesheet href=https://Esoye.github.io/style.css>
<link rel=apple-touch-icon-precomposed sizes=144x144 href=https://Esoye.github.io/img/apple-touch-icon-144-precomposed.png>
<link rel="shortcut icon" href=https://Esoye.github.io/img/favicon.png>
<link href=https://Esoye.github.io/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://Esoye.github.io/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://Esoye.github.io/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://Esoye.github.io/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://Esoye.github.io/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://Esoye.github.io/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Motion 移植实验">
<meta name=twitter:description content="AntDB的cluster和GP的motion原理上类似，但是实现上略有区别，这里尝试移植motion到AntDB上">
<meta property="og:title" content="Motion 移植实验">
<meta property="og:description" content="AntDB的cluster和GP的motion原理上类似，但是实现上略有区别，这里尝试移植motion到AntDB上">
<meta property="og:type" content="article">
<meta property="og:url" content="https://Esoye.github.io/posts/postgres/motion/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-08-17T09:38:28+08:00">
<meta property="article:modified_time" content="2022-08-17T09:38:28+08:00"><meta property="og:site_name" content="Esoye">
</head>
<body class=light-theme>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/ class=logo style=text-decoration:none>
<span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span>
<span class=logo__text>Esoye</span>
<span class=logo__cursor></span>
</a>
<span class=header__right>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/archive>Archive</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/archive>Archive</a></li>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
<span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg>
</span>
</span>
</span>
</header>
<div class=content>
<div class=post>
<h1 class=post-title>Motion 移植实验</h1>
<div class=post-meta>
<span class=post-date>
2022-08-17
</span>
</div>
<div class=post-content>
<h2 id=目的>
目的
<a href=#%e7%9b%ae%e7%9a%84 class=h-anchor aria-hidden=true>#</a>
</h2>
<ol>
<li>目的是为了知道如何把postgres扩展为一个mpp架构的数据库</li>
<li>通过具体的实验，了解具体的实现细节，探究他的实现原理</li>
<li>不一定有成果，也许慢慢的知道细节之后，会发现某些他实现当前源码的必要原因</li>
<li>只是笔记，不是设计概要</li>
</ol>
<h2 id=代码框架>
代码框架
<a href=#%e4%bb%a3%e7%a0%81%e6%a1%86%e6%9e%b6 class=h-anchor aria-hidden=true>#</a>
</h2>
<p>网络模块</p>
<p>执行层模块</p>
<ol>
<li>发送</li>
<li>接收</li>
</ol>
<p>任务分发模块</p>
<p>执行计划</p>
<p>其他</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++>create_seqscan_path add  cdbpathlocus_from_baserel



</code></pre></div><p>step</p>
<ol>
<li>实现单表</li>
<li>实现执行模块 (2 %)</li>
<li>实现任务分发模块 (2 %)</li>
<li>优化器添加对应数据结构 (95 %)</li>
<li>实现优化器模块
1. 取消cluster和<code>remote_query</code>的path，生成原生path，或者在pathlist中添加原生的path
2. 在原生path中添加<code>locus</code>
3. 使用此path生成新的执行计划，之前的cluster的暂时不动</li>
<li>代码清洗</li>
<li>case <code>select * from t1</code></li>
<li>实现join</li>
<li>实现聚合</li>
<li>实现网络模块</li>
<li>测试分析</li>
<li>优化</li>
</ol>
<p><code>cheapest_total_path</code></p>
<p>(Path *) (list_head(final_rel->pathlist))->ptr_value</p>
<ul>
<li>尝试保留cluster的处理逻辑，同时添加motion，之后慢慢替换，实现性质的代码实现，上面的第一点</li>
<li>motion加在pathlist中不是一步替换remotequery，而是在后续的代价计算中淘汰remote</li>
<li>简单的例子的时候，语句生成root gather是在逻辑处理的最后了，和motion相近，也许可以尝试修改cluster，但是这样的话，就需要对cluster做侵入性的修改，在修改之后就没有回头的可能了</li>
</ul>
<p>set_plain_rel_pathlist中</p>
<p>使用cluster相关的信息生成新的path，然后添加到cluster_pathlist中，然后接下来还会使用<code>create_plainrel_rqpath</code>尝试生成 remote_query，生成则添加到pathlist中
总结：
这里一定会生成一个cluster相关的<code>cluster_pathlist</code>和remote_query相关的<code>pathlist</code>，原生的pg逻辑几乎被屏蔽</p>
<ol>
<li>这是一种错误的处理逻辑，对于单表的scan，没有上下文的情况下很难确定是否需要remote执行，即使能判断。也需要额外的不必要的处理逻辑，且不利于精细化的操作
修改<br>
create_plainrel_rqpath 先return false,这里尝试添加常规scan到path list中</li>
</ol>
<p>add_path 是会使用代价进行比较，在query_planner之后会在pathlist中保留remote query，在cluster_pathlist中保留cluster的执行计划，然后在<code>grouping_planner</code>后期会要求输出最终的rel，此时使用add_path把这两个path加到final_rel中去，此时没有特殊配置的话，两者的代价就是在这里体现出来的，这里大多数时候，cluster优于remote
add_path多次调用，一个基于代价的淘汰机制，
修改
保持逻辑不变，按照上面的思路修改到这里，可以正常的进行代价比较，</p>
<p>create_plan 需要 flow信息，用来表示数据流动信息</p>
<ol>
<li>Plan 结构体添加flow</li>
<li>create_plan中，对每一个算子添加cdbpathtoplan_create_flow，用来生成flow信息，暂时只加在create_scan_plan中</li>
<li>按照这两点添加数据结构</li>
</ol>
<p>GetRelationLocInfo 获得数据分布信息，使用在create_plainrel_rqpath中</p>
<p>GP motion 执行计划及执行器分析</p>
<ol>
<li>执行计划</li>
</ol>
<p>execMotionReceiver
CdbDispatchPlan
cdbpath_create_motion_path
cdb_grouping_planner
cdbpathtoplan_create_flow</p>
<p>select * from t1;</p>
<p>ExecInitBatchSort <br>
BatchSort添加并行支持,并增加GroupAggregate对其的使用,以提升必须先先排序再聚集的性能,尤其是包含"agg(distinct xxx)&ldquo;这样表达式的聚集
ExecInitRemoteQuery<br>
remote query 执行
ExecInitClusterGather
cluster gather
ExecInitClusterMergeGather
ExecInitClusterReduce
ExecInitReduceScan
ExecInitEmptyResult
ExecInitParamTuplestoreScan</p>
<p>create table ta (a int, b int, c int);
insert into ta select g, g , g from generate_series(1, 100000) g;
execute direct on (dn1) &lsquo;select count(*) from ta&rsquo;;</p>
<p>set enable_fast_query_shipping=false;
explain select * from ta;</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++>ExecInitClusterGather
  <span style=color:#960050;background-color:#1e0010>主要是构造</span>ClusterGatherState<span style=color:#960050;background-color:#1e0010>，设置执行方法为</span>ExecClusterGather
  ExecStartClusterPlan() { <span style=color:#75715e>//分发执行计划 {}
</span><span style=color:#75715e></span>    <span style=color:#75715e>// gather 的执行计划只有一个 child，这个child需要在不同的节点运行 ，使用此方法单独初始化，其他单机上的node是递归使用ExecInitNode
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (EXEC_FLAG_EXPLAIN_ONLY)
      <span style=color:#66d9ef>return</span> ExecInitNode(plan, estate, eflags);
    
    <span style=color:#75715e>// 执行计划需要传输到其他节点，需要进行序列化，当前序列化操作使用的是查表的方法，可以不关注先后顺序，使用flag遍历查找，主要方法在mem_toc.h中
</span><span style=color:#75715e></span>    <span style=color:#75715e>// 针对不同的类型的数据的序列化和反序列化也是后来实现的
</span><span style=color:#75715e></span>    StartRemotePlan() {
      <span style=color:#75715e>// 发送执行计划到远程节点
</span><span style=color:#75715e></span>      PQsendPlan() 
    }
    <span style=color:#75715e>// StartRemotePlan 发送执行计划到remote，这里为什么还需要在本节点上执行ExecInitNode
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ExecInitNode</span>(plan, estate, eflags);
  } 


ExecClusterGather() {
  <span style=color:#75715e>// 获得下层节点的数据，这里分为两个不同的部分，先尝试从remote获得的数据，再尝试local的执行计划
</span><span style=color:#75715e></span>  <span style=color:#75715e>//   在初始话的时候，即使发送了remote 执行计划，但是最后还是执行了ExecInitNode(plan, estate, eflags)，且返回的是ExecInitNode(plan, estate, eflags)初始化的state，所以这里才先从remote拿数据，然后再从local 拿数据？？？ 为社么这么做
</span><span style=color:#75715e></span>
  PQNListExecFinish() {

  }
}


ExecFinishClusterGather() {

}

</code></pre></div><p>exec_cluster_plan</p>
<p>set w for ready</p>
<p>dest 实现slot 的发送接收</p>
<h3 id=gather>
gather
<a href=#gather class=h-anchor aria-hidden=true>#</a>
</h3>
<p>ExecInitClusterGather 的时候使用 ExecStartClusterPlan 发送执行计划，此方法发送执行计划之后，会使用PQgetResult尝试获得一次消息，exec_cluster_plan在DN上接收到消息之后，会发送一个w消息给dn，报告自己已经ready，等待所有的节点都回复之后，执行计划开始正常工作
发送与接受消息的时候master使用ExecClusterGather算子接受数据，此时有两个路径，一是使用PQNListExecFinish从远端接受数据，二是使用ExecProcNode处理本节点的下层节点，(这里不清楚gather是否会有类似的情况，当前只看见gather在master上，可能这里对应的之子查询)。远端在使用ExecutorRun执行gather的下层节点，此时他设置DestReceiver为 ClusterPlanReceiver，这里内部的几个函数具备发送数据到远端的功能，具体来说，使用的是 libpq的原生的网络IO接口，例如cluster_receive_slot 发送数据到master，内部使用 pq_putmessage，且这里一次只是处理一条数据
发送的时候，数据存放在缓冲区中，缓冲区默认大小8192</p>
<p>case</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>explain</span> (<span style=color:#66d9ef>verbose</span>, <span style=color:#66d9ef>analyze</span>) <span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> ta;

b
ExecClusterGather
ExecStartClusterPlan
exec_cluster_plan
</code></pre></div><p>explain 执行计划统计信息不准</p>
<h2 id=query-plan>
benchmarksql=# explain (verbose, analyze) select * from public.bmsql_new_order;
QUERY PLAN
<a href=#query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<p>Cluster Gather (cost=0.00..14194.00 rows=45000 width=12) (actual time=0.021..51.391 rows=44998 loops=1)
Remote node: 16386,16387
-> Seq Scan on public.bmsql_new_order (cost=0.00..694.00 rows=22500 width=12) (actual time=0.005..0.005 rows=0 loops=1)
Output: no_w_id, no_d_id, no_o_id
Remote node: 16386,16387
Node 16387: (actual time=0.010..1.793 rows=18000 loops=1)
Node 16386: (actual time=0.015..2.758 rows=26998 loops=1)
Planning Time: 0.074 ms
Execution Time: 53.501 ms
(9 rows)</p>
<h2 id=query-plan-1>
benchmarksql=# explain (verbose, analyze) select * from public.bmsql_new_order;
QUERY PLAN
<a href=#query-plan-1 class=h-anchor aria-hidden=true>#</a>
</h2>
<p>Seq Scan on public.bmsql_new_order (cost=0.00..416.00 rows=27000 width=12) (actual time=0.011..1.792 rows=26998 loops=1)
Output: no_w_id, no_d_id, no_o_id
Planning Time: 0.067 ms
Execution Time: 2.550 ms
(4 rows)</p>
<h2 id=query-plan-2>
benchmarksql=# explain (verbose, analyze) select * from ta;
QUERY PLAN
<a href=#query-plan-2 class=h-anchor aria-hidden=true>#</a>
</h2>
<p>Cluster Gather (cost=0.00..315437.00 rows=1000100 width=12) (actual time=0.025..943.512 rows=1000100 loops=1)
Remote node: 16386,16387
-> Seq Scan on public.ta (cost=0.00..15407.00 rows=500050 width=12) (actual time=0.005..0.005 rows=0 loops=1)
Output: a, b, c
Remote node: 16386,16387
Node 16386: (actual time=0.016..53.885 rows=500606 loops=1)
Node 16387: (actual time=0.012..53.136 rows=499494 loops=1)
Planning Time: 0.057 ms
Execution Time: 982.414 ms
(9 rows)</p>
<h2 id=query-plan-3>
benchmarksql=# explain (verbose, analyze) select * from ta;
QUERY PLAN
<a href=#query-plan-3 class=h-anchor aria-hidden=true>#</a>
</h2>
<p>Seq Scan on public.ta (cost=0.00..7712.06 rows=500606 width=12) (actual time=0.012..39.050 rows=500606 loops=1)
Output: a, b, c
Planning Time: 0.042 ms
Execution Time: 54.049 ms
(4 rows)</p>
<p>性能损失在50倍左右</p>
<h3 id=a-case>
a case
<a href=#a-case class=h-anchor aria-hidden=true>#</a>
</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>
                                                    QUERY PLAN                                                     
<span style=color:#75715e>-------------------------------------------------------------------------------------------------------------------
</span><span style=color:#75715e></span> <span style=color:#66d9ef>Cluster</span> Gather  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>315437</span>.<span style=color:#ae81ff>00</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1000100</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>) (actual time<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>018</span>..<span style=color:#ae81ff>853</span>.<span style=color:#ae81ff>209</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1000100</span> loops<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
   Remote node: <span style=color:#ae81ff>16386</span>,<span style=color:#ae81ff>16387</span>
   <span style=color:#f92672>-&gt;</span>  Seq Scan <span style=color:#66d9ef>on</span> <span style=color:#66d9ef>public</span>.ta  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>..<span style=color:#ae81ff>15407</span>.<span style=color:#ae81ff>00</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>500050</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>) (actual time<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>004</span>..<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>004</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> loops<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
         <span style=color:#66d9ef>Output</span>: a, b, <span style=color:#66d9ef>c</span>
         Remote node: <span style=color:#ae81ff>16386</span>,<span style=color:#ae81ff>16387</span>
         Node <span style=color:#ae81ff>16387</span>: (actual time<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>009</span>..<span style=color:#ae81ff>38</span>.<span style=color:#ae81ff>675</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>499494</span> loops<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
         Node <span style=color:#ae81ff>16386</span>: (actual time<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>013</span>..<span style=color:#ae81ff>41</span>.<span style=color:#ae81ff>437</span> <span style=color:#66d9ef>rows</span><span style=color:#f92672>=</span><span style=color:#ae81ff>500606</span> loops<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
 Planning Time: <span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>055</span> ms
 Execution Time: <span style=color:#ae81ff>925</span>.<span style=color:#ae81ff>119</span> ms
(<span style=color:#ae81ff>9</span> <span style=color:#66d9ef>rows</span>)

<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>23</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>49</span>:<span style=color:#ae81ff>08</span>.<span style=color:#ae81ff>607</span> UTC,<span style=color:#e6db74>&#34;vscode&#34;</span>,<span style=color:#e6db74>&#34;benchmarksql&#34;</span>,<span style=color:#ae81ff>15890</span>,<span style=color:#e6db74>&#34;[local]&#34;</span>,<span style=color:#ae81ff>630359</span>d6.<span style=color:#ae81ff>3</span>e12,<span style=color:#ae81ff>41</span>,<span style=color:#e6db74>&#34;EXPLAIN&#34;</span>,<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>22</span> <span style=color:#ae81ff>10</span>:<span style=color:#ae81ff>26</span>:<span style=color:#ae81ff>30</span> UTC,<span style=color:#ae81ff>5</span><span style=color:#f92672>/</span><span style=color:#ae81ff>13</span>,<span style=color:#ae81ff>0</span>,LOG,<span style=color:#ae81ff>08</span>P01,<span style=color:#e6db74>&#34;traceClustering==== StartRemotePlan start PQsendPlan for dn1&#34;</span>,,,,,,<span style=color:#e6db74>&#34;explain (verbose, analyze) select * from ta;&#34;</span>,,,<span style=color:#e6db74>&#34;psql&#34;</span>,<span style=color:#e6db74>&#34;client backend&#34;</span>
<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>23</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>49</span>:<span style=color:#ae81ff>08</span>.<span style=color:#ae81ff>607</span> UTC,<span style=color:#e6db74>&#34;vscode&#34;</span>,<span style=color:#e6db74>&#34;benchmarksql&#34;</span>,<span style=color:#ae81ff>15890</span>,<span style=color:#e6db74>&#34;[local]&#34;</span>,<span style=color:#ae81ff>630359</span>d6.<span style=color:#ae81ff>3</span>e12,<span style=color:#ae81ff>42</span>,<span style=color:#e6db74>&#34;EXPLAIN&#34;</span>,<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>22</span> <span style=color:#ae81ff>10</span>:<span style=color:#ae81ff>26</span>:<span style=color:#ae81ff>30</span> UTC,<span style=color:#ae81ff>5</span><span style=color:#f92672>/</span><span style=color:#ae81ff>13</span>,<span style=color:#ae81ff>0</span>,LOG,<span style=color:#ae81ff>08</span>P01,<span style=color:#e6db74>&#34;traceClustering==== StartRemotePlan start PQsendPlan for dn2&#34;</span>,,,,,,<span style=color:#e6db74>&#34;explain (verbose, analyze) select * from ta;&#34;</span>,,,<span style=color:#e6db74>&#34;psql&#34;</span>,<span style=color:#e6db74>&#34;client backend&#34;</span>
<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>23</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>49</span>:<span style=color:#ae81ff>08</span>.<span style=color:#ae81ff>607</span> UTC,<span style=color:#e6db74>&#34;vscode&#34;</span>,<span style=color:#e6db74>&#34;benchmarksql&#34;</span>,<span style=color:#ae81ff>15890</span>,<span style=color:#e6db74>&#34;[local]&#34;</span>,<span style=color:#ae81ff>630359</span>d6.<span style=color:#ae81ff>3</span>e12,<span style=color:#ae81ff>43</span>,<span style=color:#e6db74>&#34;EXPLAIN&#34;</span>,<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>22</span> <span style=color:#ae81ff>10</span>:<span style=color:#ae81ff>26</span>:<span style=color:#ae81ff>30</span> UTC,<span style=color:#ae81ff>5</span><span style=color:#f92672>/</span><span style=color:#ae81ff>13</span>,<span style=color:#ae81ff>0</span>,LOG,<span style=color:#ae81ff>08</span>P01,<span style=color:#e6db74>&#34;traceClustering==== StartRemotePlan check remote node dn1 done&#34;</span>,,,,,,<span style=color:#e6db74>&#34;explain (verbose, analyze) select * from ta;&#34;</span>,,,<span style=color:#e6db74>&#34;psql&#34;</span>,<span style=color:#e6db74>&#34;client backend&#34;</span>
<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>23</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>49</span>:<span style=color:#ae81ff>08</span>.<span style=color:#ae81ff>607</span> UTC,<span style=color:#e6db74>&#34;vscode&#34;</span>,<span style=color:#e6db74>&#34;benchmarksql&#34;</span>,<span style=color:#ae81ff>15890</span>,<span style=color:#e6db74>&#34;[local]&#34;</span>,<span style=color:#ae81ff>630359</span>d6.<span style=color:#ae81ff>3</span>e12,<span style=color:#ae81ff>44</span>,<span style=color:#e6db74>&#34;EXPLAIN&#34;</span>,<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>22</span> <span style=color:#ae81ff>10</span>:<span style=color:#ae81ff>26</span>:<span style=color:#ae81ff>30</span> UTC,<span style=color:#ae81ff>5</span><span style=color:#f92672>/</span><span style=color:#ae81ff>13</span>,<span style=color:#ae81ff>0</span>,LOG,<span style=color:#ae81ff>08</span>P01,<span style=color:#e6db74>&#34;traceClustering==== StartRemotePlan check remote node dn2 done&#34;</span>,,,,,,<span style=color:#e6db74>&#34;explain (verbose, analyze) select * from ta;&#34;</span>,,,<span style=color:#e6db74>&#34;psql&#34;</span>,<span style=color:#e6db74>&#34;client backend&#34;</span>
<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>23</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>49</span>:<span style=color:#ae81ff>09</span>.<span style=color:#ae81ff>532</span> UTC,<span style=color:#e6db74>&#34;vscode&#34;</span>,<span style=color:#e6db74>&#34;benchmarksql&#34;</span>,<span style=color:#ae81ff>15890</span>,<span style=color:#e6db74>&#34;[local]&#34;</span>,<span style=color:#ae81ff>630359</span>d6.<span style=color:#ae81ff>3</span>e12,<span style=color:#ae81ff>45</span>,<span style=color:#e6db74>&#34;EXPLAIN&#34;</span>,<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>22</span> <span style=color:#ae81ff>10</span>:<span style=color:#ae81ff>26</span>:<span style=color:#ae81ff>30</span> UTC,<span style=color:#ae81ff>5</span><span style=color:#f92672>/</span><span style=color:#ae81ff>13</span>,<span style=color:#ae81ff>0</span>,LOG,<span style=color:#ae81ff>08</span>P01,<span style=color:#e6db74>&#34;traceClustering==== ExecClusterGather get all tuple cost 924829&#34;</span>,,,,,,<span style=color:#e6db74>&#34;explain (verbose, analyze) select * from ta;&#34;</span>,,,<span style=color:#e6db74>&#34;psql&#34;</span>,<span style=color:#e6db74>&#34;client backend&#34;</span>
<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>23</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>49</span>:<span style=color:#ae81ff>09</span>.<span style=color:#ae81ff>532</span> UTC,<span style=color:#e6db74>&#34;vscode&#34;</span>,<span style=color:#e6db74>&#34;benchmarksql&#34;</span>,<span style=color:#ae81ff>15890</span>,<span style=color:#e6db74>&#34;[local]&#34;</span>,<span style=color:#ae81ff>630359</span>d6.<span style=color:#ae81ff>3</span>e12,<span style=color:#ae81ff>46</span>,<span style=color:#e6db74>&#34;EXPLAIN&#34;</span>,<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>22</span> <span style=color:#ae81ff>10</span>:<span style=color:#ae81ff>26</span>:<span style=color:#ae81ff>30</span> UTC,<span style=color:#ae81ff>5</span><span style=color:#f92672>/</span><span style=color:#ae81ff>13</span>,<span style=color:#ae81ff>0</span>,LOG,<span style=color:#ae81ff>08</span>P01,<span style=color:#e6db74>&#34;traceClustering++++ ExecClusterPlanStmt send all tuple cost 20016 &#34;</span>,,,,,,<span style=color:#e6db74>&#34;explain (verbose, analyze) select * from ta;&#34;</span>,,,<span style=color:#e6db74>&#34;psql&#34;</span>,<span style=color:#e6db74>&#34;client backend&#34;</span>


<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>23</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>49</span>:<span style=color:#ae81ff>09</span>.<span style=color:#ae81ff>532</span> UTC,<span style=color:#e6db74>&#34;vscode&#34;</span>,<span style=color:#e6db74>&#34;benchmarksql&#34;</span>,<span style=color:#ae81ff>15899</span>,<span style=color:#e6db74>&#34;172.17.0.2:57748&#34;</span>,<span style=color:#ae81ff>630359</span>d8.<span style=color:#ae81ff>3</span>e1b,<span style=color:#ae81ff>15</span>,<span style=color:#e6db74>&#34;&lt;cluster query&gt; for PID 15890 from cn1&#34;</span>,<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>22</span> <span style=color:#ae81ff>10</span>:<span style=color:#ae81ff>26</span>:<span style=color:#ae81ff>32</span> UTC,<span style=color:#ae81ff>3</span><span style=color:#f92672>/</span><span style=color:#ae81ff>18</span>,<span style=color:#ae81ff>0</span>,LOG,<span style=color:#ae81ff>08</span>P01,<span style=color:#e6db74>&#34;traceClustering++++ ExecClusterPlanStmt send all tuple cost 858118 &#34;</span>,,,,,,,,,<span style=color:#e6db74>&#34;pgxc&#34;</span>,<span style=color:#e6db74>&#34;client backend&#34;</span>
<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>23</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>49</span>:<span style=color:#ae81ff>09</span>.<span style=color:#ae81ff>532</span> UTC,<span style=color:#e6db74>&#34;vscode&#34;</span>,<span style=color:#e6db74>&#34;benchmarksql&#34;</span>,<span style=color:#ae81ff>15899</span>,<span style=color:#e6db74>&#34;172.17.0.2:57748&#34;</span>,<span style=color:#ae81ff>630359</span>d8.<span style=color:#ae81ff>3</span>e1b,<span style=color:#ae81ff>16</span>,<span style=color:#e6db74>&#34;&lt;cluster query&gt; for PID 15890 from cn1&#34;</span>,<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>22</span> <span style=color:#ae81ff>10</span>:<span style=color:#ae81ff>26</span>:<span style=color:#ae81ff>32</span> UTC,<span style=color:#ae81ff>3</span><span style=color:#f92672>/</span><span style=color:#ae81ff>18</span>,<span style=color:#ae81ff>0</span>,LOG,<span style=color:#ae81ff>08</span>P01,<span style=color:#e6db74>&#34;traceClustering==== ExecClusterPlanStmt send all tuple cost 924812 from node cn1&#34;</span>,,,,,,,,,<span style=color:#e6db74>&#34;pgxc&#34;</span>,<span style=color:#e6db74>&#34;client backend&#34;</span>

<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>23</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>49</span>:<span style=color:#ae81ff>09</span>.<span style=color:#ae81ff>490</span> UTC,<span style=color:#e6db74>&#34;vscode&#34;</span>,<span style=color:#e6db74>&#34;benchmarksql&#34;</span>,<span style=color:#ae81ff>15900</span>,<span style=color:#e6db74>&#34;172.17.0.2:40498&#34;</span>,<span style=color:#ae81ff>630359</span>d8.<span style=color:#ae81ff>3</span>e1c,<span style=color:#ae81ff>15</span>,<span style=color:#e6db74>&#34;&lt;cluster query&gt; for PID 15890 from cn1&#34;</span>,<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>22</span> <span style=color:#ae81ff>10</span>:<span style=color:#ae81ff>26</span>:<span style=color:#ae81ff>32</span> UTC,<span style=color:#ae81ff>3</span><span style=color:#f92672>/</span><span style=color:#ae81ff>18</span>,<span style=color:#ae81ff>0</span>,LOG,<span style=color:#ae81ff>08</span>P01,<span style=color:#e6db74>&#34;traceClustering++++ ExecClusterPlanStmt send all tuple cost 820119 &#34;</span>,,,,,,,,,<span style=color:#e6db74>&#34;pgxc&#34;</span>,<span style=color:#e6db74>&#34;client backend&#34;</span>
<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>23</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>49</span>:<span style=color:#ae81ff>09</span>.<span style=color:#ae81ff>490</span> UTC,<span style=color:#e6db74>&#34;vscode&#34;</span>,<span style=color:#e6db74>&#34;benchmarksql&#34;</span>,<span style=color:#ae81ff>15900</span>,<span style=color:#e6db74>&#34;172.17.0.2:40498&#34;</span>,<span style=color:#ae81ff>630359</span>d8.<span style=color:#ae81ff>3</span>e1c,<span style=color:#ae81ff>16</span>,<span style=color:#e6db74>&#34;&lt;cluster query&gt; for PID 15890 from cn1&#34;</span>,<span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>22</span> <span style=color:#ae81ff>10</span>:<span style=color:#ae81ff>26</span>:<span style=color:#ae81ff>32</span> UTC,<span style=color:#ae81ff>3</span><span style=color:#f92672>/</span><span style=color:#ae81ff>18</span>,<span style=color:#ae81ff>0</span>,LOG,<span style=color:#ae81ff>08</span>P01,<span style=color:#e6db74>&#34;traceClustering==== ExecClusterPlanStmt send all tuple cost 883075 from node cn1&#34;</span>,,,,,,,,,<span style=color:#e6db74>&#34;pgxc&#34;</span>,<span style=color:#e6db74>&#34;client backend&#34;</span>
</code></pre></div><p>master上总耗时925，在数据收集和发送的地方写日志，其中 ExecClusterGather 收取所有数据花费924829， dn 发送数据一个是924812，一个是883075，只看发送的部分的时间统计为858118和820119，dn上语句的执行时间为66694和62956，所以数据传输占大头，看下来他数据是一行一行的发送的，
可以优化为批量</p>
<ul>
<li>
<p>remote query 虽然是吧语句发送到远端执行，但是原理和clusrter gather 一样的，也是使用一样的dest，日志统计发送端逻辑几乎一样，但是时间不一样，那就是说接收端消费能力不一样</p>
</li>
<li>
<p>cluster gather 偶尔有一次性能比remote query 还高，能达到380ms</p>
</li>
<li>
<p>进行统计，gather 的接受部分还是慢，可能日志打的不够深</p>
</li>
<li>
<p>简单的语句，从一个dn上拿两条数据，时间差距在2倍左右。25ms 和 50 ms</p>
</li>
<li>
<p>context ????</p>
</li>
</ul>
<p><a href=mailto:root@10.21.13.207>root@10.21.13.207</a> AntDB119; <a href=mailto:root@10.21.13.208>root@10.21.13.208</a> AntDB119</p>
<p>子连接支持改造 文磊 4 2022/9/1 2022/9/6
doing 可以上拉的子链接？？
只在单数据节点执行的聚合函数的改造支持 文磊 4 2022/9/7 2022/9/12</p>
<p>对触发器、规则、with、多节点的聚合等不支持的规则进行排除 文磊 2 2022/9/13 2022/9/14
带连接条件的表连接的改造支持 文磊 4 2022/9/15 2022/9/20
done
RemoteQuery执行计划支持有名的Prepare 文磊 4 2022/9/21 2022/9/26</p>
<p>9.有子链接的，执行条件不可以限定语句在一个节点上执行的，不支持FQS</p>
<p>e.上述几种情况在有执行条件约束到一个节点的情况下，可以支持FQS</p>
<p>select * from t1 where t1.c1 = 10 and c2 > 10;</p>
<pre><code>新订单				
序号	事务类型	操作类型	原始sql	填上数值的sql
1	新订单	查询地区	
</code></pre>
<p>SELECT d_tax, d_next_o_id FROM bmsql_district WHERE d_w_id = ? AND d_id = ? FOR UPDATE;
SELECT d_tax, d_next_o_id FROM bmsql_district WHERE d_w_id = 2 AND d_id = 2 FOR UPDATE;
2 新订单 查询客户仓库
SELECT c_discount, c_last, c_credit, w_tax FROM bmsql_customer JOIN bmsql_warehouse ON (w_id = c_w_id) WHERE c_w_id = ? AND c_d_id = ? AND c_id = ?;
SELECT c_discount, c_last, c_credit, w_tax FROM bmsql_customer JOIN bmsql_warehouse ON (w_id = c_w_id) WHERE c_w_id = 2 AND c_d_id = 2 AND c_id =1;
3 新订单 更新地区的下一个订单编号
UPDATE bmsql_district SET d_next_o_id = d_next_o_id + 1 WHERE d_w_id = ? AND d_id = ?;
UPDATE bmsql_district SET d_next_o_id = d_next_o_id + 1 WHERE d_w_id = 2 AND d_id = 2;
4 新订单 插入订单表
INSERT INTO bmsql_oorder (o_id, o_d_id, o_w_id, o_c_id, o_entry_d, o_ol_cnt, o_all_local) VALUES (?, ?, ?, ?, ?, ?, ?);
INSERT INTO bmsql_oorder (o_id, o_d_id, o_w_id, o_c_id, o_entry_d, o_ol_cnt, o_all_local) VALUES (3001, 2, 2, 1, &lsquo;2022-04-24 14:16:10.828&rsquo;, 5, 1);
5 新订单 插入新订单表
INSERT INTO bmsql_new_order (no_o_id, no_d_id, no_w_id) VALUES (?, ?, ?);
INSERT INTO bmsql_new_order (no_o_id, no_d_id, no_w_id) VALUES (3001, 2, 2);
6 新订单 查询商品信息
SELECT i_price, i_name, i_data FROM bmsql_item WHERE i_id = ?;
SELECT i_price, i_name, i_data FROM bmsql_item WHERE i_id = 1;
7 新订单 选择库存来更新
SELECT s_quantity, s_data, s_dist_01, s_dist_02, s_dist_03, s_dist_04, s_dist_05, s_dist_06, s_dist_07, s_dist_08, s_dist_09, s_dist_10 FROM bmsql_stock WHERE s_w_id = ? AND s_i_id = ? FOR UPDATE;
SELECT s_quantity, s_data, s_dist_01, s_dist_02, s_dist_03, s_dist_04, s_dist_05, s_dist_06, s_dist_07, s_dist_08, s_dist_09, s_dist_10 FROM bmsql_stock WHERE s_w_id = 2 AND s_i_id = 1 FOR UPDATE;
8 新订单 插入订单商品明细表
INSERT INTO bmsql_order_line (ol_o_id, ol_d_id, ol_w_id, ol_number, ol_i_id, ol_supply_w_id, ol_quantity, ol_amount, ol_dist_info) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?);
INSERT INTO bmsql_order_line (ol_o_id, ol_d_id, ol_w_id, ol_number, ol_i_id, ol_supply_w_id, ol_quantity, ol_amount, ol_dist_info) VALUES (3001, 2, 2, 1, 1, 2, 1, 22.46, &rsquo;s_dist_02');
9 新订单 更新库存
UPDATE bmsql_stock SET s_quantity = ?, s_ytd = s_ytd + ?, s_order_cnt = s_order_cnt + 1, s_remote_cnt = s_remote_cnt + ? WHERE s_w_id = ? AND s_i_id = ?;
UPDATE bmsql_stock SET s_quantity = 92, s_ytd = s_ytd + 1, s_order_cnt = s_order_cnt + 1, s_remote_cnt = s_remote_cnt + 0 WHERE s_w_id = 2 AND s_i_id = 1;
10 新订单 提交 commit</p>
<pre><code>查询库存水平				
序号	事务类型	操作类型	原始sql	填上数值的sql
1	查询库存水平	查询库存水平	&quot;
</code></pre>
<p>SELECT count(*) AS low_stock FROM (
SELECT s_w_id, s_i_id, s_quantity
FROM bmsql_stock
WHERE s_w_id = ? AND s_quantity &lt; ? AND s_i_id IN (
SELECT ol_i_id
FROM bmsql_district
JOIN bmsql_order_line ON ol_w_id = d_w_id
AND ol_d_id = d_id
AND ol_o_id >= d_next_o_id - 20
AND ol_o_id &lt; d_next_o_id
WHERE d_w_id = ? AND d_id = ?
)
) AS L;</p>
<p>SELECT count(*) AS low_stock FROM (
SELECT s_w_id, s_i_id, s_quantity
FROM bmsql_stock
WHERE s_w_id = 2 AND s_quantity &lt; 15 AND s_i_id IN (
SELECT ol_i_id
FROM bmsql_district
JOIN bmsql_order_line ON ol_w_id = d_w_id
AND ol_d_id = d_id
AND ol_o_id >= d_next_o_id - 20
AND ol_o_id &lt; d_next_o_id
WHERE d_w_id = 2 AND d_id = 2
)
) AS L;
2 查询库存水平 回滚 rollback</p>
<pre><code>支付订单				
序号	事务类型	操作类型	原始sql	填上数值的sql
1	支付订单	更新地区金额	UPDATE bmsql_district SET d_ytd = d_ytd + ? WHERE d_w_id = ? AND d_id = ?;	UPDATE bmsql_district SET d_ytd = d_ytd + 50 WHERE d_w_id = 2 AND d_id = 2;
2	支付订单	查询地区	SELECT d_name, d_street_1, d_street_2, d_city, d_state, d_zip FROM bmsql_district WHERE d_w_id = ? AND d_id = ?;	SELECT d_name, d_street_1, d_street_2, d_city, d_state, d_zip FROM bmsql_district WHERE d_w_id = 2 AND d_id = 2;
3	支付订单	更新仓库金额	UPDATE bmsql_warehouse SET w_ytd = w_ytd + ? WHERE w_id = ?;	UPDATE bmsql_warehouse SET w_ytd = w_ytd + 50 WHERE w_id = 2;
4	支付订单	查询仓库	SELECT w_name, w_street_1, w_street_2, w_city, w_state, w_zip FROM bmsql_warehouse WHERE w_id = ?;	SELECT w_name, w_street_1, w_street_2, w_city, w_state, w_zip FROM bmsql_warehouse WHERE w_id = 2;
5	支付订单	查询客户id。可选，当payment.c_last != null时获取c_id 否则 随机获取 ，下面这条sql的仓库 地市是 随机获取的，15%的概率	SELECT c_id FROM bmsql_customer WHERE c_w_id = ? AND c_d_id = ? AND c_last = ? ORDER BY c_first;	SELECT c_id FROM bmsql_customer WHERE c_w_id = 2 AND c_d_id = 2 AND c_last = 'ABLEABLEBAR' ORDER BY c_first;
6	支付订单	查询客户信息	SELECT c_first, c_middle, c_last, c_street_1, c_street_2, c_city, c_state, c_zip, c_phone, c_since, c_credit, c_credit_lim, c_discount, c_balance FROM bmsql_customer WHERE c_w_id = ? AND c_d_id = ? AND c_id = ? FOR UPDATE;	SELECT c_first, c_middle, c_last, c_street_1, c_street_2, c_city, c_state, c_zip, c_phone, c_since, c_credit, c_credit_lim, c_discount, c_balance FROM bmsql_customer WHERE c_w_id = 2 AND c_d_id = 2 AND c_id = 1 FOR UPDATE;
7	支付订单	更新客户。下面只执行其中一种分支	&quot;当payment.c_credit.equals(&quot;&quot;GC&quot;&quot;) 为真时
</code></pre>
<p>UPDATE bmsql_customer SET c_balance = c_balance - ?, c_ytd_payment = c_ytd_payment + ?, c_payment_cnt = c_payment_cnt + 1 WHERE c_w_id = ? AND c_d_id = ? AND c_id = ?;
当 payment.c_credit.equals(&ldquo;&ldquo;GC&rdquo;") 为假时
SELECT c_data FROM bmsql_customer WHERE c_w_id = ? AND c_d_id = ? AND c_id = ?;
UPDATE bmsql_customer SET c_balance = c_balance - ?, c_ytd_payment = c_ytd_payment + ?, c_payment_cnt = c_payment_cnt + 1, c_data = ? WHERE c_w_id = ? AND c_d_id = ? AND c_id = ?;
" &ldquo;当payment.c_credit.equals(&ldquo;&ldquo;GC&rdquo;") 为真时
UPDATE bmsql_customer SET c_balance = c_balance - 50, c_ytd_payment = c_ytd_payment + 50, c_payment_cnt = c_payment_cnt + 1 WHERE c_w_id = 2 AND c_d_id = 2 AND c_id = 1;
当 payment.c_credit.equals(&ldquo;&ldquo;GC&rdquo;") 为假时
SELECT c_data FROM bmsql_customer WHERE c_w_id = 2 AND c_d_id = 2 AND c_id = 1;
UPDATE bmsql_customer SET c_balance = c_balance - 50, c_ytd_payment = c_ytd_payment + 50, c_payment_cnt = c_payment_cnt + 1, c_data = &lsquo;kpPptvxJnsCfvO1ytF4BDyvdazRSgRWn4sXjbv4Rf5lD7zbrvLCyCz3cShZtlZ0z3hyj4h1oYOLijM8QeoAJjtsMVeLrIllxr5yamzWvxTMvad2VbtgDvCuvBuBD6cQDCHbv8Fscz4KyXFpvSbZ18tht5HMOH5dFXCLl
3rjxalXVAd0xGAV7XlYOIGxq4J01L6AMnN7OqH68cB3zrqExErhJnLwYpjDrkPbP2HbBamF9oOkWXljHKGfsHYcnMGWVBnFHFmlxKZjLlLgLzEsXW4pM4BDDM2JPdZTkDu0fI0hGJL51TAHjhgJBQwj7F56NmELmw1Qit
edc0umZGrGL0F1406CzD&rsquo; WHERE c_w_id = 2 AND c_d_id = 2 AND c_id = 1;&rdquo;
8 支付订单 插入历史表 INSERT INTO bmsql_history (h_c_id, h_c_d_id, h_c_w_id, h_d_id, h_w_id, h_date, h_amount, h_data) VALUES (?, ?, ?, ?, ?, ?, ?, ?); INSERT INTO bmsql_history (h_c_id, h_c_d_id, h_c_w_id, h_d_id, h_w_id, h_date, h_amount, h_data) VALUES (1, 2, 2, 2, 2, &lsquo;2022-04-24 14:16:10.828&rsquo;, 50, &lsquo;kdFsmsG0gO t4J98uwY&rsquo;);
9 支付订单 提交 commit</p>
<pre><code>查询订单状态				
序号	事务类型	操作类型	原始sql	填上数值的sql
1	查询订单状态	查询客户id。60%的概率，有条件，orderStatus.c_last != null	SELECT c_id FROM bmsql_customer WHERE c_w_id = ? AND c_d_id = ? AND c_last = ? ORDER BY c_first;	SELECT c_id FROM bmsql_customer WHERE c_w_id = 2 AND c_d_id = 2 AND c_last = 'ABLEABLEBAR' ORDER BY c_first;
2	查询订单状态	查询客户信息	SELECT c_first, c_middle, c_last, c_balance FROM bmsql_customer WHERE c_w_id = ? AND c_d_id = ? AND c_id = ?;	SELECT c_first, c_middle, c_last, c_balance FROM bmsql_customer WHERE c_w_id = 2 AND c_d_id = 2 AND c_id = 1;
3	查询订单状态	查询订单信息	SELECT o_id, o_entry_d, o_carrier_id FROM bmsql_oorder WHERE o_w_id = ? AND o_d_id = ? AND o_c_id = ? AND o_id = (SELECT max(o_id) FROM bmsql_oorder WHERE o_w_id = ? AND o_d_id = ? AND o_c_id = ? );	SELECT o_id, o_entry_d, o_carrier_id FROM bmsql_oorder WHERE o_w_id = 2 AND o_d_id = 2 AND o_c_id = 1 AND o_id = (SELECT max(o_id) FROM bmsql_oorder WHERE o_w_id = 2 AND o_d_id = 2 AND o_c_id = 1 );
4	查询订单状态	查询订单商品明细	SELECT ol_i_id, ol_supply_w_id, ol_quantity, ol_amount, ol_delivery_d FROM bmsql_order_line WHERE ol_w_id = ? AND ol_d_id = ? AND ol_o_id = ? ORDER BY ol_w_id, ol_d_id, ol_o_id, ol_number;	SELECT ol_i_id, ol_supply_w_id, ol_quantity, ol_amount, ol_delivery_d FROM bmsql_order_line WHERE ol_w_id = 2 AND ol_d_id = 2 AND ol_o_id = 3001 ORDER BY ol_w_id, ol_d_id, ol_o_id, ol_number;
5	查询订单状态	回滚	rollback;	
				
				
				
投递送货				
序号	事务类型	操作类型	原始sql	填上数值的sql
1	投递送货	挑一个最老的订单进行处理。10个地市，依次 找出最老未投递的订单，一个一个处理。	SELECT no_o_id FROM bmsql_new_order WHERE no_w_id = ? AND no_d_id = ? ORDER BY no_o_id ASC;	SELECT no_o_id FROM bmsql_new_order WHERE no_w_id = 2 AND no_d_id = 2 ORDER BY no_o_id ASC;
2	投递送货	删除新订单	DELETE FROM bmsql_new_order WHERE no_w_id = ? AND no_d_id = ? AND no_o_id = ?;	DELETE FROM bmsql_new_order WHERE no_w_id = 2 AND no_d_id = 2 AND no_o_id = 2101;
3	投递送货	更新订单表投递员	UPDATE bmsql_oorder SET o_carrier_id = ? WHERE o_w_id = ? AND o_d_id = ? AND o_id = ?;	UPDATE bmsql_oorder SET o_carrier_id = 7 WHERE o_w_id = 2 AND o_d_id = 2 AND o_id = 2101;
4	投递送货	查询该订单的客户id	SELECT o_c_id FROM bmsql_oorder WHERE o_w_id = ? AND o_d_id = ? AND o_id = ?;	SELECT o_c_id FROM bmsql_oorder WHERE o_w_id = 2 AND o_d_id = 2 AND o_id = 2101;
5	投递送货	更新订单商品明细表的投递时间	UPDATE bmsql_order_line SET ol_delivery_d = ? WHERE ol_w_id = ? AND ol_d_id = ? AND ol_o_id = ?;	UPDATE bmsql_order_line SET ol_delivery_d = '2022-04-24 14:16:10.828' WHERE ol_w_id = 2 AND ol_d_id = 2 AND ol_o_id = 2101;
6	投递送货	查询此订单的要支付的金额	SELECT sum(ol_amount) AS sum_ol_amount FROM bmsql_order_line WHERE ol_w_id = ? AND ol_d_id = ? AND ol_o_id = ?;	SELECT sum(ol_amount) AS sum_ol_amount FROM bmsql_order_line WHERE ol_w_id = 2 AND ol_d_id = 2 AND ol_o_id = 2101;
7	投递送货	更新客户的账户	UPDATE bmsql_customer SET c_balance = c_balance + ?, c_delivery_cnt = c_delivery_cnt WHERE c_w_id = ? AND c_d_id = ? AND c_id = ?;	UPDATE bmsql_customer SET c_balance = c_balance + 42509.85, c_delivery_cnt = c_delivery_cnt WHERE c_w_id = 2 AND c_d_id = 2 AND c_id = 983;
8	投递送货	提交	commit	
</code></pre>
<hr>
<h2 id=explain-verbose-execute-s11-1------------------------------------------------------------------------query-plan>
TPCC SQL &ldquo;plan_cache_mode = force_custom_plan
enable_fast_query_shipping = on&rdquo; &ldquo;plan_cache_mode = force_generic_plan
enable_fast_query_shipping = on&rdquo; &ldquo;plan_cache_mode = force_custom_plan
enable_fast_query_shipping = off&rdquo; &ldquo;plan_cache_mode = force_generic_plan
enable_fast_query_shipping = off&rdquo;
&ldquo;prepare s1(int, int) as select d_tax, d_next_o_id from bmsql_district where d_w_id = $1 and d_id = $2 for update;
explain verbose execute s1(1, 1); " " QUERY PLAN
<a href=#explain-verbose-execute-s11-1------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<p>Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;&rdquo; (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_district.d_tax, bmsql_district.d_next_o_id
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT d_tax, d_next_o_id FROM public.bmsql_district bmsql_district WHERE ((d_w_id = $1) AND (d_id = $2)) FOR UPDATE OF bmsql_district
(5 rows)</p>
<h2 id=prepare-----------------------------------------------------------------------query-plan>
PREPARE&rdquo; " QUERY PLAN
<a href=#prepare-----------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows---------------------------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;&rdquo; (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_district.d_tax, bmsql_district.d_next_o_id
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT d_tax, d_next_o_id FROM public.bmsql_district bmsql_district WHERE ((d_w_id = $1) AND (d_id = $2)) FOR UPDATE OF bmsql_district
(5 rows)&rdquo; " QUERY PLAN
<a href=#5-rows---------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=7-rows----------------------------------------------------------------------------query-plan>
LockRows (cost=0.00..2195.03 rows=1 width=9)
Output: bmsql_district.d_tax, bmsql_district.d_next_o_id
-> Data Node Scan on bmsql_district &ldquo;"<em>REMOTE_TABLE_QUERY</em>&rdquo;&rdquo; (cost=0.00..2195.02 rows=1 width=9)
Output: bmsql_district.d_tax, bmsql_district.d_next_o_id
Primary node/s: dn1
Node/s: dn1
Remote query: SELECT d_tax, d_next_o_id FROM ONLY public.bmsql_district bmsql_district WHERE ((d_w_id = 1) AND (d_id = 1)) FOR UPDATE OF bmsql_district
(7 rows)" " QUERY PLAN
<a href=#7-rows----------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<p>LockRows (cost=0.00..2195.03 rows=1 width=9)
Output: bmsql_district.d_tax, bmsql_district.d_next_o_id
-> Data Node Scan on bmsql_district &ldquo;"<em>REMOTE_TABLE_QUERY</em>&rdquo;" (cost=0.00..2195.02 rows=1 width=9)
Output: bmsql_district.d_tax, bmsql_district.d_next_o_id
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT d_tax, d_next_o_id FROM ONLY public.bmsql_district bmsql_district WHERE ((d_w_id = $1) AND (d_id = $2)) FOR UPDATE OF bmsql_district
(7 rows)"</p>
<p>&ldquo;prepare s2(int, int, int, int) as select count(*) as low_stock from (select s_w_id, s_i_id, s_quantity from bmsql_stock where s_w_id = $1 and s_quantity &lt; $2 and s_i_id in (select ol_i_id from bmsql_district join bmsql_order_line on ol_w_id = d_w_id and ol_d_id = d_id and ol_o_id >= d_next_o_id - 20 and ol_o_id &lt; d_next_o_id where d_w_id = $3 and d_id = $4)) as l;
explain verbose execute s2(1, 1, 1, 1);</p>
<h2 id=2--------------------------------------------------------------------------------------------------------------------------------------------------------------query-plan>
2&rdquo; " QUERY PLAN
<a href=#2--------------------------------------------------------------------------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=28-rows--------------------------------------------------------------query-plan>
Cluster Gather (cost=13727.32..13727.63 rows=1 width=8)
Remote node: 16386
-> Aggregate (cost=13727.32..13727.33 rows=1 width=8)
Output: count(*)
-> Nested Loop (cost=13682.30..13727.32 rows=0 width=0)
Inner Unique: true
-> HashAggregate (cost=13682.12..13700.39 rows=1827 width=4)
Output: bmsql_order_line.ol_i_id
Group Key: bmsql_order_line.ol_i_id
-> Nested Loop (cost=60.08..13677.55 rows=914 width=4)
Output: bmsql_order_line.ol_i_id
-> Index Scan using bmsql_district_pkey on public.bmsql_district (cost=0.15..8.17 rows=1 width=12)
Output: bmsql_district.d_w_id, bmsql_district.d_id, bmsql_district.d_ytd, bmsql_district.d_tax, bmsql_district.d_next_o_id, bmsql_district.d_name, bmsql_district.d_street_1, bmsql_district.d_street_2, bmsql_district.d_city, bmsql_district.d_state, bmsql_district.d_zip
Index Cond: ((bmsql_district.d_w_id = 1) AND (bmsql_district.d_id = 1))
Remote node: 16386
-> Bitmap Heap Scan on public.bmsql_order_line (cost=59.93..13632.83 rows=3655 width=16)
Output: bmsql_order_line.ol_w_id, bmsql_order_line.ol_d_id, bmsql_order_line.ol_o_id, bmsql_order_line.ol_number, bmsql_order_line.ol_i_id, bmsql_order_line.ol_delivery_d, bmsql_order_line.ol_amount, bmsql_order_line.ol_supply_w_id, bmsql_order_line.ol_quantity, bmsql_order_line.ol_dist_info
Recheck Cond: ((bmsql_order_line.ol_w_id = 1) AND (bmsql_order_line.ol_d_id = 1) AND (bmsql_order_line.ol_o_id >= (bmsql_district.d_next_o_id - 20)) AND (bmsql_order_line.ol_o_id &lt; bmsql_district.d_next_o_id)) -> Bitmap Index Scan on bmsql_order_line_pkey (cost=0.00..59.01 rows=3655 width=0)
Index Cond: ((bmsql_order_line.ol_w_id = 1) AND (bmsql_order_line.ol_d_id = 1) AND (bmsql_order_line.ol_o_id >= (bmsql_district.d_next_o_id - 20)) AND (bmsql_order_line.ol_o_id &lt; bmsql_district.d_next_o_id)) Remote node: 16386
-> Materialize (cost=0.18..4.09 rows=1 width=4)
Output: bmsql_stock.s_i_id
-> Index Scan using bmsql_stock_pkey on public.bmsql_stock (cost=0.18..4.09 rows=1 width=4)
Output: bmsql_stock.s_i_id
Index Cond: ((bmsql_stock.s_w_id = 1) AND (bmsql_stock.s_i_id = bmsql_order_line.ol_i_id))
Filter: (bmsql_stock.s_quantity &lt; 1)
Remote node: 16386
(28 rows)" " QUERY PLAN
<a href=#28-rows--------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=35-rows--------------------------------------------------------------------------------------------------------------------------------------------------------------query-plan>
Finalize Aggregate (cost=350097.92..350097.93 rows=1 width=8)
Output: count(<em>)
-> Cluster Gather (cost=350097.30..350097.91 rows=2 width=8)
Remote node: 16386,16387
-> Partial Aggregate (cost=349097.30..349097.31 rows=1 width=8)
Output: PARTIAL count(</em>)
-> Hash Semi Join (cost=13884.31..349096.96 rows=139 width=0)
Hash Cond: (bmsql_stock.s_i_id = bmsql_order_line.ol_i_id)
-> Bitmap Heap Scan on public.bmsql_stock (cost=758.10..335912.10 rows=16661 width=4)
Output: bmsql_stock.s_w_id, bmsql_stock.s_i_id, bmsql_stock.s_quantity, bmsql_stock.s_ytd, bmsql_stock.s_order_cnt, bmsql_stock.s_remote_cnt, bmsql_stock.s_data, bmsql_stock.s_dist_01, bmsql_stock.s_dist_02, bmsql_stock.s_dist_03, bmsql_stock.s_dist_04, bmsql_stock.s_dist_05, bmsql_stock.s_dist_06, bmsql_stock.s_dist_07, bmsql_stock.s_dist_08, bmsql_stock.s_dist_09, bmsql_stock.s_dist_10
Recheck Cond: (bmsql_stock.s_w_id = $1)
Filter: (bmsql_stock.s_quantity &lt; $2)
-> Bitmap Index Scan on bmsql_stock_pkey (cost=0.00..753.93 rows=99966 width=0)
Index Cond: (bmsql_stock.s_w_id = $1)
Remote node: 16386,16387
-> Hash (cost=13104.95..13104.95 rows=1701 width=4)
Output: bmsql_order_line.ol_i_id
-> Cluster Reduce (cost=58.22..13104.95 rows=1701 width=4)
Reduce: unnest('[0:1]={16386,16387}'::oid[])
-> Nested Loop (cost=57.22..12836.80 rows=850 width=4)
Output: bmsql_order_line.ol_i_id
-> Cluster Reduce (cost=1.15..12.47 rows=2 width=12)
Reduce: unnest('[0:1]={16386,16387}'::oid[])
-> Index Scan using bmsql_district_pkey on public.bmsql_district (cost=0.15..8.17 rows=1 width=12)
Output: bmsql_district.d_w_id, bmsql_district.d_id, bmsql_district.d_ytd, bmsql_district.d_tax, bmsql_district.d_next_o_id, bmsql_district.d_name, bmsql_district.d_street_1, bmsql_district.d_street_2, bmsql_district.d_city, bmsql_district.d_state, bmsql_district.d_zip
Index Cond: ((bmsql_district.d_w_id = $3) AND (bmsql_district.d_id = $4))
Remote node: 16386,16387
-> Materialize (cost=56.07..12747.79 rows=3402 width=16)
Output: bmsql_order_line.ol_w_id, bmsql_order_line.ol_d_id, bmsql_order_line.ol_o_id, bmsql_order_line.ol_i_id
-> Bitmap Heap Scan on public.bmsql_order_line (cost=56.07..12730.78 rows=3402 width=16)
Output: bmsql_order_line.ol_w_id, bmsql_order_line.ol_d_id, bmsql_order_line.ol_o_id, bmsql_order_line.ol_i_id
Recheck Cond: ((bmsql_order_line.ol_w_id = $3) AND (bmsql_order_line.ol_d_id = $4) AND (bmsql_order_line.ol_o_id >= (bmsql_district.d_next_o_id - 20)) AND (bmsql_order_line.ol_o_id &lt; bmsql_district.d_next_o_id))
-> Bitmap Index Scan on bmsql_order_line_pkey (cost=0.00..55.22 rows=3402 width=0)
Index Cond: ((bmsql_order_line.ol_w_id = $3) AND (bmsql_order_line.ol_d_id = $4) AND (bmsql_order_line.ol_o_id >= (bmsql_district.d_next_o_id - 20)) AND (bmsql_order_line.ol_o_id &lt; bmsql_district.d_next_o_id))
Remote node: 16386,16387
(35 rows)" " QUERY PLAN
<a href=#35-rows--------------------------------------------------------------------------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=28-rows------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------query-plan>
Cluster Gather (cost=13727.32..13727.63 rows=1 width=8)
Remote node: 16386
-> Aggregate (cost=13727.32..13727.33 rows=1 width=8)
Output: count(*)
-> Nested Loop (cost=13682.30..13727.32 rows=0 width=0)
Inner Unique: true
-> HashAggregate (cost=13682.12..13700.39 rows=1827 width=4)
Output: bmsql_order_line.ol_i_id
Group Key: bmsql_order_line.ol_i_id
-> Nested Loop (cost=60.08..13677.55 rows=914 width=4)
Output: bmsql_order_line.ol_i_id
-> Index Scan using bmsql_district_pkey on public.bmsql_district (cost=0.15..8.17 rows=1 width=12)
Output: bmsql_district.d_w_id, bmsql_district.d_id, bmsql_district.d_ytd, bmsql_district.d_tax, bmsql_district.d_next_o_id, bmsql_district.d_name, bmsql_district.d_street_1, bmsql_district.d_street_2, bmsql_district.d_city, bmsql_district.d_state, bmsql_district.d_zip
Index Cond: ((bmsql_district.d_w_id = 1) AND (bmsql_district.d_id = 1))
Remote node: 16386
-> Bitmap Heap Scan on public.bmsql_order_line (cost=59.93..13632.83 rows=3655 width=16)
Output: bmsql_order_line.ol_w_id, bmsql_order_line.ol_d_id, bmsql_order_line.ol_o_id, bmsql_order_line.ol_number, bmsql_order_line.ol_i_id, bmsql_order_line.ol_delivery_d, bmsql_order_line.ol_amount, bmsql_order_line.ol_supply_w_id, bmsql_order_line.ol_quantity, bmsql_order_line.ol_dist_info
Recheck Cond: ((bmsql_order_line.ol_w_id = 1) AND (bmsql_order_line.ol_d_id = 1) AND (bmsql_order_line.ol_o_id >= (bmsql_district.d_next_o_id - 20)) AND (bmsql_order_line.ol_o_id &lt; bmsql_district.d_next_o_id))
-> Bitmap Index Scan on bmsql_order_line_pkey (cost=0.00..59.01 rows=3655 width=0)
Index Cond: ((bmsql_order_line.ol_w_id = 1) AND (bmsql_order_line.ol_d_id = 1) AND (bmsql_order_line.ol_o_id >= (bmsql_district.d_next_o_id - 20)) AND (bmsql_order_line.ol_o_id &lt; bmsql_district.d_next_o_id))
Remote node: 16386
-> Materialize (cost=0.18..4.09 rows=1 width=4)
Output: bmsql_stock.s_i_id
-> Index Scan using bmsql_stock_pkey on public.bmsql_stock (cost=0.18..4.09 rows=1 width=4)
Output: bmsql_stock.s_i_id
Index Cond: ((bmsql_stock.s_w_id = 1) AND (bmsql_stock.s_i_id = bmsql_order_line.ol_i_id))
Filter: (bmsql_stock.s_quantity &lt; 1)
Remote node: 16386
(28 rows)" " QUERY PLAN
<a href=#28-rows------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s31-1--------------------------------------------query-plan>
Finalize Aggregate (cost=350097.92..350097.93 rows=1 width=8)
Output: count(<em>)
-> Cluster Gather (cost=350097.30..350097.91 rows=2 width=8)
Remote node: 16386,16387
-> Partial Aggregate (cost=349097.30..349097.31 rows=1 width=8)
Output: PARTIAL count(</em>)
-> Hash Semi Join (cost=13884.31..349096.96 rows=139 width=0)
Hash Cond: (bmsql_stock.s_i_id = bmsql_order_line.ol_i_id)
-> Bitmap Heap Scan on public.bmsql_stock (cost=758.10..335912.10 rows=16661 width=4)
Output: bmsql_stock.s_w_id, bmsql_stock.s_i_id, bmsql_stock.s_quantity, bmsql_stock.s_ytd, bmsql_stock.s_order_cnt, bmsql_stock.s_remote_cnt, bmsql_stock.s_data, bmsql_stock.s_dist_01, bmsql_stock.s_dist_02, bmsql_stock.s_dist_03, bmsql_stock.s_dist_04, bmsql_stock.s_dist_05, bmsql_stock.s_dist_06, bmsql_stock.s_dist_07, bmsql_stock.s_dist_08, bmsql_stock.s_dist_09, bmsql_stock.s_dist_10
Recheck Cond: (bmsql_stock.s_w_id = $1)
Filter: (bmsql_stock.s_quantity &lt; $2)
-> Bitmap Index Scan on bmsql_stock_pkey (cost=0.00..753.93 rows=99966 width=0)
Index Cond: (bmsql_stock.s_w_id = $1)
Remote node: 16386,16387
-> Hash (cost=13104.95..13104.95 rows=1701 width=4)
Output: bmsql_order_line.ol_i_id
-> Cluster Reduce (cost=58.22..13104.95 rows=1701 width=4)
Reduce: unnest('[0:1]={16386,16387}'::oid[])
-> Nested Loop (cost=57.22..12836.80 rows=850 width=4)
Output: bmsql_order_line.ol_i_id
-> Cluster Reduce (cost=1.15..12.47 rows=2 width=12)
Reduce: unnest('[0:1]={16386,16387}'::oid[])
-> Index Scan using bmsql_district_pkey on public.bmsql_district (cost=0.15..8.17 rows=1 width=12)
Output: bmsql_district.d_w_id, bmsql_district.d_id, bmsql_district.d_ytd, bmsql_district.d_tax, bmsql_district.d_next_o_id, bmsql_district.d_name, bmsql_district.d_street_1, bmsql_district.d_street_2, bmsql_district.d_city, bmsql_district.d_state, bmsql_district.d_zip
Index Cond: ((bmsql_district.d_w_id = $3) AND (bmsql_district.d_id = $4))
Remote node: 16386,16387
-> Materialize (cost=56.07..12747.79 rows=3402 width=16)
Output: bmsql_order_line.ol_w_id, bmsql_order_line.ol_d_id, bmsql_order_line.ol_o_id, bmsql_order_line.ol_i_id
-> Bitmap Heap Scan on public.bmsql_order_line (cost=56.07..12730.78 rows=3402 width=16)
Output: bmsql_order_line.ol_w_id, bmsql_order_line.ol_d_id, bmsql_order_line.ol_o_id, bmsql_order_line.ol_i_id
Recheck Cond: ((bmsql_order_line.ol_w_id = $3) AND (bmsql_order_line.ol_d_id = $4) AND (bmsql_order_line.ol_o_id >= (bmsql_district.d_next_o_id - 20)) AND (bmsql_order_line.ol_o_id &lt; bmsql_district.d_next_o_id))
-> Bitmap Index Scan on bmsql_order_line_pkey (cost=0.00..55.22 rows=3402 width=0)
Index Cond: ((bmsql_order_line.ol_w_id = $3) AND (bmsql_order_line.ol_d_id = $4) AND (bmsql_order_line.ol_o_id >= (bmsql_district.d_next_o_id - 20)) AND (bmsql_order_line.ol_o_id &lt; bmsq
l_district.d_next_o_id))
Remote node: 16386,16387
(35 rows)"
&ldquo;prepare s3(int, int) as select no_o_id from bmsql_new_order where no_w_id = $1 and no_d_id = $2 order by no_o_id asc;
explain verbose execute s3(1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s31-1--------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=11-rows---------------------------------------------query-plan>
Cluster Gather (cost=2744.43..2913.83 rows=560 width=4)
Remote node: 16386
-> Sort (cost=2744.43..2745.83 rows=560 width=4)
Output: no_o_id
Sort Key: bmsql_new_order.no_o_id
-> Bitmap Heap Scan on public.bmsql_new_order (cost=15.52..2718.87 rows=560 width=4)
Output: no_o_id
Recheck Cond: ((bmsql_new_order.no_w_id = 1) AND (bmsql_new_order.no_d_id = 1))
-> Bitmap Index Scan on bmsql_new_order_pkey (cost=0.00..15.38 rows=1120 width=0)
Index Cond: ((bmsql_new_order.no_w_id = 1) AND (bmsql_new_order.no_d_id = 1))
Remote node: 16386
(11 rows)" " QUERY PLAN
<a href=#11-rows---------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=12-rows--------------------------------------------query-plan>
Cluster Merge Gather (cost=2382.62..2383.75 rows=906 width=0)
Remote node: 16386,16387
Sort Key: bmsql_new_order.no_o_id
-> Sort (cost=2364.50..2365.63 rows=453 width=4)
Output: no_o_id
Sort Key: bmsql_new_order.no_o_id
-> Bitmap Heap Scan on public.bmsql_new_order (cost=13.35..2344.52 rows=453 width=4)
Output: no_o_id
Recheck Cond: ((bmsql_new_order.no_w_id = $1) AND (bmsql_new_order.no_d_id = $2))
-> Bitmap Index Scan on bmsql_new_order_pkey (cost=0.00..13.24 rows=906 width=0)
Index Cond: ((bmsql_new_order.no_w_id = $1) AND (bmsql_new_order.no_d_id = $2))
Remote node: 16386,16387
(12 rows)" " QUERY PLAN
<a href=#12-rows--------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=11-rows---------------------------------------------query-plan-1>
Cluster Gather (cost=2744.43..2913.83 rows=560 width=4)
Remote node: 16386
-> Sort (cost=2744.43..2745.83 rows=560 width=4)
Output: no_o_id
Sort Key: bmsql_new_order.no_o_id
-> Bitmap Heap Scan on public.bmsql_new_order (cost=15.52..2718.87 rows=560 width=4)
Output: no_o_id
Recheck Cond: ((bmsql_new_order.no_w_id = 1) AND (bmsql_new_order.no_d_id = 1))
-> Bitmap Index Scan on bmsql_new_order_pkey (cost=0.00..15.38 rows=1120 width=0)
Index Cond: ((bmsql_new_order.no_w_id = 1) AND (bmsql_new_order.no_d_id = 1))
Remote node: 16386
(11 rows)" " QUERY PLAN
<a href=#11-rows---------------------------------------------query-plan-1 class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s41-1-1------------------------------------------------------query-plan>
Cluster Merge Gather (cost=2382.62..2383.75 rows=906 width=0)
Remote node: 16386,16387
Sort Key: bmsql_new_order.no_o_id
-> Sort (cost=2364.50..2365.63 rows=453 width=4)
Output: no_o_id
Sort Key: bmsql_new_order.no_o_id
-> Bitmap Heap Scan on public.bmsql_new_order (cost=13.35..2344.52 rows=453 width=4)
Output: no_o_id
Recheck Cond: ((bmsql_new_order.no_w_id = $1) AND (bmsql_new_order.no_d_id = $2))
-> Bitmap Index Scan on bmsql_new_order_pkey (cost=0.00..13.24 rows=906 width=0)
Index Cond: ((bmsql_new_order.no_w_id = $1) AND (bmsql_new_order.no_d_id = $2))
Remote node: 16386,16387
(12 rows)" 茅晓萍
&ldquo;prepare s4(int, int, int) as insert into bmsql_new_order (no_o_id, no_d_id, no_w_id) values ($1, $2, $3);
explain verbose execute s4(1, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s41-1-1------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=4-rows------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: ($3), ($2), ($1)
Node expr: $3
Remote query: INSERT INTO public.bmsql_new_order AS bmsql_new_order (no_w_id, no_d_id, no_o_id) VALUES ($3, $2, $1)
(4 rows)" " QUERY PLAN
<a href=#4-rows------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=4-rows--------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: ($3), ($2), ($1)
Node expr: $3
Remote query: INSERT INTO public.bmsql_new_order AS bmsql_new_order (no_w_id, no_d_id, no_o_id) VALUES ($3, $2, $1)
(4 rows)" " QUERY PLAN
<a href=#4-rows--------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=8-rows------------------------------------------------------query-plan>
Cluster Gather (cost=0.01..0.62 rows=2 width=12)
Remote node: 16386
-> Insert on public.bmsql_new_order (cost=0.01..0.03 rows=1 width=12)
-> Result (cost=0.01..0.03 rows=1 width=12)
Output: 1, 1, 1
Filter: (adb_node_oid() &lt;> &lsquo;12338&rsquo;::oid)
-> Result (cost=0.00..0.01 rows=1 width=12)
Output: 1, 1, 1
(8 rows)" " QUERY PLAN
<a href=#8-rows------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s51----------------------------------------------query-plan>
Insert on public.bmsql_new_order (cost=0.00..0.01 rows=1 width=12)
Primary node/s: dn1
Node/s: dn1, dn2
Node expr: bmsql_new_order.no_w_id
Remote query: INSERT INTO public.bmsql_new_order AS bmsql_new_order (no_w_id, no_d_id, no_o_id) VALUES ($1, $2, $3)
-> Result (cost=0.00..0.01 rows=1 width=12)
Output: $3, $2, $1
(7 rows)"
" prepare s5(int) as select i_price, i_name, i_data from bmsql_item where i_id = $1;
explain verbose execute s5(1); " " QUERY PLAN
<a href=#explain-verbose-execute-s51----------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=4-rows---------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_item.i_price, bmsql_item.i_name, bmsql_item.i_data
Node/s: dn2
Remote query: SELECT i_price, i_name, i_data FROM public.bmsql_item bmsql_item WHERE (i_id = $1)
(4 rows)" " QUERY PLAN
<a href=#4-rows---------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=4-rows-------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_item.i_price, bmsql_item.i_name, bmsql_item.i_data
Node/s: dn2
Remote query: SELECT i_price, i_name, i_data FROM public.bmsql_item bmsql_item WHERE (i_id = $1)
(4 rows)" " QUERY PLAN
<a href=#4-rows-------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=6-rows-------------------------------------------query-plan>
Cluster Gather (cost=0.17..8.49 rows=1 width=64)
Remote node: 16387
-> Index Scan using bmsql_item_pkey on public.bmsql_item (cost=0.17..8.19 rows=1 width=64)
Output: i_price, i_name, i_data
Index Cond: (bmsql_item.i_id = 1)
Remote node: 16386,16387
(6 rows)" " QUERY PLAN
<a href=#6-rows-------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s61-1-1---------------------------------------------------------query-plan>
Cluster Gather (cost=0.17..8.49 rows=1 width=64)
Remote node: 16387
-> Index Scan using bmsql_item_pkey on public.bmsql_item (cost=0.17..8.19 rows=1 width=64)
Output: i_price, i_name, i_data
Index Cond: (bmsql_item.i_id = $1)
Remote node: 16386,16387
(6 rows)"
&ldquo;prepare s6(int, int, int) as select o_c_id from bmsql_oorder where o_w_id = $1 and o_d_id = $2 and o_id = $3;
explain verbose execute s6(1, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s61-1-1---------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows---------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_oorder.o_c_id
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT o_c_id FROM public.bmsql_oorder bmsql_oorder WHERE ((o_w_id = $1) AND (o_d_id = $2) AND (o_id = $3))
(5 rows)" " QUERY PLAN
<a href=#5-rows---------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_oorder.o_c_id
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT o_c_id FROM public.bmsql_oorder bmsql_oorder WHERE ((o_w_id = $1) AND (o_d_id = $2) AND (o_id = $3))
(5 rows)" " QUERY PLAN
<a href=#5-rows------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=6-rows--------------------------------------------------query-plan>
Cluster Gather (cost=0.18..8.50 rows=1 width=4)
Remote node: 16386
-> Index Scan using bmsql_oorder_pkey on public.bmsql_oorder (cost=0.18..8.20 rows=1 width=4)
Output: o_c_id
Index Cond: ((bmsql_oorder.o_w_id = 1) AND (bmsql_oorder.o_d_id = 1) AND (bmsql_oorder.o_id = 1))
Remote node: 16386
(6 rows)" " QUERY PLAN
<a href=#6-rows--------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s71-1-oughtbarpres--------------------------------------------query-plan>
Cluster Gather (cost=0.18..8.80 rows=2 width=4)
Remote node: 16386,16387
-> Index Scan using bmsql_oorder_pkey on public.bmsql_oorder (cost=0.18..8.20 rows=1 width=4)
Output: o_c_id
Index Cond: ((bmsql_oorder.o_w_id = $1) AND (bmsql_oorder.o_d_id = $2) AND (bmsql_oorder.o_id = $3))
Remote node: 16386,16387
(6 rows)"
" prepare s7(int, int, char(32)) as select c_id from bmsql_customer where c_w_id = $1 and c_d_id = $2 and c_last = $3 order by c_first;
explain verbose execute s7(1, 1, &lsquo;OUGHTBARPRES&rsquo;);" " QUERY PLAN
<a href=#explain-verbose-execute-s71-1-oughtbarpres--------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=12-rows--------------------------------------------query-plan-1>
Cluster Gather (cost=13055.61..13055.91 rows=1 width=16)
Remote node: 16386
-> Sort (cost=13055.61..13055.61 rows=1 width=16)
Output: c_id, c_first
Sort Key: bmsql_customer.c_first
-> Bitmap Heap Scan on public.bmsql_customer (cost=40.16..13055.60 rows=1 width=16)
Output: c_id, c_first
Recheck Cond: ((bmsql_customer.c_w_id = 1) AND (bmsql_customer.c_d_id = 1))
Filter: ((bmsql_customer.c_last)::bpchar = &lsquo;OUGHTBARPRES&rsquo;::bpchar)
-> Bitmap Index Scan on bmsql_customer_idx1 (cost=0.00..40.16 rows=3598 width=0)
Index Cond: ((bmsql_customer.c_w_id = 1) AND (bmsql_customer.c_d_id = 1))
Remote node: 16386
(12 rows)" " QUERY PLAN
<a href=#12-rows--------------------------------------------query-plan-1 class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=13-rows--------------------------------------------query-plan>
Cluster Merge Gather (cost=10991.69..10991.69 rows=4 width=0)
Remote node: 16386,16387
Sort Key: bmsql_customer.c_first
-> Sort (cost=10991.61..10991.61 rows=2 width=16)
Output: c_id, c_first
Sort Key: bmsql_customer.c_first
-> Bitmap Heap Scan on public.bmsql_customer (cost=34.17..10991.60 rows=2 width=16)
Output: c_id, c_first
Recheck Cond: ((bmsql_customer.c_w_id = $1) AND (bmsql_customer.c_d_id = $2))
Filter: ((bmsql_customer.c_last)::bpchar = $3)
-> Bitmap Index Scan on bmsql_customer_idx1 (cost=0.00..34.17 rows=2999 width=0)
Index Cond: ((bmsql_customer.c_w_id = $1) AND (bmsql_customer.c_d_id = $2))
Remote node: 16386,16387
(13 rows)" " QUERY PLAN
<a href=#13-rows--------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=12-rows--------------------------------------------query-plan-2>
Cluster Gather (cost=13055.61..13055.91 rows=1 width=16)
Remote node: 16386
-> Sort (cost=13055.61..13055.61 rows=1 width=16)
Output: c_id, c_first
Sort Key: bmsql_customer.c_first
-> Bitmap Heap Scan on public.bmsql_customer (cost=40.16..13055.60 rows=1 width=16)
Output: c_id, c_first
Recheck Cond: ((bmsql_customer.c_w_id = 1) AND (bmsql_customer.c_d_id = 1))
Filter: ((bmsql_customer.c_last)::bpchar = &lsquo;OUGHTBARPRES&rsquo;::bpchar)
-> Bitmap Index Scan on bmsql_customer_idx1 (cost=0.00..40.16 rows=3598 width=0)
Index Cond: ((bmsql_customer.c_w_id = 1) AND (bmsql_customer.c_d_id = 1))
Remote node: 16386
(12 rows)" " QUERY PLAN
<a href=#12-rows--------------------------------------------query-plan-2 class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s81-1-1--------------------------------------------------------------query-plan>
Cluster Merge Gather (cost=10991.69..10991.69 rows=4 width=0)
Remote node: 16386,16387
Sort Key: bmsql_customer.c_first
-> Sort (cost=10991.61..10991.61 rows=2 width=16)
Output: c_id, c_first
Sort Key: bmsql_customer.c_first
-> Bitmap Heap Scan on public.bmsql_customer (cost=34.17..10991.60 rows=2 width=16)
Output: c_id, c_first
Recheck Cond: ((bmsql_customer.c_w_id = $1) AND (bmsql_customer.c_d_id = $2))
Filter: ((bmsql_customer.c_last)::bpchar = $3)
-> Bitmap Index Scan on bmsql_customer_idx1 (cost=0.00..34.17 rows=2999 width=0)
Index Cond: ((bmsql_customer.c_w_id = $1) AND (bmsql_customer.c_d_id = $2))
Remote node: 16386,16387
(13 rows)" 茅晓萍
&ldquo;prepare s8(int, int, int) as update bmsql_district set d_ytd = d_ytd + $1 where d_w_id = $2 and d_id = $3;
explain verbose execute s8(1, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s81-1-1--------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows--------------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: (((bmsql_district.d_ytd + ($1)::numeric))::numeric(12,2))
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: UPDATE public.bmsql_district bmsql_district SET d_ytd = (d_ytd + ($1)::numeric) WHERE ((d_w_id = $2) AND (d_id = $3))
(5 rows)" " QUERY PLAN
<a href=#5-rows--------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows------------------------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: (((bmsql_district.d_ytd + ($1)::numeric))::numeric(12,2))
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: UPDATE public.bmsql_district bmsql_district SET d_ytd = (d_ytd + ($1)::numeric) WHERE ((d_w_id = $2) AND (d_id = $3))
(5 rows)" " QUERY PLAN
<a href=#5-rows------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=7-rows------------------------------------------------------------------------query-plan>
Cluster Gather (cost=0.15..8.48 rows=1 width=111)
Remote node: 16386
-> Update on public.bmsql_district (cost=0.15..8.18 rows=1 width=111)
-> Index Scan using bmsql_district_pkey on public.bmsql_district (cost=0.15..8.18 rows=1 width=111)
Output: d_w_id, d_id, (d_ytd + &lsquo;1&rsquo;::numeric), d_tax, d_next_o_id, d_name, d_street_1, d_street_2, d_city, d_state, d_zip, ctid, xc_node_id
Index Cond: ((bmsql_district.d_w_id = 1) AND (bmsql_district.d_id = 1))
Remote node: 16386
(7 rows)" " QUERY PLAN
<a href=#7-rows------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s91-1-1----------------------------------------------------------------query-plan>
Cluster Gather (cost=0.15..8.78 rows=2 width=111)
Remote node: 16386,16387
-> Update on public.bmsql_district (cost=0.15..8.18 rows=1 width=111)
-> Index Scan using bmsql_district_pkey on public.bmsql_district (cost=0.15..8.18 rows=1 width=111)
Output: d_w_id, d_id, (d_ytd + ($1)::numeric), d_tax, d_next_o_id, d_name, d_street_1, d_street_2, d_city, d_state, d_zip, ctid, xc_node_id
Index Cond: ((bmsql_district.d_w_id = $2) AND (bmsql_district.d_id = $3))
Remote node: 16386,16387
(7 rows)"
&ldquo;prepare s9(int, int, int) as select sum(ol_amount) as sum_ol_amount from bmsql_order_line where ol_w_id = $1 and ol_d_id = $2 and ol_o_id = $3;
explain verbose execute s9(1, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s91-1-1----------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=8-rows-------------------------------------------------------------------query-plan>
Cluster Gather (cost=44.42..44.73 rows=1 width=32)
Remote node: 16386
-> Aggregate (cost=44.42..44.43 rows=1 width=32)
Output: sum(ol_amount)
-> Index Scan using bmsql_order_line_pkey on public.bmsql_order_line (cost=0.19..44.40 rows=5 width=4)
Output: ol_w_id, ol_d_id, ol_o_id, ol_number, ol_i_id, ol_delivery_d, ol_amount, ol_supply_w_id, ol_quantity, ol_dist_info
Index Cond: ((bmsql_order_line.ol_w_id = 1) AND (bmsql_order_line.ol_d_id = 1) AND (bmsql_order_line.ol_o_id = 1))
Remote node: 16386
(8 rows)" " QUERY PLAN
<a href=#8-rows-------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=10-rows----------------------------------------------------------------query-plan>
Finalize Aggregate (cost=45.04..45.05 rows=1 width=32)
Output: sum(ol_amount)
-> Cluster Gather (cost=44.42..45.03 rows=2 width=32)
Remote node: 16386,16387
-> Partial Aggregate (cost=44.42..44.43 rows=1 width=32)
Output: PARTIAL sum(ol_amount)
-> Index Scan using bmsql_order_line_pkey on public.bmsql_order_line (cost=0.19..44.40 rows=5 width=4)
Output: ol_w_id, ol_d_id, ol_o_id, ol_number, ol_i_id, ol_delivery_d, ol_amount, ol_supply_w_id, ol_quantity, ol_dist_info
Index Cond: ((bmsql_order_line.ol_w_id = $1) AND (bmsql_order_line.ol_d_id = $2) AND (bmsql_order_line.ol_o_id = $3))
Remote node: 16386,16387
(10 rows)" " QUERY PLAN
<a href=#10-rows----------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=8-rows-------------------------------------------------------------------query-plan-1>
Cluster Gather (cost=44.42..44.73 rows=1 width=32)
Remote node: 16386
-> Aggregate (cost=44.42..44.43 rows=1 width=32)
Output: sum(ol_amount)
-> Index Scan using bmsql_order_line_pkey on public.bmsql_order_line (cost=0.19..44.40 rows=5 width=4)
Output: ol_w_id, ol_d_id, ol_o_id, ol_number, ol_i_id, ol_delivery_d, ol_amount, ol_supply_w_id, ol_quantity, ol_dist_info
Index Cond: ((bmsql_order_line.ol_w_id = 1) AND (bmsql_order_line.ol_d_id = 1) AND (bmsql_order_line.ol_o_id = 1))
Remote node: 16386
(8 rows)" " QUERY PLAN
<a href=#8-rows-------------------------------------------------------------------query-plan-1 class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s101-1--------------------------------------------------------------------------query-plan>
Finalize Aggregate (cost=45.04..45.05 rows=1 width=32)
Output: sum(ol_amount)
-> Cluster Gather (cost=44.42..45.03 rows=2 width=32)
Remote node: 16386,16387
-> Partial Aggregate (cost=44.42..44.43 rows=1 width=32)
Output: PARTIAL sum(ol_amount)
-> Index Scan using bmsql_order_line_pkey on public.bmsql_order_line (cost=0.19..44.40 rows=5 width=4)
Output: ol_w_id, ol_d_id, ol_o_id, ol_number, ol_i_id, ol_delivery_d, ol_amount, ol_supply_w_id, ol_quantity, ol_dist_info
Index Cond: ((bmsql_order_line.ol_w_id = $1) AND (bmsql_order_line.ol_d_id = $2) AND (bmsql_order_line.ol_o_id = $3))
Remote node: 16386,16387
(10 rows)" 李建国
" prepare s10(int, int) as select d_name, d_street_1, d_street_2, d_city, d_state, d_zip from bmsql_district where d_w_id = $1 and d_id = $2;
explain verbose execute s10(1, 1);" " QUERY PLAN
<a href=#explain-verbose-execute-s101-1--------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows--------------------------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_district.d_name, bmsql_district.d_street_1, bmsql_district.d_street_2, bmsql_district.d_city, bmsql_district.d_state, bmsql_district.d_zip
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT d_name, d_street_1, d_street_2, d_city, d_state, d_zip FROM public.bmsql_district bmsql_district WHERE ((d_w_id = $1) AND (d_id = $2))
(5 rows)" " QUERY PLAN
<a href=#5-rows--------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows-----------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_district.d_name, bmsql_district.d_street_1, bmsql_district.d_street_2, bmsql_district.d_city, bmsql_district.d_state, bmsql_district.d_zip
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT d_name, d_street_1, d_street_2, d_city, d_state, d_zip FROM public.bmsql_district bmsql_district WHERE ((d_w_id = $1) AND (d_id = $2))
(5 rows)" " QUERY PLAN
<a href=#5-rows-----------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=6-rows-----------------------------------------------query-plan>
Cluster Gather (cost=0.15..8.47 rows=1 width=68)
Remote node: 16386
-> Index Scan using bmsql_district_pkey on public.bmsql_district (cost=0.15..8.17 rows=1 width=68)
Output: d_name, d_street_1, d_street_2, d_city, d_state, d_zip
Index Cond: ((bmsql_district.d_w_id = 1) AND (bmsql_district.d_id = 1))
Remote node: 16386
(6 rows)" " QUERY PLAN
<a href=#6-rows-----------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s11warehouses-----------------------------------------------query-plan>
Cluster Gather (cost=0.15..8.77 rows=2 width=68)
Remote node: 16386,16387
-> Index Scan using bmsql_district_pkey on public.bmsql_district (cost=0.15..8.17 rows=1 width=68)
Output: d_name, d_street_1, d_street_2, d_city, d_state, d_zip
Index Cond: ((bmsql_district.d_w_id = $1) AND (bmsql_district.d_id = $2))
Remote node: 16386,16387
(6 rows)"
&ldquo;prepare s11(char(32)) as select cfg_value from bmsql_config where cfg_name = $1;
explain verbose execute s11(&lsquo;warehouses&rsquo;);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s11warehouses-----------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=4-rows-----------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_config.cfg_value
Node/s: dn2
Remote query: SELECT cfg_value FROM public.bmsql_config bmsql_config WHERE ((cfg_name)::bpchar = $1)
(4 rows)" " QUERY PLAN
<a href=#4-rows-----------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=4-rows--------------------------------query-plan-1>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_config.cfg_value
Node/s: dn2
Remote query: SELECT cfg_value FROM public.bmsql_config bmsql_config WHERE ((cfg_name)::bpchar = $1)
(4 rows)" " QUERY PLAN
<a href=#4-rows--------------------------------query-plan-1 class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=6-rows-------------------------------query-plan>
Cluster Gather (cost=0.00..1.35 rows=1 width=4)
Remote node: 16387
-> Seq Scan on public.bmsql_config (cost=0.00..1.05 rows=1 width=4)
Output: cfg_value
Filter: ((bmsql_config.cfg_name)::bpchar = &lsquo;warehouses&rsquo;::bpchar)
Remote node: 16386,16387
(6 rows)" " QUERY PLAN
<a href=#6-rows-------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s121-1-1-----------------------------------------------------------query-plan>
Cluster Gather (cost=0.00..1.35 rows=1 width=4)
Remote node: 16387
-> Seq Scan on public.bmsql_config (cost=0.00..1.05 rows=1 width=4)
Output: cfg_value
Filter: ((bmsql_config.cfg_name)::bpchar = $1)
Remote node: 16386,16387
(6 rows)"
&ldquo;prepare s12(int, int, int) as delete from bmsql_new_order where no_w_id = $1 and no_d_id = $2 and no_o_id = $3;
explain verbose execute s12(1, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s121-1-1-----------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=4-rows-----------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: DELETE FROM public.bmsql_new_order bmsql_new_order WHERE ((no_w_id = $1) AND (no_d_id = $2) AND (no_o_id = $3))
(4 rows)" " QUERY PLAN
<a href=#4-rows-----------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=4-rows----------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: DELETE FROM public.bmsql_new_order bmsql_new_order WHERE ((no_w_id = $1) AND (no_d_id = $2) AND (no_o_id = $3))
(4 rows)" " QUERY PLAN
<a href=#4-rows----------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=7-rows------------------------------------------------------------query-plan>
Cluster Gather (cost=0.17..8.50 rows=1 width=22)
Remote node: 16386
-> Delete on public.bmsql_new_order (cost=0.17..8.20 rows=1 width=22)
-> Index Scan using bmsql_new_order_pkey on public.bmsql_new_order (cost=0.17..8.20 rows=1 width=22)
Output: no_w_id, no_d_id, no_o_id, ctid, xc_node_id
Index Cond: ((bmsql_new_order.no_w_id = 1) AND (bmsql_new_order.no_d_id = 1) AND (bmsql_new_order.no_o_id = 1))
Remote node: 16386
(7 rows)" " QUERY PLAN
<a href=#7-rows------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s131-1-1-1-1-1-1-1-1--------------------------------------------------------------------query-plan>
Cluster Gather (cost=0.17..8.80 rows=2 width=22)
Remote node: 16386,16387
-> Delete on public.bmsql_new_order (cost=0.17..8.20 rows=1 width=22)
-> Index Scan using bmsql_new_order_pkey on public.bmsql_new_order (cost=0.17..8.20 rows=1 width=22)
Output: no_w_id, no_d_id, no_o_id, ctid, xc_node_id
Index Cond: ((bmsql_new_order.no_w_id = $1) AND (bmsql_new_order.no_d_id = $2) AND (bmsql_new_order.no_o_id = $3))
Remote node: 16386,16387
(7 rows)"
&ldquo;prepare s13(int, int, int, int, int, int, int, int, int) as insert into bmsql_order_line (ol_o_id, ol_d_id, ol_w_id, ol_number, ol_i_id, ol_supply_w_id, ol_quantity, ol_amount, ol_dist_info) values ($1, $2, $3, $4, $5, $6, $7, $8, $9);
explain verbose execute s13(1, 1, 1, 1, 1, 1, 1, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s131-1-1-1-1-1-1-1-1--------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=8-rows------------------------------------------------------------------------------------------------------------------query-plan>
Cluster Gather (cost=0.01..0.62 rows=2 width=150)
Remote node: 16386
-> Insert on public.bmsql_order_line (cost=0.01..0.03 rows=1 width=150)
-> Result (cost=0.01..0.03 rows=1 width=150)
Output: 1, 1, 1, 1, 1, NULL::timestamp without time zone, 1.00::numeric(6,2), 1, 1, &lsquo;1 &lsquo;::character(24)
Filter: (adb_node_oid() &lt;> &lsquo;12338&rsquo;::oid)
-> Result (cost=0.00..0.01 rows=1 width=150)
Output: 1, 1, 1, 1, 1, NULL::timestamp without time zone, 1.00::numeric(6,2), 1, 1, &lsquo;1 &lsquo;::character(24)
(8 rows)" " QUERY PLAN
<a href=#8-rows------------------------------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=7-rows--------------------------------------------------------------------query-plan>
Insert on public.bmsql_order_line (cost=0.00..0.02 rows=1 width=150)
Primary node/s: dn1
Node/s: dn1, dn2
Node expr: bmsql_order_line.ol_w_id
Remote query: INSERT INTO public.bmsql_order_line AS bmsql_order_line (ol_w_id, ol_d_id, ol_o_id, ol_number, ol_i_id, ol_delivery_d, ol_amount, ol_supply_w_id, ol_quantity, ol_dist_info) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)
-> Result (cost=0.00..0.02 rows=1 width=150)
Output: $3, $2, $1, $4, $5, NULL::timestamp without time zone, $8, $6, $7, $9
(7 rows)" " QUERY PLAN
<a href=#7-rows--------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=8-rows------------------------------------------------------------------------------------------------------------------query-plan-1>
Cluster Gather (cost=0.01..0.62 rows=2 width=150)
Remote node: 16386
-> Insert on public.bmsql_order_line (cost=0.01..0.03 rows=1 width=150)
-> Result (cost=0.01..0.03 rows=1 width=150)
Output: 1, 1, 1, 1, 1, NULL::timestamp without time zone, 1.00::numeric(6,2), 1, 1, &lsquo;1 &lsquo;::character(24)
Filter: (adb_node_oid() &lt;> &lsquo;12338&rsquo;::oid)
-> Result (cost=0.00..0.01 rows=1 width=150)
Output: 1, 1, 1, 1, 1, NULL::timestamp without time zone, 1.00::numeric(6,2), 1, 1, &lsquo;1 &lsquo;::character(24)
(8 rows)" " QUERY PLAN
<a href=#8-rows------------------------------------------------------------------------------------------------------------------query-plan-1 class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s141-1-1-----------------------------------------------------------query-plan>
Insert on public.bmsql_order_line (cost=0.00..0.02 rows=1 width=150)
Primary node/s: dn1
Node/s: dn1, dn2
Node expr: bmsql_order_line.ol_w_id
Remote query: INSERT INTO public.bmsql_order_line AS bmsql_order_line (ol_w_id, ol_d_id, ol_o_id, ol_number, ol_i_id, ol_delivery_d, ol_amount, ol_supply_w_id, ol_quantity, ol_dist_info) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)
-> Result (cost=0.00..0.02 rows=1 width=150)
Output: $3, $2, $1, $4, $5, NULL::timestamp without time zone, $8, $6, $7, $9
(7 rows)"
&ldquo;prepare s14(int, int, int) as select c_data from bmsql_customer where c_w_id = $1 and c_d_id = $2 and c_id = $3;
explain verbose execute s14(1, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s141-1-1-----------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows-----------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_customer.c_data
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT c_data FROM public.bmsql_customer bmsql_customer WHERE ((c_w_id = $1) AND (c_d_id = $2) AND (c_id = $3))
(5 rows)" " QUERY PLAN
<a href=#5-rows-----------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows---------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_customer.c_data
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT c_data FROM public.bmsql_customer bmsql_customer WHERE ((c_w_id = $1) AND (c_d_id = $2) AND (c_id = $3))
(5 rows)" " QUERY PLAN
<a href=#5-rows---------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=6-rows-----------------------------------------------------query-plan>
Cluster Gather (cost=0.18..8.50 rows=1 width=403)
Remote node: 16386
-> Index Scan using bmsql_customer_pkey on public.bmsql_customer (cost=0.18..8.20 rows=1 width=403)
Output: c_data
Index Cond: ((bmsql_customer.c_w_id = 1) AND (bmsql_customer.c_d_id = 1) AND (bmsql_customer.c_id = 1))
Remote node: 16386
(6 rows)" " QUERY PLAN
<a href=#6-rows-----------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s151-1-1-1--------------------------------------------------------------query-plan>
Cluster Gather (cost=0.18..8.80 rows=2 width=403)
Remote node: 16386,16387
-> Index Scan using bmsql_customer_pkey on public.bmsql_customer (cost=0.18..8.20 rows=1 width=403)
Output: c_data
Index Cond: ((bmsql_customer.c_w_id = $1) AND (bmsql_customer.c_d_id = $2) AND (bmsql_customer.c_id = $3))
Remote node: 16386,16387
(6 rows)"
&ldquo;prepare s15(int, int, int, int) as update bmsql_oorder set o_carrier_id = $1 where o_w_id = $2 and o_d_id = $3 and o_id = $4;
explain verbose execute s15(1, 1, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s151-1-1-1--------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows--------------------------------------------------------------query-plan-1>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: ($1)
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: UPDATE public.bmsql_oorder bmsql_oorder SET o_carrier_id = $1 WHERE ((o_w_id = $2) AND (o_d_id = $3) AND (o_id = $4))
(5 rows)" " QUERY PLAN
<a href=#5-rows--------------------------------------------------------------query-plan-1 class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows---------------------------------------------------query-plan-1>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: ($1)
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: UPDATE public.bmsql_oorder bmsql_oorder SET o_carrier_id = $1 WHERE ((o_w_id = $2) AND (o_d_id = $3) AND (o_id = $4))
(5 rows)" " QUERY PLAN
<a href=#5-rows---------------------------------------------------query-plan-1 class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=7-rows-----------------------------------------------------query-plan>
Cluster Gather (cost=0.18..8.50 rows=1 width=46)
Remote node: 16386
-> Update on public.bmsql_oorder (cost=0.18..8.20 rows=1 width=46)
-> Index Scan using bmsql_oorder_pkey on public.bmsql_oorder (cost=0.18..8.20 rows=1 width=46)
Output: o_w_id, o_d_id, o_id, o_c_id, 1, o_ol_cnt, o_all_local, o_entry_d, ctid, xc_node_id
Index Cond: ((bmsql_oorder.o_w_id = 1) AND (bmsql_oorder.o_d_id = 1) AND (bmsql_oorder.o_id = 1))
Remote node: 16386
(7 rows)" " QUERY PLAN
<a href=#7-rows-----------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s161-1-1-1-1-1-------------------------------------------------------------------------------------------------------------query-plan>
Cluster Gather (cost=0.18..8.80 rows=2 width=46)
Remote node: 16386,16387
-> Update on public.bmsql_oorder (cost=0.18..8.20 rows=1 width=46)
-> Index Scan using bmsql_oorder_pkey on public.bmsql_oorder (cost=0.18..8.20 rows=1 width=46)
Output: o_w_id, o_d_id, o_id, o_c_id, $1, o_ol_cnt, o_all_local, o_entry_d, ctid, xc_node_id
Index Cond: ((bmsql_oorder.o_w_id = $2) AND (bmsql_oorder.o_d_id = $3) AND (bmsql_oorder.o_id = $4))
Remote node: 16386,16387
(7 rows)"
&ldquo;prepare s16(int, int, int, int, int, int) as select o_id, o_entry_d, o_carrier_id from bmsql_oorder where o_w_id = $1 and o_d_id = $2 and o_c_id = $3 and o_id = (select max(o_id) from bmsql_oorder where o_w_id = $4 and o_d_id = $5 and o_c_id = $6);
explain verbose execute s16(1, 1, 1, 1, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s161-1-1-1-1-1-------------------------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=17-rows-------------------------------------------------------------------------------------------------------------------query-plan>
Cluster Gather (cost=2787000.19..2787008.51 rows=1 width=16)
Remote node: 16386
-> Index Scan using bmsql_oorder_pkey on public.bmsql_oorder (cost=0.18..8.20 rows=1 width=16)
Output: bmsql_oorder.o_id, bmsql_oorder.o_entry_d, bmsql_oorder.o_carrier_id
Index Cond: ((bmsql_oorder.o_w_id = 1) AND (bmsql_oorder.o_d_id = 1) AND (bmsql_oorder.o_id = $0))
Filter: (bmsql_oorder.o_c_id = 1)
Remote node: 16386
InitPlan 1 (returns $0)
-> Aggregate (cost=9655.39..9655.40 rows=1 width=4)
Output: max(bmsql_oorder_1.o_id)
-> Bitmap Heap Scan on public.bmsql_oorder bmsql_oorder_1 (cost=39.44..9655.39 rows=1 width=4)
Output: bmsql_oorder_1.o_w_id, bmsql_oorder_1.o_d_id, bmsql_oorder_1.o_id, bmsql_oorder_1.o_c_id, bmsql_oorder_1.o_carrier_id, bmsql_oorder_1.o_ol_cnt, bmsql_oorder_1.o_all_local, bmsql_oorder_1.o_entry_d
Recheck Cond: ((bmsql_oorder_1.o_w_id = 1) AND (bmsql_oorder_1.o_d_id = 1))
Filter: (bmsql_oorder_1.o_c_id = 1)
-> Bitmap Index Scan on bmsql_oorder_idx1 (cost=0.00..39.44 rows=3526 width=0)
Index Cond: ((bmsql_oorder_1.o_w_id = 1) AND (bmsql_oorder_1.o_d_id = 1))
Remote node: 16386
(17 rows)" " QUERY PLAN
<a href=#17-rows-------------------------------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=21-rows-------------------------------------------------------------------------------------------------------------query-plan>
Cluster Gather (cost=2787000.19..2787008.81 rows=2 width=16)
Remote node: 16386,16387
-> Index Scan using bmsql_oorder_pkey on public.bmsql_oorder (cost=0.18..8.20 rows=1 width=16)
Output: bmsql_oorder.o_id, bmsql_oorder.o_entry_d, bmsql_oorder.o_carrier_id
Index Cond: ((bmsql_oorder.o_w_id = $1) AND (bmsql_oorder.o_d_id = $2) AND (bmsql_oorder.o_id = $0))
Filter: (bmsql_oorder.o_c_id = $3)
Remote node: 16386,16387
InitPlan 1 (returns $0)
-> Cluster Reduce (cost=8626.36..8629.67 rows=1 width=4)
Reduce: unnest('[0:2]={12338,16386,16387}'::oid[])
-> Aggregate (cost=8625.36..8625.37 rows=1 width=4)
Output: max(bmsql_oorder_1.o_id)
-> Cluster Reduce (cost=35.62..8625.36 rows=2 width=4)
Reduce: &lsquo;12338&rsquo;::oid
-> Bitmap Heap Scan on public.bmsql_oorder bmsql_oorder_1 (cost=34.62..8620.76 rows=1 width=4)
Output: bmsql_oorder_1.o_w_id, bmsql_oorder_1.o_d_id, bmsql_oorder_1.o_id, bmsql_oorder_1.o_c_id, bmsql_oorder_1.o_carrier_id, bmsql_oorder_1.o_ol_cnt, bmsql_oorder_1.o_all_local, bmsql_oorder_1.o_entry_d
Recheck Cond: ((bmsql_oorder_1.o_w_id = $4) AND (bmsql_oorder_1.o_d_id = $5))
Filter: (bmsql_oorder_1.o_c_id = $6)
-> Bitmap Index Scan on bmsql_oorder_idx1 (cost=0.00..34.62 rows=3044 width=0)
Index Cond: ((bmsql_oorder_1.o_w_id = $4) AND (bmsql_oorder_1.o_d_id = $5))
Remote node: 16386,16387
(21 rows)" " QUERY PLAN
<a href=#21-rows-------------------------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=17-rows-------------------------------------------------------------------------------------------------------------------query-plan-1>
Cluster Gather (cost=2787000.19..2787008.51 rows=1 width=16)
Remote node: 16386
-> Index Scan using bmsql_oorder_pkey on public.bmsql_oorder (cost=0.18..8.20 rows=1 width=16)
Output: bmsql_oorder.o_id, bmsql_oorder.o_entry_d, bmsql_oorder.o_carrier_id
Index Cond: ((bmsql_oorder.o_w_id = 1) AND (bmsql_oorder.o_d_id = 1) AND (bmsql_oorder.o_id = $0))
Filter: (bmsql_oorder.o_c_id = 1)
Remote node: 16386
InitPlan 1 (returns $0)
-> Aggregate (cost=9655.39..9655.40 rows=1 width=4)
Output: max(bmsql_oorder_1.o_id)
-> Bitmap Heap Scan on public.bmsql_oorder bmsql_oorder_1 (cost=39.44..9655.39 rows=1 width=4)
Output: bmsql_oorder_1.o_w_id, bmsql_oorder_1.o_d_id, bmsql_oorder_1.o_id, bmsql_oorder_1.o_c_id, bmsql_oorder_1.o_carrier_id, bmsql_oorder_1.o_ol_cnt, bmsql_oorder_1.o_all_local, bmsql_oorder_1.o_entry_d
Recheck Cond: ((bmsql_oorder_1.o_w_id = 1) AND (bmsql_oorder_1.o_d_id = 1))
Filter: (bmsql_oorder_1.o_c_id = 1)
-> Bitmap Index Scan on bmsql_oorder_idx1 (cost=0.00..39.44 rows=3526 width=0)
Index Cond: ((bmsql_oorder_1.o_w_id = 1) AND (bmsql_oorder_1.o_d_id = 1))
Remote node: 16386
(17 rows)" " QUERY PLAN
<a href=#17-rows-------------------------------------------------------------------------------------------------------------------query-plan-1 class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s171-1-1-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------query-plan>
Cluster Gather (cost=2787000.19..2787008.81 rows=2 width=16)
Remote node: 16386,16387
-> Index Scan using bmsql_oorder_pkey on public.bmsql_oorder (cost=0.18..8.20 rows=1 width=16)
Output: bmsql_oorder.o_id, bmsql_oorder.o_entry_d, bmsql_oorder.o_carrier_id
Index Cond: ((bmsql_oorder.o_w_id = $1) AND (bmsql_oorder.o_d_id = $2) AND (bmsql_oorder.o_id = $0))
Filter: (bmsql_oorder.o_c_id = $3)
Remote node: 16386,16387
InitPlan 1 (returns $0)
-> Cluster Reduce (cost=8626.36..8629.67 rows=1 width=4)
Reduce: unnest('[0:2]={12338,16386,16387}'::oid[])
-> Aggregate (cost=8625.36..8625.37 rows=1 width=4)
Output: max(bmsql_oorder_1.o_id)
-> Cluster Reduce (cost=35.62..8625.36 rows=2 width=4)
Reduce: &lsquo;12338&rsquo;::oid
-> Bitmap Heap Scan on public.bmsql_oorder bmsql_oorder_1 (cost=34.62..8620.76 rows=1 width=4)
Output: bmsql_oorder_1.o_w_id, bmsql_oorder_1.o_d_id, bmsql_oorder_1.o_id, bmsql_oorder_1.o_c_id, bmsql_oorder_1.o_carrier_id, bmsql_oorder_1.o_ol_cnt, bmsql_oorder_1.o_all_local, bmsql_oorder_1.o_entry_d
Recheck Cond: ((bmsql_oorder_1.o_w_id = $4) AND (bmsql_oorder_1.o_d_id = $5))
Filter: (bmsql_oorder_1.o_c_id = $6)
-> Bitmap Index Scan on bmsql_oorder_idx1 (cost=0.00..34.62 rows=3044 width=0)
Index Cond: ((bmsql_oorder_1.o_w_id = $4) AND (bmsql_oorder_1.o_d_id = $5))
Remote node: 16386,16387
(21 rows)" 李建国 对只有一个wid是否可以走RemoteQuery
&ldquo;prepare s17(int, int, int) as select c_first, c_middle, c_last, c_street_1, c_street_2, c_city, c_state, c_zip, c_phone, c_since, c_credit, c_credit_lim, c_discount, c_balance from bmsql_customer where c_w_id = $1 and c_d_id = $2 and c_id = $3 for update;
explain verbose execute s17(1, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s171-1-1-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_customer.c_first, bmsql_customer.c_middle, bmsql_customer.c_last, bmsql_customer.c_street_1, bmsql_customer.c_street_2, bmsql_customer.c_city, bmsql_customer.c_state, bmsql_customer.c_zip, bmsql_customer.c_phone, bmsql_customer.c_since, bmsql_customer.c_credit, bmsql_customer.c_credit_lim, bmsql_customer.c_discount, bmsql_customer.c_balance
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT c_first, c_middle, c_last, c_street_1, c_street_2, c_city, c_state, c_zip, c_phone, c_since, c_credit, c_credit_lim, c_discount, c_balance FROM public.bmsql_customer bmsql_customer WHERE ((c_w_id = $1) AND (c_d_id = $2) AND (c_id = $3)) FOR UPDATE OF bmsql_customer
(5 rows)" " QUERY PLAN
<a href=#5-rows-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_customer.c_first, bmsql_customer.c_middle, bmsql_customer.c_last, bmsql_customer.c_street_1, bmsql_customer.c_street_2, bmsql_customer.c_city, bmsql_customer.c_state, bmsql_customer.c_zip, bmsql_customer.c_phone, bmsql_custom
er.c_since, bmsql_customer.c_credit, bmsql_customer.c_credit_lim, bmsql_customer.c_discount, bmsql_customer.c_balance
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT c_first, c_middle, c_last, c_street_1, c_street_2, c_city, c_state, c_zip, c_phone, c_since, c_credit, c_credit_lim, c_discount, c_balance FROM public.bmsql_customer bmsql_customer WHERE ((c_w_id = $1) AND (c_d_id = $2
) AND (c_id = $3)) FOR UPDATE OF bmsql_customer
(5 rows)" " QUERY PLAN
<a href=#5-rows----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<p>LockRows (cost=0.00..2952686.17 rows=1 width=130)
Output: bmsql_customer.c_first, bmsql_customer.c_middle, bmsql_customer.c_last, bmsql_customer.c_street_1, bmsql_customer.c_street_2, bmsql_customer.c_city, bmsql_customer.c_state, bmsql_customer.c_zip, bmsql_customer.c_phone, bmsql_custom
er.c_since, bmsql_customer.c_credit, bmsql_customer.c_credit_lim, bmsql_customer.c_discount, bmsql_customer.c_balance
-> Data Node Scan on bmsql_customer &ldquo;"<em>REMOTE_TABLE_QUERY</em>&rdquo;" (cost=0.00..2952686.16 rows=1 width=130)
Output: bmsql_customer.c_first, bmsql_customer.c_middle, bmsql_customer.c_last, bmsql_customer.c_street_1, bmsql_customer.c_street_2, bmsql_customer.c_city, bmsql_customer.c_state, bmsql_customer.c_zip, bmsql_customer.c_phone, bmsql_
customer.c_since, bmsql_customer.c_credit, bmsql_customer.c_credit_lim, bmsql_customer.c_discount, bmsql_customer.c_balance
Primary node/s: dn1
Node/s: dn1
Remote query: SELECT c_first, c_middle, c_last, c_street_1, c_street_2, c_city, c_state, c_zip, c_phone, c_since, c_credit, c_credit_lim, c_discount, c_balance FROM ONLY public.bmsql_customer bmsql_customer WHERE ((c_w_id = 1) AND (c
_d_id = 1) AND (c_id = 1)) FOR UPDATE OF bmsql_customer
(7 rows)" " QUERY PLAN</p>
<hr>
<h2 id=explain-verbose-execute-s181-1-1-1-----------------------------------------------------------------------------------------------query-plan>
LockRows (cost=0.00..2952686.17 rows=1 width=130)
Output: bmsql_customer.c_first, bmsql_customer.c_middle, bmsql_customer.c_last, bmsql_customer.c_street_1, bmsql_customer.c_street_2, bmsql_customer.c_city, bmsql_customer.c_state, bmsql_customer.c_zip, bmsql_customer.c_phone, bmsql_custom
er.c_since, bmsql_customer.c_credit, bmsql_customer.c_credit_lim, bmsql_customer.c_discount, bmsql_customer.c_balance
-> Data Node Scan on bmsql_customer &ldquo;"<em>REMOTE_TABLE_QUERY</em>&rdquo;" (cost=0.00..2952686.16 rows=1 width=130)
Output: bmsql_customer.c_first, bmsql_customer.c_middle, bmsql_customer.c_last, bmsql_customer.c_street_1, bmsql_customer.c_street_2, bmsql_customer.c_city, bmsql_customer.c_state, bmsql_customer.c_zip, bmsql_customer.c_phone, bmsql_
customer.c_since, bmsql_customer.c_credit, bmsql_customer.c_credit_lim, bmsql_customer.c_discount, bmsql_customer.c_balance
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT c_first, c_middle, c_last, c_street_1, c_street_2, c_city, c_state, c_zip, c_phone, c_since, c_credit, c_credit_lim, c_discount, c_balance FROM ONLY public.bmsql_customer bmsql_customer WHERE ((c_w_id = $1) AND (
c_d_id = $2) AND (c_id = $3)) FOR UPDATE OF bmsql_customer
(7 rows)"
&ldquo;prepare s18(int, int, int, int) as update bmsql_customer set c_balance = c_balance + $1, c_delivery_cnt = c_delivery_cnt + 1 where c_w_id = $2 and c_d_id = $3 and c_id = $4;
explain verbose execute s18(1, 1, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s181-1-1-1-----------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows-----------------------------------------------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: (((bmsql_customer.c_balance + ($1)::numeric))::numeric(12,2)), ((bmsql_customer.c_delivery_cnt + 1))
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: UPDATE public.bmsql_customer bmsql_customer SET c_balance = (c_balance + ($1)::numeric), c_delivery_cnt = (c_delivery_cnt + 1) WHERE ((c_w_id = $2) AND (c_d_id = $3) AND (c_id = $4))
(5 rows)" " QUERY PLAN
<a href=#5-rows-----------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows--------------------------------------------------------------------------------------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: (((bmsql_customer.c_balance + ($1)::numeric))::numeric(12,2)), ((bmsql_customer.c_delivery_cnt + 1))
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: UPDATE public.bmsql_customer bmsql_customer SET c_balance = (c_balance + ($1)::numeric), c_delivery_cnt = (c_delivery_cnt + 1) WHERE ((c_w_id = $2) AND (c_d_id = $3) AND (c_id = $4))
(5 rows)" " QUERY PLAN
<a href=#5-rows--------------------------------------------------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<p>Cluster Gather (cost=0.18..8.51 rows=1 width=579)
Remote node: 16386
-> Update on public.bmsql_customer (cost=0.18..8.21 rows=1 width=579)
-> Index Scan using bmsql_customer_pkey on public.bmsql_customer (cost=0.18..8.21 rows=1 width=579)
Output: c_w_id, c_d_id, c_id, c_discount, c_credit, c_last, c_first, c_credit_lim, (c_balance + &lsquo;1&rsquo;::numeric), c_ytd_payment, c_payment_cnt, (c_delivery_cnt + 1), c_street_1, c_street_2, c_city, c_state, c_zip, c_phone, c_since
, c_middle, c_data, ctid, xc_node_id
Index Cond: ((bmsql_customer.c_w_id = 1) AND (bmsql_customer.c_d_id = 1) AND (bmsql_customer.c_id = 1))
Remote node: 16386
(7 rows)" " QUERY PLAN</p>
<hr>
<h2 id=explain-verbose-execute-s191-1-1---------------------------------------------------------query-plan>
Cluster Gather (cost=0.18..8.81 rows=2 width=579)
Remote node: 16386,16387
-> Update on public.bmsql_customer (cost=0.18..8.21 rows=1 width=579)
-> Index Scan using bmsql_customer_pkey on public.bmsql_customer (cost=0.18..8.21 rows=1 width=579)
Output: c_w_id, c_d_id, c_id, c_discount, c_credit, c_last, c_first, c_credit_lim, (c_balance + ($1)::numeric), c_ytd_payment, c_payment_cnt, (c_delivery_cnt + 1), c_street_1, c_street_2, c_city, c_state, c_zip, c_phone, c_sinc
e, c_middle, c_data, ctid, xc_node_id
Index Cond: ((bmsql_customer.c_w_id = $2) AND (bmsql_customer.c_d_id = $3) AND (bmsql_customer.c_id = $4))
Remote node: 16386,16387
(7 rows)
"
&ldquo;prepare s19(int, int, int) as select ol_i_id, ol_supply_w_id, ol_quantity, ol_amount, ol_delivery_d from bmsql_order_line where ol_w_id = $1 and ol_d_id = $2 and ol_o_id = $3 order by ol_w_id, ol_d_id, ol_o_id, ol_number;
explain verbose execute s19(1, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s191-1-1---------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=6-rows----------------------------------------------------------query-plan>
Cluster Gather (cost=0.19..45.90 rows=5 width=40)
Remote node: 16386
-> Index Scan using bmsql_order_line_pkey on public.bmsql_order_line (cost=0.19..44.40 rows=5 width=40)
Output: ol_i_id, ol_supply_w_id, ol_quantity, ol_amount, ol_delivery_d, ol_w_id, ol_d_id, ol_o_id, ol_number
Index Cond: ((bmsql_order_line.ol_w_id = 1) AND (bmsql_order_line.ol_d_id = 1) AND (bmsql_order_line.ol_o_id = 1))
Remote node: 16386
(6 rows)" " QUERY PLAN
<a href=#6-rows----------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=7-rows---------------------------------------------------------query-plan>
Cluster Merge Gather (cost=0.39..44.60 rows=10 width=0)
Remote node: 16386,16387
Sort Key: bmsql_order_line.ol_number
-> Index Scan using bmsql_order_line_pkey on public.bmsql_order_line (cost=0.19..44.40 rows=5 width=40)
Output: ol_i_id, ol_supply_w_id, ol_quantity, ol_amount, ol_delivery_d, ol_w_id, ol_d_id, ol_o_id, ol_number
Index Cond: ((bmsql_order_line.ol_w_id = $1) AND (bmsql_order_line.ol_d_id = $2) AND (bmsql_order_line.ol_o_id = $3))
Remote node: 16386,16387
(7 rows)" " QUERY PLAN
<a href=#7-rows---------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=6-rows----------------------------------------------------------query-plan-1>
Cluster Gather (cost=0.19..45.90 rows=5 width=40)
Remote node: 16386
-> Index Scan using bmsql_order_line_pkey on public.bmsql_order_line (cost=0.19..44.40 rows=5 width=40)
Output: ol_i_id, ol_supply_w_id, ol_quantity, ol_amount, ol_delivery_d, ol_w_id, ol_d_id, ol_o_id, ol_number
Index Cond: ((bmsql_order_line.ol_w_id = 1) AND (bmsql_order_line.ol_d_id = 1) AND (bmsql_order_line.ol_o_id = 1))
Remote node: 16386
(6 rows)" " QUERY PLAN
<a href=#6-rows----------------------------------------------------------query-plan-1 class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s201-1-1-1-1-1---------------------------------------------------------------------------------------------------------------------------------------------------------query-plan>
Cluster Merge Gather (cost=0.39..44.60 rows=10 width=0)
Remote node: 16386,16387
Sort Key: bmsql_order_line.ol_number
-> Index Scan using bmsql_order_line_pkey on public.bmsql_order_line (cost=0.19..44.40 rows=5 width=40)
Output: ol_i_id, ol_supply_w_id, ol_quantity, ol_amount, ol_delivery_d, ol_w_id, ol_d_id, ol_o_id, ol_number
Index Cond: ((bmsql_order_line.ol_w_id = $1) AND (bmsql_order_line.ol_d_id = $2) AND (bmsql_order_line.ol_o_id = $3))
Remote node: 16386,16387
(7 rows)" 茅晓萍
&ldquo;prepare s20(int, int, int, int, int, int) as update bmsql_customer set c_balance = c_balance - $1, c_ytd_payment = c_ytd_payment + $2, c_payment_cnt = c_payment_cnt + 1, c_data = $3 where c_w_id = $4 and c_d_id = $5 and c_id = $6;
explain verbose execute s20(1, 1, 1, 1, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s201-1-1-1-1-1---------------------------------------------------------------------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<p>Cluster Gather (cost=0.18..8.51 rows=1 width=703)
Remote node: 16386
-> Update on public.bmsql_customer (cost=0.18..8.21 rows=1 width=703)
-> Index Scan using bmsql_customer_pkey on public.bmsql_customer (cost=0.18..8.21 rows=1 width=703)
Output: c_w_id, c_d_id, c_id, c_discount, c_credit, c_last, c_first, c_credit_lim, (c_balance - &lsquo;1&rsquo;::numeric), (c_ytd_payment + &lsquo;1&rsquo;::numeric), (c_payment_cnt + 1), c_delivery_cnt, c_street_1, c_street_2, c_city, c_state, c_zip, c_phone, c_since, c_middle, &lsquo;1&rsquo;::character varying(500), ctid, xc_node_id
Index Cond: ((bmsql_customer.c_w_id = 1) AND (bmsql_customer.c_d_id = 1) AND (bmsql_customer.c_id = 1))
Remote node: 16386
(7 rows)" " QUERY PLAN</p>
<hr>
<p>Cluster Gather (cost=0.18..8.83 rows=2 width=703)
Remote node: 16386,16387
-> Update on public.bmsql_customer (cost=0.18..8.23 rows=1 width=703)
-> Index Scan using bmsql_customer_pkey on public.bmsql_customer (cost=0.18..8.23 rows=1 width=703)
Output: c_w_id, c_d_id, c_id, c_discount, c_credit, c_last, c_first, c_credit_lim, (c_balance - ($1)::numeric), (c_ytd_payment + ($2)::numeric), (c_payment_cnt + 1), c_delivery_cnt, c_street_1, c_street_2, c_city, c_state, c_zi
p, c_phone, c_since, c_middle, $3, ctid, xc_node_id
Index Cond: ((bmsql_customer.c_w_id = $4) AND (bmsql_customer.c_d_id = $5) AND (bmsql_customer.c_id = $6))
Remote node: 16386,16387
(7 rows)" " QUERY PLAN</p>
<hr>
<p>Cluster Gather (cost=0.18..8.51 rows=1 width=703)
Remote node: 16386
-> Update on public.bmsql_customer (cost=0.18..8.21 rows=1 width=703)
-> Index Scan using bmsql_customer_pkey on public.bmsql_customer (cost=0.18..8.21 rows=1 width=703)
Output: c_w_id, c_d_id, c_id, c_discount, c_credit, c_last, c_first, c_credit_lim, (c_balance - &lsquo;1&rsquo;::numeric), (c_ytd_payment + &lsquo;1&rsquo;::numeric), (c_payment_cnt + 1), c_delivery_cnt, c_street_1, c_street_2, c_city, c_state, c_zip,
c_phone, c_since, c_middle, &lsquo;1&rsquo;::character varying(500), ctid, xc_node_id
Index Cond: ((bmsql_customer.c_w_id = 1) AND (bmsql_customer.c_d_id = 1) AND (bmsql_customer.c_id = 1))
Remote node: 16386
(7 rows)" " QUERY PLAN</p>
<hr>
<h2 id=explain-verbose-execute-s211-1-1--------------------------------------------------------------------------query-plan>
Cluster Gather (cost=0.18..8.83 rows=2 width=703)
Remote node: 16386,16387
-> Update on public.bmsql_customer (cost=0.18..8.23 rows=1 width=703)
-> Index Scan using bmsql_customer_pkey on public.bmsql_customer (cost=0.18..8.23 rows=1 width=703)
Output: c_w_id, c_d_id, c_id, c_discount, c_credit, c_last, c_first, c_credit_lim, (c_balance - ($1)::numeric), (c_ytd_payment + ($2)::numeric), (c_payment_cnt + 1), c_delivery_cnt, c_street_1, c_street_2, c_city, c_state, c_zi
p, c_phone, c_since, c_middle, $3, ctid, xc_node_id
Index Cond: ((bmsql_customer.c_w_id = $4) AND (bmsql_customer.c_d_id = $5) AND (bmsql_customer.c_id = $6))
Remote node: 16386,16387
(7 rows)" 李建国
&ldquo;prepare s21(int, int, int) as select c_first, c_middle, c_last, c_balance from bmsql_customer where c_w_id = $1 and c_d_id = $2 and c_id = $3;
explain verbose execute s21(1, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s211-1-1--------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows--------------------------------------------------------------------------query-plan-1>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_customer.c_first, bmsql_customer.c_middle, bmsql_customer.c_last, bmsql_customer.c_balance
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT c_first, c_middle, c_last, c_balance FROM public.bmsql_customer bmsql_customer WHERE ((c_w_id = $1) AND (c_d_id = $2) AND (c_id = $3))
(5 rows)" " QUERY PLAN
<a href=#5-rows--------------------------------------------------------------------------query-plan-1 class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows---------------------------------------------------query-plan-2>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_customer.c_first, bmsql_customer.c_middle, bmsql_customer.c_last, bmsql_customer.c_balance
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT c_first, c_middle, c_last, c_balance FROM public.bmsql_customer bmsql_customer WHERE ((c_w_id = $1) AND (c_d_id = $2) AND (c_id = $3))
(5 rows)" " QUERY PLAN
<a href=#5-rows---------------------------------------------------query-plan-2 class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=6-rows-----------------------------------------------------query-plan-1>
Cluster Gather (cost=0.18..8.50 rows=1 width=32)
Remote node: 16386
-> Index Scan using bmsql_customer_pkey on public.bmsql_customer (cost=0.18..8.20 rows=1 width=32)
Output: c_first, c_middle, c_last, c_balance
Index Cond: ((bmsql_customer.c_w_id = 1) AND (bmsql_customer.c_d_id = 1) AND (bmsql_customer.c_id = 1))
Remote node: 16386
(6 rows)" " QUERY PLAN
<a href=#6-rows-----------------------------------------------------query-plan-1 class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s221-1-1-1-1----------------------------------------------------------------------------------------------------------------------query-plan>
Cluster Gather (cost=0.18..8.80 rows=2 width=32)
Remote node: 16386,16387
-> Index Scan using bmsql_customer_pkey on public.bmsql_customer (cost=0.18..8.20 rows=1 width=32)
Output: c_first, c_middle, c_last, c_balance
Index Cond: ((bmsql_customer.c_w_id = $1) AND (bmsql_customer.c_d_id = $2) AND (bmsql_customer.c_id = $3))
Remote node: 16386,16387
(6 rows)"
&ldquo;prepare s22(int, int, int, int, int) as update bmsql_customer set c_balance = c_balance - $1, c_ytd_payment = c_ytd_payment + $2, c_payment_cnt = c_payment_cnt + 1 where c_w_id = $3 and c_d_id = $4 and c_id = $5;
explain verbose execute s22(1, 1, 1, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s221-1-1-1-1----------------------------------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<p>Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: (((bmsql_customer.c_balance - ($1)::numeric))::numeric(12,2)), (((bmsql_customer.c_ytd_payment + ($2)::numeric))::numeric(12,2)), ((bmsql_customer.c_payment_cnt + 1))
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: UPDATE public.bmsql_customer bmsql_customer SET c_balance = (c_balance - ($1)::numeric), c_ytd_payment = (c_ytd_payment + ($2)::numeric), c_payment_cnt = (c_payment_cnt + 1) WHERE ((c_w_id = $3) AND (c_d_id = $4) AND (c_id = $5))
(5 rows)" " QUERY PLAN</p>
<hr>
<p>Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: (((bmsql_customer.c_balance - ($1)::numeric))::numeric(12,2)), (((bmsql_customer.c_ytd_payment + ($2)::numeric))::numeric(12,2)), ((bmsql_customer.c_payment_cnt + 1))
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: UPDATE public.bmsql_customer bmsql_customer SET c_balance = (c_balance - ($1)::numeric), c_ytd_payment = (c_ytd_payment + ($2)::numeric), c_payment_cnt = (c_payment_cnt + 1) WHERE ((c_w_id = $3) AND (c_d_id = $4) AND (c_id =
$5))
(5 rows)" " QUERY PLAN</p>
<hr>
<p>Cluster Gather (cost=0.18..8.51 rows=1 width=590)
Remote node: 16386
-> Update on public.bmsql_customer (cost=0.18..8.21 rows=1 width=590)
-> Index Scan using bmsql_customer_pkey on public.bmsql_customer (cost=0.18..8.21 rows=1 width=590)
Output: c_w_id, c_d_id, c_id, c_discount, c_credit, c_last, c_first, c_credit_lim, (c_balance - &lsquo;1&rsquo;::numeric), (c_ytd_payment + &lsquo;1&rsquo;::numeric), (c_payment_cnt + 1), c_delivery_cnt, c_street_1, c_street_2, c_city, c_state, c_zip,
c_phone, c_since, c_middle, c_data, ctid, xc_node_id
Index Cond: ((bmsql_customer.c_w_id = 1) AND (bmsql_customer.c_d_id = 1) AND (bmsql_customer.c_id = 1))
Remote node: 16386
(7 rows)" " QUERY PLAN</p>
<hr>
<h2 id=explain-verbose-execute-s231-1-----------------------------------------------------------------------------------------------------------------------------------------query-plan>
Cluster Gather (cost=0.18..8.82 rows=2 width=590)
Remote node: 16386,16387
-> Update on public.bmsql_customer (cost=0.18..8.22 rows=1 width=590)
-> Index Scan using bmsql_customer_pkey on public.bmsql_customer (cost=0.18..8.22 rows=1 width=590)
Output: c_w_id, c_d_id, c_id, c_discount, c_credit, c_last, c_first, c_credit_lim, (c_balance - ($1)::numeric), (c_ytd_payment + ($2)::numeric), (c_payment_cnt + 1), c_delivery_cnt, c_street_1, c_street_2, c_city, c_state, c_zi
p, c_phone, c_since, c_middle, c_data, ctid, xc_node_id
Index Cond: ((bmsql_customer.c_w_id = $3) AND (bmsql_customer.c_d_id = $4) AND (bmsql_customer.c_id = $5))
Remote node: 16386,16387
(7 rows)"
" prepare s23(int, int) as select s_quantity, s_data, s_dist_01, s_dist_02, s_dist_03, s_dist_04, s_dist_05, s_dist_06, s_dist_07, s_dist_08, s_dist_09, s_dist_10 from bmsql_stock where s_w_id = $1 and s_i_id = $2 for update;
explain verbose execute s23(1, 1);" " QUERY PLAN
<a href=#explain-verbose-execute-s231-1-----------------------------------------------------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<p>Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_stock.s_quantity, bmsql_stock.s_data, bmsql_stock.s_dist_01, bmsql_stock.s_dist_02, bmsql_stock.s_dist_03, bmsql_stock.s_dist_04, bmsql_stock.s_dist_05, bmsql_stock.s_dist_06, bmsql_stock.s_dist_07, bmsql_stock.s_dist_08, bmsql_stock.s_dist_09, bmsql_stock.s_dist_10
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT s_quantity, s_data, s_dist_01, s_dist_02, s_dist_03, s_dist_04, s_dist_05, s_dist_06, s_dist_07, s_dist_08, s_dist_09, s_dist_10 FROM public.bmsql_stock bmsql_stock WHERE ((s_w_id = $1) AND (s_i_id = $2)) FOR UPDATE OF bmsql_stock
(5 rows)" " QUERY PLAN</p>
<hr>
<p>Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_stock.s_quantity, bmsql_stock.s_data, bmsql_stock.s_dist_01, bmsql_stock.s_dist_02, bmsql_stock.s_dist_03, bmsql_stock.s_dist_04, bmsql_stock.s_dist_05, bmsql_stock.s_dist_06, bmsql_stock.s_dist_07, bmsql_stock.s_dist_08, bms
ql_stock.s_dist_09, bmsql_stock.s_dist_10
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT s_quantity, s_data, s_dist_01, s_dist_02, s_dist_03, s_dist_04, s_dist_05, s_dist_06, s_dist_07, s_dist_08, s_dist_09, s_dist_10 FROM public.bmsql_stock bmsql_stock WHERE ((s_w_id = $1) AND (s_i_id = $2)) FOR UPDATE OF
bmsql_stock
(5 rows)" " QUERY PLAN</p>
<hr>
<p>LockRows (cost=0.00..9497318.49 rows=1 width=293)
Output: bmsql_stock.s_quantity, bmsql_stock.s_data, bmsql_stock.s_dist_01, bmsql_stock.s_dist_02, bmsql_stock.s_dist_03, bmsql_stock.s_dist_04, bmsql_stock.s_dist_05, bmsql_stock.s_dist_06, bmsql_stock.s_dist_07, bmsql_stock.s_dist_08, bms
ql_stock.s_dist_09, bmsql_stock.s_dist_10
-> Data Node Scan on bmsql_stock &ldquo;"<em>REMOTE_TABLE_QUERY</em>&rdquo;" (cost=0.00..9497318.48 rows=1 width=293)
Output: bmsql_stock.s_quantity, bmsql_stock.s_data, bmsql_stock.s_dist_01, bmsql_stock.s_dist_02, bmsql_stock.s_dist_03, bmsql_stock.s_dist_04, bmsql_stock.s_dist_05, bmsql_stock.s_dist_06, bmsql_stock.s_dist_07, bmsql_stock.s_dist_0
8, bmsql_stock.s_dist_09, bmsql_stock.s_dist_10
Primary node/s: dn1
Node/s: dn1
Remote query: SELECT s_quantity, s_data, s_dist_01, s_dist_02, s_dist_03, s_dist_04, s_dist_05, s_dist_06, s_dist_07, s_dist_08, s_dist_09, s_dist_10 FROM ONLY public.bmsql_stock bmsql_stock WHERE ((s_w_id = 1) AND (s_i_id = 1)) FOR
UPDATE OF bmsql_stock
(7 rows)" " QUERY PLAN</p>
<hr>
<h2 id=explain-verbose-execute-s241-1-1-1-1--------------------------------------------------------------------------------------------------query-plan>
LockRows (cost=0.00..9497318.49 rows=1 width=293)
Output: bmsql_stock.s_quantity, bmsql_stock.s_data, bmsql_stock.s_dist_01, bmsql_stock.s_dist_02, bmsql_stock.s_dist_03, bmsql_stock.s_dist_04, bmsql_stock.s_dist_05, bmsql_stock.s_dist_06, bmsql_stock.s_dist_07, bmsql_stock.s_dist_08, bms
ql_stock.s_dist_09, bmsql_stock.s_dist_10
-> Data Node Scan on bmsql_stock &ldquo;"<em>REMOTE_TABLE_QUERY</em>&rdquo;" (cost=0.00..9497318.48 rows=1 width=293)
Output: bmsql_stock.s_quantity, bmsql_stock.s_data, bmsql_stock.s_dist_01, bmsql_stock.s_dist_02, bmsql_stock.s_dist_03, bmsql_stock.s_dist_04, bmsql_stock.s_dist_05, bmsql_stock.s_dist_06, bmsql_stock.s_dist_07, bmsql_stock.s_dist_0
8, bmsql_stock.s_dist_09, bmsql_stock.s_dist_10
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT s_quantity, s_data, s_dist_01, s_dist_02, s_dist_03, s_dist_04, s_dist_05, s_dist_06, s_dist_07, s_dist_08, s_dist_09, s_dist_10 FROM ONLY public.bmsql_stock bmsql_stock WHERE ((s_w_id = $1) AND (s_i_id = $2)) FO
R UPDATE OF bmsql_stock
(7 rows)"
&ldquo;prepare s24(int, int, int, int, int) as update bmsql_stock set s_quantity = $1, s_ytd = s_ytd + $2, s_order_cnt = s_order_cnt + 1, s_remote_cnt = s_remote_cnt + $3 where s_w_id = $4 and s_i_id = $5;
explain verbose execute s24(1, 1, 1, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s241-1-1-1-1--------------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows--------------------------------------------------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: ($1), ((bmsql_stock.s_ytd + $2)), ((bmsql_stock.s_order_cnt + 1)), ((bmsql_stock.s_remote_cnt + $3))
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: UPDATE public.bmsql_stock bmsql_stock SET s_quantity = $1, s_ytd = (s_ytd + $2), s_order_cnt = (s_order_cnt + 1), s_remote_cnt = (s_remote_cnt + $3) WHERE ((s_w_id = $4) AND (s_i_id = $5))
(5 rows)" " QUERY PLAN
<a href=#5-rows--------------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows-------------------------------------------------------------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: ($1), ((bmsql_stock.s_ytd + $2)), ((bmsql_stock.s_order_cnt + 1)), ((bmsql_stock.s_remote_cnt + $3))
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: UPDATE public.bmsql_stock bmsql_stock SET s_quantity = $1, s_ytd = (s_ytd + $2), s_order_cnt = (s_order_cnt + 1), s_remote_cnt = (s_remote_cnt + $3) WHERE ((s_w_id = $4) AND (s_i_id = $5))
(5 rows)" " QUERY PLAN
<a href=#5-rows-------------------------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=7-rows---------------------------------------------------------------------------------------------------------------query-plan>
Cluster Gather (cost=0.18..8.51 rows=1 width=323)
Remote node: 16386
-> Update on public.bmsql_stock (cost=0.18..8.21 rows=1 width=323)
-> Index Scan using bmsql_stock_pkey on public.bmsql_stock (cost=0.18..8.21 rows=1 width=323)
Output: s_w_id, s_i_id, 1, (s_ytd + 1), (s_order_cnt + 1), (s_remote_cnt + 1), s_data, s_dist_01, s_dist_02, s_dist_03, s_dist_04, s_dist_05, s_dist_06, s_dist_07, s_dist_08, s_dist_09, s_dist_10, ctid, xc_node_id
Index Cond: ((bmsql_stock.s_w_id = 1) AND (bmsql_stock.s_i_id = 1))
Remote node: 16386
(7 rows)" " QUERY PLAN
<a href=#7-rows---------------------------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s251-1-1-1-2022-07-14-175436841-1-1------------------------------------------------------------------------------query-plan>
Cluster Gather (cost=0.18..8.81 rows=2 width=323)
Remote node: 16386,16387
-> Update on public.bmsql_stock (cost=0.18..8.21 rows=1 width=323)
-> Index Scan using bmsql_stock_pkey on public.bmsql_stock (cost=0.18..8.21 rows=1 width=323)
Output: s_w_id, s_i_id, $1, (s_ytd + $2), (s_order_cnt + 1), (s_remote_cnt + $3), s_data, s_dist_01, s_dist_02, s_dist_03, s_dist_04, s_dist_05, s_dist_06, s_dist_07, s_dist_08, s_dist_09, s_dist_10, ctid, xc_node_id
Index Cond: ((bmsql_stock.s_w_id = $4) AND (bmsql_stock.s_i_id = $5))
Remote node: 16386,16387
(7 rows)"
&ldquo;prepare s25(int, int, int, int, timestamp, int, int) as insert into bmsql_oorder (o_id, o_d_id, o_w_id, o_c_id, o_entry_d, o_ol_cnt, o_all_local) values ($1, $2, $3, $4, $5, $6, $7);
explain verbose execute s25(1, 1, 1, 1, &lsquo;2022-07-14 17:54:36.841&rsquo;, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s251-1-1-1-2022-07-14-175436841-1-1------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=4-rows------------------------------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: ($3), ($2), ($1), ($4), ($6), ($7), ($5)
Node expr: $3
Remote query: INSERT INTO public.bmsql_oorder AS bmsql_oorder (o_w_id, o_d_id, o_id, o_c_id, o_ol_cnt, o_all_local, o_entry_d) VALUES ($3, $2, $1, $4, $6, $7, $5)
(4 rows)" " QUERY PLAN
<a href=#4-rows------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=4-rows-----------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: ($3), ($2), ($1), ($4), ($6), ($7), ($5)
Node expr: $3
Remote query: INSERT INTO public.bmsql_oorder AS bmsql_oorder (o_w_id, o_d_id, o_id, o_c_id, o_ol_cnt, o_all_local, o_entry_d) VALUES ($3, $2, $1, $4, $6, $7, $5)
(4 rows)" " QUERY PLAN
<a href=#4-rows-----------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=8-rows---------------------------------------------------------------------------------------query-plan>
Cluster Gather (cost=0.01..0.62 rows=2 width=36)
Remote node: 16386
-> Insert on public.bmsql_oorder (cost=0.01..0.03 rows=1 width=36)
-> Result (cost=0.01..0.03 rows=1 width=36)
Output: 1, 1, 1, 1, NULL::integer, 1, 1, &lsquo;2022-07-14 17:54:36.841&rsquo;::timestamp without time zone
Filter: (adb_node_oid() &lt;> &lsquo;12338&rsquo;::oid)
-> Result (cost=0.00..0.01 rows=1 width=36)
Output: 1, 1, 1, 1, NULL::integer, 1, 1, &lsquo;2022-07-14 17:54:36.841&rsquo;::timestamp without time zone
(8 rows)" " QUERY PLAN
<a href=#8-rows---------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s261-1-1-1-1-2022-07-14-175436841-1-1------------------------------------------------------------------------------------------query-plan>
Insert on public.bmsql_oorder (cost=0.00..0.01 rows=1 width=36)
Primary node/s: dn1
Node/s: dn1, dn2
Node expr: bmsql_oorder.o_w_id
Remote query: INSERT INTO public.bmsql_oorder AS bmsql_oorder (o_w_id, o_d_id, o_id, o_c_id, o_carrier_id, o_ol_cnt, o_all_local, o_entry_d) VALUES ($1, $2, $3, $4, $5, $6, $7, $8)
-> Result (cost=0.00..0.01 rows=1 width=36)
Output: $3, $2, $1, $4, NULL::integer, $6, $7, $5
(7 rows)"
&ldquo;prepare s26(int, int, int, int, int, timestamp, int, int) as insert into bmsql_history (h_c_id, h_c_d_id, h_c_w_id, h_d_id, h_w_id, h_date, h_amount, h_data) values ($1, $2, $3, $4, $5, $6, $7, $8);
explain verbose execute s26(1, 1, 1, 1, 1, &lsquo;2022-07-14 17:54:36.841&rsquo;, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s261-1-1-1-1-2022-07-14-175436841-1-1------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=7-rows------------------------------------------------------------------------------------------query-plan>
Insert on public.bmsql_history (cost=0.00..0.01 rows=1 width=112)
Primary node/s: dn1
Node/s: dn1, dn2
Node expr: bmsql_history.h_w_id
Remote query: INSERT INTO public.bmsql_history AS bmsql_history (hist_id, h_c_id, h_c_d_id, h_c_w_id, h_d_id, h_w_id, h_date, h_amount, h_data) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)
-> Result (cost=0.00..0.01 rows=1 width=112)
Output: nextval(&lsquo;bmsql_hist_id_seq&rsquo;::regclass), 1, 1, 1, 1, 1, &lsquo;2022-07-14 17:54:36.841&rsquo;::timestamp without time zone, 1.00::numeric(6,2), &lsquo;1&rsquo;::character varying(24)
(7 rows)" " QUERY PLAN
<a href=#7-rows------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=7-rows------------------------------------------------------------------------------------------query-plan-1>
Insert on public.bmsql_history (cost=0.00..0.03 rows=1 width=112)
Primary node/s: dn1
Node/s: dn1, dn2
Node expr: bmsql_history.h_w_id
Remote query: INSERT INTO public.bmsql_history AS bmsql_history (hist_id, h_c_id, h_c_d_id, h_c_w_id, h_d_id, h_w_id, h_date, h_amount, h_data) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)
-> Result (cost=0.00..0.03 rows=1 width=112)
Output: nextval(&lsquo;bmsql_hist_id_seq&rsquo;::regclass), $1, $2, $3, $4, $5, $6, $7, $8
(7 rows)" " QUERY PLAN
<a href=#7-rows------------------------------------------------------------------------------------------query-plan-1 class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=7-rows------------------------------------------------------------------------------------------query-plan-2>
Insert on public.bmsql_history (cost=0.00..0.01 rows=1 width=112)
Primary node/s: dn1
Node/s: dn1, dn2
Node expr: bmsql_history.h_w_id
Remote query: INSERT INTO public.bmsql_history AS bmsql_history (hist_id, h_c_id, h_c_d_id, h_c_w_id, h_d_id, h_w_id, h_date, h_amount, h_data) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)
-> Result (cost=0.00..0.01 rows=1 width=112)
Output: nextval(&lsquo;bmsql_hist_id_seq&rsquo;::regclass), 1, 1, 1, 1, 1, &lsquo;2022-07-14 17:54:36.841&rsquo;::timestamp without time zone, 1.00::numeric(6,2), &lsquo;1&rsquo;::character varying(24)
(7 rows)" " QUERY PLAN
<a href=#7-rows------------------------------------------------------------------------------------------query-plan-2 class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s271----------------------------------------------------------------------------query-plan>
Insert on public.bmsql_history (cost=0.00..0.03 rows=1 width=112)
Primary node/s: dn1
Node/s: dn1, dn2
Node expr: bmsql_history.h_w_id
Remote query: INSERT INTO public.bmsql_history AS bmsql_history (hist_id, h_c_id, h_c_d_id, h_c_w_id, h_d_id, h_w_id, h_date, h_amount, h_data) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)
-> Result (cost=0.00..0.03 rows=1 width=112)
Output: nextval(&lsquo;bmsql_hist_id_seq&rsquo;::regclass), $1, $2, $3, $4, $5, $6, $7, $8
(7 rows)"
&ldquo;prepare s27(int) as select w_name, w_street_1, w_street_2, w_city, w_state, w_zip from bmsql_warehouse where w_id = $1;
explain verbose execute s27(1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s271----------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows----------------------------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_warehouse.w_name, bmsql_warehouse.w_street_1, bmsql_warehouse.w_street_2, bmsql_warehouse.w_city, bmsql_warehouse.w_state, bmsql_warehouse.w_zip
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT w_name, w_street_1, w_street_2, w_city, w_state, w_zip FROM public.bmsql_warehouse bmsql_warehouse WHERE (w_id = $1)
(5 rows)" " QUERY PLAN
<a href=#5-rows----------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows------------------------------------------------query-plan-1>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: bmsql_warehouse.w_name, bmsql_warehouse.w_street_1, bmsql_warehouse.w_street_2, bmsql_warehouse.w_city, bmsql_warehouse.w_state, bmsql_warehouse.w_zip
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: SELECT w_name, w_street_1, w_street_2, w_city, w_state, w_zip FROM public.bmsql_warehouse bmsql_warehouse WHERE (w_id = $1)
(5 rows)" " QUERY PLAN
<a href=#5-rows------------------------------------------------query-plan-1 class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=6-rows------------------------------------------------query-plan>
Cluster Gather (cost=0.14..8.50 rows=1 width=68)
Remote node: 16386
-> Index Scan using bmsql_warehouse_pkey on public.bmsql_warehouse (cost=0.14..8.20 rows=1 width=68)
Output: w_name, w_street_1, w_street_2, w_city, w_state, w_zip
Index Cond: (bmsql_warehouse.w_id = 1)
Remote node: 16386
(6 rows)" " QUERY PLAN
<a href=#6-rows------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s282022-07-14-175438694-1-1-1---------------------------------------------------------------------query-plan>
Cluster Gather (cost=0.14..8.80 rows=2 width=68)
Remote node: 16386,16387
-> Index Scan using bmsql_warehouse_pkey on public.bmsql_warehouse (cost=0.14..8.20 rows=1 width=68)
Output: w_name, w_street_1, w_street_2, w_city, w_state, w_zip
Index Cond: (bmsql_warehouse.w_id = $1)
Remote node: 16386,16387
(6 rows)"
&ldquo;prepare s28(timestamp, int, int, int) as update bmsql_order_line set ol_delivery_d = $1 where ol_w_id = $2 and ol_d_id = $3 and ol_o_id = $4;
explain verbose execute s28(&lsquo;2022-07-14 17:54:38.694&rsquo;, 1, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s282022-07-14-175438694-1-1-1---------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows---------------------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: ($1)
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: UPDATE public.bmsql_order_line bmsql_order_line SET ol_delivery_d = $1 WHERE ((ol_w_id = $2) AND (ol_d_id = $3) AND (ol_o_id = $4))
(5 rows)" " QUERY PLAN
<a href=#5-rows---------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows---------------------------------------------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: ($1)
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: UPDATE public.bmsql_order_line bmsql_order_line SET ol_delivery_d = $1 WHERE ((ol_w_id = $2) AND (ol_d_id = $3) AND (ol_o_id = $4))
(5 rows)" " QUERY PLAN
<a href=#5-rows---------------------------------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=7-rows-------------------------------------------------------------------query-plan>
Cluster Gather (cost=0.19..45.90 rows=5 width=75)
Remote node: 16386
-> Update on public.bmsql_order_line (cost=0.19..44.40 rows=5 width=75)
-> Index Scan using bmsql_order_line_pkey on public.bmsql_order_line (cost=0.19..44.40 rows=5 width=75)
Output: ol_w_id, ol_d_id, ol_o_id, ol_number, ol_i_id, &lsquo;2022-07-14 17:54:38.694&rsquo;::timestamp without time zone, ol_amount, ol_supply_w_id, ol_quantity, ol_dist_info, ctid, xc_node_id
Index Cond: ((bmsql_order_line.ol_w_id = 1) AND (bmsql_order_line.ol_d_id = 1) AND (bmsql_order_line.ol_o_id = 1))
Remote node: 16386
(7 rows)" " QUERY PLAN
<a href=#7-rows-------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s291-1-----------------------------------------------------query-plan>
Cluster Gather (cost=0.19..47.40 rows=10 width=75)
Remote node: 16386,16387
-> Update on public.bmsql_order_line (cost=0.19..44.40 rows=5 width=75)
-> Index Scan using bmsql_order_line_pkey on public.bmsql_order_line (cost=0.19..44.40 rows=5 width=75)
Output: ol_w_id, ol_d_id, ol_o_id, ol_number, ol_i_id, $1, ol_amount, ol_supply_w_id, ol_quantity, ol_dist_info, ctid, xc_node_id
Index Cond: ((bmsql_order_line.ol_w_id = $2) AND (bmsql_order_line.ol_d_id = $3) AND (bmsql_order_line.ol_o_id = $4))
Remote node: 16386,16387
(7 rows)"
&ldquo;prepare s29(int, int) as update bmsql_warehouse set w_ytd = w_ytd + $1 where w_id = $2;
explain verbose execute s29(1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s291-1-----------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows-----------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: (((bmsql_warehouse.w_ytd + ($1)::numeric))::numeric(12,2))
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: UPDATE public.bmsql_warehouse bmsql_warehouse SET w_ytd = (w_ytd + ($1)::numeric) WHERE (w_id = $2)
(5 rows)" " QUERY PLAN
<a href=#5-rows-----------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows-------------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: (((bmsql_warehouse.w_ytd + ($1)::numeric))::numeric(12,2))
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: UPDATE public.bmsql_warehouse bmsql_warehouse SET w_ytd = (w_ytd + ($1)::numeric) WHERE (w_id = $2)
(5 rows)" " QUERY PLAN
<a href=#5-rows-------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=7-rows--------------------------------------------------------------query-plan>
Cluster Gather (cost=0.14..8.50 rows=1 width=103)
Remote node: 16386
-> Update on public.bmsql_warehouse (cost=0.14..8.20 rows=1 width=103)
-> Index Scan using bmsql_warehouse_pkey on public.bmsql_warehouse (cost=0.14..8.20 rows=1 width=103)
Output: w_id, (w_ytd + &lsquo;1&rsquo;::numeric), w_tax, w_name, w_street_1, w_street_2, w_city, w_state, w_zip, ctid, xc_node_id
Index Cond: (bmsql_warehouse.w_id = 1)
Remote node: 16386
(7 rows)" " QUERY PLAN
<a href=#7-rows--------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s301-1--------------------------------------------------------------query-plan>
Cluster Gather (cost=0.14..8.80 rows=2 width=103)
Remote node: 16386,16387
-> Update on public.bmsql_warehouse (cost=0.14..8.20 rows=1 width=103)
-> Index Scan using bmsql_warehouse_pkey on public.bmsql_warehouse (cost=0.14..8.20 rows=1 width=103)
Output: w_id, (w_ytd + ($1)::numeric), w_tax, w_name, w_street_1, w_street_2, w_city, w_state, w_zip, ctid, xc_node_id
Index Cond: (bmsql_warehouse.w_id = $2)
Remote node: 16386,16387
(7 rows)"
&ldquo;prepare s30(int, int) as update bmsql_district set d_next_o_id = d_next_o_id + 1 where d_w_id = $1 and d_id = $2;
explain verbose execute s30(1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s301-1--------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows--------------------------------------------------------------query-plan-2>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: ((bmsql_district.d_next_o_id + 1))
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: UPDATE public.bmsql_district bmsql_district SET d_next_o_id = (d_next_o_id + 1) WHERE ((d_w_id = $1) AND (d_id = $2))
(5 rows)" " QUERY PLAN
<a href=#5-rows--------------------------------------------------------------query-plan-2 class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=5-rows------------------------------------------------------------------query-plan>
Data Node Scan on &ldquo;"<strong>REMOTE_FQS_QUERY</strong>&rdquo;" (cost=0.00..0.00 rows=0 width=0)
Output: ((bmsql_district.d_next_o_id + 1))
Primary node/s: dn1
Node/s: dn1, dn2
Remote query: UPDATE public.bmsql_district bmsql_district SET d_next_o_id = (d_next_o_id + 1) WHERE ((d_w_id = $1) AND (d_id = $2))
(5 rows)" " QUERY PLAN
<a href=#5-rows------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=7-rows------------------------------------------------------------------query-plan>
Cluster Gather (cost=0.15..8.47 rows=1 width=102)
Remote node: 16386
-> Update on public.bmsql_district (cost=0.15..8.17 rows=1 width=102)
-> Index Scan using bmsql_district_pkey on public.bmsql_district (cost=0.15..8.17 rows=1 width=102)
Output: d_w_id, d_id, d_ytd, d_tax, (d_next_o_id + 1), d_name, d_street_1, d_street_2, d_city, d_state, d_zip, ctid, xc_node_id
Index Cond: ((bmsql_district.d_w_id = 1) AND (bmsql_district.d_id = 1))
Remote node: 16386
(7 rows)" " QUERY PLAN
<a href=#7-rows------------------------------------------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=explain-verbose-execute-s311-1-1-----------------------------query-plan>
Cluster Gather (cost=0.15..8.77 rows=2 width=102)
Remote node: 16386,16387
-> Update on public.bmsql_district (cost=0.15..8.17 rows=1 width=102)
-> Index Scan using bmsql_district_pkey on public.bmsql_district (cost=0.15..8.17 rows=1 width=102)
Output: d_w_id, d_id, d_ytd, d_tax, (d_next_o_id + 1), d_name, d_street_1, d_street_2, d_city, d_state, d_zip, ctid, xc_node_id
Index Cond: ((bmsql_district.d_w_id = $1) AND (bmsql_district.d_id = $2))
Remote node: 16386,16387
(7 rows)"
&ldquo;prepare s31(int, int, int) as select c_discount, c_last, c_credit, w_tax from bmsql_customer join bmsql_warehouse on (w_id = c_w_id) where c_w_id = $1 and c_d_id = $2 and c_id = $3;
explain verbose execute s31(1, 1, 1);&rdquo; " QUERY PLAN
<a href=#explain-verbose-execute-s311-1-1-----------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<h2 id=12-rows--------------------------------query-plan>
Cluster Gather (cost=0.32..16.56 rows=0 width=24)
Remote node: 16386
-> Nested Loop (cost=0.32..16.41 rows=0 width=24)
Output: bmsql_customer.c_discount, bmsql_customer.c_last, bmsql_customer.c_credit, bmsql_warehouse.w_tax
-> Index Scan using bmsql_customer_pkey on public.bmsql_customer (cost=0.18..8.20 rows=1 width=23)
Output: bmsql_customer.c_w_id, bmsql_customer.c_d_id, bmsql_customer.c_id, bmsql_customer.c_discount, bmsql_customer.c_credit, bmsql_customer.c_last, bmsql_customer.c_first, bmsql_customer.c_credit_lim, bmsql_customer.c_balance, bmsql_customer.c_ytd_payment, bmsql_customer.c_payment_cnt, bmsql_customer.c_delivery_cnt, bmsql_customer.c_street_1, bmsql_customer.c_street_2, bmsql_customer.c_city, bmsql_customer.c_state, bmsql_customer.c_zip, bmsql_customer.c_phone, bmsql_customer.c_since, bmsql_customer.c_middle, bmsql_customer.c_data
Index Cond: ((bmsql_customer.c_w_id = 1) AND (bmsql_customer.c_d_id = 1) AND (bmsql_customer.c_id = 1))
Remote node: 16386
-> Index Scan using bmsql_warehouse_pkey on public.bmsql_warehouse (cost=0.14..8.20 rows=1 width=9)
Output: bmsql_warehouse.w_id, bmsql_warehouse.w_ytd, bmsql_warehouse.w_tax, bmsql_warehouse.w_name, bmsql_warehouse.w_street_1, bmsql_warehouse.w_street_2, bmsql_warehouse.w_city, bmsql_warehouse.w_state, bmsql_warehouse.w_zip
Index Cond: (bmsql_warehouse.w_id = 1)
Remote node: 16386
(12 rows)" " QUERY PLAN
<a href=#12-rows--------------------------------query-plan class=h-anchor aria-hidden=true>#</a>
</h2>
<p>Cluster Gather (cost=1001.32..1021.02 rows=1 width=24)
Remote node: 16386,16387
-> Nested Loop (cost=1.32..20.72 rows=0 width=24)
Output: bmsql_customer.c_discount, bmsql_customer.c_last, bmsql_customer.c_credit, bmsql_warehouse.w_tax
-> Index Scan using bmsql_warehouse_pkey on public.bmsql_warehouse (cost=0.14..8.20 rows=1 width=9)
Output: bmsql_warehouse.w_id, bmsql_warehouse.w_ytd, bmsql_warehouse.w_tax, bmsql_warehouse.w_name, bmsql_warehouse.w_street_1, bmsql_warehouse.w_street_2, bmsql_warehouse.w_city, bmsql_warehouse.w_state, bmsql_warehouse.w_zip
Index Cond: (bmsql_warehouse.w_id = $1)
Remote node: 16386,16387
-> Cluster Reduce (cost=1.18..12.50 rows=2 width=23)
Reduce: unnest('[0:1]={16386,16387}'::oid[])
-> Index Scan using bmsql_customer_pkey on public.bmsql_customer (cost=0.18..8.20 rows=1 width=23)
Output: bmsql_customer.c_w_id, bmsql_customer.c_d_id, bmsql_customer.c_id, bmsql_customer.c_discount, bmsql_customer.c_credit, bmsql_customer.c_last, bmsql_customer.c_first, bmsql_customer.c_credit_lim, bmsql_customer.c_b
alance, bmsql_customer.c_ytd_payment, bmsql_customer.c_payment_cnt, bmsql_customer.c_delivery_cnt, bmsql_customer.c_street_1, bmsql_customer.c_street_2, bmsql_customer.c_city, bmsql_customer.c_state, bmsql_customer.c_zip, bmsql_customer.c_pho
ne, bmsql_customer.c_since, bmsql_customer.c_middle, bmsql_customer.c_data
Index Cond: ((bmsql_customer.c_w_id = $1) AND (bmsql_customer.c_d_id = $2) AND (bmsql_customer.c_id = $3))
Remote node: 16386,16387
(14 rows)" " QUERY PLAN</p>
<hr>
<p>Cluster Gather (cost=0.32..16.56 rows=0 width=24)
Remote node: 16386
-> Nested Loop (cost=0.32..16.41 rows=0 width=24)
Output: bmsql_customer.c_discount, bmsql_customer.c_last, bmsql_customer.c_credit, bmsql_warehouse.w_tax
-> Index Scan using bmsql_customer_pkey on public.bmsql_customer (cost=0.18..8.20 rows=1 width=23)
Output: bmsql_customer.c_w_id, bmsql_customer.c_d_id, bmsql_customer.c_id, bmsql_customer.c_discount, bmsql_customer.c_credit, bmsql_customer.c_last, bmsql_customer.c_first, bmsql_customer.c_credit_lim, bmsql_customer.c_balance
, bmsql_customer.c_ytd_payment, bmsql_customer.c_payment_cnt, bmsql_customer.c_delivery_cnt, bmsql_customer.c_street_1, bmsql_customer.c_street_2, bmsql_customer.c_city, bmsql_customer.c_state, bmsql_customer.c_zip, bmsql_customer.c_phone, bm
sql_customer.c_since, bmsql_customer.c_middle, bmsql_customer.c_data
Index Cond: ((bmsql_customer.c_w_id = 1) AND (bmsql_customer.c_d_id = 1) AND (bmsql_customer.c_id = 1))
Remote node: 16386
-> Index Scan using bmsql_warehouse_pkey on public.bmsql_warehouse (cost=0.14..8.20 rows=1 width=9)
Output: bmsql_warehouse.w_id, bmsql_warehouse.w_ytd, bmsql_warehouse.w_tax, bmsql_warehouse.w_name, bmsql_warehouse.w_street_1, bmsql_warehouse.w_street_2, bmsql_warehouse.w_city, bmsql_warehouse.w_state, bmsql_warehouse.w_zip
Index Cond: (bmsql_warehouse.w_id = 1)
Remote node: 16386
(12 rows)" " QUERY PLAN</p>
<hr>
<hr>
<p>Cluster Gather (cost=1001.32..1021.02 rows=1 width=24)
Remote node: 16386,16387
-> Nested Loop (cost=1.32..20.72 rows=0 width=24)
Output: bmsql_customer.c_discount, bmsql_customer.c_last, bmsql_customer.c_credit, bmsql_warehouse.w_tax
-> Index Scan using bmsql_warehouse_pkey on public.bmsql_warehouse (cost=0.14..8.20 rows=1 width=9)
Output: bmsql_warehouse.w_id, bmsql_warehouse.w_ytd, bmsql_warehouse.w_tax, bmsql_warehouse.w_name, bmsql_warehouse.w_street_1, bmsql_warehouse.w_street_2, bmsql_warehouse.w_city, bmsql_warehouse.w_state, bmsql_warehouse.w_zip
Index Cond: (bmsql_warehouse.w_id = $1)
Remote node: 16386,16387
-> Cluster Reduce (cost=1.18..12.50 rows=2 width=23)
Reduce: unnest('[0:1]={16386,16387}'::oid[])
-> Index Scan using bmsql_customer_pkey on public.bmsql_customer (cost=0.18..8.20 rows=1 width=23)
Output: bmsql_customer.c_w_id, bmsql_customer.c_d_id, bmsql_customer.c_id, bmsql_customer.c_discount, bmsql_customer.c_credit, bmsql_customer.c_last, bmsql_customer.c_first, bmsql_customer.c_credit_lim, bmsql_customer.c_b
alance, bmsql_customer.c_ytd_payment, bmsql_customer.c_payment_cnt, bmsql_customer.c_delivery_cnt, bmsql_customer.c_street_1, bmsql_customer.c_street_2, bmsql_customer.c_city, bmsql_customer.c_state, bmsql_customer.c_zip, bmsql_customer.c_pho
ne, bmsql_customer.c_since, bmsql_customer.c_middle, bmsql_customer.c_data
Index Cond: ((bmsql_customer.c_w_id = $1) AND (bmsql_customer.c_d_id = $2) AND (bmsql_customer.c_id = $3))
Remote node: 16386,16387</p>
<p>create table t1 (c1 int , c2 int , c3 int);
create table t2 (c1 int , c2 int , c3 int);
create table t3 (c1 int , c2 int , c3 int);</p>
<p>typedef enum SubLinkType
{
EXISTS_SUBLINK, // select * from t1 where exists (select * from t2 where t1.c1 = t2.c1);
ALL_SUBLINK, // select * from t1 where exists (select * from t2 where t1.c1 = t2.c1);
ANY_SUBLINK, // select * from t1 where t1.c1 > all (select t2.c2 + 10 from t2); all 和 =in 是相等的
ROWCOMPARE_SUBLINK, // select * from t1 where (t1.c1, t1.c2) = (select t2.c2 + 10, t2.c1 - 5 from t2); 和EXPR_SUBLINK相比，需要返回多列
EXPR_SUBLINK, // select * from t1 where t1.c1 > (select max(c1) from t2);
MULTIEXPR_SUBLINK,
ARRAY_SUBLINK,
CTE_SUBLINK /* for SubPlans only */
} SubLinkType;</p>
<p>insert into t1 select floor(random() * 100000)::int % 10, floor(random() * 100000)::int % 10, generate_series(1,100);
insert into t2 select floor(random() * 100000)::int % 10, floor(random() * 100000)::int % 10, generate_series(1,100);
insert into t3 select floor(random() * 100000)::int % 10, floor(random() * 100000)::int % 10, generate_series(1,100);</p>
<p>insert into t1 select floor(random() * 100000)::int % 10, floor(random() * 100000)::int % 10, generate_series(1,100000);
insert into t2 select floor(random() * 100000)::int % 10, generate_series(1,100000), floor(random() * 100000);
insert into t3 select floor(random() * 100000)::int % 10, generate_series(1,100000), floor(random() * 100000);</p>
<ul>
<li>子链接
any/some/all/in/exist/some</li>
</ul>
<ol>
<li>多层子链接</li>
<li>单节点依据，对于每一个子查询，使用条件判断能否在一个节点执行</li>
<li>子链接如果上拉，那就是join。所以如果存在分区键的关联条件，则可以直接下发语句</li>
<li>多种子链接类型，暂时支持 ALL_SUBLINK EXISTS_SUBLINK ANY_SUBLINK</li>
<li>相关子查询，非相关子查询，非相关子查询需要判断只能修改条件是否和外部查询节点一致
// explain select count (*) from t1 where exists (select * from t2 where t2.c1 = 3) and t1.c1 = 2;</li>
</ol>
<p>最终还是使用查询条件判断</p>
<p>sql (
sql (
sql (
sql x4
) x3
) x2
) x1</p>
<p>select * from t1 join t2 on t1.c1 = t2.c1 and t1.c1 = 10 join t3;</p>
<p>explain select count (<em>) from t1 where exists (select * from t2 where t2.c1 = t1.c1) and t1.c1 = 1;
explain select count (</em>) from t1 where exists (
select * from t2 where exists (
select * from t3 where t2.c1 = t1.c1
) and t2.c1 = t1.c1
) and t1.c1 = 1;</p>
<p>explain select count (*) from t1 where exists (
select * from t2 where t2.c1 = t1.c1
) and exists (
select * from t3 where t3.c1 = t1.c1
) and t1.c1 = 1;</p>
<p>explain select count (*) from t1 where exists (
select * from t2 where t2.c1 = t1.c1
) and exists (
select * from t3 where t3.c1 = t1.c1 and t1.c1 = 1
) ;</p>
<p>改造后：
plan_cache_mode = force_generic_plan
enable_fast_query_shipping = off
enable_cluster_plan=false</p>
<p>explain select count (*) from t1 where exists (
select * from t2 where t2.c1 = 2
) and exists (
select * from t3 where t3.c1 = 2
) and t1.c1 = 2;</p>
<p>explain select count (*) from t1 where t1.c1 in (
select c1 from t2 where t2.c1 = 2
);</p>
<p>explain select count (*) from t1 where exists (
select c1 from t2 where t2.c1=t1.c1 and t2.c1 = 2
);</p>
<p>explain select count (*) from t1 where exists (
select * from t2
) and c1 = 2;</p>
<p>explain select count (*) from t1 where t1.c1 in (
select c1 from t2
) and exists (
select * from t3
) and t1.c1 = 2;</p>
<p>explain select count (*) from t1 where t1.c1 in (
select c1 from t2 where t2.c1 = 2
) and exists (
select * from t3 where t3.c1 = 2
) and t1.c1 = 2;</p>
<p>select * from t1 where t1.c1 = 10;</p>
<p>select * from t1 join t2 on t1.c1 = 10 and t2.c1 = 10;</p>
<p>select * from t1 join t2 on t1.c1 = t2.c1 join t3 on t3.c2 = t1.c1 and t1.c1 = 4;</p>
<p>select * from t1 where exists (select * from t2 where t1.c1 = t2.c1) and t1.c1 = 1;</p>
<p>Query [commandType=CMD_SELECT querySource=QSRC_ORIGINAL queryId=0 canSetTag=True resultRelation=0]
[rtable]
RangeTblEntry (rtekind=RTE_RELATION relid=16526 relkind=r inh=True)
[jointree] FromExpr
[fromlist]
RangeTblRef (rtindex=1)
[quals] BoolExpr [op=AND_EXPR]
SubLink [subLinkType=EXISTS_SUBLINK location=False]
[subselect] Query [commandType=CMD_SELECT querySource=QSRC_ORIGINAL queryId=0 canSetTag=True resultRelation=0]
[rtable]
RangeTblEntry (rtekind=RTE_RELATION relid=16529 relkind=r inh=True)
[jointree] FromExpr
[fromlist]
RangeTblRef (rtindex=1)
[quals] OpExpr [opno=96 opfuncid=65 opresulttype=16]
Var [varno=1 varattno=1 levelsup=1 location=54]
Var [varno=1 varattno=1 levelsup=0 location=62]
[targetList]
TargetEntry [resno=1 resname=&ldquo;c1&rdquo; ressortgroupref=0 origtbl=16529 origcol=1 junk=False]
Var [varno=1 varattno=1 levelsup=0 location=38]
TargetEntry [resno=2 resname=&ldquo;c2&rdquo; ressortgroupref=0 origtbl=16529 origcol=2 junk=False]
Var [varno=1 varattno=2 levelsup=0 location=38]
TargetEntry [resno=3 resname=&ldquo;c3&rdquo; ressortgroupref=0 origtbl=16529 origcol=3 junk=False]
Var [varno=1 varattno=3 levelsup=0 location=38]
OpExpr [opno=96 opfuncid=65 opresulttype=16]
Var [varno=1 varattno=1 levelsup=0 location=73]
Const [consttype=23 consttypmod=-1 constlen=4 constvalue=1 constisnull=False constbyval=True]
[targetList]
TargetEntry [resno=1 resname=&ldquo;c1&rdquo; ressortgroupref=0 origtbl=16526 origcol=1 junk=False]
Var [varno=1 varattno=1 levelsup=0 location=7]
TargetEntry [resno=2 resname=&ldquo;c2&rdquo; ressortgroupref=0 origtbl=16526 origcol=2 junk=False]
Var [varno=1 varattno=2 levelsup=0 location=7]
TargetEntry [resno=3 resname=&ldquo;c3&rdquo; ressortgroupref=0 origtbl=16526 origcol=3 junk=False]
Var [varno=1 varattno=3 levelsup=0 location=7]</p>
<p>select * from</p>
<p>prepare s2(int, int, int, int) as
SELECT count(*) AS low_stock FROM (
SELECT s_w_id, s_i_id, s_quantity
FROM bmsql_stock
WHERE s_w_id = $1 AND s_quantity &lt; $2 AND s_i_id IN (
SELECT ol_i_id
FROM bmsql_district
JOIN bmsql_order_line ON ol_w_id = d_w_id
AND ol_d_id = d_id
AND ol_o_id >= d_next_o_id - 20
AND ol_o_id &lt; d_next_o_id
WHERE d_w_id = $3 AND d_id = $4
)
) AS L;</p>
<p>explain verbose execute s2(1, 1, 1, 1);</p>
<p>SELECT count(*) AS low_stock FROM (
SELECT s_w_id, s_i_id, s_quantity
FROM bmsql_stock
WHERE s_w_id = 1 AND s_quantity &lt; 1 AND s_i_id IN (
SELECT ol_i_id
FROM bmsql_district
JOIN bmsql_order_line ON ol_w_id = d_w_id
AND ol_d_id = d_id
AND ol_o_id >= d_next_o_id - 20
AND ol_o_id &lt; d_next_o_id
WHERE d_w_id = 1 AND d_id = 1
)
) AS L;</p>
<p>prepare SEL_orderline_0(integer, integer, integer) as select ol.* from bmsql_order_line ol where ol_w_id = $1 and ol_d_id = $2 and ol_o_id = $3;
execute SEL_orderline_0(18, 7, 6);</p>
<p>explain verbose execute SEL_orderline_0(18, 7, 6);</p>
<p><a href=mailto:dockerxc@10.21.13.208>dockerxc@10.21.13.208</a> AntDB119</p>
<p>postgres-xc环境</p>
<p>cn 2
dn 2
gtm 1</p>
<p>startxc 启动集群
stopxc 关闭集群
pcn1 链接cn1
pcn2 链接cn2</p>
<p>SELECT count(*) AS low_stock FROM (
SELECT s_w_id, s_i_id, s_quantity FROM bmsql_stock WHERE s_w_id = 1 AND s_quantity &lt; 1 AND s_i_id IN (
SELECT ol_i_id FROM bmsql_district JOIN bmsql_order_line ON ol_w_id = d_w_id
AND ol_d_id = d_id
AND ol_o_id >= d_next_o_id - 20
AND ol_o_id &lt; d_next_o_id
WHERE d_w_id = 1 AND d_id = 1
)
) as l;</p>
<p>SELECT s_w_id, s_i_id, s_quantity FROM bmsql_stock WHERE s_w_id = 1 AND s_quantity &lt; 1 AND s_i_id IN (
SELECT ol_i_id FROM bmsql_district JOIN bmsql_order_line ON ol_w_id = d_w_id
AND ol_d_id = d_id
AND ol_o_id >= d_next_o_id - 20
AND ol_o_id &lt; d_next_o_id
WHERE d_w_id = 1 AND d_id = 1
);</p>
<h2 id=query-plan-4>
enchmarksql=# explain verbose SELECT s_w_id, s_i_id, s_quantity FROM bmsql_stock WHERE s_w_id = 1 AND s_quantity &lt; 1 AND s_i_id IN (
SELECT ol_i_id FROM bmsql_district JOIN bmsql_order_line ON ol_w_id = d_w_id
AND ol_d_id = d_id
AND ol_o_id >= d_next_o_id - 20
AND ol_o_id &lt; d_next_o_id
WHERE d_w_id = 1 AND d_id = 1
);
QUERY PLAN
<a href=#query-plan-4 class=h-anchor aria-hidden=true>#</a>
</h2>
<p>Nested Loop Semi Join (cost=0.00..1850908.58 rows=1 width=12)
Output: bmsql_stock.s_w_id, bmsql_stock.s_i_id, bmsql_stock.s_quantity
Join Filter: (bmsql_stock.s_i_id = bmsql_order_line.ol_i_id)
-> Data Node Scan on bmsql_stock &ldquo;<em>REMOTE_TABLE_QUERY</em>&rdquo; (cost=0.00..474235.00 rows=1 width=12)
Output: bmsql_stock.s_w_id, bmsql_stock.s_i_id, bmsql_stock.s_quantity
Primary node/s: dn1
Node/s: dn1
Remote query: SELECT s_w_id, s_i_id, s_quantity FROM ONLY public.bmsql_stock bmsql_stock WHERE ((s_quantity &lt; 1) AND (s_w_id = 1))
-> Nested Loop (cost=0.00..1376638.33 rows=2820 width=4)
Output: bmsql_order_line.ol_i_id
Join Filter: ((bmsql_order_line.ol_o_id &lt; bmsql_district.d_next_o_id) AND (bmsql_order_line.ol_o_id >= (bmsql_district.d_next_o_id - 20)))
-> Data Node Scan on bmsql_district &ldquo;_REMOTE_TABLE_QUERY__1&rdquo; (cost=0.00..47.25 rows=1 width=12)
Output: bmsql_district.d_w_id, bmsql_district.d_id, bmsql_district.d_next_o_id
Primary node/s: dn1
Node/s: dn1
Remote query: SELECT d_w_id, d_id, d_next_o_id FROM ONLY public.bmsql_district bmsql_district WHERE ((d_id = 1) AND (d_w_id = 1))
-> Data Node Scan on bmsql_order_line &ldquo;_REMOTE_TABLE_QUERY__2&rdquo; (cost=0.00..1376146.89 rows=25382 width=16)
Output: bmsql_order_line.ol_w_id, bmsql_order_line.ol_d_id, bmsql_order_line.ol_o_id, bmsql_order_line.ol_i_id
Primary node/s: dn1
Node/s: dn1
Remote query: SELECT ol_w_id, ol_d_id, ol_o_id, ol_i_id FROM ONLY public.bmsql_order_line bmsql_order_line WHERE ((ol_d_id = 1) AND (ol_w_id = 1))
(21 rows)</p>
<p>Query [commandType=CMD_SELECT querySource=QSRC_ORIGINAL queryId=0 canSetTag=True resultRelation=0]
[rtable]
RangeTblEntry (rtekind=RTE_RELATION relid=16424 relkind=r inh=True)
[jointree] FromExpr
[fromlist]
RangeTblRef (rtindex=1)
[quals] BoolExpr [op=AND_EXPR]
OpExpr [opno=96 opfuncid=65 opresulttype=16]
Var [varno=1 varattno=1 levelsup=0 location=67]
Const [consttype=23 consttypmod=-1 constlen=4 constvalue=1 constisnull=False constbyval=True]
OpExpr [opno=97 opfuncid=66 opresulttype=16]
Var [varno=1 varattno=3 levelsup=0 location=82]
Const [consttype=23 consttypmod=-1 constlen=4 constvalue=1 constisnull=False constbyval=True]
SubLink [subLinkType=ANY_SUBLINK location=False]
[testexpr] OpExpr [opno=96 opfuncid=65 opresulttype=16]
Var [varno=1 varattno=2 levelsup=0 location=101]
Param (paramkind=PARAM_SUBLINK paramid=1 paramtype=23 paramtypmod=-1 location=-1)
[operName]
String ["="]
[subselect] Query [commandType=CMD_SELECT querySource=QSRC_ORIGINAL queryId=0 canSetTag=True resultRelation=0]
[rtable]
RangeTblEntry (rtekind=RTE_RELATION relid=16398 relkind=r inh=True)
RangeTblEntry (rtekind=RTE_RELATION relid=16418 relkind=r inh=True)
RangeTblEntry (rtekind=RTE_JOIN relid=0 relkind=\000)
[jointree] FromExpr
[fromlist]
JoinExpr [jointype=JOIN_INNER isNatural=False]
[larg] RangeTblRef (rtindex=1)
[rarg] RangeTblRef (rtindex=2)
[quals] BoolExpr [op=AND_EXPR]
OpExpr [opno=96 opfuncid=65 opresulttype=16]
Var [varno=2 varattno=1 levelsup=0 location=177]
Var [varno=1 varattno=1 levelsup=0 location=187]
OpExpr [opno=96 opfuncid=65 opresulttype=16]
Var [varno=2 varattno=2 levelsup=0 location=210]
Var [varno=1 varattno=2 levelsup=0 location=220]
OpExpr [opno=525 opfuncid=150 opresulttype=16]
Var [varno=2 varattno=3 levelsup=0 location=241]
OpExpr [opno=555 opfuncid=181 opresulttype=23]
Var [varno=1 varattno=5 levelsup=0 location=252]
Const [consttype=23 consttypmod=-1 constlen=4 constvalue=20 constisnull=False constbyval=True]
OpExpr [opno=97 opfuncid=66 opresulttype=16]
Var [varno=2 varattno=3 levelsup=0 location=285]
Var [varno=1 varattno=5 levelsup=0 location=295]
[quals] BoolExpr [op=AND_EXPR]
OpExpr [opno=96 opfuncid=65 opresulttype=16]
Var [varno=1 varattno=1 levelsup=0 location=325]
Const [consttype=23 consttypmod=-1 constlen=4 constvalue=1 constisnull=False constbyval=True]
OpExpr [opno=96 opfuncid=65 opresulttype=16]
Var [varno=1 varattno=2 levelsup=0 location=340]
Const [consttype=23 consttypmod=-1 constlen=4 constvalue=1 constisnull=False constbyval=True]
[targetList]
TargetEntry [resno=1 resname=&ldquo;ol_i_id&rdquo; ressortgroupref=0 origtbl=16418 origcol=5 junk=False]
Var [varno=2 varattno=5 levelsup=0 location=124]
[targetList]
TargetEntry [resno=1 resname=&ldquo;s_w_id&rdquo; ressortgroupref=0 origtbl=16424 origcol=1 junk=False]
Var [varno=1 varattno=1 levelsup=0 location=17]
TargetEntry [resno=2 resname=&ldquo;s_i_id&rdquo; ressortgroupref=0 origtbl=16424 origcol=2 junk=False]
Var [varno=1 varattno=2 levelsup=0 location=25]
TargetEntry [resno=3 resname=&ldquo;s_quantity&rdquo; ressortgroupref=0 origtbl=16424 origcol=3 junk=False]
Var [varno=1 varattno=3 levelsup=0 location=33]</p>
<pre><code>SELECT ol_i_id FROM bmsql_district JOIN bmsql_order_line ON ol_w_id = d_w_id 
       AND ol_d_id = d_id 
       AND ol_o_id &gt;= d_next_o_id - 20 
       AND ol_o_id &lt; d_next_o_id 
       WHERE d_w_id = 1 AND d_id = 1;

select * from t1 join t2 on t1.c1 = t2.c1 and t1.c1 = 10;

make_one_rel中使用约束条件精确计算exec_nodes，优化之后的约束条件是精确的，会进行表达式的优化
</code></pre>
<p>#0 adb_build_shippable_query_join_item (pstate=0x55b56b1e7dc8, root=0x55b56b1e0050, path=0x55b56b1e30e8, aliasname=0x55b569580e03 &ldquo;l&rdquo;, rtr=0x55b56b1e7ee8, unshippable_quals=0x7fff8d3bcd58, rep_tlist=0x7fff8d3bcd60)
at /workspaces/antdb/src/backend/optimizer/plan/pgxcplan.c:384
#1 0x000055b569081c8d in pgxc_build_shippable_query_jointree (root=0x55b56b1e0050, rqpath=0x55b56b1e5c08, unshippable_quals=0x7fff8d3bce98, rep_tlist=0x7fff8d3bce90) at /workspaces/antdb/src/backend/optimizer/plan/pgxcplan.c:438
#2 0x000055b56908232b in pgxc_build_shippable_query_recurse (root=0x55b56b1e0050, rqpath=0x55b56b1e5c08, unshippable_quals=0x7fff8d3bce98, rep_tlist=0x7fff8d3bce90) at /workspaces/antdb/src/backend/optimizer/plan/pgxcplan.c:578
#3 0x000055b56908268d in pgxc_build_shippable_query (root=0x55b56b1e0050, covering_path=0x55b56b1e5c08, result_node=0x55b56b1e6ee8) at /workspaces/antdb/src/backend/optimizer/plan/pgxcplan.c:689
#4 0x000055b569082776 in create_remotequery_plan (root=0x55b56b1e0050, best_path=0x55b56b1e5c08) at /workspaces/antdb/src/backend/optimizer/plan/pgxcplan.c:727
#5 0x000055b569048fb7 in create_plan_recurse (root=0x55b56b1e0050, best_path=0x55b56b1e5c08, flags=1) at /workspaces/antdb/src/backend/optimizer/plan/createplan.c:589
#6 0x000055b569048ad6 in create_plan (root=0x55b56b1e0050, best_path=0x55b56b1e5c08) at /workspaces/antdb/src/backend/optimizer/plan/createplan.c:366
#7 0x000055b56905d907 in standard_planner (parse=0x55b56b1ed568, query_string=0x55b56b0d5608 &ldquo;explain verbose select * from t1 join t2 on t1.c1 = t2.c1 and t1.c1 = 10;&rdquo;, cursorOptions=33024, boundParams=0x0)
at /workspaces/antdb/src/backend/optimizer/plan/planner.c:655
#8 0x000055b56905cf56 in planner (parse=0x55b56b1ed568, query_string=0x55b56b0d5608 &ldquo;explain verbose select * from t1 join t2 on t1.c1 = t2.c1 and t1.c1 = 10;&rdquo;, cursorOptions=33024, boundParams=0x0) at /workspaces/antdb/src/backend/optimizer/plan/planner.c:394
#9 0x000055b5691b6568 in pg_plan_query (querytree=0x55b56b1ed568, query_string=0x55b56b0d5608 &ldquo;explain verbose select * from t1 join t2 on t1.c1 = t2.c1 and t1.c1 = 10;&rdquo;, cursorOptions=33024, boundParams=0x0)
at /workspaces/antdb/src/backend/tcop/postgres.c:1187
#10 0x000055b568dd5553 in ExplainOneQuery (query=0x55b56b1ed568, cursorOptions=33024, into=0x0, es=0x55b56b0f6930, queryString=0x55b56b0d5608 &ldquo;explain verbose select * from t1 join t2 on t1.c1 = t2.c1 and t1.c1 = 10;&rdquo;, params=0x0, queryEnv=0x0)
at /workspaces/antdb/src/backend/commands/explain.c:447
#11 0x000055b568dd4fe3 in ExplainQuery (pstate=0x55b56b0fd668, stmt=0x55b56b0d68e8, params=0x0, dest=0x55b56b0f6810, isTopLive=true) at /workspaces/antdb/src/backend/commands/explain.c:308
#12 0x000055b5691c10d8 in standard_ProcessUtility (pstmt=0x55b56b0d6a38, queryString=0x55b56b0d5608 &ldquo;explain verbose select * from t1 join t2 on t1.c1 = t2.c1 and t1.c1 = 10;&rdquo;, context=PROCESS_UTILITY_TOPLEVEL, params=0x0, queryEnv=0x0, dest=0x55b56b0f6810,
sentToRemote=false, qc=0x7fff8d3bd610) at /workspaces/antdb/src/backend/tcop/utility.c:1078
#13 0x000055b5691c0275 in ProcessUtility (pstmt=0x55b56b0d6a38, queryString=0x55b56b0d5608 &ldquo;explain verbose select * from t1 join t2 on t1.c1 = t2.c1 and t1.c1 = 10;&rdquo;, context=PROCESS_UTILITY_TOPLEVEL, params=0x0, queryEnv=0x0, dest=0x55b56b0f6810,
sentToRemote=false, qc=0x7fff8d3bd610) at /workspaces/antdb/src/backend/tcop/utility.c:611
#14 0x000055b5691bef4b in PortalRunUtility (portal=0x55b56b152f98, pstmt=0x55b56b0d6a38, isTopLevel=true, setHoldSnapshot=true, dest=0x55b56b0f6810, qc=0x7fff8d3bd610) at /workspaces/antdb/src/backend/tcop/pquery.c:1283
#15 0x000055b5691bec12 in FillPortalStore (portal=0x55b56b152f98, isTopLevel=true) at /workspaces/antdb/src/backend/tcop/pquery.c:1139</p>
<pre><code>SELECT ol_i_id FROM bmsql_district JOIN bmsql_order_line ON ol_w_id = d_w_id 
       OR ol_d_id = d_id 
       AND ol_o_id &gt;= d_next_o_id - 20 
       AND ol_o_id &lt; d_next_o_id 
       OR d_w_id = 1
       OR ol_w_id = 1
       WHERE d_w_id = 1 AND d_id = 1;
</code></pre>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++>


Query [commandType<span style=color:#f92672>=</span>CMD_SELECT querySource<span style=color:#f92672>=</span>QSRC_ORIGINAL queryId<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> canSetTag<span style=color:#f92672>=</span>True resultRelation<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>]
        [rtable]
                RangeTblEntry (rtekind<span style=color:#f92672>=</span>RTE_RELATION relid<span style=color:#f92672>=</span><span style=color:#ae81ff>16398</span> relkind<span style=color:#f92672>=</span>r inh<span style=color:#f92672>=</span>True)
                RangeTblEntry (rtekind<span style=color:#f92672>=</span>RTE_RELATION relid<span style=color:#f92672>=</span><span style=color:#ae81ff>16418</span> relkind<span style=color:#f92672>=</span>r inh<span style=color:#f92672>=</span>True)
                RangeTblEntry (rtekind<span style=color:#f92672>=</span>RTE_JOIN relid<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> relkind<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>000</span>)
        [jointree] FromExpr
                [fromlist]
                        JoinExpr [jointype<span style=color:#f92672>=</span>JOIN_INNER isNatural<span style=color:#f92672>=</span>False]
                                [larg] RangeTblRef (rtindex<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
                                [rarg] RangeTblRef (rtindex<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>)
                                [quals] BoolExpr [op<span style=color:#f92672>=</span>AND_EXPR]
                                        OpExpr [opno<span style=color:#f92672>=</span><span style=color:#ae81ff>96</span> opfuncid<span style=color:#f92672>=</span><span style=color:#ae81ff>65</span> opresulttype<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>]
                                                Var [varno<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> varattno<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> levelsup<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> location<span style=color:#f92672>=</span><span style=color:#ae81ff>72</span>]
                                                Var [varno<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> varattno<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> levelsup<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> location<span style=color:#f92672>=</span><span style=color:#ae81ff>82</span>]
                                        OpExpr [opno<span style=color:#f92672>=</span><span style=color:#ae81ff>96</span> opfuncid<span style=color:#f92672>=</span><span style=color:#ae81ff>65</span> opresulttype<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>]
                                                Var [varno<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> varattno<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> levelsup<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> location<span style=color:#f92672>=</span><span style=color:#ae81ff>105</span>]
                                                Var [varno<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> varattno<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> levelsup<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> location<span style=color:#f92672>=</span><span style=color:#ae81ff>115</span>]
                                        OpExpr [opno<span style=color:#f92672>=</span><span style=color:#ae81ff>525</span> opfuncid<span style=color:#f92672>=</span><span style=color:#ae81ff>150</span> opresulttype<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>]
                                                Var [varno<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> varattno<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> levelsup<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> location<span style=color:#f92672>=</span><span style=color:#ae81ff>136</span>]
                                                OpExpr [opno<span style=color:#f92672>=</span><span style=color:#ae81ff>555</span> opfuncid<span style=color:#f92672>=</span><span style=color:#ae81ff>181</span> opresulttype<span style=color:#f92672>=</span><span style=color:#ae81ff>23</span>]
                                                        Var [varno<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> varattno<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> levelsup<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> location<span style=color:#f92672>=</span><span style=color:#ae81ff>147</span>]
                                                        Const [consttype<span style=color:#f92672>=</span><span style=color:#ae81ff>23</span> consttypmod<span style=color:#f92672>=-</span><span style=color:#ae81ff>1</span> constlen<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> constvalue<span style=color:#f92672>=</span><span style=color:#ae81ff>20</span> constisnull<span style=color:#f92672>=</span>False constbyval<span style=color:#f92672>=</span>True]
                                        OpExpr [opno<span style=color:#f92672>=</span><span style=color:#ae81ff>97</span> opfuncid<span style=color:#f92672>=</span><span style=color:#ae81ff>66</span> opresulttype<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>]
                                                Var [varno<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> varattno<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> levelsup<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> location<span style=color:#f92672>=</span><span style=color:#ae81ff>180</span>]
                                                Var [varno<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> varattno<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> levelsup<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> location<span style=color:#f92672>=</span><span style=color:#ae81ff>190</span>]
                                        OpExpr [opno<span style=color:#f92672>=</span><span style=color:#ae81ff>96</span> opfuncid<span style=color:#f92672>=</span><span style=color:#ae81ff>65</span> opresulttype<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>]
                                                Var [varno<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> varattno<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> levelsup<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> location<span style=color:#f92672>=</span><span style=color:#ae81ff>218</span>]
                                                Const [consttype<span style=color:#f92672>=</span><span style=color:#ae81ff>23</span> consttypmod<span style=color:#f92672>=-</span><span style=color:#ae81ff>1</span> constlen<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> constvalue<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> constisnull<span style=color:#f92672>=</span>False constbyval<span style=color:#f92672>=</span>True]
                                        OpExpr [opno<span style=color:#f92672>=</span><span style=color:#ae81ff>96</span> opfuncid<span style=color:#f92672>=</span><span style=color:#ae81ff>65</span> opresulttype<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>]
                                                Var [varno<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> varattno<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> levelsup<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> location<span style=color:#f92672>=</span><span style=color:#ae81ff>244</span>]
                                                Const [consttype<span style=color:#f92672>=</span><span style=color:#ae81ff>23</span> consttypmod<span style=color:#f92672>=-</span><span style=color:#ae81ff>1</span> constlen<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> constvalue<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> constisnull<span style=color:#f92672>=</span>False constbyval<span style=color:#f92672>=</span>True]
                [quals] BoolExpr [op<span style=color:#f92672>=</span>AND_EXPR]
                        OpExpr [opno<span style=color:#f92672>=</span><span style=color:#ae81ff>96</span> opfuncid<span style=color:#f92672>=</span><span style=color:#ae81ff>65</span> opresulttype<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>]
                                Var [varno<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> varattno<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> levelsup<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> location<span style=color:#f92672>=</span><span style=color:#ae81ff>273</span>]
                                Const [consttype<span style=color:#f92672>=</span><span style=color:#ae81ff>23</span> consttypmod<span style=color:#f92672>=-</span><span style=color:#ae81ff>1</span> constlen<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> constvalue<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> constisnull<span style=color:#f92672>=</span>False constbyval<span style=color:#f92672>=</span>True]
                        OpExpr [opno<span style=color:#f92672>=</span><span style=color:#ae81ff>96</span> opfuncid<span style=color:#f92672>=</span><span style=color:#ae81ff>65</span> opresulttype<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>]
                                Var [varno<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> varattno<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> levelsup<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> location<span style=color:#f92672>=</span><span style=color:#ae81ff>288</span>]
                                Const [consttype<span style=color:#f92672>=</span><span style=color:#ae81ff>23</span> consttypmod<span style=color:#f92672>=-</span><span style=color:#ae81ff>1</span> constlen<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> constvalue<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> constisnull<span style=color:#f92672>=</span>False constbyval<span style=color:#f92672>=</span>True]
        [targetList]
                TargetEntry [resno<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> resname<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ol_i_id&#34;</span> ressortgroupref<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> origtbl<span style=color:#f92672>=</span><span style=color:#ae81ff>16418</span> origcol<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> junk<span style=color:#f92672>=</span>False]
                        Var [varno<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> varattno<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> levelsup<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> location<span style=color:#f92672>=</span><span style=color:#ae81ff>19</span>]


		<span style=color:#75715e>/*
</span><span style=color:#75715e>		 hash 分布的时候，对于子链接，如果直接计算了exec_nodes，这里可以判断exec_nodes和sc_subquery_en是否相等，不相等，return null
</span><span style=color:#75715e>		  case sql: explain  select count (*) from t1 where exists (select * from t2 where t2.c1 = 2) and t1.c1 = 2;
</span><span style=color:#75715e>		  多层子链接，使用相同的判断逻辑，递归查找到某层这里return null了，那就代表整条语句不适用FQS
</span><span style=color:#75715e>		  TODO: 动态语句
</span><span style=color:#75715e>				静态语句节点可以直接计算，这里可以直接判断，但是动态语句？
</span><span style=color:#75715e>				a. t1.c1 = ? &amp;&amp; t2.c1 = ?			(explain  select count (*) from t1 where exists (select * from t2 where t2.c1 = ?) and t1.c1 = ?;)
</span><span style=color:#75715e>				b. t1.c1 = t2.c1 &amp;&amp; t2.c1 = ?		(explain  select count (*) from t1 where exists (select * from t2 where t2.c1 = t1.c1) and t1.c1 = ?;)
</span><span style=color:#75715e>			case a 涉及两个分区键，无法正常判断，无法保证输入计算节点是一个，这里判断直接return null
</span><span style=color:#75715e>				但是如果prepare的语句使用相同的占位符呢 (explain  select count (*) from t1 where exists (select * from t2 where t2.c1 = $1) and t1.c1 = $1;)
</span><span style=color:#75715e>			case b 根据条件推导，可以只有一个执行节点，但是这里没有相关的逻辑，后面估计有，后面调研下怎么减少代码复用
</span><span style=color:#75715e>				这里没有条件推导的相关例子，计算节点的时候，b的表达式在子链接中有几种语句
</span><span style=color:#75715e>				1. (explain  select count (*) from t1 where exists (select * from t2 where t2.c1 = t1.c1) and t1.c1 = ?;)
</span><span style=color:#75715e>				2. (explain  select count (*) from t1 where exists (select * from t2 where t2.c1 = t1.c1 and t1.c1 = ?);)
</span><span style=color:#75715e>				上面的2种语句，在这里在递归到pgxc_FQS_get_relation_nodes中的时候，内层语句可以正常以预期的方式执行，但是外层语句，quals 是一个子链接，此时
</span><span style=color:#75715e>				使用上面的方法查找exec_node的时候，一定会失败的，且对于内层来说，使用语句1的时候，quals 是 t2.c1 = t1.c1，也无法正确计算exec_nodes
</span><span style=color:#75715e>				所以子链接应该使用新逻辑计算，现有的逻辑是错误的，同理，链接操作也是一样的
</span><span style=color:#75715e>
</span><span style=color:#75715e>				回顾pgxc_FQS_get_relation_nodes，他能成功计算一条语句的exec_node的情况，主要依赖表达式中是否有  t1.c1 = ?， 所以对于上面的语句，可以适当的改写为
</span><span style=color:#75715e>				(explain  select count (*) from t1 where exists (select * from t2 where t2.c1 = t1.c1 and t1.c1 = ?) and t1.c1 = ?;)
</span><span style=color:#75715e>				此时对于内部语句，由于有t1.c1 = ?，可使用pgxc_FQS_get_relation_nodes计算exec_node，对于外层语句也是类似的情况，
</span><span style=color:#75715e>				而可以语句变换的情况是语句有以下要求
</span><span style=color:#75715e>				1. 子链接必须有条件且条件必须有 t2.c1 = t1.c1
</span><span style=color:#75715e>
</span><span style=color:#75715e>explain select count (*) from t1 where exists (		| 	explain select count (*) from t1 where exists (		|	explain select count (*) from t1 where exists (	
</span><span style=color:#75715e>	select * from t2 where exists (					| 		select * from t2 where exists (					|		select * from t2 where exists (		
</span><span style=color:#75715e>		select * from t3 where t2.c1 = t1.c1		| 			select * from t3 where t3.c1 = t1.c1		|			select * from t3
</span><span style=color:#75715e>	) and t2.c1 = t1.c1								| 		) and t2.c1 = t1.c1								|		) and t2.c1 = t1.c1			
</span><span style=color:#75715e>) and t1.c1 = 1;									| 	) and t1.c1 = 1;									|	) and t1.c1 = 1;		
</span><span style=color:#75715e>
</span><span style=color:#75715e>explain  select count (*) from t1 where exists (	|	explain  select count (*) from t1 where exists (
</span><span style=color:#75715e>	select * from t2 where t2.c1 = t1.c1			|		select * from t2 where t2.c1 = t1.c1
</span><span style=color:#75715e>) and exists (										|	) and exists (								
</span><span style=color:#75715e>	select * from t3 where t3.c1 = t1.c1			|		select * from t3 where t3.c1 = t1.c1 and t1.c1 = 1
</span><span style=color:#75715e>) and t1.c1 = 1;									|	) ;										
</span><span style=color:#75715e>
</span><span style=color:#75715e>
</span><span style=color:#75715e>			这里需要变形，需要对表达式进行上推下拉的操作，join的优化在那里？可以参考上拉子链接和谓词下推的操作实现类似的逻辑吗
</span><span style=color:#75715e>			再或者，这里不需要做这么复杂的工作，`select * from t1 join t2 on t1.c1 = t2.c1 and t1.c1 = 10;`这条语句在之后的逻辑被传到单个节点执行了，所以是否可以在后面做
</span><span style=color:#75715e>		*/</span>


select <span style=color:#f92672>*</span> from (select <span style=color:#f92672>*</span> from t1) a where a.c1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;


select <span style=color:#f92672>*</span> from t1 where t1.c1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span> limit <span style=color:#ae81ff>10</span>;



select <span style=color:#f92672>*</span> from t1 where t1.c1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span> limit <span style=color:#ae81ff>10</span>;


<span style=color:#f92672>----------------------</span>

<span style=color:#ae81ff>1.</span>  <span style=color:#960050;background-color:#1e0010>查找</span>Query条件表达式中的分片表达式                              
  <span style=color:#960050;background-color:#1e0010>刘坤朋</span>  
  <span style=color:#ae81ff>3</span>               done
<span style=color:#ae81ff>2.</span>  <span style=color:#960050;background-color:#1e0010>内连接单数据节点的</span>select改造支持                                <span style=color:#960050;background-color:#1e0010>刘坤朋</span>  <span style=color:#ae81ff>4</span>               done
<span style=color:#ae81ff>3.</span>  <span style=color:#960050;background-color:#1e0010>对</span>Query条件表达式中多个分片条件的筛选                           <span style=color:#960050;background-color:#1e0010>茅晓萍</span>  <span style=color:#ae81ff>2</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>8</span><span style=color:#f92672>/</span><span style=color:#ae81ff>29</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>8</span><span style=color:#f92672>/</span><span style=color:#ae81ff>30</span>
    FQS的前置条件<span style=color:#960050;background-color:#1e0010>，当前已支持大部分</span>
<span style=color:#ae81ff>4.</span>  <span style=color:#960050;background-color:#1e0010>左连接、右连接支持改造</span>                                          <span style=color:#960050;background-color:#1e0010>茅晓萍</span>  <span style=color:#ae81ff>3</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>8</span><span style=color:#f92672>/</span><span style=color:#ae81ff>31</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>
    <span style=color:#960050;background-color:#1e0010>当前简单语句以支持</span>
    <span style=color:#960050;background-color:#1e0010>```</span>sql
    <span style=color:#f92672>--</span> <span style=color:#960050;background-color:#1e0010>对于</span> left right以及full join<span style=color:#960050;background-color:#1e0010>，只要存在左子树和右子树是在同一个节点上执行的情况，则其他条件可以忽略，此时</span>join部分可以整个实现为remote_query<span style=color:#960050;background-color:#1e0010>，</span>
	<span style=color:#f92672>--</span> 

benchmarksql<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>#</span> explain verbose select <span style=color:#f92672>*</span> from t1 left join t2 on t1.c1 <span style=color:#f92672>=</span> t2.c1 where  t1.c1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
                                           QUERY PLAN
<span style=color:#f92672>-------------------------------------------------------------------------------------------------</span>
 Nested Loop Left Join  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0.00</span>.<span style=color:#ae81ff>.1267.33</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>187</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>24</span>)
   Output: t1.c1, t1.c2, t1.c3, t2.c1, t2.c2, t2.c3
   Join Filter: (t1.c1 <span style=color:#f92672>=</span> t2.c1)
   <span style=color:#f92672>-&gt;</span>  Data Node Scan on t1 <span style=color:#e6db74>&#34;_REMOTE_TABLE_QUERY_&#34;</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0.00</span>.<span style=color:#ae81ff>.632.25</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>17</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>)
         Output: t1.c1, t1.c2, t1.c3
         Primary node<span style=color:#f92672>/</span>s: dn1
         Node<span style=color:#f92672>/</span>s: dn1
         Remote query: SELECT c1, c2, c3 FROM ONLY <span style=color:#66d9ef>public</span>.t1 t1 WHERE (c1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>)
   <span style=color:#f92672>-&gt;</span>  Materialize  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0.00</span>.<span style=color:#ae81ff>.632.30</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>11</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>)
         Output: t2.c1, t2.c2, t2.c3
         <span style=color:#f92672>-&gt;</span>  Data Node Scan on t2 <span style=color:#e6db74>&#34;_REMOTE_TABLE_QUERY__1&#34;</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>0.00</span>.<span style=color:#ae81ff>.632.25</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>11</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>)
               Output: t2.c1, t2.c2, t2.c3
               Primary node<span style=color:#f92672>/</span>s: dn1
               Node<span style=color:#f92672>/</span>s: dn1
               Remote query: SELECT c1, c2, c3 FROM ONLY <span style=color:#66d9ef>public</span>.t2 t2 WHERE (c1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>)
(<span style=color:#ae81ff>15</span> rows)

    <span style=color:#ae81ff>1.</span> select <span style=color:#f92672>*</span> from t1 left join t2 on t1.c1 <span style=color:#f92672>=</span> t2.c1 and t1.c1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
benchmarksql<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>#</span> explain verbose select <span style=color:#f92672>*</span> from t1 left join t2 on t1.c1 <span style=color:#f92672>=</span> t2.c1 where  t1.c1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;

                                     QUERY PLAN
<span style=color:#f92672>------------------------------------------------------------------------------------------------------</span>
 Data Node Scan on <span style=color:#e6db74>&#34;_REMOTE_TABLE_QUERY_&#34;</span>  (cost<span style=color:#f92672>=</span><span style=color:#ae81ff>10000002000.00</span>.<span style=color:#ae81ff>.10000002168.30</span> rows<span style=color:#f92672>=</span><span style=color:#ae81ff>187</span> width<span style=color:#f92672>=</span><span style=color:#ae81ff>24</span>)
   Output: t1.c1, t1.c2, t1.c3, t2.c1, t2.c2, t2.c3
   Primary node<span style=color:#f92672>/</span>s: dn1
   Node<span style=color:#f92672>/</span>s: dn1
   Remote query: SELECT l.a_1, l.a_2, l.a_3, r.a_1, r.a_2, r.a_3 FROM ((SELECT t1.c1, t1.c2, t1.c3 FROM ONLY <span style=color:#66d9ef>public</span>.t1 t1 WHERE (t1.c1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>)) l(a_1, a_2, a_3) LEFT JOIN (SELECT t2.c1, t2.c2, t2.c3 FROM ONLY <span style=color:#66d9ef>public</span>.t2 t2 WHERE (t2.c1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>)) r(a_1, a_2, a_3) ON ((l.a_1 <span style=color:#f92672>=</span> r.a_1))) WHERE true
(<span style=color:#ae81ff>5</span> rows)

    <span style=color:#ae81ff>2.</span> select <span style=color:#f92672>*</span> from t1 right join t2 on t1.c1 <span style=color:#f92672>=</span> t2.c1 and t1.c1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
    <span style=color:#ae81ff>3.</span> select <span style=color:#f92672>*</span> from t1 full join t2 on t1.c1 <span style=color:#f92672>=</span> t2.c1 and t1.c1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;

    <span style=color:#960050;background-color:#1e0010>```</span>
<span style=color:#ae81ff>5.</span>  <span style=color:#960050;background-color:#1e0010>全连接、半连接、反连接、交叉连接改造支持</span>                <span style=color:#960050;background-color:#1e0010>茅晓萍</span>  <span style=color:#ae81ff>3</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>5</span>    <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>7</span>
<span style=color:#ae81ff>6.</span>  <span style=color:#960050;background-color:#1e0010>带动态参数的子查询，普通子查询、标量子查询、关联子查询支持改造</span>  <span style=color:#960050;background-color:#1e0010>茅晓萍</span>  <span style=color:#ae81ff>3</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>8</span>    <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>12</span>
<span style=color:#ae81ff>7.</span>  <span style=color:#960050;background-color:#1e0010>不带动态参数的子查询，普通子查询、标量子查询、关联子查询支持改造</span>    <span style=color:#960050;background-color:#1e0010>茅晓萍</span>  <span style=color:#ae81ff>2</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>13</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>14</span>
<span style=color:#ae81ff>8.</span>  insert<span style=color:#960050;background-color:#1e0010>、</span><span style=color:#66d9ef>delete</span><span style=color:#960050;background-color:#1e0010>、</span>update<span style=color:#960050;background-color:#1e0010>、</span><span style=color:#66d9ef>for</span> update的改造支持            <span style=color:#960050;background-color:#1e0010>茅晓萍</span>  <span style=color:#ae81ff>3</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>15</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>19</span>
<span style=color:#ae81ff>9.</span>  SQL语句带nextsql序列等动态函数的改造支持                <span style=color:#960050;background-color:#1e0010>茅晓萍</span>  <span style=color:#ae81ff>3</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>20</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>22</span>
<span style=color:#ae81ff>10.</span> <span style=color:#960050;background-color:#1e0010>子连接支持改造</span>                          <span style=color:#960050;background-color:#1e0010>文磊</span>    <span style=color:#ae81ff>4</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1</span>    <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>6</span>
<span style=color:#ae81ff>11.</span> <span style=color:#960050;background-color:#1e0010>只在单数据节点执行的聚合函数的改造支持</span>              <span style=color:#960050;background-color:#1e0010>文磊</span>    <span style=color:#ae81ff>4</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>7</span>    <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>12</span>
<span style=color:#ae81ff>12.</span> <span style=color:#960050;background-color:#1e0010>对触发器、规则、</span>with<span style=color:#960050;background-color:#1e0010>、多节点的聚合等不支持的规则进行排除</span>        <span style=color:#960050;background-color:#1e0010>文磊</span>    <span style=color:#ae81ff>2</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>13</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>14</span>
<span style=color:#ae81ff>13.</span> <span style=color:#960050;background-color:#1e0010>带连接条件的表连接的改造支持</span>                    <span style=color:#960050;background-color:#1e0010>文磊</span>    <span style=color:#ae81ff>4</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>15</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>20</span>
<span style=color:#ae81ff>14.</span> RemoteQuery执行计划支持有名的Prepare                <span style=color:#960050;background-color:#1e0010>文磊</span>    <span style=color:#ae81ff>4</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>21</span>   <span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>26</span>
<span style=color:#ae81ff>5.</span>  <span style=color:#960050;background-color:#1e0010>全连接、半连接、反连接、交叉连接改造支持</span>				<span style=color:#960050;background-color:#1e0010>茅晓萍</span>	<span style=color:#ae81ff>3</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>5</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>7</span>
<span style=color:#ae81ff>6.</span>  <span style=color:#960050;background-color:#1e0010>带动态参数的子查询，普通子查询、标量子查询、关联子查询支持改造</span>	<span style=color:#960050;background-color:#1e0010>茅晓萍</span>	<span style=color:#ae81ff>3</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>8</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>12</span>
<span style=color:#ae81ff>7.</span>  <span style=color:#960050;background-color:#1e0010>不带动态参数的子查询，普通子查询、标量子查询、关联子查询支持改造</span>	<span style=color:#960050;background-color:#1e0010>茅晓萍</span>	<span style=color:#ae81ff>2</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>13</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>14</span>
<span style=color:#ae81ff>8.</span>  insert<span style=color:#960050;background-color:#1e0010>、</span><span style=color:#66d9ef>delete</span><span style=color:#960050;background-color:#1e0010>、</span>update<span style=color:#960050;background-color:#1e0010>、</span><span style=color:#66d9ef>for</span> update的改造支持			<span style=color:#960050;background-color:#1e0010>茅晓萍</span>	<span style=color:#ae81ff>3</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>15</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>19</span>
<span style=color:#ae81ff>9.</span>  SQL语句带nextsql序列等动态函数的改造支持				<span style=color:#960050;background-color:#1e0010>茅晓萍</span>	<span style=color:#ae81ff>3</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>20</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>22</span>
<span style=color:#ae81ff>10.</span> <span style=color:#960050;background-color:#1e0010>子连接支持改造</span>							<span style=color:#960050;background-color:#1e0010>文磊</span>	<span style=color:#ae81ff>4</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>6</span>
<span style=color:#ae81ff>11.</span> <span style=color:#960050;background-color:#1e0010>只在单数据节点执行的聚合函数的改造支持</span>				<span style=color:#960050;background-color:#1e0010>文磊</span>	<span style=color:#ae81ff>4</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>7</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>12</span>
<span style=color:#ae81ff>12.</span> <span style=color:#960050;background-color:#1e0010>对触发器、规则、</span>with<span style=color:#960050;background-color:#1e0010>、多节点的聚合等不支持的规则进行排除</span>		<span style=color:#960050;background-color:#1e0010>文磊</span>	<span style=color:#ae81ff>2</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>13</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>14</span>
<span style=color:#ae81ff>13.</span> <span style=color:#960050;background-color:#1e0010>带连接条件的表连接的改造支持</span>					<span style=color:#960050;background-color:#1e0010>文磊</span>	<span style=color:#ae81ff>4</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>15</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>20</span>
<span style=color:#ae81ff>14.</span> RemoteQuery执行计划支持有名的Prepare				<span style=color:#960050;background-color:#1e0010>文磊</span>	<span style=color:#ae81ff>4</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>21</span>	<span style=color:#ae81ff>2022</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>26</span>



prepare s10(<span style=color:#66d9ef>int</span>) as select max(b) from t WHERE a <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>1</span>;
explain verbose execute <span style=color:#a6e22e>s10</span>(<span style=color:#ae81ff>1</span>); 



waj7kVLv40o6rWZV0agXhDj8



<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>19</span><span style=color:#f92672>:</span><span style=color:#ae81ff>21</span>,<span style=color:#ae81ff>882</span> [main] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, C value <span style=color:#66d9ef>for</span> C_LAST during load: <span style=color:#ae81ff>149</span>
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>19</span><span style=color:#f92672>:</span><span style=color:#ae81ff>21</span>,<span style=color:#ae81ff>882</span> [main] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, C value <span style=color:#66d9ef>for</span> C_LAST <span style=color:#66d9ef>this</span> run:    <span style=color:#ae81ff>232</span>
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>19</span><span style=color:#f92672>:</span><span style=color:#ae81ff>21</span>,<span style=color:#ae81ff>882</span> [main] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>,
Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Running Average tpmTOTAL: <span style=color:#ae81ff>296.18</span>    Current tpmTOTAL: <span style=color:#ae81ff>12900</span>    Memory Usage: <span style=color:#ae81ff>104</span>MB <span style=color:#f92672>/</span> <span style=color:#ae81ff>396</span>MB
Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Running Average tpmTOTAL: <span style=color:#ae81ff>296.23</span>    Current tpmTOTAL: <span style=color:#ae81ff>13164</span>    Memory Usage: <span style=color:#ae81ff>106</span>MB <span style=color:#f92672>/</span> <span style=color:#ae81ff>396</span>MB
Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Running Average tpmTOTAL: <span style=color:#ae81ff>296.41</span>    Current tpmTOTAL: <span style=color:#ae81ff>13992</span>    Memory Usage: <span style=color:#ae81ff>113</span>MB <span style=color:#f92672>/</span> <span style=color:#ae81ff>396</span>MB
Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Running Average tpmTOTAL: <span style=color:#ae81ff>297.01</span>    Current tpmTOTAL: <span style=color:#ae81ff>17556</span>    Memory Usage: <span style=color:#ae81ff>150</span>MB <span style=color:#f92672>/</span> <span style=color:#ae81ff>396</span>MB
Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Running Average tpmTOTAL: <span style=color:#ae81ff>297.29</span>    Current tpmTOTAL: <span style=color:#ae81ff>19788</span>    Memory Usage: <span style=color:#ae81ff>168</span>MB <span style=color:#f92672>/</span> <span style=color:#ae81ff>396</span>MB
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>29</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22</span>,<span style=color:#ae81ff>115</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>,
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>29</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22</span>,<span style=color:#ae81ff>116</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>,
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>29</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22</span>,<span style=color:#ae81ff>117</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Measured tpmC (NewOrders) <span style=color:#f92672>=</span> <span style=color:#ae81ff>132.75</span>
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>29</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22</span>,<span style=color:#ae81ff>117</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Measured tpmTOTAL <span style=color:#f92672>=</span> <span style=color:#ae81ff>297.2</span>
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>29</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22</span>,<span style=color:#ae81ff>117</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Session Start     <span style=color:#f92672>=</span> <span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>09</span><span style=color:#f92672>-</span><span style=color:#ae81ff>14</span> <span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>19</span><span style=color:#f92672>:</span><span style=color:#ae81ff>21</span>
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>29</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22</span>,<span style=color:#ae81ff>118</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Session End       <span style=color:#f92672>=</span> <span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>09</span><span style=color:#f92672>-</span><span style=color:#ae81ff>14</span> <span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>29</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22</span>
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>29</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22</span>,<span style=color:#ae81ff>118</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Transaction Count <span style=color:#f92672>=</span> <span style=color:#ae81ff>2972</span>


<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>35</span><span style=color:#f92672>:</span><span style=color:#ae81ff>09</span>,<span style=color:#ae81ff>257</span> [main] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, C value <span style=color:#66d9ef>for</span> C_LAST during load: <span style=color:#ae81ff>149</span>
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>35</span><span style=color:#f92672>:</span><span style=color:#ae81ff>09</span>,<span style=color:#ae81ff>257</span> [main] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, C value <span style=color:#66d9ef>for</span> C_LAST <span style=color:#66d9ef>this</span> run:    <span style=color:#ae81ff>217</span>
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>35</span><span style=color:#f92672>:</span><span style=color:#ae81ff>09</span>,<span style=color:#ae81ff>257</span> [main] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>,
Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Running Average tpmTOTAL: <span style=color:#ae81ff>301.08</span>    Current tpmTOTAL: <span style=color:#ae81ff>2328</span>    Memory Usage: <span style=color:#ae81ff>16</span>MB <span style=color:#f92672>/</span> <span style=color:#ae81ff>396</span>MB
Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Running Average tpmTOTAL: <span style=color:#ae81ff>299.67</span>    Current tpmTOTAL: <span style=color:#ae81ff>20292</span>    Memory Usage: <span style=color:#ae81ff>167</span>MB <span style=color:#f92672>/</span> <span style=color:#ae81ff>396</span>MB
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>45</span><span style=color:#f92672>:</span><span style=color:#ae81ff>09</span>,<span style=color:#ae81ff>523</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>,
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>45</span><span style=color:#f92672>:</span><span style=color:#ae81ff>09</span>,<span style=color:#ae81ff>525</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>,
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>45</span><span style=color:#f92672>:</span><span style=color:#ae81ff>09</span>,<span style=color:#ae81ff>525</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Measured tpmC (NewOrders) <span style=color:#f92672>=</span> <span style=color:#ae81ff>130.85</span>
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>45</span><span style=color:#f92672>:</span><span style=color:#ae81ff>09</span>,<span style=color:#ae81ff>526</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Measured tpmTOTAL <span style=color:#f92672>=</span> <span style=color:#ae81ff>299.58</span>
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>45</span><span style=color:#f92672>:</span><span style=color:#ae81ff>09</span>,<span style=color:#ae81ff>526</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Session Start     <span style=color:#f92672>=</span> <span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>09</span><span style=color:#f92672>-</span><span style=color:#ae81ff>14</span> <span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>35</span><span style=color:#f92672>:</span><span style=color:#ae81ff>09</span>
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>45</span><span style=color:#f92672>:</span><span style=color:#ae81ff>09</span>,<span style=color:#ae81ff>526</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Session End       <span style=color:#f92672>=</span> <span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>09</span><span style=color:#f92672>-</span><span style=color:#ae81ff>14</span> <span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>45</span><span style=color:#f92672>:</span><span style=color:#ae81ff>09</span>
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>45</span><span style=color:#f92672>:</span><span style=color:#ae81ff>09</span>,<span style=color:#ae81ff>526</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Transaction Count <span style=color:#f92672>=</span> <span style=color:#ae81ff>2996</span>


<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>47</span><span style=color:#f92672>:</span><span style=color:#ae81ff>03</span>,<span style=color:#ae81ff>489</span> [main] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, C value <span style=color:#66d9ef>for</span> C_LAST during load: <span style=color:#ae81ff>149</span>
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>47</span><span style=color:#f92672>:</span><span style=color:#ae81ff>03</span>,<span style=color:#ae81ff>489</span> [main] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, C value <span style=color:#66d9ef>for</span> C_LAST <span style=color:#66d9ef>this</span> run:    <span style=color:#ae81ff>249</span>
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>47</span><span style=color:#f92672>:</span><span style=color:#ae81ff>03</span>,<span style=color:#ae81ff>489</span> [main] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>,
Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Running Average tpmTOTAL: <span style=color:#ae81ff>300.48</span>    Current tpmTOTAL: <span style=color:#ae81ff>3828</span>    Memory Usage: <span style=color:#ae81ff>28</span>MB <span style=color:#f92672>/</span> <span style=color:#ae81ff>396</span>MB
Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Running Average tpmTOTAL: <span style=color:#ae81ff>299.65</span>    Current tpmTOTAL: <span style=color:#ae81ff>19428</span>    Memory Usage: <span style=color:#ae81ff>165</span>MB <span style=color:#f92672>/</span> <span style=color:#ae81ff>396</span>MB
Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Running Average tpmTOTAL: <span style=color:#ae81ff>299.64</span>    Current tpmTOTAL: <span style=color:#ae81ff>19872</span>    Memory Usage: <span style=color:#ae81ff>169</span>MB <span style=color:#f92672>/</span> <span style=color:#ae81ff>396</span>MB
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>57</span><span style=color:#f92672>:</span><span style=color:#ae81ff>03</span>,<span style=color:#ae81ff>827</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>,
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>57</span><span style=color:#f92672>:</span><span style=color:#ae81ff>03</span>,<span style=color:#ae81ff>828</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>,
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>57</span><span style=color:#f92672>:</span><span style=color:#ae81ff>03</span>,<span style=color:#ae81ff>829</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Measured tpmC (NewOrders) <span style=color:#f92672>=</span> <span style=color:#ae81ff>134.23</span>
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>57</span><span style=color:#f92672>:</span><span style=color:#ae81ff>03</span>,<span style=color:#ae81ff>829</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Measured tpmTOTAL <span style=color:#f92672>=</span> <span style=color:#ae81ff>299.54</span>
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>57</span><span style=color:#f92672>:</span><span style=color:#ae81ff>03</span>,<span style=color:#ae81ff>830</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Session Start     <span style=color:#f92672>=</span> <span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>09</span><span style=color:#f92672>-</span><span style=color:#ae81ff>14</span> <span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>47</span><span style=color:#f92672>:</span><span style=color:#ae81ff>03</span>
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>57</span><span style=color:#f92672>:</span><span style=color:#ae81ff>03</span>,<span style=color:#ae81ff>830</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Session End       <span style=color:#f92672>=</span> <span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>09</span><span style=color:#f92672>-</span><span style=color:#ae81ff>14</span> <span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>57</span><span style=color:#f92672>:</span><span style=color:#ae81ff>03</span>
<span style=color:#ae81ff>02</span><span style=color:#f92672>:</span><span style=color:#ae81ff>57</span><span style=color:#f92672>:</span><span style=color:#ae81ff>03</span>,<span style=color:#ae81ff>830</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Transaction Count <span style=color:#f92672>=</span> <span style=color:#ae81ff>2996</span>


<span style=color:#ae81ff>1.</span> <span style=color:#960050;background-color:#1e0010>既然要自主可控，那源码的修改就不能像现在一样加宏来控制隔离，现在代码中有的功能为了隔离，极端的会在原来模块之外再建立一个类似的，</span>
<span style=color:#ae81ff>2.</span> <span style=color:#960050;background-color:#1e0010>勇于实践，</span>
<span style=color:#ae81ff>2.</span> <span style=color:#960050;background-color:#1e0010>建议规范开发流程，完善</span>gitlab自动化工具<span style=color:#960050;background-color:#1e0010>，代码每次提交进行</span>review<span style=color:#960050;background-color:#1e0010>，每次提交进行</span>regress check<span style=color:#960050;background-color:#1e0010>，进行性能测试</span>
<span style=color:#ae81ff>3.</span> <span style=color:#960050;background-color:#1e0010>现有两套分布式执行路径，需要明确重点，理论上</span>remote query <span style=color:#960050;background-color:#1e0010>和</span> cluster是一样<span style=color:#960050;background-color:#1e0010>，且</span>remote query <span style=color:#960050;background-color:#1e0010>感觉更类似分库分表。</span>


<span style=color:#960050;background-color:#1e0010>我们有类似</span>gpstate <span style=color:#960050;background-color:#1e0010>这种工具吗</span>





benchmarksql<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>#</span> prepare s2(<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>) as
select count(<span style=color:#f92672>*</span>) as low_stock from
(
   select s_w_id, s_i_id, s_quantity from bmsql_stock where s_w_id <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>1</span> and s_quantity <span style=color:#f92672>&lt;</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>2</span> and s_i_id in (
      select ol_i_id from bmsql_district join bmsql_order_line
      on
         ol_w_id <span style=color:#f92672>=</span> d_w_id and
         ol_d_id <span style=color:#f92672>=</span> d_id and
         ol_o_id <span style=color:#f92672>&gt;=</span> d_next_o_id <span style=color:#f92672>-</span> <span style=color:#ae81ff>20</span> and
         ol_o_id <span style=color:#f92672>&lt;</span> d_next_o_id
      where
         d_w_id <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>3</span> and d_id <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>4</span>
   )
) as l;




<span style=color:#ae81ff>1.</span> <span style=color:#960050;background-color:#1e0010>配置信息</span>


create table 

create table nu_tab(a <span style=color:#66d9ef>int</span>) distribute by modulo(a);
insert into nu_tab select g  from <span style=color:#a6e22e>generate_series</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1000</span>) g;
execute direct <span style=color:#a6e22e>on</span>(dn1) <span style=color:#960050;background-color:#1e0010>&#39;</span>select <span style=color:#f92672>*</span> from nu_tab<span style=color:#960050;background-color:#1e0010>&#39;</span>;

select <span style=color:#f92672>*</span> from nu_tab where <span style=color:#a6e22e>mod</span> (a, <span style=color:#ae81ff>2</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;

alias sqps<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;echo &#39;  PID  PPID    VSZ WCHAN                CMD&#39; ; ps -eo pid,ppid,vsize,wchan:20,cmd | grep -E &#39;postgres&#39;&#34;</span>


cc<span style=color:#960050;background-color:#1e0010>@</span><span style=color:#ae81ff>10.1.206.127</span>
antdb<span style=color:#960050;background-color:#1e0010>@</span><span style=color:#ae81ff>123</span>

root<span style=color:#960050;background-color:#1e0010>@</span><span style=color:#ae81ff>10.1.207.164</span> 
aidb<span style=color:#960050;background-color:#1e0010>@</span><span style=color:#ae81ff>123</span><span style=color:#f92672>!</span><span style=color:#960050;background-color:#1e0010>@#</span>

..<span style=color:#f92672>/</span>configure <span style=color:#f92672>--</span>prefix<span style=color:#f92672>=/</span>data01<span style=color:#f92672>/</span>adbhz<span style=color:#f92672>/</span>app_fqs_pp <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>segsize<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>wal<span style=color:#f92672>-</span>blocksize<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> <span style=color:#f92672>--</span>enable<span style=color:#f92672>-</span>grammar<span style=color:#f92672>-</span>oracle <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>perl <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>python <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>pam <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>ldap <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>libxml <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>libxslt <span style=color:#f92672>--</span>enable<span style=color:#f92672>-</span><span style=color:#66d9ef>thread</span><span style=color:#f92672>-</span>safety <span style=color:#f92672>--</span>disable<span style=color:#f92672>-</span>debug <span style=color:#f92672>--</span>disable<span style=color:#f92672>-</span>cassert <span style=color:#f92672>--</span>enable<span style=color:#f92672>-</span>depend CFLAGS<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#f92672>-</span>O2<span style=color:#960050;background-color:#1e0010>&#39;</span>


psql postgres <span style=color:#f92672>-</span>p <span style=color:#ae81ff>15432</span> <span style=color:#f92672>-</span>c <span style=color:#e6db74>&#34;set COORDINATOR all (enable_fast_query_shipping = off);&#34;</span>
psql postgres <span style=color:#f92672>-</span>p <span style=color:#ae81ff>15432</span> <span style=color:#f92672>-</span>c <span style=color:#e6db74>&#34;set COORDINATOR all (pgxc_enable_remote_query = off);&#34;</span>
psql postgres <span style=color:#f92672>-</span>p <span style=color:#ae81ff>15432</span> <span style=color:#f92672>-</span>c <span style=color:#e6db74>&#34;set COORDINATOR all (plan_cache_mode = force_generic_plan);&#34;</span>
psql postgres <span style=color:#f92672>-</span>p <span style=color:#ae81ff>15432</span> <span style=color:#f92672>-</span>c <span style=color:#e6db74>&#34;set COORDINATOR all (plan_cache_mode = force_custom_plan);&#34;</span>

plan_cache_mode <span style=color:#f92672>=</span> force_generic_plan,enable_fast_query_shipping <span style=color:#f92672>=</span> off,pgxc_enable_remote_query<span style=color:#f92672>=</span>off
plan_cache_mode <span style=color:#f92672>=</span> force_generic_plan,enable_fast_query_shipping <span style=color:#f92672>=</span> off,pgxc_enable_remote_query<span style=color:#f92672>=</span>off


sync
echo <span style=color:#ae81ff>3</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>/</span>proc<span style=color:#f92672>/</span>sys<span style=color:#f92672>/</span>vm<span style=color:#f92672>/</span>drop_caches

echo <span style=color:#ae81ff>2</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>/</span>proc<span style=color:#f92672>/</span>sys<span style=color:#f92672>/</span>vm<span style=color:#f92672>/</span>drop_caches
echo <span style=color:#ae81ff>1</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>/</span>proc<span style=color:#f92672>/</span>sys<span style=color:#f92672>/</span>vm<span style=color:#f92672>/</span>drop_caches


psql <span style=color:#f92672>-</span>d postgres <span style=color:#f92672>-</span>p <span style=color:#ae81ff>15432</span>
stop all mode i;
stop agent all;
mgr_ctl stop <span style=color:#f92672>-</span>D <span style=color:#f92672>/</span>data01<span style=color:#f92672>/</span>adbhz<span style=color:#f92672>/</span>mgr


mgr_ctl start <span style=color:#f92672>-</span>D <span style=color:#f92672>/</span>data01<span style=color:#f92672>/</span>adbhz<span style=color:#f92672>/</span>mgr <span style=color:#f92672>-</span>l <span style=color:#f92672>/</span>data01<span style=color:#f92672>/</span>adbhz<span style=color:#f92672>/</span>mgr<span style=color:#f92672>/</span>logfile
psql <span style=color:#f92672>-</span>d postgres <span style=color:#f92672>-</span>p <span style=color:#ae81ff>15432</span>
deploy all password <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#ae81ff>123456</span><span style=color:#960050;background-color:#1e0010>&#39;</span>;
start agent all password <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#ae81ff>123456</span><span style=color:#960050;background-color:#1e0010>&#39;</span>;
start all;




<span style=color:#ae81ff>13</span><span style=color:#f92672>:</span><span style=color:#ae81ff>17</span><span style=color:#f92672>:</span><span style=color:#ae81ff>18</span>,<span style=color:#ae81ff>635</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>205</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>,
<span style=color:#ae81ff>13</span><span style=color:#f92672>:</span><span style=color:#ae81ff>17</span><span style=color:#f92672>:</span><span style=color:#ae81ff>18</span>,<span style=color:#ae81ff>635</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>205</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>,
<span style=color:#ae81ff>13</span><span style=color:#f92672>:</span><span style=color:#ae81ff>17</span><span style=color:#f92672>:</span><span style=color:#ae81ff>18</span>,<span style=color:#ae81ff>635</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>205</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Measured tpmC (NewOrders) <span style=color:#f92672>=</span> <span style=color:#ae81ff>72442.9</span>
<span style=color:#ae81ff>13</span><span style=color:#f92672>:</span><span style=color:#ae81ff>17</span><span style=color:#f92672>:</span><span style=color:#ae81ff>18</span>,<span style=color:#ae81ff>635</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>205</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Measured tpmTOTAL <span style=color:#f92672>=</span> <span style=color:#ae81ff>161094.77</span>
<span style=color:#ae81ff>13</span><span style=color:#f92672>:</span><span style=color:#ae81ff>17</span><span style=color:#f92672>:</span><span style=color:#ae81ff>18</span>,<span style=color:#ae81ff>636</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>205</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Session Start     <span style=color:#f92672>=</span> <span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>10</span><span style=color:#f92672>-</span><span style=color:#ae81ff>31</span> <span style=color:#ae81ff>13</span><span style=color:#f92672>:</span><span style=color:#ae81ff>07</span><span style=color:#f92672>:</span><span style=color:#ae81ff>18</span>
<span style=color:#ae81ff>13</span><span style=color:#f92672>:</span><span style=color:#ae81ff>17</span><span style=color:#f92672>:</span><span style=color:#ae81ff>18</span>,<span style=color:#ae81ff>636</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>205</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Session End       <span style=color:#f92672>=</span> <span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>10</span><span style=color:#f92672>-</span><span style=color:#ae81ff>31</span> <span style=color:#ae81ff>13</span><span style=color:#f92672>:</span><span style=color:#ae81ff>17</span><span style=color:#f92672>:</span><span style=color:#ae81ff>18</span>
<span style=color:#ae81ff>13</span><span style=color:#f92672>:</span><span style=color:#ae81ff>17</span><span style=color:#f92672>:</span><span style=color:#ae81ff>18</span>,<span style=color:#ae81ff>636</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>205</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Transaction Count <span style=color:#f92672>=</span> <span style=color:#ae81ff>1611814</span>



plan_cache_mode <span style=color:#f92672>=</span> force_generic_plan,enable_fast_query_shipping <span style=color:#f92672>=</span> off<span style=color:#960050;background-color:#1e0010>，</span>pgxc_enable_remote_query<span style=color:#f92672>=</span>off
Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Running Average tpmTOTAL: <span style=color:#ae81ff>149537.60</span>    Current tpmTOTAL: <span style=color:#ae81ff>9878496</span>    Memory Usage: <span style=color:#ae81ff>789</span>MB <span style=color:#f92672>/</span> <span style=color:#ae81ff>1452</span>MB
<span style=color:#ae81ff>14</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22</span>,<span style=color:#ae81ff>637</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>248</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>,
<span style=color:#ae81ff>14</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22</span>,<span style=color:#ae81ff>637</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>248</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>,
<span style=color:#ae81ff>14</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22</span>,<span style=color:#ae81ff>638</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>248</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Measured tpmC (NewOrders) <span style=color:#f92672>=</span> <span style=color:#ae81ff>67315.36</span>
<span style=color:#ae81ff>14</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22</span>,<span style=color:#ae81ff>638</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>248</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Measured tpmTOTAL <span style=color:#f92672>=</span> <span style=color:#ae81ff>149477.31</span>
<span style=color:#ae81ff>14</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22</span>,<span style=color:#ae81ff>638</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>248</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Session Start     <span style=color:#f92672>=</span> <span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>10</span><span style=color:#f92672>-</span><span style=color:#ae81ff>31</span> <span style=color:#ae81ff>14</span><span style=color:#f92672>:</span><span style=color:#ae81ff>28</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22</span>
<span style=color:#ae81ff>14</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22</span>,<span style=color:#ae81ff>638</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>248</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Session End       <span style=color:#f92672>=</span> <span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>10</span><span style=color:#f92672>-</span><span style=color:#ae81ff>31</span> <span style=color:#ae81ff>14</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22</span>
<span style=color:#ae81ff>14</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22</span>,<span style=color:#ae81ff>638</span> [Thread<span style=color:#f92672>-</span><span style=color:#ae81ff>248</span>] INFO   jTPCC : Term<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>, Transaction Count <span style=color:#f92672>=</span> <span style=color:#ae81ff>1495679</span>


<span style=color:#75715e>// 13:56:10,470 [Thread-85] INFO   jTPCC : Term-00,
</span><span style=color:#75715e>// 13:56:10,471 [Thread-85] INFO   jTPCC : Term-00,
</span><span style=color:#75715e>// 13:56:10,471 [Thread-85] INFO   jTPCC : Term-00, Measured tpmC (NewOrders) = 67896.16
</span><span style=color:#75715e>// 13:56:10,471 [Thread-85] INFO   jTPCC : Term-00, Measured tpmTOTAL = 150849.38
</span><span style=color:#75715e>// 13:56:10,471 [Thread-85] INFO   jTPCC : Term-00, Session Start     = 2022-10-31 13:46:10
</span><span style=color:#75715e>// 13:56:10,471 [Thread-85] INFO   jTPCC : Term-00, Session End       = 2022-10-31 13:56:10
</span><span style=color:#75715e>// 13:56:10,471 [Thread-85] INFO   jTPCC : Term-00, Transaction Count = 1508787
</span><span style=color:#75715e></span>



select d_tax, d_next_o_id from bmsql_district where d_w_id <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>1</span> and d_id <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>2</span> <span style=color:#66d9ef>for</span> update;
select c_first, c_middle, c_last, c_street_1, c_street_2, c_city, c_state, c_zip, c_phone, c_since, c_credit, c_credit_lim, c_discount, c_balance from bmsql_customer where c_w_id <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>1</span> and c_d_id <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>2</span> and c_id <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>3</span> <span style=color:#66d9ef>for</span> update;
select s_quantity, s_data, s_dist_01, s_dist_02, s_dist_03, s_dist_04, s_dist_05, s_dist_06, s_dist_07, s_dist_08, s_dist_09, s_dist_10 from bmsql_stock where s_w_id <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>1</span> and s_i_id <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>2</span> <span style=color:#66d9ef>for</span> update;


prepare <span style=color:#a6e22e>s1</span>(<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>) as select d_tax, d_next_o_id from bmsql_district where d_w_id <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>1</span> and d_id <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>2</span> <span style=color:#66d9ef>for</span> update;
explain execute <span style=color:#a6e22e>s1</span>(<span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>2</span>);

prepare <span style=color:#a6e22e>s2</span>(<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>) as select c_first, c_middle, c_last, c_street_1, c_street_2, c_city, c_state, c_zip, c_phone, c_since, c_credit, c_credit_lim, c_discount, c_balance from bmsql_customer where c_w_id <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>1</span> and c_d_id <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>2</span> and c_id <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>3</span> <span style=color:#66d9ef>for</span> update;
explain execute <span style=color:#a6e22e>s2</span>(<span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>2</span>);

prepare <span style=color:#a6e22e>s3</span>(<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>) as select s_quantity, s_data, s_dist_01, s_dist_02, s_dist_03, s_dist_04, s_dist_05, s_dist_06, s_dist_07, s_dist_08, s_dist_09, s_dist_10 from bmsql_stock where s_w_id <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>1</span> and s_i_id <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>2</span> <span style=color:#66d9ef>for</span> update;
explain execute <span style=color:#a6e22e>s3</span>(<span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>1</span>);</code></pre></div>
</div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=https://Esoye.github.io/posts/postgres/remotequery/>
<span class=button__icon>←</span>
<span class=button__text>Postgres RemoteQuery 扩展</span>
</a>
</span>
<span class="button next">
<a href=https://Esoye.github.io/posts/postgres/greenplum/>
<span class=button__text>Greenplum</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<a href=/ class=logo style=text-decoration:none>
<span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span>
<span class=logo__text>Esoye</span>
<span class=logo__cursor></span>
</a>
<div class=copyright>
<span>© 2022 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span>
</div>
</div>
</footer>
<script src=https://Esoye.github.io/assets/main.js></script>
<script src=https://Esoye.github.io/assets/prism.js></script>
</div>
</body>
</html>