<!doctype html><html lang=en>
<head>
<title>vacuum å’Œ analyze è¿‡ç¨‹åˆ†æ :: Asky</title>
<meta charset=utf-8>
<meta charset=utf-8>
<meta name=renderer content="webkit">
<meta name=force-rendering content="webkit">
<meta name=referrer content="no-referrer">
<meta http-equiv=x-ua-compatible content="IE=Edge,chrome=1">
<script>(!1||!!window.MSInputMethodContext&&!!document.documentMode)&&document.write('<script id="_iealwn_js" data-outver="11" src="https://support.dmeng.net/ie-alert-warning/latest.js"><\/script>')</script>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta name=description content="è¯­å¥çš„å…·ä½“ä¿¡æ¯å‚è€ƒpgè¯´æ˜æ–‡æ¡£ http://postgres.cn/docs/12/routine-vacuuming.html http://postgres.cn/docs/12/sql-vacuum.html http://postgres.cn/docs/12/sql-analyze.html antdbå¯¹åŠŸèƒ½è¿›è¡Œå¢å¼ºï¼Œå¯ä»¥cnä¸Šæ‰§è¡Œè¯­å¥ç„¶åæ”¶é›†ç»Ÿè®¡ä¿¡æ¯ï¼Œæ›´æ–°cnçš„å…ƒæ•°æ®ä¿¡æ¯ç­‰æ“ä½œï¼Œä¸”æ•°æ®å˜åŠ¨ä¼šåŒæ­¥åˆ°å…¶ä»–cnèŠ‚ç‚¹å’Œgtm èŠ‚ç‚¹ vacuum cnæ‰§è¡Œvacuumçš„å…¥å£ä¸ºExecVacuumï¼Œå…·ä½“æ‰§è¡Œå‡½æ•°ä¸ºvacuumï¼Œæ­¤å‡½æ•°åœ¨åç»­ä¼šè¢«å…¶ä»–èŠ‚ç‚¹è°ƒç”¨ï¼Œç”¨">
<meta name=keywords content="ç¨‹åºå‘˜ã€ç å†œã€databaseã€C++">
<link href=/atom.xml title=Asky type=application/rss+xml>
<link rel=canonical href=https://askyx.github.io/posts/vacuum/>
<link rel=stylesheet href=//cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.6.0/lxgwwenkaiscreen.css media=print onload="this.media='all'">
<link rel=stylesheet href=/theme-20230215.css>
<link rel="shortcut icon" href=https://askyx.github.io/favicon.ico>
<link rel=apple-touch-icon href=https://askyx.github.io/favicon.ico>
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="black-translucent">
<meta name=apple-mobile-web-app-title content="Asky">
<link rel=bookmark href=https://askyx.github.io/favicon.ico>
<link rel=apple-touch-icon-precomposed sizes=180x180 href=https://askyx.github.io/favicon.ico>
<meta property="og:title" content="vacuum å’Œ analyze è¿‡ç¨‹åˆ†æ">
<meta property="og:description" content="AntDB VACUUM æµç¨‹">
<meta property="og:type" content="article">
<meta property="og:url" content="https://askyx.github.io/posts/vacuum/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-09-26T16:37:37+08:00">
<meta property="article:modified_time" content="2022-09-26T16:37:37+08:00">
<script async defer data-website-id=c27bd84b-02a3-4c3f-a168-0d7fadec9c74 src=https://u.edui.fun/lmmtj.js></script>
<link rel=prefetch href=https://askyx.github.io/posts/locks/>
<link rel=prefetch href=https://askyx.github.io/posts/opt/>
</head>
<body>
<script>var getTheme=localStorage.getItem("theme")||'';getTheme=='dark'?document.body.classList.add("dark"):getTheme=='light'&&document.body.classList.remove("dark")</script>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=https://askyx.github.io/ class=logo style=text-decoration:none>
<span class=logo__text>Asky</span>
<span class=logo__cursor></span>
</a>
<span class=header__right>
<nav class="menu hidden">
<ul class="menu__inner menu__inner--desktop">
<li><a href=/archives/>å½’æ¡£</a></li>
<li><a href=/about/>å…³äºæˆ‘</a></li>
<li><a href=/search/>ğŸ”</a></li>
<li><a href=javascript:; onclick=randomPost() title=éšæœºè®¿é—®ä¸€ç¯‡æ–‡ç« ><svg t="1660103436159" class="icon search-box-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="1184" width="32" height="32"><path d="M421.376 481.28s117.248 24.576 175.104-8.704c0 0-89.6 70.144-89.6 166.4.512-.512-8.192-121.344-85.504-157.696zm17.408 487.936s68.608 6.656 68.608-80.896c0 0 3.072 88.576 65.024 78.336.0.512-50.688 22.016-133.632 2.56zM161.28 238.08s-30.208 65.536 11.264 91.648c0 0-67.072-17.408-81.408 37.376.0.0 8.704-82.944 70.144-129.024zM857.6 227.328s49.152 50.176 1.024 81.408c0 0 58.88-18.432 66.56 36.352.0.0 5.12-69.632-67.584-117.76z" p-id="1185"/><path d="M443.392 970.752c-5.632.0-10.752-1.024-15.36-3.072L157.184 810.496l-1.536-1.024s-1.024-1.024-4.608-2.56c-51.2-29.184-62.976-94.208-65.536-120.832V386.56c0-3.072.512-7.168 1.024-11.264l.512-3.584 1.024-2.56c19.456-50.688 76.8-51.2 103.936-44.032l-1.536 5.632 4.096-6.144L476.16 486.4l18.944 37.888c20.992 36.864 29.184 77.824 32.768 99.84v258.048c-4.608 56.32-36.864 76.288-55.808 82.944-1.024.512-15.36 5.632-28.672 5.632zM181.248 774.656l263.168 152.576c12.288-.512 36.864-6.656 40.448-48.128V628.736c-4.608-31.744-20.992-103.936-72.192-128L322.56 445.44l1.536 3.072L181.76 366.08c-2.048-.512-40.448-9.216-52.736 15.872-.512 2.56-.512 4.608-.512 6.144v294.4c1.536 16.896 9.728 67.072 43.52 86.528 3.584 2.048 6.656 4.096 9.216 5.632z" p-id="1186"/><path d="M837.632 212.992c6.656 4.096 12.8 7.168 18.432 10.752l1.536 1.024 1.536 1.536c5.12 4.096 10.752 9.216 16.384 15.36 6.144 11.776 5.632 33.28 4.608 49.152-1.024 12.288-6.656 30.208-26.624 44.544l-1.024.512-247.808 156.672c-26.624 14.336-62.976 18.432-96.256 18.432-40.96.0-77.824-6.656-89.088-8.704l-3.072-.512-245.248-142.336c-39.424-29.696-28.16-85.504-15.36-113.664l2.56-6.144 263.68-166.912c29.184-14.336 104.448-43.008 173.056-1.024 3.584 2.56 58.368 34.304 119.296 69.632M431.616 460.8c40.448 7.168 114.176 13.824 152.576-6.144L828.928 299.52c7.168-5.632 8.192-10.24 8.704-12.8 1.024-11.264-9.728-26.624-15.36-32.768-55.808-32.256-243.712-141.312-250.368-145.408-49.664-30.72-107.008-9.216-130.048 2.56L192.512 268.8c-4.096 12.288-12.288 42.496 3.584 55.808L431.616 460.8z" p-id="1187"/><path d="M831.488 299.008c4.096-1.024 38.4-11.264 66.048 6.144 7.168 4.608 17.92 11.776 24.064 24.576 1.024 5.632 4.096 10.752 4.608 16.896v2.048l-1.024 323.072c-5.12 35.328-22.528 91.648-77.312 125.44l-5.12 3.584h-1.024L579.584 966.656l-4.608.512c-4.096.512-8.704 1.024-12.8 1.024-15.872.0-30.208-5.12-41.984-14.848-24.576-20.48-32.768-55.808-35.328-73.728l-1.024-252.928h1.536c6.144-96.768 88.576-164.864 96.768-171.008l-.512-.512L829.44 299.52M528.384 867.328c.512 10.24 5.12 41.472 19.968 53.76 3.072 2.56 7.68 5.632 16.384 5.12L829.44 758.272c56.32-38.4 53.76-115.712 53.76-116.224l-.512-32.256 1.024-250.368h-.512c-1.536-12.8-7.168-16.384-8.704-17.408-8.704-5.632-23.552-3.072-28.672-2.048L610.304 488.96c-1.024.512-80.896 65.024-80.896 149.504h-1.536l.512 228.864zM435.2 264.192c0 27.648 31.744 50.176 71.168 50.176s71.168-22.528 71.168-50.176-31.744-50.176-71.168-50.176S435.2 236.544 435.2 264.192z" p-id="1188"/><path d="M663.552 782.848c0 30.72-22.528 67.072-49.664 80.384-27.648 13.824-50.176-.512-50.176-31.232s22.528-67.072 50.176-80.384c27.136-13.824 49.664.0 49.664 31.232zM760.32 602.624c0 30.72-22.528 67.072-49.664 80.384-27.648 13.824-49.664-.512-49.664-31.232s22.528-67.072 49.664-80.384c27.136-13.824 49.664.512 49.664 31.232zM867.84 428.032c0 30.72-22.528 67.072-49.664 80.384C790.528 522.24 768 507.904 768 477.184s22.528-67.072 50.176-80.384c27.136-13.824 49.664.0 49.664 31.232zM270.848 538.112c0 30.72-22.016 41.984-48.64 24.576-27.136-16.896-48.64-55.808-48.64-86.528s22.016-41.984 48.64-24.576c26.624 16.896 48.64 55.808 48.64 86.528zm161.28 285.184c0 30.72-22.016 41.984-48.64 24.576-26.624-17.408-48.64-55.808-48.64-86.528s22.016-41.984 48.64-24.576c26.624 16.896 48.64 55.808 48.64 86.528z" p-id="1189"/></svg></a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/archives/>å½’æ¡£</a></li>
<li><a href=/about/>å…³äºæˆ‘</a></li>
<li><a href=/search/>ğŸ”</a></li>
</ul>
</nav>
<span class="menu-trigger hidden"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
<span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg>
</span>
</span>
</span>
</header>
<div class=content>
<div class="post postgres">
<div class=breadcrumb>
<li>
<a href=https://askyx.github.io/>é¦–é¡µ</a>
</li>
<li>
<a href=https://askyx.github.io/posts/>Posts</a>
</li>
<li class=active>
<a href=https://askyx.github.io/posts/vacuum/>vacuum å’Œ analyze è¿‡ç¨‹åˆ†æ</a>
</li>
</div>
<h2 class=post-title><a href=https://askyx.github.io/posts/vacuum/>vacuum å’Œ analyze è¿‡ç¨‹åˆ†æ</a></h2>
<div class=post-meta>
<span class=post-date>2022-09-26</span>
</div>
<div class=post-content>
<p>è¯­å¥çš„å…·ä½“ä¿¡æ¯å‚è€ƒpgè¯´æ˜æ–‡æ¡£</p>
<ol>
<li><a href=http://postgres.cn/docs/12/routine-vacuuming.html target=_blank rel="noopener nofollow noreferrer">http://postgres.cn/docs/12/routine-vacuuming.html</a></li>
<li><a href=http://postgres.cn/docs/12/sql-vacuum.html target=_blank rel="noopener nofollow noreferrer">http://postgres.cn/docs/12/sql-vacuum.html</a></li>
<li><a href=http://postgres.cn/docs/12/sql-analyze.html target=_blank rel="noopener nofollow noreferrer">http://postgres.cn/docs/12/sql-analyze.html</a></li>
</ol>
<hr>
<p>antdbå¯¹åŠŸèƒ½è¿›è¡Œå¢å¼ºï¼Œå¯ä»¥cnä¸Šæ‰§è¡Œè¯­å¥ç„¶åæ”¶é›†ç»Ÿè®¡ä¿¡æ¯ï¼Œæ›´æ–°cnçš„å…ƒæ•°æ®ä¿¡æ¯ç­‰æ“ä½œï¼Œä¸”æ•°æ®å˜åŠ¨ä¼šåŒæ­¥åˆ°å…¶ä»–cnèŠ‚ç‚¹å’Œgtm èŠ‚ç‚¹</p>
<h2 id=vacuum>vacuum</h2>
<p>cnæ‰§è¡Œvacuumçš„å…¥å£ä¸º<code>ExecVacuum</code>ï¼Œå…·ä½“æ‰§è¡Œå‡½æ•°ä¸º<code>vacuum</code>ï¼Œæ­¤å‡½æ•°åœ¨åç»­ä¼šè¢«å…¶ä»–èŠ‚ç‚¹è°ƒç”¨ï¼Œç”¨æ¥æ›´æ–°æœ¬èŠ‚ç‚¹çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œæ‰€ä»¥ä»–æŒ‰ä¸åŒçš„è§’è‰²æ‰§è¡Œä¸åŒçš„ä»£ç é€»è¾‘</p>
<p>å¯¹äºå½“å‰æ‰§è¡Œè¯­å¥çš„cnï¼Œä¸»è¦ä»»åŠ¡ä¸º</p>
<ol>
<li>æ‰§è¡Œè¯­å¥</li>
<li>ä½¿ç”¨<code>ExecClusterCustomFunction</code>é€šçŸ¥å…¶ä»–èŠ‚ç‚¹è¿›è¡Œvacuumæ“ä½œ</li>
<li>è¿›è¡Œæ•°æ®ä¸­è½¬
<ol>
<li>ä»dnæ”¶é›†ç»Ÿè®¡ä¿¡æ¯çš„æ•°æ®</li>
<li>è½¬å‘åˆ°å…¶ä»–cnå’Œgtmä»¥åŠslave</li>
</ol>
</li>
</ol>
<p>å…¶ä»–cnå’Œgtm</p>
<ol>
<li>æ¥å—cnçš„æ¶ˆæ¯ï¼Œå¯åŠ¨vacuumæ“ä½œï¼Œä½†æ˜¯ç”±äºæœ¬åœ°æ²¡æœ‰æ•°æ®ï¼Œæ‰€ä»¥ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†èƒ½æ‰§è¡Œç›¸åŒçš„ä»£ç é€»è¾‘ï¼Œè¿›è¡Œå…ƒæ•°æ®æ›´æ–°</li>
<li>æ¥æ”¶cnçš„æ•°æ®ï¼Œæ›´æ–°æœ¬èŠ‚ç‚¹å…ƒæ•°æ®ä¿¡æ¯</li>
</ol>
<p>dn</p>
<ol>
<li>æ¥å—cnçš„æ¶ˆæ¯ï¼Œå¯åŠ¨vacuumæ“ä½œ</li>
<li>æ›´æ–°æœ¬èŠ‚ç‚¹çš„å…ƒæ•°æ®ä¿¡æ¯</li>
<li>å‘é€æ•°æ®åˆ°cn</li>
</ol>
<p>å¤§è‡´æµç¨‹å¦‚ä¸‹å›¾</p>
<p><img loading=lazy decoding=async src=/posts/postgres/images/vacuum1.svg alt=rplan1></p>
<p>å…·ä½“çš„æ•°æ®äº¤äº’è¿‡ç¨‹ä»¥<code>vacuum t1</code>ä¸ºä¾‹ï¼Œå¦‚ä¸‹å›¾</p>
<p><img loading=lazy decoding=async src=/posts/postgres/images/vacuum2.svg alt=rplan1></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++>recvfrom(<span style=color:#ae81ff>11</span>, <span style=color:#e6db74>&#34;Q</span><span style=color:#ae81ff>\0\0\0\20</span><span style=color:#e6db74>vacuum  t1;</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>&#34;</span>, <span style=color:#ae81ff>8192</span>, <span style=color:#ae81ff>0</span>, NULL, NULL) <span style=color:#f92672>=</span> <span style=color:#ae81ff>17</span>
sendto(<span style=color:#ae81ff>10</span>, <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\1\0\0\0</span><span style=color:#e6db74> </span><span style=color:#ae81ff>\0\0\0\n</span><span style=color:#e6db74>X</span><span style=color:#ae81ff>\243\335\215\214\2\0\352\266\233\335\215\214\2\0</span><span style=color:#e6db74>w2</span><span style=color:#ae81ff>\0\0\0\0\0\0</span><span style=color:#e6db74>&#34;</span>, <span style=color:#ae81ff>32</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>32</span>
sendto(<span style=color:#ae81ff>17</span>, <span style=color:#e6db74>&#34;p</span><span style=color:#ae81ff>\0\0\0\234\v\377\377\377\20\0\0\0</span><span style=color:#e6db74>cluster_vacuum</span><span style=color:#ae81ff>\0\0\1\0\0</span><span style=color:#e6db74>&#34;</span>..., <span style=color:#ae81ff>157</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>157</span>
sendto(<span style=color:#ae81ff>15</span>, <span style=color:#e6db74>&#34;p</span><span style=color:#ae81ff>\0\0\0\234\v\377\377\377\20\0\0\0</span><span style=color:#e6db74>cluster_vacuum</span><span style=color:#ae81ff>\0\0\1\0\0</span><span style=color:#e6db74>&#34;</span>..., <span style=color:#ae81ff>157</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>157</span>
sendto(<span style=color:#ae81ff>50</span>, <span style=color:#e6db74>&#34;p</span><span style=color:#ae81ff>\0\0\0\234\v\377\377\377\20\0\0\0</span><span style=color:#e6db74>cluster_vacuum</span><span style=color:#ae81ff>\0\0\1\0\0</span><span style=color:#e6db74>&#34;</span>..., <span style=color:#ae81ff>157</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>157</span>
sendto(<span style=color:#ae81ff>49</span>, <span style=color:#e6db74>&#34;p</span><span style=color:#ae81ff>\0\0\0\234\v\377\377\377\20\0\0\0</span><span style=color:#e6db74>cluster_vacuum</span><span style=color:#ae81ff>\0\0\1\0\0</span><span style=color:#e6db74>&#34;</span>..., <span style=color:#ae81ff>157</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>157</span>
recvfrom(<span style=color:#ae81ff>17</span>, <span style=color:#e6db74>&#34;W</span><span style=color:#ae81ff>\0\0\0\7\1\0\0</span><span style=color:#e6db74>&#34;</span>, <span style=color:#ae81ff>16384</span>, <span style=color:#ae81ff>0</span>, NULL, NULL) <span style=color:#f92672>=</span> <span style=color:#ae81ff>8</span>
recvfrom(<span style=color:#ae81ff>15</span>, <span style=color:#e6db74>&#34;W</span><span style=color:#ae81ff>\0\0\0\7\1\0\0</span><span style=color:#e6db74>&#34;</span>, <span style=color:#ae81ff>16384</span>, <span style=color:#ae81ff>0</span>, NULL, NULL) <span style=color:#f92672>=</span> <span style=color:#ae81ff>8</span>
recvfrom(<span style=color:#ae81ff>50</span>, <span style=color:#e6db74>&#34;W</span><span style=color:#ae81ff>\0\0\0\7\1\0\0</span><span style=color:#e6db74>&#34;</span>, <span style=color:#ae81ff>16384</span>, <span style=color:#ae81ff>0</span>, NULL, NULL) <span style=color:#f92672>=</span> <span style=color:#ae81ff>8</span>
recvfrom(<span style=color:#ae81ff>49</span>, <span style=color:#e6db74>&#34;W</span><span style=color:#ae81ff>\0\0\0\7\1\0\0</span><span style=color:#e6db74>&#34;</span>, <span style=color:#ae81ff>16384</span>, <span style=color:#ae81ff>0</span>, NULL, NULL) <span style=color:#f92672>=</span> <span style=color:#ae81ff>8</span>
sendto(<span style=color:#ae81ff>17</span>, <span style=color:#e6db74>&#34;d</span><span style=color:#ae81ff>\0\0\0\23\200\232\2\0\0</span><span style=color:#e6db74>public</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>t1</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>&#34;</span>, <span style=color:#ae81ff>20</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span> TCP b3b87dd4fb6c:<span style=color:#ae81ff>59200</span><span style=color:#f92672>-&gt;</span>b3b87dd4fb6c:<span style=color:#ae81ff>65032</span> (ESTABLISHED) cn1
sendto(<span style=color:#ae81ff>15</span>, <span style=color:#e6db74>&#34;d</span><span style=color:#ae81ff>\0\0\0\23\200\232\2\0\0</span><span style=color:#e6db74>public</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>t1</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>&#34;</span>, <span style=color:#ae81ff>20</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span> TCP b3b87dd4fb6c:<span style=color:#ae81ff>46498</span><span style=color:#f92672>-&gt;</span>b3b87dd4fb6c:<span style=color:#ae81ff>65011</span> (ESTABLISHED) gtm
sendto(<span style=color:#ae81ff>50</span>, <span style=color:#e6db74>&#34;d</span><span style=color:#ae81ff>\0\0\0\23\200\232\2\0\0</span><span style=color:#e6db74>public</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>t1</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>&#34;</span>, <span style=color:#ae81ff>20</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span> TCP b3b87dd4fb6c:<span style=color:#ae81ff>54044</span><span style=color:#f92672>-&gt;</span>b3b87dd4fb6c:<span style=color:#ae81ff>65013</span> (ESTABLISHED) dn1
sendto(<span style=color:#ae81ff>49</span>, <span style=color:#e6db74>&#34;d</span><span style=color:#ae81ff>\0\0\0\23\200\232\2\0\0</span><span style=color:#e6db74>public</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>t1</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>&#34;</span>, <span style=color:#ae81ff>20</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span> TCP b3b87dd4fb6c:<span style=color:#ae81ff>55242</span><span style=color:#f92672>-&gt;</span>b3b87dd4fb6c:<span style=color:#ae81ff>65014</span> (ESTABLISHED) dn2
recvfrom(<span style=color:#ae81ff>50</span>, <span style=color:#e6db74>&#34;d</span><span style=color:#ae81ff>\0\0\0\266</span><span style=color:#e6db74>T</span><span style=color:#ae81ff>\5\0\0\0\0</span><span style=color:#e6db74>new_rel_pages</span><span style=color:#ae81ff>\0\377\377\377\377\0\0\0</span><span style=color:#e6db74>&#34;</span>..., <span style=color:#ae81ff>16384</span>, <span style=color:#ae81ff>0</span>, NULL, NULL) <span style=color:#f92672>=</span> <span style=color:#ae81ff>237</span>
recvfrom(<span style=color:#ae81ff>49</span>, <span style=color:#e6db74>&#34;d</span><span style=color:#ae81ff>\0\0\0\266</span><span style=color:#e6db74>T</span><span style=color:#ae81ff>\5\0\0\0\0</span><span style=color:#e6db74>new_rel_pages</span><span style=color:#ae81ff>\0\377\377\377\377\0\0\0</span><span style=color:#e6db74>&#34;</span>..., <span style=color:#ae81ff>16384</span>, <span style=color:#ae81ff>0</span>, NULL, NULL) <span style=color:#f92672>=</span> <span style=color:#ae81ff>237</span>
sendto(<span style=color:#ae81ff>17</span>, <span style=color:#e6db74>&#34;d</span><span style=color:#ae81ff>\0\0\0\266</span><span style=color:#e6db74>T</span><span style=color:#ae81ff>\5\0\0\0\0</span><span style=color:#e6db74>new_rel_pages</span><span style=color:#ae81ff>\0\377\377\377\377\0\0\0</span><span style=color:#e6db74>&#34;</span>..., <span style=color:#ae81ff>231</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>231</span>
sendto(<span style=color:#ae81ff>15</span>, <span style=color:#e6db74>&#34;d</span><span style=color:#ae81ff>\0\0\0\266</span><span style=color:#e6db74>T</span><span style=color:#ae81ff>\5\0\0\0\0</span><span style=color:#e6db74>new_rel_pages</span><span style=color:#ae81ff>\0\377\377\377\377\0\0\0</span><span style=color:#e6db74>&#34;</span>..., <span style=color:#ae81ff>231</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>231</span>
recvfrom(<span style=color:#ae81ff>17</span>, <span style=color:#e6db74>&#34;d</span><span style=color:#ae81ff>\0\0\0\5</span><span style=color:#e6db74>Md</span><span style=color:#ae81ff>\0\0\0\5</span><span style=color:#e6db74>M&#34;</span>, <span style=color:#ae81ff>16384</span>, <span style=color:#ae81ff>0</span>, NULL, NULL) <span style=color:#f92672>=</span> <span style=color:#ae81ff>12</span>
recvfrom(<span style=color:#ae81ff>15</span>, <span style=color:#e6db74>&#34;d</span><span style=color:#ae81ff>\0\0\0\5</span><span style=color:#e6db74>Md</span><span style=color:#ae81ff>\0\0\0\5</span><span style=color:#e6db74>M&#34;</span>, <span style=color:#ae81ff>16384</span>, <span style=color:#ae81ff>0</span>, NULL, NULL) <span style=color:#f92672>=</span> <span style=color:#ae81ff>12</span>
sendto(<span style=color:#ae81ff>10</span>, <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n\0\0\000</span><span style=color:#e6db74>0</span><span style=color:#ae81ff>\0\0\0</span><span style=color:#e6db74>w2</span><span style=color:#ae81ff>\0\0\4</span><span style=color:#e6db74>@</span><span style=color:#ae81ff>\0\0\0\214</span><span style=color:#e6db74>2</span><span style=color:#ae81ff>\177\262</span><span style=color:#e6db74>U</span><span style=color:#ae81ff>\0\0</span><span style=color:#e6db74>y</span><span style=color:#ae81ff>\224\243\335\215\214\2\0</span><span style=color:#e6db74>&#34;</span>..., <span style=color:#ae81ff>48</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>48</span>
sendto(<span style=color:#ae81ff>17</span>, <span style=color:#e6db74>&#34;c</span><span style=color:#ae81ff>\0\0\0\4</span><span style=color:#e6db74>&#34;</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>)  <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
sendto(<span style=color:#ae81ff>15</span>, <span style=color:#e6db74>&#34;c</span><span style=color:#ae81ff>\0\0\0\4</span><span style=color:#e6db74>&#34;</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>)  <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
sendto(<span style=color:#ae81ff>50</span>, <span style=color:#e6db74>&#34;c</span><span style=color:#ae81ff>\0\0\0\4</span><span style=color:#e6db74>&#34;</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>)  <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
sendto(<span style=color:#ae81ff>49</span>, <span style=color:#e6db74>&#34;c</span><span style=color:#ae81ff>\0\0\0\4</span><span style=color:#e6db74>&#34;</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>)  <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
recvfrom(<span style=color:#ae81ff>17</span>, <span style=color:#e6db74>&#34;c</span><span style=color:#ae81ff>\0\0\0\4</span><span style=color:#e6db74>Z</span><span style=color:#ae81ff>\0\0\0\5</span><span style=color:#e6db74>I&#34;</span>, <span style=color:#ae81ff>16384</span>, <span style=color:#ae81ff>0</span>, NULL, NULL) <span style=color:#f92672>=</span> <span style=color:#ae81ff>11</span>
recvfrom(<span style=color:#ae81ff>15</span>, <span style=color:#e6db74>&#34;c</span><span style=color:#ae81ff>\0\0\0\4</span><span style=color:#e6db74>Z</span><span style=color:#ae81ff>\0\0\0\5</span><span style=color:#e6db74>I&#34;</span>, <span style=color:#ae81ff>16384</span>, <span style=color:#ae81ff>0</span>, NULL, NULL) <span style=color:#f92672>=</span> <span style=color:#ae81ff>11</span>
recvfrom(<span style=color:#ae81ff>50</span>, <span style=color:#e6db74>&#34;c</span><span style=color:#ae81ff>\0\0\0\4</span><span style=color:#e6db74>Z</span><span style=color:#ae81ff>\0\0\0\5</span><span style=color:#e6db74>I&#34;</span>, <span style=color:#ae81ff>16384</span>, <span style=color:#ae81ff>0</span>, NULL, NULL) <span style=color:#f92672>=</span> <span style=color:#ae81ff>11</span>
recvfrom(<span style=color:#ae81ff>49</span>, <span style=color:#e6db74>&#34;c</span><span style=color:#ae81ff>\0\0\0\4</span><span style=color:#e6db74>Z</span><span style=color:#ae81ff>\0\0\0\5</span><span style=color:#e6db74>I&#34;</span>, <span style=color:#ae81ff>16384</span>, <span style=color:#ae81ff>0</span>, NULL, NULL) <span style=color:#f92672>=</span> <span style=color:#ae81ff>11</span>
sendto(<span style=color:#ae81ff>10</span>, <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\2\0\0\0\230\0\0\0</span><span style=color:#e6db74>w2</span><span style=color:#ae81ff>\0\0\1\0\0\0\3\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0</span><span style=color:#e6db74>&#34;</span>..., <span style=color:#ae81ff>152</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>152</span>
sendto(<span style=color:#ae81ff>10</span>, <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\2\0\0\0\230\0\0\0\0\0\0\0\1\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0</span><span style=color:#e6db74>&#34;</span>..., <span style=color:#ae81ff>152</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>152</span>
sendto(<span style=color:#ae81ff>10</span>, <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\16\0\0\0</span><span style=color:#e6db74>H</span><span style=color:#ae81ff>\0\0\0\6\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\1\0\0\0\0\0\0\0</span><span style=color:#e6db74>&#34;</span>..., <span style=color:#ae81ff>72</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>72</span>
sendto(<span style=color:#ae81ff>11</span>, <span style=color:#e6db74>&#34;C</span><span style=color:#ae81ff>\0\0\0\v</span><span style=color:#e6db74>VACUUM</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>Z</span><span style=color:#ae81ff>\0\0\0\5</span><span style=color:#e6db74>I&#34;</span>, <span style=color:#ae81ff>18</span>, <span style=color:#ae81ff>0</span>, NULL, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>18</span>
</code></pre></div><p>ä»å…·ä½“çš„æ•°æ®äº¤äº’çš„traceä¿¡æ¯å¯ä»¥çœ‹å‡ºï¼Œcnéœ€è¦ä½¿ç”¨pæ¶ˆæ¯å‘é€ä¸€ä¸ªå‡½æ•°è°ƒç”¨åˆ°å…·ä½“çš„èŠ‚ç‚¹ä¸Šå»æ‰§è¡Œï¼Œcnæ‰§è¡Œvacuumçš„å‡½æ•°ä¸»è¦æ˜¯åœ¨<code>vacuum_rel</code>ä¸­è¿›è¡Œçš„ï¼Œè¿™é‡Œä¼šæŠŠéœ€è¦æ“ä½œçš„è¡¨ä¼ è¾“åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šå»ï¼Œä¸»è¦ä¼ è¾“çš„æ•°æ®å¦‚ä¸‹ï¼Œä»–å…ˆè®¾ç½®æ¶ˆæ¯ç±»å‹ä¸º<code>CLUSTER_VACUUM_CMD_VACUUM</code>ï¼Œä¹‹åå†æ‰“åŒ…xidå’Œnameã€‚æ¶ˆæ¯ç±»å‹åœ¨åé¢çš„<code>process_master_vacuum_cmd</code>ä¸­ä¼šè¿›è¡Œå¤„ç†ã€‚<code>CLUSTER_VACUUM_CMD_VACUUM</code>å¯¹åº”vacuum</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++>			appendStringInfoChar(<span style=color:#f92672>&amp;</span>buf, CLUSTER_VACUUM_CMD_VACUUM);
			appendBinaryStringInfo(<span style=color:#f92672>&amp;</span>buf, (<span style=color:#66d9ef>char</span><span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>xid, <span style=color:#66d9ef>sizeof</span>(xid));
			<span style=color:#66d9ef>namespace</span> <span style=color:#f92672>=</span> get_namespace_name(RelationGetNamespace(onerel));
			save_node_string(<span style=color:#f92672>&amp;</span>buf, <span style=color:#66d9ef>namespace</span>);
			save_node_string(<span style=color:#f92672>&amp;</span>buf, RelationGetRelationName(onerel));
</code></pre></div><p>å‘é€æ•°æ®ä¹‹åæŒ‰åŸæ¥çš„é€»è¾‘ç»§ç»­è¿è¡Œï¼Œåé¢ä½¿ç”¨<code>lazy_vacuum_rel_ext</code>å‡½æ•°å¤„ç†vacuumï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯pgæ”¯æŒä¸¤ç§vacuumæ“ä½œï¼Œä¸€ç§æ˜¯<code>vacuum lazy</code>ï¼Œä¸€ç§æ˜¯<code>vacuum full</code>ï¼Œå‰è€…ä¸ä¼šè·¨pageæ“ä½œè¡¨ï¼Œåªæ˜¯æ ‡è®°ä¸‹è¿‡æœŸæ•°æ®ç„¶åæ›´æ–°fsmå’Œvmï¼Œåè€…ç®€å•çš„ç†è§£ä¼šé‡å»ºçš„è¡¨</p>
<p>(<a href=https://cloud.tencent.com/developer/article/1743815 target=_blank rel="noopener nofollow noreferrer">openGauss/PostgreSQL vacuum fullæºç è§£æ - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a>)</p>
<p>åœ¨<code>lazy_vacuum_rel_ext</code>ä¸­ï¼Œåˆ™è¿›è¡Œå…·ä½“çš„vacuumæ“ä½œï¼Œcnä¼šæ¥æ”¶dnçš„æ•°æ®ï¼Œè½¬å‘åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++>	<span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>IsToastRelation(onerel) <span style=color:#f92672>&amp;&amp;</span> (onerel<span style=color:#f92672>-&gt;</span>rd_locator_info <span style=color:#f92672>!=</span> NULL))
	{
		<span style=color:#66d9ef>if</span> (IsCnMaster() <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>IsConnFromCoord())
		{
			<span style=color:#66d9ef>if</span> (dn_conns <span style=color:#f92672>!=</span> NIL)
			{
				<span style=color:#75715e>/* recv vacuum sync info from datanode */</span>
				VACUUM_CLUSTER_DEBUG_LOG((errmsg(<span style=color:#e6db74>&#34;cnmaster relname %s wait vacuum sync info from dn</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, RelationGetRelationName(onerel))));
				acquire_vsi_coord_master(dn_conns, <span style=color:#f92672>&amp;</span>sum_vsi);
				VACUUM_CLUSTER_DEBUG_LOG((errmsg(<span style=color:#e6db74>&#34;acquire_vsi_coord_master:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)));
				PrintDebugVsi(<span style=color:#f92672>&amp;</span>sum_vsi);
				new_rel_pages <span style=color:#f92672>=</span> sum_vsi.new_rel_pages;
				new_live_tuples <span style=color:#f92672>=</span> sum_vsi.new_live_tuples;
				new_rel_allvisible <span style=color:#f92672>=</span> sum_vsi.new_rel_allvisible;
				new_frozen_xid <span style=color:#f92672>=</span> sum_vsi.new_frozen_xid;
				new_min_multi <span style=color:#f92672>=</span> sum_vsi.new_min_multi;
			}

			<span style=color:#66d9ef>if</span> (cn_conns <span style=color:#f92672>!=</span> NIL)
			{
				<span style=color:#75715e>/* send relfreezeid to other coordinator */</span>
				VACUUM_CLUSTER_DEBUG_LOG((errmsg(<span style=color:#e6db74>&#34;cnmaster relname %s send vacuum info to other cn slave:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, RelationGetRelationName(onerel))));
				send_vsi_other_coord(cn_conns, <span style=color:#f92672>&amp;</span>sum_vsi);
			}

			<span style=color:#66d9ef>if</span> (cn_conns)
			{
				VACUUM_CLUSTER_DEBUG_LOG((errmsg(<span style=color:#e6db74>&#34;cnmaster relname %s waiter cn slave ack:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, RelationGetRelationName(onerel))));
				cluster_recv_exec_end(cn_conns);
			}
		}
		<span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> ((params<span style=color:#f92672>-&gt;</span>options <span style=color:#f92672>&amp;</span> VACOPT_IN_CLUSTER) <span style=color:#f92672>==</span> VACOPT_IN_CLUSTER <span style=color:#f92672>&amp;&amp;</span>
			IS_PGXC_COORDINATOR <span style=color:#f92672>&amp;&amp;</span>
			IsConnFromCoord())
		{
			<span style=color:#75715e>/* recv freeze xid from master */</span>
			VACUUM_CLUSTER_DEBUG_LOG((errmsg(<span style=color:#e6db74>&#34;cn slave relname %s waiter cn master vacuum info:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, RelationGetRelationName(onerel))));
			acquire_relvsi_coord_slave(<span style=color:#f92672>&amp;</span>sum_vsi);
			VACUUM_CLUSTER_DEBUG_LOG((errmsg(<span style=color:#e6db74>&#34;cn slave relname %s get cn master vacuum info:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, RelationGetRelationName(onerel))));
			PrintDebugVsi(<span style=color:#f92672>&amp;</span>sum_vsi);
			new_rel_pages <span style=color:#f92672>=</span> sum_vsi.new_rel_pages;
			new_live_tuples <span style=color:#f92672>=</span> sum_vsi.new_live_tuples;
			new_rel_allvisible <span style=color:#f92672>=</span> sum_vsi.new_rel_allvisible;
			new_frozen_xid <span style=color:#f92672>=</span> sum_vsi.new_frozen_xid;
			new_min_multi <span style=color:#f92672>=</span> sum_vsi.new_min_multi;
		}
	}
</code></pre></div><hr>
<h3 id=å¯¹äºdn>å¯¹äºDN</h3>
<p>cnå‘é€çš„å‡½æ•°ä¸ºcluster_vacuumï¼Œæ­¤å‡½æ•°ä¼šè®¾ç½®æ ‡è®°<code>VACOPT_IN_CLUSTER</code>ï¼Œç”¨æ¥åŒºåˆ†åœ¨vacuumä¸­çš„è§’è‰²ï¼Œä¹‹åä¼šè°ƒç”¨vacuumå‡½æ•°</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cluster_vacuum</span>(<span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>StringInfoData</span> <span style=color:#f92672>*</span>msg)
{
	StringInfoData	buf;
	VacuumParams	params;

	buf.data <span style=color:#f92672>=</span> mem_toc_lookup(msg, REMOTE_KEY_VACUUM_INFO, <span style=color:#f92672>&amp;</span>buf.maxlen);
	<span style=color:#66d9ef>if</span> (buf.data <span style=color:#f92672>==</span> NULL)
	{
		ereport(ERROR,
				(errcode(ERRCODE_PROTOCOL_VIOLATION),
				 errmsg(<span style=color:#e6db74>&#34;Can not found vacuum info&#34;</span>)));
	}
	buf.cursor <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
	buf.len <span style=color:#f92672>=</span> buf.maxlen;

	pq_copymsgbytes(<span style=color:#f92672>&amp;</span>buf, (<span style=color:#66d9ef>char</span><span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>params, <span style=color:#66d9ef>sizeof</span>(params));

	params.options <span style=color:#f92672>|=</span> VACOPT_IN_CLUSTER;
	vacuum(NIL,
		   <span style=color:#f92672>&amp;</span>params,
		   NULL,
		   true);
}
</code></pre></div><p>è¿™é‡Œè°ƒç”¨çš„æ—¶å€™relationæŒ‡å®šä¸ºnullï¼Œåé¢<code>SimpleNextCopyFromNewFE</code>ä¼šä»cnæ¥æ”¶æ•°æ®è¿›è¡Œå…·ä½“çš„vacuumæ“ä½œ</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=color:#75715e>#ifdef ADB
</span><span style=color:#75715e></span>		<span style=color:#66d9ef>if</span> (params<span style=color:#f92672>-&gt;</span>options <span style=color:#f92672>&amp;</span> VACOPT_IN_CLUSTER)
		{
			ClusterVacuumCmdContext context;
			context.params <span style=color:#f92672>=</span> params;
			context.use_own_xacts <span style=color:#f92672>=</span> use_own_xacts;
			context.in_outer_xact <span style=color:#f92672>=</span> in_outer_xact;

			SimpleNextCopyFromNewFE((SimpleCopyDataFunction)process_master_vacuum_cmd, <span style=color:#f92672>&amp;</span>context);
		}
<span style=color:#75715e>#endif </span><span style=color:#75715e>/* ADB */</span><span style=color:#75715e>
</span></code></pre></div><p>è¿™é‡Œçš„å›è°ƒå‡½æ•°<code>process_master_vacuum_cmd</code>ä¼šæŒ‰ç…§è¯­å¥çš„ç±»å‹æ‰§è¡Œä¸åŒçš„æ–¹æ³•ï¼Œå¦‚æœæ˜¯vacuumæ–¹æ³•ï¼Œåˆ™æ‰§è¡Œ<code>vacuum_rel</code>ï¼Œæœ€ç»ˆåœ¨<code>lazy_vacuum_rel_ext</code>ä¸­ï¼Œæ‰§è¡Œå®Œvacuumä¹‹åå¾—åˆ°å…·ä½“çš„ç»Ÿè®¡æ•°æ®ï¼Œåœ¨æ›´æ–°å®Œ<code>pg_class</code>ä¹‹åï¼Œè°ƒç”¨<code>send_localvsi_to_coord</code>å‘é€æ•°æ®åˆ°cnã€‚</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++>	<span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>IsToastRelation(onerel) <span style=color:#f92672>&amp;&amp;</span> IsConnFromCoord() <span style=color:#f92672>&amp;&amp;</span> IS_PGXC_DATANODE)
	{
		<span style=color:#75715e>/* send freeze xid to master */</span>
		VACUUM_CLUSTER_DEBUG_LOG((errmsg(<span style=color:#e6db74>&#34;dn relname %s send local vacuum info to cn master :</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, RelationGetRelationName(onerel))));
		PrintDebugVsi(<span style=color:#f92672>&amp;</span>local_vsi);
		send_localvsi_to_coord(<span style=color:#f92672>&amp;</span>local_vsi);
	}
</code></pre></div><p><code>lazy_vacuum_rel_ext</code>ä¸­çš„æµç¨‹å¤§è‡´å¦‚ä¸‹</p>
<p><img loading=lazy decoding=async src=/posts/postgres/images/vacuum3.svg alt=rplan1></p>
<h2 id=analyze>analyze</h2>
<p>analyze çš„å¤§è‡´æµç¨‹å’Œvacuumç±»ä¼¼ï¼Œvacuumæ”¯æŒä½¿ç”¨<code>vacuum analyze</code>å‘½ä»¤åœ¨è¿›è¡Œvacuumä¹‹ååŒæ—¶è°ƒç”¨analyzeæ”¶é›†ç»Ÿè®¡ä¿¡æ¯ã€‚æ‰€ä»¥åœ¨åŠŸèƒ½ä¸Šä»–ä»¬æ˜¯ç±»ä¼¼çš„ï¼Œæ‰€ä»¥pgæŠŠvacuumå’Œanalyzeå®ç°åœ¨åŒä¸€ä¸ªå‡½æ•°ä¸­ï¼Œæœ€ç»ˆåœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œvacuumä½¿ç”¨<code>vacuum_rel</code>è¿›è¡Œvacuumï¼Œä¹‹åç´§æ¥ç€ä½¿ç”¨<code>analyze_rel</code>æ‰§è¡Œanalyzeï¼Œåœ¨<code>analyze_rel</code>ä¸­ï¼Œæ•°æ®çš„äº¤äº’å’Œvacuumç±»ä¼¼ï¼Œåœ¨ä¸‹å‘åˆ°dnçš„æ•°æ®æ‰“åŒ…çš„æ—¶å€™ï¼Œæ ‡è®°ç±»å‹ä¸º<code>CLUSTER_VACUUM_CMD_ANALYZE</code>æˆ–è€…<code>CLUSTER_VACUUM_CMD_ANALYZE_FORCE_INH</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++>			initStringInfo(<span style=color:#f92672>&amp;</span>buf);
			<span style=color:#66d9ef>if</span> (onerel<span style=color:#f92672>-&gt;</span>rd_rel<span style=color:#f92672>-&gt;</span>relhassubclass)
				appendStringInfoChar(<span style=color:#f92672>&amp;</span>buf, CLUSTER_VACUUM_CMD_ANALYZE_FORCE_INH);
			<span style=color:#66d9ef>else</span>
				<span style=color:#a6e22e>appendStringInfoChar</span>(<span style=color:#f92672>&amp;</span>buf, CLUSTER_VACUUM_CMD_ANALYZE);
			
			xid <span style=color:#f92672>=</span> GetTopTransactionId();
			appendBinaryStringInfo(<span style=color:#f92672>&amp;</span>buf, (<span style=color:#66d9ef>char</span><span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>xid, <span style=color:#66d9ef>sizeof</span>(xid));
			save_node_string(<span style=color:#f92672>&amp;</span>buf, <span style=color:#66d9ef>namespace</span>);
			save_node_string(<span style=color:#f92672>&amp;</span>buf, RelationGetRelationName(onerel));
</code></pre></div><p>dnä¸Š<code>process_master_vacuum_cmd</code>ä½¿ç”¨analyze_relå‡½æ•°å¤„ç†analyzeæ“ä½œï¼Œåœ¨è¿›è¡Œanalyzeä¹‹åï¼Œä¼šæŠŠæ•°æ®ä¼ é€åˆ°cnï¼Œåœ¨analyze_relä¸­ï¼Œä¹ŸåŒºåˆ†è§’è‰²ï¼Œæ‰§è¡Œä¸åŒçš„æ“ä½œæµç¨‹</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++>	<span style=color:#66d9ef>if</span> (acquirefunc <span style=color:#f92672>==</span> acquire_sample_rows_coord_master <span style=color:#f92672>||</span>
		((params<span style=color:#f92672>-&gt;</span>options <span style=color:#f92672>&amp;</span> VACOPT_IN_CLUSTER) <span style=color:#f92672>==</span> VACOPT_IN_CLUSTER <span style=color:#f92672>&amp;&amp;</span>
		 IsCnMaster() <span style=color:#f92672>&amp;&amp;</span>
		 (onerel<span style=color:#f92672>-&gt;</span>rd_rel<span style=color:#f92672>-&gt;</span>relkind <span style=color:#f92672>==</span> RELKIND_MATVIEW <span style=color:#f92672>||</span>
		  onerel<span style=color:#f92672>-&gt;</span>rd_rel<span style=color:#f92672>-&gt;</span>relkind <span style=color:#f92672>==</span> RELKIND_FOREIGN_TABLE)))
	{
        ......
		<span style=color:#66d9ef>if</span> (onerel<span style=color:#f92672>-&gt;</span>rd_rel<span style=color:#f92672>-&gt;</span>relkind <span style=color:#f92672>!=</span> RELKIND_PARTITIONED_TABLE)
		{
			<span style=color:#66d9ef>if</span> (dnlist <span style=color:#f92672>!=</span> NIL)
			{
				<span style=color:#75715e>/* recv relpages from datanode */</span>
				relpages <span style=color:#f92672>=</span> acquire_relpage_num_coord_master(dnlist);
			}

			<span style=color:#66d9ef>if</span> (cnlist <span style=color:#f92672>!=</span> NIL)
			{
				<span style=color:#75715e>/* send relpages to other coordinator */</span>
				send_relpage_num_to_other_coord(cnlist, relpages);
			}
		}
	}<span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (acquirefunc <span style=color:#f92672>==</span> acquire_sample_rows_coord_slave <span style=color:#f92672>&amp;&amp;</span>
		onerel<span style=color:#f92672>-&gt;</span>rd_rel<span style=color:#f92672>-&gt;</span>relkind <span style=color:#f92672>!=</span> RELKIND_PARTITIONED_TABLE)
	{
		<span style=color:#75715e>/* recv relpages from master */</span>
		relpages <span style=color:#f92672>=</span> acquire_relpage_num_coord_slave();
	}<span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (IS_PGXC_DATANODE <span style=color:#f92672>&amp;&amp;</span>
		IsConnFromCoord() <span style=color:#f92672>&amp;&amp;</span>
		(params<span style=color:#f92672>-&gt;</span>options <span style=color:#f92672>&amp;</span> VACOPT_IN_CLUSTER) <span style=color:#f92672>==</span> VACOPT_IN_CLUSTER <span style=color:#f92672>&amp;&amp;</span>
		onerel<span style=color:#f92672>-&gt;</span>rd_rel<span style=color:#f92672>-&gt;</span>relkind <span style=color:#f92672>!=</span> RELKIND_PARTITIONED_TABLE)
	{
		<span style=color:#75715e>/* send relpages to master */</span>
		send_relpage_num_to_coord(relpages);
	}

</code></pre></div><p>ç»Ÿè®¡ä¿¡æ¯ä¸»è¦ç”¨äºæŒ‡å¯¼ä¼˜åŒ–å™¨ä¼˜åŒ–æ‰§è¡Œè®¡åˆ’ã€‚å…ƒæ•°æ®ä¸­pg_statisticä¸»è¦å­˜å‚¨ç»Ÿè®¡ä¿¡æ¯ï¼Œä½†æ˜¯ä¸æ˜¯å¯ä»¥äººè¯»çš„ï¼Œå®˜ç½‘çš„è§£é‡Šæ˜¯è¡¨ä¸­çš„æ•°æ®æ˜¯æ¯”è¾ƒæ•æ„Ÿçš„ã€‚æ‰€ä»¥pgå»ºç«‹äº†ä¸¤ä¸ªè§†å›¾ï¼Œ<code>pg_stats</code>å’Œ<code>pg_statistic_ext</code>ï¼Œå‰è€…æ˜¯å¸¸è§„çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œåè€…ä¸»è¦æ˜¯è‡ªå®šä¹‰è¡¨è¾¾å¼çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</p>
<p>pg_statisticçš„æ•°æ®ç”±analyze æ”¶é›†ï¼Œå…·ä½“çš„æ”¶é›†è¿‡ç¨‹åœ¨å‡½æ•°<code>analyze_rel</code>ä¸­çš„<code>do_analyze_rel</code>å‡½æ•°ï¼Œåœ¨<code>analyze_rel</code>å‰é¢å¤„ç†å®Œå‰ç½®åˆ¤æ–­ä¹‹åï¼Œ<code>do_analyze_rel</code>è¯»è¡¨æŠ½æ ·ï¼Œç„¶åè®¡ç®—ç»Ÿè®¡ä¿¡æ¯ï¼Œè¯»è¡¨ä½¿ç”¨çš„æ˜¯<code>acquire_sample_rows</code>å‡½æ•°ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯</p>
<ol>
<li>æŠ½æ ·æ¯”ä¾‹æŒ‰è¡¨çš„å¤§å°ï¼Œé»˜è®¤æœ€å¤šåªæŠ½å–30000è¡Œï¼Œå°‘äº30000åˆ™å…¨é‡ç»Ÿè®¡ï¼Œæœ‰ä¸€ä¸ªå‚æ•°å¯ä»¥è¿›è¡Œæ§åˆ¶ï¼Œ</li>
<li>æŠ½æ ·æœ‰å…·ä½“çš„ç®—æ³•ï¼Œå’Œåˆ—ç±»å‹å¯†åˆ‡ç›¸å…³</li>
<li>å…ˆæŠ½å–æ‰€æœ‰pageï¼Œç„¶ååœ¨pageé‡Œé¢åœ¨æŠ½æ ·</li>
</ol>
<p>å¯ä»¥å‚è€ƒä»£ç <code>std_typanalyze</code>é‡Œé¢çš„ç‰‡æ®µï¼Œå…¶ä¸­attstattargetç”±gucå‚æ•°default_statistics_targetæ§åˆ¶ï¼Œé»˜è®¤ä¸º100.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++>	<span style=color:#66d9ef>if</span> (OidIsValid(eqopr) <span style=color:#f92672>&amp;&amp;</span> OidIsValid(ltopr))
	{
		<span style=color:#75715e>/* Seems to be a scalar datatype */</span>
		stats<span style=color:#f92672>-&gt;</span>compute_stats <span style=color:#f92672>=</span> compute_scalar_stats;
		<span style=color:#75715e>/*--------------------
</span><span style=color:#75715e>		 * The following choice of minrows is based on the paper
</span><span style=color:#75715e>		 * &#34;Random sampling for histogram construction: how much is enough?&#34;
</span><span style=color:#75715e>		 * by Surajit Chaudhuri, Rajeev Motwani and Vivek Narasayya, in
</span><span style=color:#75715e>		 * Proceedings of ACM SIGMOD International Conference on Management
</span><span style=color:#75715e>		 * of Data, 1998, Pages 436-447.  Their Corollary 1 to Theorem 5
</span><span style=color:#75715e>		 * says that for table size n, histogram size k, maximum relative
</span><span style=color:#75715e>		 * error in bin size f, and error probability gamma, the minimum
</span><span style=color:#75715e>		 * random sample size is
</span><span style=color:#75715e>		 *		r = 4 * k * ln(2*n/gamma) / f^2
</span><span style=color:#75715e>		 * Taking f = 0.5, gamma = 0.01, n = 10^6 rows, we obtain
</span><span style=color:#75715e>		 *		r = 305.82 * k
</span><span style=color:#75715e>		 * Note that because of the log function, the dependence on n is
</span><span style=color:#75715e>		 * quite weak; even at n = 10^12, a 300*k sample gives &lt;= 0.66
</span><span style=color:#75715e>		 * bin size error with probability 0.99.  So there&#39;s no real need to
</span><span style=color:#75715e>		 * scale for n, which is a good thing because we don&#39;t necessarily
</span><span style=color:#75715e>		 * know it at this point.
</span><span style=color:#75715e>		 *--------------------
</span><span style=color:#75715e>		 */</span>
		stats<span style=color:#f92672>-&gt;</span>minrows <span style=color:#f92672>=</span> <span style=color:#ae81ff>300</span> <span style=color:#f92672>*</span> attr<span style=color:#f92672>-&gt;</span>attstattarget;
	}
</code></pre></div><p>ç¡®å®šè¡Œæ•°ä¹‹åä½¿ç”¨<code>acquire_sample_rows</code>æŠ½å–æ•°æ®ï¼Œå­˜å‚¨åˆ°rowä¸­ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ä»–ä½¿ç”¨ä¸åŒçš„éšæœºç®—æ³•ï¼Œéœ€è¦å‡è¡¡åˆ°pageå’Œtuplesï¼Œæ˜¯æœ‰å…·ä½“çš„ç†è®º(Jeff Vitter)æŒ‡å¯¼çš„ï¼Œå¤§è‡´æ¥è¯´å°±æ˜¯ä¸¤é˜¶æ®µé‡‡æ ·</p>
<blockquote>
<p>ç¬¬ä¸€é˜¶æ®µå¯¹æ•°æ®é¡µè¿›è¡Œé‡‡æ ·ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæ•°æ®é¡µæ˜¯å¯ä»¥å‡†ç¡®è·å¾—çš„ï¼Œä½¿ç”¨éšæœºé‡‡æ ·æ³•-Sç®—æ³•ï¼Œç›¸å¯¹ç®€å•ã€‚ç¬¬äºŒé˜¶æ®µæ˜¯å¯¹å…ƒç»„è¿›è¡Œé‡‡æ ·ç”±äºæ•°æ®é‡ä¸å¯çŸ¥ï¼Œé‡‡ç”¨çš„æ˜¯è“„æ°´æ± ç®—æ³•-Z(Vitter)ç®—æ³•ã€‚</p>
</blockquote>
<ul>
<li><a href=https://www.cnblogs.com/python27/p/Reservoir_Sampling_Algorithm.html target=_blank rel="noopener nofollow noreferrer">è“„æ°´æ± æŠ½æ ·ç®—æ³•ï¼ˆReservoir Samplingï¼‰</a></li>
</ul>
<p>ä¹‹åå°±æ˜¯ä½¿ç”¨å…·ä½“çš„ç»Ÿè®¡ç®—æ³•å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå½“å‰ä»£ç ä¸­æœ‰</p>
<ol>
<li><code>compute_scalar_stats</code></li>
<li><code>compute_distinct_stats</code></li>
<li><code>compute_trivial_stats</code></li>
</ol>
<p>å…·ä½“é€‚ç”¨çš„åœºæ™¯è§æ³¨é‡Šï¼Œå¤§è‡´æ˜¯å¦æ˜¯æ»¡è¶³å¯ä»¥ä½¿ç”¨<code>=</code>å’Œ<code>></code>å¯¹åˆ—è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œçš„å…·ä½“çš„ç®—æ³•é€‰æ‹©å’Œåˆ—ç±»å‹æœ‰å…³ã€‚</p>
<p>å¤„ç†å®Œä¹‹åä½¿ç”¨<code>update_attstats</code>å‡½æ•°æ›´æ–°åˆ° pg_statistics ã€‚</p>
<p>AntDB åœ¨dnå¤„ç†å®Œè‡ªèº«çš„ä»»åŠ¡ä¹‹åï¼Œè¿˜ä¼šæŠŠæ•°æ®ä¼ è¾“åˆ°cnèŠ‚ç‚¹ï¼Œç”±cnå†è¿›è¡Œè®¡ç®—ã€‚cnå…ˆæ˜¯æ±‡æ€»æ‰€æœ‰çš„dnæŠ½æ ·ä¹‹åçš„æ•°æ®ä¹‹åï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œ30000è¡Œçš„æŠ½æ ·ï¼Œç„¶ååœ¨è¿›è¡Œå¸¸è§„çš„ç»Ÿè®¡ä¿¡æ¯çš„è®¡ç®—ï¼Œä»–å±äºæŠ½æ ·ä¹‹ä¸Šå†æŠ½æ ·ã€‚è¿™é‡Œä¸èƒ½ç›´æ¥ä½¿ç”¨dnè®¡ç®—ä¹‹åçš„ç»“æœç›´æ¥æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼Œå› ä¸ºç»Ÿè®¡ä¿¡æ¯éœ€è¦ç»¼åˆæ•°æ®ï¼Œä»æ•°æ®ä¸­è¿›è¡Œè®¡ç®—ï¼Œå½“ç„¶å¦‚æœéå¸¸æ¸…æ¥šç®—æ³•çš„è®¡ç®—è¿‡ç¨‹ï¼Œç„¶åä¿ç•™ä¸­é—´ç»“æœï¼Œç„¶åç”±cnè¿›è¡ŒäºŒæ¬¡è®¡ç®—ç†è®ºä¸Šä¹Ÿå¯è¡Œï¼Œåªæ˜¯ç°åœ¨cnä¸Šçš„ç»Ÿè®¡ä¿¡æ¯åˆ™æ˜¯åŸºäº<code>30000*count(dn)</code>è®¡ç®—ï¼Œåº”è¯¥æ˜¯å¯ä»¥æ›´å‡†ç¡®çš„ã€‚ä½†æ˜¯æ²¡æœ‰ä»”ç»†æ¢ç©¶ç®—æ³•å®ç°ï¼Œæ‰€ä»¥è¿˜ä¸çŸ¥é“æ˜¯å¦ç¡®å®å¯è¡Œã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹é—®é¢˜å°±æ˜¯ï¼Œå½“å‰çš„cnä¼šæŠŠæ•°æ®è½¬å‘åˆ°å…¶ä»–cnæˆ–è€…gtmï¼Œç”±ä»–ä»¬åœ¨æ•°æ®ä¸Šè¿›è¡ŒäºŒæ¬¡è®¡ç®—ï¼Œæ‰€ä»¥ç½‘ç»œioè¾ƒå¤§ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥ç›´æ¥ä¼ è¾“è®¡ç®—çš„ç»“æœï¼Œæ¯•ç«Ÿç†è®ºä¸Šcnçš„æ•°æ®éƒ½å¾—ä¿æŒä¸€è‡´ã€‚</p>
<p>ä½¿ç”¨ä¸‹é¢çš„ä¾‹å­ï¼Œç„¶åä½¿ç”¨strace è§‚å¯Ÿcnçš„ç½‘ç»œäº¤äº’ï¼Œå¯ä»¥æ˜æ˜¾çš„çœ‹å‡ºä¸Šé¢çš„é—®é¢˜</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> t1 (c1 int , c2 int , c3 int);
<span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> t1 <span style=color:#66d9ef>select</span>  floor(random() <span style=color:#f92672>*</span> <span style=color:#ae81ff>100000</span>)::int <span style=color:#f92672>%</span> <span style=color:#ae81ff>10</span>, floor(random() <span style=color:#f92672>*</span> <span style=color:#ae81ff>100000</span>)::int <span style=color:#f92672>%</span> <span style=color:#ae81ff>10</span>, generate_series(<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>100000</span>);

<span style=color:#66d9ef>analyze</span> <span style=color:#66d9ef>verbose</span> t1;
INFO:  <span style=color:#e6db74>&#34;t1&#34;</span>:containing <span style=color:#ae81ff>100000</span> live <span style=color:#66d9ef>rows</span> <span style=color:#66d9ef>and</span> <span style=color:#ae81ff>0</span> dead <span style=color:#66d9ef>rows</span>;<span style=color:#ae81ff>30000</span> <span style=color:#66d9ef>rows</span> <span style=color:#66d9ef>in</span> sample, <span style=color:#ae81ff>60000</span> total sample <span style=color:#66d9ef>rows</span> <span style=color:#66d9ef>from</span> datanode(s)

strace <span style=color:#f92672>-</span>p  <span style=color:#ae81ff>1443</span> <span style=color:#f92672>-</span>e trace<span style=color:#f92672>=</span>network
</code></pre></div><h2 id=æ€»ç»“>æ€»ç»“</h2>
<ol>
<li>vacuumå’Œanalyzeæ‰§è¡Œä»£ç åœ¨ä¸Šå±‚æ˜¯ç›¸åŒçš„ï¼Œåº•å±‚ä½¿ç”¨<code>analyze_rel</code>å’Œ<code>vacuum_rel</code>æ‰§è¡Œä¸åŒçš„æ“ä½œï¼Œæˆ–è€…åœ¨<code>vacuum analyze table</code>ä¸­ä¸€èµ·æ‰§è¡Œã€‚</li>
<li>antdbåœ¨å…¶é€»è¾‘ä¸Šè¿›è¡Œæ‰©å±•ï¼Œåœ¨åŸæœ‰çš„é€»è¾‘ä¸Šæ·»åŠ æ¥å£ï¼Œå’Œå…¶ä»–èŠ‚ç‚¹è¿›è¡Œæ•°æ®äº¤äº’ã€‚</li>
<li><code>vacuum full</code>ä½¿ç”¨<code>cluster_rel</code>å®ç°ï¼Œæ²¡æœ‰å®ç°åˆ†å¸ƒå¼vacuumåŠŸèƒ½ã€‚æ‰§è¡Œ<code>vacuum full</code>ä¹‹åï¼Œcnçš„pg_classæ•°æ®ä¸å˜ï¼Œä½†æ˜¯dnçš„æ˜¯å˜åŠ¨çš„ã€‚</li>
<li>vacuumæ˜¯æŠŠdnçš„æ•°æ®è¿›è¡Œæ±‡æ€»ç›¸åŠ ï¼Œç„¶åæ›´æ–°åˆ°å…ƒæ•°æ®ä¿¡æ¯ã€‚</li>
<li>analyzeä¹Ÿæ˜¯ç±»ä¼¼çš„æ“ä½œï¼Œä½†æ˜¯analyzeéœ€è¦åœ¨æ¥æ”¶åˆ°æŠ½æ ·æ•°æ®ä¹‹ååœ¨cnä¸Šè¿›è¡ŒæŠ½æ ·å†è®¡ç®—ï¼Œå› ä¸ºpg_statsitics è¡¨ä¸­çš„ä¿¡æ¯æ˜¯ç›´æ–¹å›¾ï¼Œç›´æ¥æ±‡æ€»ç›¸åŠ ä¼šä¸æ­£ç¡®ã€‚</li>
<li>analyzeæ—¶cnä¼šæ”¶é›†æ‰€æœ‰dnçš„æŠ½æ ·æ•°æ®ï¼Œè½¬å‘åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯è®¡ç®—ä¹‹åçš„æ•°æ®ï¼Œç†è®ºä¸Šæ‰€æœ‰cnä¸Šçš„å…ƒæ•°æ®ä¿¡æ¯åº”è¯¥ä¸€è‡´ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ä¸æ˜¯å¯ä»¥ä¼ è¾“è®¡ç®—ä¹‹åçš„æ•°æ®è€Œä¸æ˜¯rows</li>
</ol>
</div>
<span class=post-tags>
#<a href=https://askyx.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/>æ•°æ®åº“</a>&nbsp;
#<a href=https://askyx.github.io/tags/postgres/>Postgres</a>&nbsp;
#<a href=https://askyx.github.io/tags/vacuum/>VACUUM</a>&nbsp;
</span>
<div class=clear></div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>é˜…è¯»æ›´å¤š</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=https://askyx.github.io/posts/locks/>
<span class=button__icon>â†</span>
<span class=button__text>Locks</span>
</a>
</span>
<span class="button next">
<a href=https://askyx.github.io/posts/opt/>
<span class=button__text>Postgres Optimizer</span>
<span class=button__icon>â†’</span>
</a>
</span>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<div class="copyright copyright-font">
<span>å…± 135545 å­— <br> å†™å®Œä¸€æœ¬ æ›¹ç¦º çš„</br>ã€Šé›·é›¨ã€‹äº†ï¼</span>
</div>
<div class=copyright>
<span>Â© 2024 Powered by <a href=https://gohugo.io target=_blank rel=noopener>Hugo</a> Theme by <a href=https://github.com/lmm214/immmmm/tree/master/themes/hello-friend target=_blank rel=noopener>immmmm</a></span>
</div>
</div>
</footer>
<script type=text/javascript src=/theme-main-1.js></script>
<script type=text/javascript src=/lately.min.js></script>
<script type=text/javascript src=/waterfall.min.js></script>
<script type=text/javascript src=/imgStatus.min.js></script>
<script type=text/javascript src=/view-image.js></script>
<script type=text/javascript src=/theme-lmm-20230123.js></script>
<script type=text/javascript src=/pangu.min.js></script>
</div>
</body>
</html>