<!doctype html><html lang=en><head><title>Postgres_xc æºç ç¼–è¯‘åŠç¯å¢ƒæ­å»º ::
Asky â€” My note blog
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="æºç ç¼–è¯‘ # ä¸‹è½½æºç ï¼Œè§£å‹ï¼Œè¿™é‡Œå°è¯•ä½¿ç”¨-gç¼–è¯‘æºç ï¼Œç›®çš„æ˜¯ä¸ºäº†å¯ä»¥è°ƒè¯•æºç 
ç¼–è¯‘ä¸­æœ‰flexçš„ä¸€ä¸ªé—®é¢˜ï¼Œæç¤ºç‰ˆæœ¬ä¸æ­£ç¡®ï¼Œä¸”å³ä½¿ä½¿ç”¨exportæŒ‡å®šFLEXï¼Œç¼–è¯‘çš„æ—¶å€™è¿˜æ˜¯ä¼šç”¨yylexçš„ä¸€ä¸ªé‡å®šä¹‰çš„é”™è¯¯ï¼Œä»postgresä¸»çº¿ä¸Šæ‰¾åˆ°è§£å†³çš„patchï¼Œè¿™é‡Œç½‘ä¸Šæ²¡æœ‰å¤ªå¤šæœ‰ç”¨çš„èµ„æ–™ï¼Œæ‰€ä»¥æœ‰å°è¯•çš„å»ºè®®å…ˆç›´æ¥ç¼–è¯‘ï¼Œå¦‚æœé‡åˆ°ç›¸åŒçš„é—®é¢˜å†ä½¿ç”¨ä¸‹é¢çš„è§£å†³æ–¹æ³•ã€‚
gcc -DPGXC -Wall -Wmissing-prototypes -Wpointer-arith -Wdeclaration-after-statement -Werror=vla -Wendif-labels -Wmissing-format-attribute -Wimplicit-fallthrough=3 -Wcast-function-type -Wformat-security -fno-strict-aliasing -fwrapv -fexcess-precision=standard -Wno-format-truncation -Wno-stringop-truncation -g -I. -I. -I../../../src/include -D_GNU_SOURCE -c -o gram.o gram.c gram.y: In function â€˜base_yyparseâ€™: gram.y:9025:11: warning: implicit declaration of function â€˜superuserâ€™ [-Wimplicit-function-declaration] 9025 | if (!superuser()) | ^~~~~~~~~ scan.c: At top level: gram.c:68:25: error: conflicting types for â€˜base_yylexâ€™ 68 | #define yylex base_yylex | ^~~~~~~~~~ scan.c:9108:12: note: in expansion of macro â€˜yylexâ€™ 9108 | extern int yylex \ | ^~~~~ In file included from gram.y:60: ../../../src/include/parser/gramparse.h:66:12: note: previous declaration of â€˜base_yylexâ€™ was here 66 | extern int base_yylex(YYSTYPE *lvalp, YYLTYPE *llocp, | ^~~~~~~~~~ gram."><meta name=keywords content="ç¨‹åºå‘˜ã€ç å†œã€databaseã€C++"><meta name=robots content="noodp"><link rel=canonical href=https://askyx.github.io/trash/postgres_xc_build/><link rel=stylesheet href=//cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.6.0/lxgwwenkaiscreen.css media=print onload='this.media="all"'><link rel=stylesheet href=https://askyx.github.io/assets/style.css><link rel=stylesheet href=https://askyx.github.io/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://askyx.github.io/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://askyx.github.io/favicon.ico><link rel=apple-touch-icon href=https://askyx.github.io/favicon.ico><link rel=bookmark href=https://askyx.github.io/favicon.ico><link rel=apple-touch-icon-precomposed sizes=180x180 href=https://askyx.github.io/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:title content="Postgres_xc æºç ç¼–è¯‘åŠç¯å¢ƒæ­å»º"><meta name=twitter:description content="Postgres_xc æºç ç¼–è¯‘ï¼Œé›†ç¾¤ç¯å¢ƒæ­å»º"><meta property="og:title" content="Postgres_xc æºç ç¼–è¯‘åŠç¯å¢ƒæ­å»º"><meta property="og:description" content="Postgres_xc æºç ç¼–è¯‘ï¼Œé›†ç¾¤ç¯å¢ƒæ­å»º"><meta property="og:type" content="article"><meta property="og:url" content="https://askyx.github.io/trash/postgres_xc_build/"><meta property="article:section" content="trash"><meta property="article:published_time" content="2022-07-27T16:44:08+08:00"><meta property="article:modified_time" content="2022-07-27T16:44:08+08:00"></head><body class=light-theme><div class=container><header class=header><span class=header__inner><a href=https://askyx.github.io/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>Asky</span>
<span class=logo__cursor></span>
</a><span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=/archive>Archive</a></li><li><a href=/books/duckdb_internal>DuckDB</a></li><li><a href=/search>ğŸ”</a></li><li><a href=javascript:; onclick=randomPost() title=éšæœºè®¿é—®ä¸€ç¯‡æ–‡ç« ><svg t="1660103436159" class="icon search-box-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="1184" width="32" height="32"><path d="M421.376 481.28s117.248 24.576 175.104-8.704c0 0-89.6 70.144-89.6 166.4.512-.512-8.192-121.344-85.504-157.696zm17.408 487.936s68.608 6.656 68.608-80.896c0 0 3.072 88.576 65.024 78.336.0.512-50.688 22.016-133.632 2.56zM161.28 238.08s-30.208 65.536 11.264 91.648c0 0-67.072-17.408-81.408 37.376.0.0 8.704-82.944 70.144-129.024zM857.6 227.328s49.152 50.176 1.024 81.408c0 0 58.88-18.432 66.56 36.352.0.0 5.12-69.632-67.584-117.76z" p-id="1185"/><path d="M443.392 970.752c-5.632.0-10.752-1.024-15.36-3.072L157.184 810.496l-1.536-1.024s-1.024-1.024-4.608-2.56c-51.2-29.184-62.976-94.208-65.536-120.832V386.56c0-3.072.512-7.168 1.024-11.264l.512-3.584 1.024-2.56c19.456-50.688 76.8-51.2 103.936-44.032l-1.536 5.632 4.096-6.144L476.16 486.4l18.944 37.888c20.992 36.864 29.184 77.824 32.768 99.84v258.048c-4.608 56.32-36.864 76.288-55.808 82.944-1.024.512-15.36 5.632-28.672 5.632zM181.248 774.656l263.168 152.576c12.288-.512 36.864-6.656 40.448-48.128V628.736c-4.608-31.744-20.992-103.936-72.192-128L322.56 445.44l1.536 3.072L181.76 366.08c-2.048-.512-40.448-9.216-52.736 15.872-.512 2.56-.512 4.608-.512 6.144v294.4c1.536 16.896 9.728 67.072 43.52 86.528 3.584 2.048 6.656 4.096 9.216 5.632z" p-id="1186"/><path d="M837.632 212.992c6.656 4.096 12.8 7.168 18.432 10.752l1.536 1.024 1.536 1.536c5.12 4.096 10.752 9.216 16.384 15.36 6.144 11.776 5.632 33.28 4.608 49.152-1.024 12.288-6.656 30.208-26.624 44.544l-1.024.512-247.808 156.672c-26.624 14.336-62.976 18.432-96.256 18.432-40.96.0-77.824-6.656-89.088-8.704l-3.072-.512-245.248-142.336c-39.424-29.696-28.16-85.504-15.36-113.664l2.56-6.144 263.68-166.912c29.184-14.336 104.448-43.008 173.056-1.024 3.584 2.56 58.368 34.304 119.296 69.632M431.616 460.8c40.448 7.168 114.176 13.824 152.576-6.144L828.928 299.52c7.168-5.632 8.192-10.24 8.704-12.8 1.024-11.264-9.728-26.624-15.36-32.768-55.808-32.256-243.712-141.312-250.368-145.408-49.664-30.72-107.008-9.216-130.048 2.56L192.512 268.8c-4.096 12.288-12.288 42.496 3.584 55.808L431.616 460.8z" p-id="1187"/><path d="M831.488 299.008c4.096-1.024 38.4-11.264 66.048 6.144 7.168 4.608 17.92 11.776 24.064 24.576 1.024 5.632 4.096 10.752 4.608 16.896v2.048l-1.024 323.072c-5.12 35.328-22.528 91.648-77.312 125.44l-5.12 3.584h-1.024L579.584 966.656l-4.608.512c-4.096.512-8.704 1.024-12.8 1.024-15.872.0-30.208-5.12-41.984-14.848-24.576-20.48-32.768-55.808-35.328-73.728l-1.024-252.928h1.536c6.144-96.768 88.576-164.864 96.768-171.008l-.512-.512L829.44 299.52M528.384 867.328c.512 10.24 5.12 41.472 19.968 53.76 3.072 2.56 7.68 5.632 16.384 5.12L829.44 758.272c56.32-38.4 53.76-115.712 53.76-116.224l-.512-32.256 1.024-250.368h-.512c-1.536-12.8-7.168-16.384-8.704-17.408-8.704-5.632-23.552-3.072-28.672-2.048L610.304 488.96c-1.024.512-80.896 65.024-80.896 149.504h-1.536l.512 228.864zM435.2 264.192c0 27.648 31.744 50.176 71.168 50.176s71.168-22.528 71.168-50.176-31.744-50.176-71.168-50.176S435.2 236.544 435.2 264.192z" p-id="1188"/><path d="M663.552 782.848c0 30.72-22.528 67.072-49.664 80.384-27.648 13.824-50.176-.512-50.176-31.232s22.528-67.072 50.176-80.384c27.136-13.824 49.664.0 49.664 31.232zM760.32 602.624c0 30.72-22.528 67.072-49.664 80.384-27.648 13.824-49.664-.512-49.664-31.232s22.528-67.072 49.664-80.384c27.136-13.824 49.664.512 49.664 31.232zM867.84 428.032c0 30.72-22.528 67.072-49.664 80.384C790.528 522.24 768 507.904 768 477.184s22.528-67.072 50.176-80.384c27.136-13.824 49.664.0 49.664 31.232zM270.848 538.112c0 30.72-22.016 41.984-48.64 24.576-27.136-16.896-48.64-55.808-48.64-86.528s22.016-41.984 48.64-24.576c26.624 16.896 48.64 55.808 48.64 86.528zm161.28 285.184c0 30.72-22.016 41.984-48.64 24.576-26.624-17.408-48.64-55.808-48.64-86.528s22.016-41.984 48.64-24.576c26.624 16.896 48.64 55.808 48.64 86.528z" p-id="1189"/></svg></a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=/archive>Archive</a></li><li><a href=/books/duckdb_internal>DuckDB</a></li><li><a href=/search>ğŸ”</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><div class=breadcrumb><li><a href=https://askyx.github.io/>é¦–é¡µ</a></li><li><a href=https://askyx.github.io/trash/></a></li><li class=active><a href=https://askyx.github.io/trash/postgres_xc_build/>Postgres_xc æºç ç¼–è¯‘åŠç¯å¢ƒæ­å»º</a></li></div><h2 class=post-title><a href=https://askyx.github.io/trash/postgres_xc_build/>Postgres_xc æºç ç¼–è¯‘åŠç¯å¢ƒæ­å»º</a></h2><div class=post-meta><span class=post-date>2022-07-27</span></div><div class=post-content><aside class=table-of-contents><nav id=TableOfContents><ul><li><a href=#æºç ç¼–è¯‘>æºç ç¼–è¯‘</a></li><li><a href=#é…ç½®é›†ç¾¤>é…ç½®é›†ç¾¤</a></li><li><a href=#é‡æ–°åˆ†å¸ƒæ•°æ®ä»¥åŠèŠ‚ç‚¹æ“ä½œ>é‡æ–°åˆ†å¸ƒæ•°æ®ä»¥åŠèŠ‚ç‚¹æ“ä½œ</a><ul><li><a href=#å¢åŠ coordinatorsèŠ‚ç‚¹>å¢åŠ CoordinatorsèŠ‚ç‚¹</a></li><li><a href=#ç§»é™¤coordinators-èŠ‚ç‚¹>ç§»é™¤Coordinators èŠ‚ç‚¹</a></li><li><a href=#å¢åŠ -datanodeèŠ‚ç‚¹>å¢åŠ  DatanodeèŠ‚ç‚¹</a></li></ul></li></ul></nav></aside><h2 id=æºç ç¼–è¯‘>æºç ç¼–è¯‘
<a href=#%e6%ba%90%e7%a0%81%e7%bc%96%e8%af%91 class=h-anchor aria-hidden=true>#</a></h2><p>ä¸‹è½½<a href="https://master.dl.sourceforge.net/project/postgres-xc/Version_1.2/pgxc-v1.2.1.tar.gz?viasf=1">æºç </a>ï¼Œè§£å‹ï¼Œè¿™é‡Œå°è¯•ä½¿ç”¨<code>-g</code>ç¼–è¯‘æºç ï¼Œç›®çš„æ˜¯ä¸ºäº†å¯ä»¥è°ƒè¯•æºç </p><p>ç¼–è¯‘ä¸­æœ‰flexçš„ä¸€ä¸ªé—®é¢˜ï¼Œæç¤ºç‰ˆæœ¬ä¸æ­£ç¡®ï¼Œä¸”å³ä½¿ä½¿ç”¨<code>export</code>æŒ‡å®š<code>FLEX</code>ï¼Œç¼–è¯‘çš„æ—¶å€™è¿˜æ˜¯ä¼šç”¨yylexçš„ä¸€ä¸ªé‡å®šä¹‰çš„é”™è¯¯ï¼Œä»postgresä¸»çº¿ä¸Šæ‰¾åˆ°è§£å†³çš„patchï¼Œè¿™é‡Œç½‘ä¸Šæ²¡æœ‰å¤ªå¤šæœ‰ç”¨çš„èµ„æ–™ï¼Œæ‰€ä»¥æœ‰å°è¯•çš„å»ºè®®å…ˆç›´æ¥ç¼–è¯‘ï¼Œå¦‚æœé‡åˆ°ç›¸åŒçš„é—®é¢˜å†ä½¿ç”¨ä¸‹é¢çš„è§£å†³æ–¹æ³•ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span>gcc <span style=color:#f92672>-</span>DPGXC  <span style=color:#f92672>-</span>Wall <span style=color:#f92672>-</span>Wmissing<span style=color:#f92672>-</span>prototypes <span style=color:#f92672>-</span>Wpointer<span style=color:#f92672>-</span>arith <span style=color:#f92672>-</span>Wdeclaration<span style=color:#f92672>-</span>after<span style=color:#f92672>-</span>statement <span style=color:#f92672>-</span>Werror<span style=color:#f92672>=</span>vla <span style=color:#f92672>-</span>Wendif<span style=color:#f92672>-</span>labels <span style=color:#f92672>-</span>Wmissing<span style=color:#f92672>-</span>format<span style=color:#f92672>-</span>attribute <span style=color:#f92672>-</span>Wimplicit<span style=color:#f92672>-</span>fallthrough<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> <span style=color:#f92672>-</span>Wcast<span style=color:#f92672>-</span>function<span style=color:#f92672>-</span>type <span style=color:#f92672>-</span>Wformat<span style=color:#f92672>-</span>security <span style=color:#f92672>-</span>fno<span style=color:#f92672>-</span>strict<span style=color:#f92672>-</span>aliasing <span style=color:#f92672>-</span>fwrapv <span style=color:#f92672>-</span>fexcess<span style=color:#f92672>-</span>precision<span style=color:#f92672>=</span>standard <span style=color:#f92672>-</span>Wno<span style=color:#f92672>-</span>format<span style=color:#f92672>-</span>truncation <span style=color:#f92672>-</span>Wno<span style=color:#f92672>-</span>stringop<span style=color:#f92672>-</span>truncation <span style=color:#f92672>-</span>g <span style=color:#f92672>-</span>I. <span style=color:#f92672>-</span>I. <span style=color:#f92672>-</span>I..<span style=color:#f92672>/</span>..<span style=color:#f92672>/</span>..<span style=color:#f92672>/</span>src<span style=color:#f92672>/</span>include  <span style=color:#f92672>-</span>D_GNU_SOURCE   <span style=color:#f92672>-</span>c <span style=color:#f92672>-</span>o gram.o gram.c
</span></span><span style=display:flex><span>gram.y: In function <span style=color:#960050;background-color:#1e0010>â€˜</span>base_yyparse<span style=color:#960050;background-color:#1e0010>â€™</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>gram.y:<span style=color:#ae81ff>9025</span><span style=color:#f92672>:</span><span style=color:#ae81ff>11</span><span style=color:#f92672>:</span> warning: implicit declaration of function <span style=color:#960050;background-color:#1e0010>â€˜</span>superuser<span style=color:#960050;background-color:#1e0010>â€™</span> [<span style=color:#f92672>-</span>Wimplicit<span style=color:#f92672>-</span>function<span style=color:#f92672>-</span>declaration]
</span></span><span style=display:flex><span> <span style=color:#ae81ff>9025</span> <span style=color:#f92672>|</span>      <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>superuser())
</span></span><span style=display:flex><span>      <span style=color:#f92672>|</span>           <span style=color:#f92672>^~~~~~~~~</span>
</span></span><span style=display:flex><span>scan.c: At top level:
</span></span><span style=display:flex><span>gram.c:<span style=color:#ae81ff>68</span><span style=color:#f92672>:</span><span style=color:#ae81ff>25</span><span style=color:#f92672>:</span> error: conflicting types <span style=color:#66d9ef>for</span> <span style=color:#960050;background-color:#1e0010>â€˜</span>base_yylex<span style=color:#960050;background-color:#1e0010>â€™</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>68</span> <span style=color:#f92672>|</span> <span style=color:#960050;background-color:#1e0010>#</span>define yylex           base_yylex
</span></span><span style=display:flex><span>      <span style=color:#f92672>|</span>                         <span style=color:#f92672>^~~~~~~~~~</span>
</span></span><span style=display:flex><span>scan.c:<span style=color:#ae81ff>9108</span><span style=color:#f92672>:</span><span style=color:#ae81ff>12</span><span style=color:#f92672>:</span> note: in expansion of macro <span style=color:#960050;background-color:#1e0010>â€˜</span>yylex<span style=color:#960050;background-color:#1e0010>â€™</span>
</span></span><span style=display:flex><span> <span style=color:#ae81ff>9108</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>extern</span> <span style=color:#66d9ef>int</span> yylex \
</span></span><span style=display:flex><span>      <span style=color:#f92672>|</span>            <span style=color:#f92672>^~~~~</span>
</span></span><span style=display:flex><span>In file included from gram.y:<span style=color:#ae81ff>60</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>..<span style=color:#f92672>/</span>..<span style=color:#f92672>/</span>..<span style=color:#f92672>/</span>src<span style=color:#f92672>/</span>include<span style=color:#f92672>/</span>parser<span style=color:#f92672>/</span>gramparse.h:<span style=color:#ae81ff>66</span><span style=color:#f92672>:</span><span style=color:#ae81ff>12</span><span style=color:#f92672>:</span> note: previous declaration of <span style=color:#960050;background-color:#1e0010>â€˜</span>base_yylex<span style=color:#960050;background-color:#1e0010>â€™</span> was here
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>66</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>extern</span> <span style=color:#66d9ef>int</span> base_yylex(YYSTYPE <span style=color:#f92672>*</span>lvalp, YYLTYPE <span style=color:#f92672>*</span>llocp,
</span></span><span style=display:flex><span>      <span style=color:#f92672>|</span>            <span style=color:#f92672>^~~~~~~~~~</span>
</span></span><span style=display:flex><span>gram.c:<span style=color:#ae81ff>68</span><span style=color:#f92672>:</span><span style=color:#ae81ff>25</span><span style=color:#f92672>:</span> error: conflicting types <span style=color:#66d9ef>for</span> <span style=color:#960050;background-color:#1e0010>â€˜</span>base_yylex<span style=color:#960050;background-color:#1e0010>â€™</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>68</span> <span style=color:#f92672>|</span> <span style=color:#960050;background-color:#1e0010>#</span>define yylex           base_yylex
</span></span><span style=display:flex><span>      <span style=color:#f92672>|</span>                         <span style=color:#f92672>^~~~~~~~~~</span>
</span></span><span style=display:flex><span>scan.c:<span style=color:#ae81ff>9111</span><span style=color:#f92672>:</span><span style=color:#ae81ff>21</span><span style=color:#f92672>:</span> note: in expansion of macro <span style=color:#960050;background-color:#1e0010>â€˜</span>yylex<span style=color:#960050;background-color:#1e0010>â€™</span>
</span></span><span style=display:flex><span> <span style=color:#ae81ff>9111</span> <span style=color:#f92672>|</span> <span style=color:#960050;background-color:#1e0010>#</span>define YY_DECL <span style=color:#66d9ef>int</span> yylex \
</span></span><span style=display:flex><span>      <span style=color:#f92672>|</span>                     <span style=color:#f92672>^~~~~</span>
</span></span><span style=display:flex><span>scan.c:<span style=color:#ae81ff>9132</span><span style=color:#f92672>:</span><span style=color:#ae81ff>1</span><span style=color:#f92672>:</span> note: in expansion of macro <span style=color:#960050;background-color:#1e0010>â€˜</span>YY_DECL<span style=color:#960050;background-color:#1e0010>â€™</span>
</span></span><span style=display:flex><span> <span style=color:#ae81ff>9132</span> <span style=color:#f92672>|</span> YY_DECL
</span></span><span style=display:flex><span>      <span style=color:#f92672>|</span> <span style=color:#f92672>^~~~~~~</span>
</span></span><span style=display:flex><span>In file included from gram.y:<span style=color:#ae81ff>60</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>..<span style=color:#f92672>/</span>..<span style=color:#f92672>/</span>..<span style=color:#f92672>/</span>src<span style=color:#f92672>/</span>include<span style=color:#f92672>/</span>parser<span style=color:#f92672>/</span>gramparse.h:<span style=color:#ae81ff>66</span><span style=color:#f92672>:</span><span style=color:#ae81ff>12</span><span style=color:#f92672>:</span> note: previous declaration of <span style=color:#960050;background-color:#1e0010>â€˜</span>base_yylex<span style=color:#960050;background-color:#1e0010>â€™</span> was here
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>66</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>extern</span> <span style=color:#66d9ef>int</span> base_yylex(YYSTYPE <span style=color:#f92672>*</span>lvalp, YYLTYPE <span style=color:#f92672>*</span>llocp,
</span></span><span style=display:flex><span>      <span style=color:#f92672>|</span>            <span style=color:#f92672>^~~~~~~~~~</span>
</span></span></code></pre></div><p>ä½¿ç”¨ä¸‹é¢çš„patchå¯ä»¥è§£å†³é—®é¢˜ï¼Œå…¶ä¸­configureæˆ‘è¿˜ä¿®æ”¹äº†ç¼–è¯‘é€‰é¡¹ï¼Œå¦‚æœåªæ˜¯æƒ³æ­å»ºé›†ç¾¤ï¼Œå¯ä»¥æŠŠä»–ä¿®æ”¹å›æ¥</p><pre tabindex=0><code class=language-git data-lang=git>diff --git a/configure b/configure
index 64fccd7..4199c1d 100755
--- a/configure
+++ b/configure
@@ -3702,13 +3702,13 @@ if test &#34;$ac_test_CFLAGS&#34; = set; then
   CFLAGS=$ac_save_CFLAGS
 elif test $ac_cv_prog_cc_g = yes; then
   if test &#34;$GCC&#34; = yes; then
-    CFLAGS=&#34;-g -O2&#34;
+    CFLAGS=&#34;-g&#34;
   else
     CFLAGS=&#34;-g&#34;
   fi
 else
   if test &#34;$GCC&#34; = yes; then
-    CFLAGS=&#34;-O2&#34;
+    CFLAGS=&#34;-g&#34;
   else
     CFLAGS=
   fi
@@ -3945,8 +3945,8 @@ unset CFLAGS
 # If the user specifies something in the environment, that is used.
 # else:  If the template file set something, that is used.
 # else:  If coverage was enabled, don&#39;t set anything.
-# else:  If the compiler is GCC, then we use -O2.
-# else:  If the compiler is something else, then we use -O, unless debugging.
+# else:  If the compiler is GCC, then we use -g.
+# else:  If the compiler is something else, then we use -g, unless debugging.
 
 if test &#34;$ac_env_CFLAGS_set&#34; = set; then
   CFLAGS=$ac_env_CFLAGS_value
@@ -3955,11 +3955,11 @@ elif test &#34;${CFLAGS+set}&#34; = set; then
 elif test &#34;$enable_coverage&#34; = yes; then
   : # no optimization by default
 elif test &#34;$GCC&#34; = yes; then
-  CFLAGS=&#34;-O2&#34;
+  CFLAGS=&#34;-g&#34;
 else
-  # if the user selected debug mode, don&#39;t use -O
+  # if the user selected debug mode, don&#39;t use -g
   if test &#34;$enable_debug&#34; != yes; then
-    CFLAGS=&#34;-O&#34;
+    CFLAGS=&#34;-g&#34;
   fi
 fi
 
@@ -7335,7 +7335,7 @@ else
         echo &#39;%%&#39;  &gt; conftest.l
         if $pgac_candidate -t conftest.l 2&gt;/dev/null | grep FLEX_SCANNER &gt;/dev/null 2&gt;&amp;1; then
           pgac_flex_version=`$pgac_candidate --version 2&gt;/dev/null`
-          if echo &#34;$pgac_flex_version&#34; | sed &#39;s/[.a-z]/ /g&#39; | $AWK &#39;{ if ($1 = 2 &amp;&amp; $2 = 5 &amp;&amp; $3 &gt;= 31) exit 0; else exit 1;}&#39;
+          if echo &#34;$pgac_flex_version&#34; | sed &#39;s/[.a-z]/ /g&#39; | $AWK &#39;{ if ($1 == 2 &amp;&amp; ($2 &gt; 5 || ($2 == 5 &amp;&amp; $3 &gt;= 31))) exit 0; else exit 1;}&#39;
           then
             pgac_cv_path_flex=$pgac_candidate
             break 2
@@ -7433,7 +7433,7 @@ if test &#34;$PERL&#34;; then
   { $as_echo &#34;$as_me:$LINENO: using perl $pgac_perl_version&#34; &gt;&amp;5
 $as_echo &#34;$as_me: using perl $pgac_perl_version&#34; &gt;&amp;6;}
   if echo &#34;$pgac_perl_version&#34; | sed &#39;s/[.a-z_]/ /g&#39; | \
-    $AWK &#39;{ if ($1 = 5 &amp;&amp; $2 &gt;= 8) exit 1; else exit 0;}&#39;
+    $AWK &#39;{ if ($1 == 5 &amp;&amp; $2 &gt;= 8) exit 1; else exit 0;}&#39;
   then
     { $as_echo &#34;$as_me:$LINENO: WARNING:
 *** The installed version of Perl, $PERL, is too old to use with PostgreSQL.
diff --git a/contrib/pgxc_ctl/variables.c b/contrib/pgxc_ctl/variables.c
index 1bfaf79..74ceecf 100644
--- a/contrib/pgxc_ctl/variables.c
+++ b/contrib/pgxc_ctl/variables.c
@@ -17,6 +17,7 @@
 
 pgxc_ctl_var *var_head = NULL;
 pgxc_ctl_var *var_tail = NULL;
+pgxc_var_hash var_hash[NUM_HASH_BUCKET];
 
 static void clear_var(pgxc_ctl_var *var);
 /*
@@ -35,7 +35,7 @@ typedef struct pgxc_var_hash {
 } pgxc_var_hash;
 
 
-pgxc_var_hash var_hash[NUM_HASH_BUCKET];
+
 
 void init_var_hash(void);
 void add_var_hash(pgxc_ctl_var *var);
diff --git a/src/backend/parser/Makefile b/src/backend/parser/Makefile
index 0395bd5..9cc8946 100644
--- a/src/backend/parser/Makefile
+++ b/src/backend/parser/Makefile
@@ -12,7 +12,7 @@ include $(top_builddir)/src/Makefile.global
 
 override CPPFLAGS := -I. -I$(srcdir) $(CPPFLAGS)
 
-OBJS= analyze.o gram.o keywords.o kwlookup.o parser.o \
+OBJS= analyze.o gram.o scan.o keywords.o kwlookup.o parser.o \
       parse_agg.o parse_clause.o parse_coerce.o parse_collate.o parse_cte.o \
       parse_expr.o parse_func.o parse_node.o parse_oper.o parse_param.o \
       parse_relation.o parse_target.o parse_type.o parse_utilcmd.o scansup.o
@@ -20,12 +20,9 @@ OBJS= analyze.o gram.o keywords.o kwlookup.o parser.o \
 include $(top_srcdir)/src/backend/common.mk
 
 
-# scan is compiled as part of gram
-gram.o: scan.c
-
 # Latest flex causes warnings in this file.
 ifeq ($(GCC),yes)
-gram.o: CFLAGS += -Wno-error
+scan.o: CFLAGS += -Wno-error
 endif
 
 
@@ -47,7 +44,7 @@ scan.c: FLEX_NO_BACKUP=yes
 
 
 # Force these dependencies to be known even without dependency info built:
-gram.o keywords.o parser.o: gram.h
+gram.o scan.o keywords.o parser.o: gram.h
 
 
 # gram.c, gram.h, and scan.c are in the distribution tarball, so they
diff --git a/src/backend/parser/gram.y b/src/backend/parser/gram.y
index 173c078..cce9386 100644
--- a/src/backend/parser/gram.y
+++ b/src/backend/parser/gram.y
@@ -14254,13 +14254,3 @@ parser_init(base_yy_extra_type *yyext)
 {
 	yyext-&gt;parsetree = NIL;		/* in case grammar forgets to set it */
 }
-
-/*
- * Must undefine this stuff before including scan.c, since it has different
- * definitions for these macros.
- */
-#undef yyerror
-#undef yylval
-#undef yylloc
-
-#include &#34;scan.c&#34;
diff --git a/src/backend/parser/scan.l b/src/backend/parser/scan.l
index 92f38a2..911a0ed 100644
--- a/src/backend/parser/scan.l
+++ b/src/backend/parser/scan.l
@@ -1,4 +1,4 @@
-%{
+%top{
 /*-------------------------------------------------------------------------
  *
  * scan.l
@@ -6,7 +6,7 @@
  *
  * NOTE NOTE NOTE:
  *
- * The rules in this file must be kept in sync with psql&#39;s lexer!!!
+ * The rules in this file must be kept in sync with psql&#39;s psqlscan.l!
  *
  * The rules are designed so that the scanner never has to backtrack,
  * in the sense that there is always a rule that can match the input
@@ -34,12 +34,13 @@
 #include &lt;ctype.h&gt;
 #include &lt;unistd.h&gt;
 
+#include &#34;parser/gramparse.h&#34;
 #include &#34;parser/parser.h&#34;				/* only needed for GUC variables */
-#include &#34;parser/scanner.h&#34;
 #include &#34;parser/scansup.h&#34;
 #include &#34;mb/pg_wchar.h&#34;
+}
 
-
+%{
 /* Avoid exit() on fatal scanner errors (a bit ugly -- see yy_fatal_error) */
 #undef fprintf
 #define fprintf(file, fmt, msg)  fprintf_to_ereport(fmt, msg)
diff --git a/src/gtm/proxy/proxy_main.c b/src/gtm/proxy/proxy_main.c
index 3224525..52d186f 100644
--- a/src/gtm/proxy/proxy_main.c
+++ b/src/gtm/proxy/proxy_main.c
@@ -69,7 +69,7 @@ int			GTMProxyPortNumber;
 int			GTMProxyWorkerThreads;
 char		*GTMProxyDataDir;
 char		*GTMProxyConfigFileName;
-char		*GTMConfigFileName;
+extern char		*GTMConfigFileName;
 
 char		*GTMServerHost;
 int			GTMServerPortNumber;
diff --git a/src/interfaces/ecpg/preproc/Makefile b/src/interfaces/ecpg/preproc/Makefile
index 715be28..8651f30 100644
--- a/src/interfaces/ecpg/preproc/Makefile
+++ b/src/interfaces/ecpg/preproc/Makefile
@@ -26,7 +26,7 @@ override CPPFLAGS := -I../include -I$(top_srcdir)/src/interfaces/ecpg/include \
 
 override CFLAGS += $(PTHREAD_CFLAGS) -DECPG_COMPILE
 
-OBJS=	preproc.o type.o ecpg.o output.o parser.o \
+OBJS=	preproc.o pgc.o type.o ecpg.o output.o parser.o \
 	keywords.o c_keywords.o ecpg_keywords.o kwlookup.o ../ecpglib/typename.o descriptor.o variable.o \
 	$(WIN32RES)
 
@@ -44,9 +44,6 @@ ecpg: $(OBJS) | submake-libpgport
 ../ecpglib/typename.o: ../ecpglib/typename.c
 	$(MAKE) -C $(dir $@) $(notdir $@)
 
-# pgc is compiled as part of preproc
-preproc.o: pgc.c
-
 preproc.h: preproc.c ;
 preproc.c: BISONFLAGS += -d
 
@@ -54,7 +51,7 @@ preproc.y: ../../../backend/parser/gram.y parse.pl ecpg.addons ecpg.header ecpg.
 	$(PERL) $(srcdir)/parse.pl $(srcdir) &lt; $&lt; &gt; $@
 	$(PERL) $(srcdir)/check_rules.pl $(srcdir) $&lt;
 
-ecpg_keywords.o c_keywords.o keywords.o preproc.o parser.o: preproc.h
+ecpg_keywords.o c_keywords.o keywords.o preproc.o pgc.o parser.o: preproc.h
 
 kwlookup.c: % : $(top_srcdir)/src/backend/parser/%
 	rm -f $@ &amp;&amp; $(LN_S) $&lt; .
diff --git a/src/interfaces/ecpg/preproc/ecpg.trailer b/src/interfaces/ecpg/preproc/ecpg.trailer
index 70dc690..fb8e03a 100644
--- a/src/interfaces/ecpg/preproc/ecpg.trailer
+++ b/src/interfaces/ecpg/preproc/ecpg.trailer
@@ -1912,11 +1912,3 @@ void parser_init(void)
 {
  /* This function is empty. It only exists for compatibility with the backend parser right now. */
 }
-
-/*
- * Must undefine base_yylex before including pgc.c, since we want it
- * to create the function base_yylex not filtered_base_yylex.
- */
-#undef base_yylex
-
-#include &#34;pgc.c&#34;
diff --git a/src/interfaces/ecpg/preproc/pgc.l b/src/interfaces/ecpg/preproc/pgc.l
index 5abb74f..2e363c2 100644
--- a/src/interfaces/ecpg/preproc/pgc.l
+++ b/src/interfaces/ecpg/preproc/pgc.l
@@ -1,4 +1,4 @@
-%{
+%top{
 /*-------------------------------------------------------------------------
  *
  * pgc.l
@@ -23,7 +23,19 @@
 #include &lt;limits.h&gt;
 
 #include &#34;extern.h&#34;
+#include &#34;preproc.h&#34;
+
+/*
+ * Change symbol names as expected by preproc.l.  It&#39;d be better to do this
+ * with %option prefix=&#34;base_yy&#34;, but that affects some other names that
+ * various files expect *not* to be prefixed with &#34;base_&#34;.  Cleaning it up
+ * is not worth the trouble right now.
+ */
+#define yylex           base_yylex
+#define yylval          base_yylval
+}
 
+%{
 extern YYSTYPE yylval;
 
 static int		xcdepth = 0;	/* depth of nesting in slash-star comments */
</code></pre><ul><li>ä½¿ç”¨æ­£å¸¸çš„ç¼–è¯‘postgresçš„æ–¹æ³•ç¼–è¯‘æºç å³å¯ï¼Œå…·ä½“å¯ä»¥å‚è€ƒæˆ‘å…¶ä»–æ–‡ç« </li></ul><hr><h2 id=é…ç½®é›†ç¾¤>é…ç½®é›†ç¾¤
<a href=#%e9%85%8d%e7%bd%ae%e9%9b%86%e7%be%a4 class=h-anchor aria-hidden=true>#</a></h2><ul><li>GTM * 1</li><li>COOR * 2</li><li>DNODE * 2</li></ul><blockquote><p>æˆ‘è¿™é‡Œå°è¯•åœ¨å•æœºä¸Šæ­å»ºé›†ç¾¤ç¯å¢ƒï¼Œç†è®ºä¸Šä¿®æ”¹portæ˜¯å¯ä»¥æˆåŠŸçš„ï¼Œä½†æ˜¯æˆ‘å¯èƒ½æŸä¸€æ­¥æ²¡æœ‰æ­£ç¡®é…ç½®ï¼Œæ‰€ä»¥å¤±è´¥äº†ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œçš„èµ„æ–™éƒ½æ˜¯æˆ‘ä¸»è¦ä»å®˜ç½‘æ‰’ä¸‹æ¥çš„ï¼Œå¤±è´¥äº†ä¹Ÿæ˜¯æƒ³ä¸é€šğŸ˜‚</p></blockquote><p>ä¸»è¦è¿‡ç¨‹ä¸ºå’Œé…ç½®å¦‚ä¸‹ï¼Œè¿™æ˜¯åæœŸæ•´ç†çš„èµ„æ–™ï¼Œå› è¯¥æœ‰ç”¨ï¼Œèµ·ç å‘½ä»¤æœ‰ç”¨</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®.bashrc</span>
</span></span><span style=display:flex><span>export PGHOME<span style=color:#f92672>=</span>/home/postgres/postgres-home/build/postgres-xc/build
</span></span><span style=display:flex><span>export PGPORT<span style=color:#f92672>=</span><span style=color:#ae81ff>4431</span>
</span></span><span style=display:flex><span>export PGDATA<span style=color:#f92672>=</span>$PGHOME/../data
</span></span><span style=display:flex><span>export LANG<span style=color:#f92672>=</span>en_US.utf8
</span></span><span style=display:flex><span>export LD_LIBRARY_PATH<span style=color:#f92672>=</span>$PGHOME/lib:$LD_LIBRARY_PATH
</span></span><span style=display:flex><span>export PATH<span style=color:#f92672>=</span>$PGHOME/bin:$PATH:.
</span></span><span style=display:flex><span>export MANPATH<span style=color:#f92672>=</span>$PGHOME/share/man:$MANPATH
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./initgtm -Z gtm -D $PGHOME/../data1/gtm/data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./initdb -D $PGHOME/../data1/coor_1/data --nodename coor_1
</span></span><span style=display:flex><span>./initdb -D $PGHOME/../data1/coor_2/data --nodename coor_2
</span></span><span style=display:flex><span>./initdb -D $PGHOME/../data1/db_1/data --nodename db_1
</span></span><span style=display:flex><span>./initdb -D $PGHOME/../data1/db_2/data --nodename db_2
</span></span><span style=display:flex><span>./initdb -D $PGHOME/../data1/db_3/data --nodename db_3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sed -i <span style=color:#e6db74>&#34;s/#port = 5432/port = 24076/g&#34;</span> coor_1/data/postgresql.conf 
</span></span><span style=display:flex><span>sed -i <span style=color:#e6db74>&#34;s/#pooler_port = 6667/pooler_port = 6667/g&#34;</span> coor_1/data/postgresql.conf 
</span></span><span style=display:flex><span>sed -i <span style=color:#e6db74>&#34;s/#port = 5432/port = 24077/g&#34;</span> coor_2/data/postgresql.conf 
</span></span><span style=display:flex><span>sed -i <span style=color:#e6db74>&#34;s/#pooler_port = 6667/pooler_port = 6668/g&#34;</span> coor_2/data/postgresql.conf 
</span></span><span style=display:flex><span>sed -i <span style=color:#e6db74>&#34;s/#port = 5432/port = 24071/g&#34;</span> db_1/data/postgresql.conf 
</span></span><span style=display:flex><span>sed -i <span style=color:#e6db74>&#34;s/#port = 5432/port = 24072/g&#34;</span> db_2/data/postgresql.conf 
</span></span><span style=display:flex><span>sed -i <span style=color:#e6db74>&#34;s/#port = 5432/port = 24073/g&#34;</span> db_3/data/postgresql.conf 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ç¼–è¾‘data/co1/postgresql.confï¼š 
</span></span><span style=display:flex><span>  gtm_port <span style=color:#f92672>=</span> <span style=color:#ae81ff>6666</span>            //ä¸ºé»˜è®¤å€¼
</span></span><span style=display:flex><span>  pgxc_node_name <span style=color:#f92672>=</span> co1        //pgxc_node_nameä¸èƒ½é‡å¤
</span></span><span style=display:flex><span>ç¼–è¾‘data/co2/postgresql.confï¼š 
</span></span><span style=display:flex><span>  gtm_port <span style=color:#f92672>=</span> <span style=color:#ae81ff>6666</span>
</span></span><span style=display:flex><span>  pgxc_node_name <span style=color:#f92672>=</span> co2
</span></span><span style=display:flex><span>ç¼–è¾‘data/dn1/postgresql.confï¼š 
</span></span><span style=display:flex><span>  gtm_port <span style=color:#f92672>=</span> <span style=color:#ae81ff>6666</span>
</span></span><span style=display:flex><span>  pgxc_node_name <span style=color:#f92672>=</span> dn1          
</span></span><span style=display:flex><span>ç¼–è¾‘data/dn2/postgresql.confï¼š 
</span></span><span style=display:flex><span>  gtm_port <span style=color:#f92672>=</span> <span style=color:#ae81ff>6666</span>
</span></span><span style=display:flex><span>  pgxc_node_name <span style=color:#f92672>=</span> dn2
</span></span><span style=display:flex><span>ç¼–è¾‘data/dn2/postgresql.confï¼š 
</span></span><span style=display:flex><span>  gtm_port <span style=color:#f92672>=</span> <span style=color:#ae81ff>6666</span>
</span></span><span style=display:flex><span>  pgxc_node_name <span style=color:#f92672>=</span> dn3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mkdir gtm/data/log
</span></span><span style=display:flex><span>mkdir coor_1/data/log
</span></span><span style=display:flex><span>mkdir coor_2/data/log
</span></span><span style=display:flex><span>mkdir db_1/data/log
</span></span><span style=display:flex><span>mkdir db_2/data/log
</span></span><span style=display:flex><span>mkdir db_3/data/log
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#./bin/gtm_ctl start -S gtm -D data/gtm -l data/gtm/gtm.log  //å¯åŠ¨gtmï¼ˆç”±äºåˆ‡æ¢ä¸ºç›¸å¯¹è·¯å¾„åæ‰¾ä¸åˆ°å¯¹åº”çš„æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥åˆ›å»ºæ—¥å¿—ä¼šå¤±è´¥ï¼‰</span>
</span></span><span style=display:flex><span>./gtm_ctl start -Z gtm -D $PGHOME/../data1/gtm/data -l /home/wen/postgres-home/build/postgres-xc/data1/gtm/data/log/gtm.log 
</span></span><span style=display:flex><span>./pg_ctl start -Z datanode -D $PGHOME/../data1/db_1/data -l /home/wen/postgres-home/build/postgres-xc/data1/db_1/data/log/postgresql.log  -o <span style=color:#e6db74>&#34;-p 24071&#34;</span>
</span></span><span style=display:flex><span>./pg_ctl start -Z datanode -D $PGHOME/../data1/db_2/data -l /home/wen/postgres-home/build/postgres-xc/data1/db_2/data/log/postgresql.log  -o <span style=color:#e6db74>&#34;-p 24072&#34;</span>
</span></span><span style=display:flex><span>./pg_ctl start -Z datanode -D $PGHOME/../data1/db_3/data -l /home/wen/postgres-home/build/postgres-xc/data1/db_3/data/log/postgresql.log  -o <span style=color:#e6db74>&#34;-p 24073&#34;</span>
</span></span><span style=display:flex><span>./pg_ctl start -Z coordinator -D $PGHOME/../data1/coor_2/data -l /home/wen/postgres-home/build/postgres-xc/data1/coor_2/data/log/postgresql.log  -o <span style=color:#e6db74>&#34;-p 24077&#34;</span>
</span></span><span style=display:flex><span>./pg_ctl start -Z coordinator -D $PGHOME/../data1/coor_1/data -l /home/wen/postgres-home/build/postgres-xc/data1/coor_1/data/log/postgresql.log  -o <span style=color:#e6db74>&#34;-p 24076&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./psql -p <span style=color:#ae81ff>24076</span> 
</span></span><span style=display:flex><span> CREATE NODE db_1 WITH <span style=color:#f92672>(</span>HOST <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;localhost&#39;</span>, type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;datanode&#39;</span>, PORT <span style=color:#f92672>=</span> 24071<span style=color:#f92672>)</span>; 
</span></span><span style=display:flex><span> CREATE NODE db_2 WITH <span style=color:#f92672>(</span>HOST <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;localhost&#39;</span>, type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;datanode&#39;</span>, PORT <span style=color:#f92672>=</span> 24072<span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span> CREATE NODE db_3 WITH <span style=color:#f92672>(</span>HOST <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;localhost&#39;</span>, type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;datanode&#39;</span>, PORT <span style=color:#f92672>=</span> 24073<span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span> CREATE NODE coor_1 WITH <span style=color:#f92672>(</span>HOST <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;localhost&#39;</span>, type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;coordinator&#39;</span>, PORT <span style=color:#f92672>=</span> 24076<span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span> CREATE NODE coor_2 WITH <span style=color:#f92672>(</span>HOST <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;localhost&#39;</span>, type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;coordinator&#39;</span>, PORT <span style=color:#f92672>=</span> 24077<span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span> SELECT pgxc_pool_reload<span style=color:#f92672>()</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>select</span> * from pgxc_node;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./pg_ctl stop -D $PGHOME/../data1/coor_1/data -m immediate
</span></span><span style=display:flex><span>./pg_ctl stop -D $PGHOME/../data1/coor_2/data -m immediate
</span></span><span style=display:flex><span>./pg_ctl stop -D $PGHOME/../data1/db_1/data -m immediate
</span></span><span style=display:flex><span>./pg_ctl stop -D $PGHOME/../data1/db_2/data -m immediate
</span></span><span style=display:flex><span>./pg_ctl stop -D $PGHOME/../data1/db_3/data -m immediate
</span></span><span style=display:flex><span>./gtm_ctl stop -Z gtm -D  $PGHOME/../data1/gtm/data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ rm -f data/gtm/register.node  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ ./bin/gtm_ctl start -Z gtm -D data/gtm -p ./bin -l data/gtm/gtm.log 
</span></span><span style=display:flex><span>$ ./bin/pg_ctl start -l data/dn1/postgresql.log -Z datanode -D data/dn1 -o <span style=color:#e6db74>&#34;-p 24071&#34;</span>
</span></span><span style=display:flex><span>$ ./bin/pg_ctl start -l data/dn2/postgresql.log -Z datanode -D data/dn2 -o <span style=color:#e6db74>&#34;-p 24072&#34;</span>
</span></span><span style=display:flex><span>$ ./bin/pg_ctl start -l data/dn3/postgresql.log -Z datanode -D data/dn3 -o <span style=color:#e6db74>&#34;-p 24073&#34;</span>
</span></span><span style=display:flex><span>$ ./bin/pg_ctl start -l data/co1/postgresql.log -Z coordinator -D data/co1 -o <span style=color:#e6db74>&#34;-p 24076&#34;</span>
</span></span><span style=display:flex><span>$ ./bin/pg_ctl start -l data/co2/postgresql.log -Z coordinator -D data/co2 -o <span style=color:#e6db74>&#34;-p 24077&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ ./bin/pg_ctl stop -D data/co1 -m immediate
</span></span><span style=display:flex><span>$ ./bin/pg_ctl stop -D data/co2 -m immediate
</span></span><span style=display:flex><span>$ ./bin/pg_ctl stop -D data/dn1 -m immediate
</span></span><span style=display:flex><span>$ ./bin/pg_ctl stop -D data/dn2 -m immediate
</span></span><span style=display:flex><span>$ ./bin/pg_ctl stop -D data/dn3 -m immediate
</span></span><span style=display:flex><span>$ ./bin/gtm_ctl stop -Z gtm -D data/gtm 
</span></span><span style=display:flex><span>$ rm -f data/gtm/register.node 
</span></span><span style=display:flex><span>$ rm -rf data
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>export XCHOME<span style=color:#f92672>=</span>/home/wen/postgres/build/postgres-xc/build
</span></span><span style=display:flex><span>export PATH<span style=color:#f92672>=</span>$XCHOME/bin:$PATH
</span></span><span style=display:flex><span>export LD_LIBRARY_PATH<span style=color:#f92672>=</span>$XCHOME/lib:$LD_LIBRARY_PATH
</span></span><span style=display:flex><span>export XCDATABASE<span style=color:#f92672>=</span>postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export XCDATA<span style=color:#f92672>=</span>/home/wen/postgres/build/postgres-xc/data
</span></span><span style=display:flex><span>alias cdd<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;cd </span>$XCDATA<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># alias pcn1=&#34;psql -d postgres -p 65022&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># alias pcn2=&#34;psql -d postgres -p 65023&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># alias pdn1=&#34;psql -d postgres -p 65013&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># alias pdn2=&#34;psql -d postgres -p 65014&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># alias pgtm=&#34;psql -d postgres -p 65011&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>alias mk<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;cd /home/wen/postgres/build/postgres-xc/make &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/home/wen/postgres/postgres-xc/configure --prefix=</span>$XCHOME<span style=color:#e6db74> \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>--with-segsize=4 \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>--with-wal-blocksize=64 \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>--enable-grammar-oracle \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>--with-perl \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>--with-python \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>--with-pam \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>--with-ldap \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>--with-libxml \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>--with-libxslt \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>--enable-thread-safety \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>--disable-cassert \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>--enable-depend CFLAGS=&#39;-g&#39; &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>make &amp;&amp; make install
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><h2 id=é‡æ–°åˆ†å¸ƒæ•°æ®ä»¥åŠèŠ‚ç‚¹æ“ä½œ>é‡æ–°åˆ†å¸ƒæ•°æ®ä»¥åŠèŠ‚ç‚¹æ“ä½œ
<a href=#%e9%87%8d%e6%96%b0%e5%88%86%e5%b8%83%e6%95%b0%e6%8d%ae%e4%bb%a5%e5%8f%8a%e8%8a%82%e7%82%b9%e6%93%8d%e4%bd%9c class=h-anchor aria-hidden=true>#</a></h2><p>PXC å¯ä»¥ä¿®æ”¹è¡¨çš„é‡åˆ†å¸ƒå±æ€§ï¼Œå³å°†è¡¨çš„æ•°æ®åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸­è¿›è¡Œé‡æ–°åˆ†å¸ƒã€‚æœ‰ä¸‹é¢å‡ ç§æ–¹æ³•</p><ol><li><p>é»˜è®¤çš„é‡åˆ†å¸ƒæ–¹æ³•ï¼Œé¦–å…ˆï¼Œé€šè¿‡ copy to å‘½ä»¤æŠŠæ‰€æœ‰çš„æ•°æ®ä¿å­˜åˆ° coordinatorä¸Šï¼Œç„¶åä½¿ç”¨truncateæŠŠå„ä¸ªæ•°æ®èŠ‚ç‚¹ä¸Šçš„æ•°æ®æ¸…ç©ºã€‚æœ€åä½¿ç”¨ copy from æœºåˆ¶æŠŠæ•°æ®é‡æ–°åˆ†å¸ƒåˆ°åº•å±‚çš„å„ä¸ªæ•°æ®èŠ‚ç‚¹ä¸Šã€‚æœ€åæ ¹æ®æƒ…å†µå¯èƒ½ä¼šæ‰§è¡Œ reindexã€‚</p></li><li><p>replicatedè¡¨åˆ°replicatedè¡¨ï¼š è¿™é€šå¸¸æ˜¯åœ¨ replicatedè¡¨ä¸­å¢åŠ æˆ–åˆ é™¤åº•å±‚æ•°æ®èŠ‚ç‚¹æ—¶ä½¿ç”¨ã€‚</p></li></ol><ul><li>åˆ é™¤ä¸€ä¸ªå‰¯æœ¬ï¼Œç›´æ¥åœ¨è¿™ä¸ªæ•°æ®èŠ‚ç‚¹ä¸Š æ‰§è¡Œ truncate å³å¯ã€‚</li><li>å¢åŠ ä¸€ä¸ªå‰¯æœ¬ï¼Œé€šè¿‡ copy to å‘½ä»¤æŠŠä»»æ„èŠ‚ç‚¹ä¸Šçš„æ•°æ®ä¿å­˜åˆ° coordinatorä¸Šï¼Œç„¶åä½¿ç”¨ copy from æœºåˆ¶æŠŠæ•°æ®å¤åˆ¶åˆ°æ–°å¢çš„èŠ‚ç‚¹ä¸Šå³å¯ã€‚æœ€åæ ¹æ®æƒ…å†µå¯èƒ½ä¼šæ‰§è¡Œ reindexã€‚</li></ul><ol start=3><li><p>æŠŠreplicatedè¡¨è½¬ä¸ºdistributeè¡¨ï¼š
å¦‚æœè½¬æ¢å distributeè¡¨çš„èŠ‚ç‚¹åˆ†å¸ƒåˆ—è¡¨ä¸åˆ†å¸ƒå‰ä¸åŒæˆ–æœ‰æ–°èŠ‚ç‚¹å¢åŠ ï¼Œåˆ™ä½¿ç”¨é»˜è®¤æ–¹æ³•ï¼Œå³ç¬¬ä¸€ç§ï¼›
å¦‚æœè½¬æ¢ådistributeè¡¨åˆ†å¸ƒçš„èŠ‚ç‚¹å’Œè½¬æ¢å‰ç›¸åŒæˆ–å‡å°‘äº†ï¼Œåˆ™ä¸éœ€è¦è·¨èŠ‚ç‚¹é‡æ–°åˆ†å¸ƒæ•°æ®ï¼Œåªéœ€è¦åˆ é™¤åº•å±‚èŠ‚ç‚¹è¡¨ä¸­é‚£äº›ä¸éœ€è¦ä¿ç•™çš„æ•°æ®å³å¯ã€‚æœ€åæ ¹æ®æƒ…å†µå¯èƒ½ä¼šæ‰§è¡Œ reindexã€‚</p></li><li><p>æŠŠdistributeè¡¨è½¬æ¢æˆ replicatedè¡¨ï¼š ä½¿ç”¨é»˜è®¤çš„é‡åˆ†å¸ƒæ–¹æ³•ï¼Œå³ç¬¬ä¸€ç§ã€‚</p></li></ol><p>Postgres-XC é€šè¿‡æ‰©å±• <code>ALTER TABLE</code> å‘½ä»¤æä¾›äº†è®©è¡¨æ•°æ®é‡æ–°åˆ†å¸ƒçš„åŠŸèƒ½ï¼Œä¸»è¦å¢åŠ äº†ä»¥ä¸‹å­å¥</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>DISTRIBUTE <span style=color:#66d9ef>BY</span> <span style=color:#960050;background-color:#1e0010>{</span> REPLICATION <span style=color:#f92672>|</span> ROUNDROBIN <span style=color:#f92672>|</span> <span style=color:#960050;background-color:#1e0010>{</span> HASH <span style=color:#f92672>|</span> MODULO  ( <span style=color:#66d9ef>column_name</span>) <span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>TO</span> <span style=color:#960050;background-color:#1e0010>{</span> <span style=color:#66d9ef>GROUP</span>  groupname <span style=color:#f92672>|</span> NODE  <span style=color:#960050;background-color:#1e0010>ï¼ˆ</span>nodename [ , ....]<span style=color:#960050;background-color:#1e0010>ï¼‰}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>ADD</span> NODE <span style=color:#960050;background-color:#1e0010>ï¼ˆ</span>nodename [, ... ]<span style=color:#960050;background-color:#1e0010>ï¼‰</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>DELETE</span> NODE (nodename [, ... ] <span style=color:#960050;background-color:#1e0010>ï¼‰</span>
</span></span></code></pre></div><h3 id=å¢åŠ coordinatorsèŠ‚ç‚¹>å¢åŠ CoordinatorsèŠ‚ç‚¹
<a href=#%e5%a2%9e%e5%8a%a0coordinators%e8%8a%82%e7%82%b9 class=h-anchor aria-hidden=true>#</a></h3><ol><li>åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ coordinatorèŠ‚ç‚¹</li><li>é…ç½®å¯¹åº”çš„ postgresql.conf æ–‡ä»¶</li><li>è¿æ¥åˆ°ä»»æ„å·²æœ‰çš„ coordinatorèŠ‚ç‚¹ï¼Œé”ä½é›†ç¾¤ï¼Œä¸ºå¤‡ä»½åšå‡†å¤‡ï¼Œæ‰§è¡Œé”ä½å‘½ä»¤ ä½†ä¸è¦é€€å‡º,å¦åˆ™å¤‡ä»½å‡ºæ¥çš„æ•°æ®ä¼šä¸ä¸€è‡´</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>  postgres<span style=color:#f92672>=#</span> <span style=color:#66d9ef>select</span> pgxc_lock_for_backup();
</span></span><span style=display:flex><span>  INFO:  please <span style=color:#66d9ef>do</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>close</span> this <span style=color:#66d9ef>session</span> <span style=color:#66d9ef>until</span> you <span style=color:#66d9ef>are</span> done adding the <span style=color:#66d9ef>new</span> node
</span></span></code></pre></div><p>åšå®Œè¿™ä¸ªæ“ä½œåï¼Œæ•´ä¸ªé›†ç¾¤ä¸è¦æ‰§è¡ŒDDLè¯­å¥ï¼Œè¿™æ ·æ•°æ®åº“çš„å…ƒæ•°æ®å°±ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå°±èƒ½ä¿è¯å¤‡ä»½çš„ä¸€è‡´æ€§äº†ã€‚</p><ol start=4><li>å†è¿æ¥å·²æœ‰çš„ä»»æ„ä¸€ä¸ª coordinatorèŠ‚ç‚¹ï¼Œæ‰§è¡Œå¤‡ä»½</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>  pg_dumpall <span style=color:#f92672>-</span>p <span style=color:#ae81ff>5432</span> <span style=color:#f92672>-</span>s <span style=color:#75715e>--include-nodes --dump-nodes --file=meta.sql
</span></span></span></code></pre></div><ol start=5><li>æŠŠæ–°çš„ coordinatorèŠ‚ç‚¹å¯åŠ¨åˆ° restoremode æ¨¡å¼ä¸‹<code>pg_ctl start -Z restoremode -D /opt/pgxc/coordinator/</code></li></ol><ul><li>å°†å¤‡ä»½æ–‡ä»¶æ‹·è´åˆ°æ–°èŠ‚ç‚¹
<code>psql -d postgres -p 5432 -f /tmp/meta.sql</code></li><li>ç„¶åå°†æ–°çš„ coordinatoråœæ­¢
<code>pg_ctl stop -D /opt/pgxc/coordinator</code></li></ul><ol start=6><li>å¯åŠ¨æ–°coordinator
<code>pg_ctl start -Z coordinator -D /opt/pgxc/coordinator</code></li><li>åœ¨æ¯å° coordinatorä¸Šæ‰§è¡Œ create node å‘½ä»¤å¢åŠ æ–°èŠ‚ç‚¹,æœ€åè°ƒç”¨å‡½æ•° <code>pgxc_pool_reload()</code> åˆ·æ–°ç¼“å­˜åœ¨è¿æ¥æ± ä¸­çš„èŠ‚ç‚¹ä¿¡æ¯</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#66d9ef>create</span> node cdtor5 <span style=color:#66d9ef>with</span> (<span style=color:#66d9ef>host</span><span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;vlnx107001.firstshare.cn&#39;</span>,<span style=color:#66d9ef>type</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;coordinator&#39;</span>,port<span style=color:#f92672>=</span><span style=color:#ae81ff>5432</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>select</span> pgxc_pool_reload();
</span></span></code></pre></div><ol start=8><li>é€€å‡ºç¬¬3 æ­¥çš„sessionï¼Œé‡Šæ”¾é›†ç¾¤é”ã€‚</li></ol><h3 id=ç§»é™¤coordinators-èŠ‚ç‚¹>ç§»é™¤Coordinators èŠ‚ç‚¹
<a href=#%e7%a7%bb%e9%99%a4coordinators-%e8%8a%82%e7%82%b9 class=h-anchor aria-hidden=true>#</a></h3><ol><li>å°†è¦ç§»é™¤çš„èŠ‚ç‚¹åœæ‰</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>  pg_ctl stop <span style=color:#f92672>-</span>Z coordinator <span style=color:#f92672>-</span>D <span style=color:#f92672>/</span>opt<span style=color:#f92672>/</span>pgxc<span style=color:#f92672>/</span>coordinators <span style=color:#f92672>-</span>m faster
</span></span></code></pre></div><ol start=2><li>è¿æ¥åˆ°ä»»æ„ coordinatorï¼Œ æ‰§è¡Œ drop nodeå‘½ä»¤</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>  <span style=color:#66d9ef>drop</span> node cdtor3;
</span></span></code></pre></div><ol start=3><li>åˆ·æ–°ç¼“å­˜</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>  <span style=color:#66d9ef>select</span>  pgxc_pool_reload();
</span></span></code></pre></div><h3 id=å¢åŠ -datanodeèŠ‚ç‚¹>å¢åŠ  DatanodeèŠ‚ç‚¹
<a href=#%e5%a2%9e%e5%8a%a0-datanode%e8%8a%82%e7%82%b9 class=h-anchor aria-hidden=true>#</a></h3><ol><li>åˆå§‹åŒ–æ–°çš„ datanode å¹¶ä¿®æ”¹å¯¹åº”çš„postgresql.confæ–‡ä»¶</li><li>è¿æ¥åˆ°ä»»æ„å·²æœ‰çš„ coordinatorèŠ‚ç‚¹ï¼Œé”ä½é›†ç¾¤ï¼Œä¸ºå¤‡ä»½åšå‡†å¤‡ï¼Œæ‰§è¡Œé”ä½å‘½ä»¤ ä½†ä¸è¦é€€å‡º,å¦åˆ™å¤‡ä»½å‡ºæ¥çš„æ•°æ®ä¼šä¸ä¸€è‡´</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>  postgres<span style=color:#f92672>=#</span> <span style=color:#66d9ef>select</span> pgxc_lock_for_backup();
</span></span><span style=display:flex><span>  INFO:  please <span style=color:#66d9ef>do</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>close</span> this <span style=color:#66d9ef>session</span> <span style=color:#66d9ef>until</span> you <span style=color:#66d9ef>are</span> done adding the <span style=color:#66d9ef>new</span> node
</span></span></code></pre></div><p>åšå®Œè¿™ä¸ªæ“ä½œåï¼Œæ•´ä¸ªé›†ç¾¤ä¸è¦æ‰§è¡ŒDDLè¯­å¥ï¼Œè¿™æ ·æ•°æ®åº“çš„å…ƒæ•°æ®å°±ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå°±èƒ½ä¿è¯å¤‡ä»½çš„ä¸€è‡´æ€§äº†ã€‚</p><ol start=3><li>è¿æ¥åˆ°ä»»æ„ datanodeèŠ‚ç‚¹ï¼Œæ‰§è¡Œå…ƒæ•°æ®çš„å¤‡ä»½</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>  pg_dumpall <span style=color:#f92672>-</span>p <span style=color:#ae81ff>5432</span> <span style=color:#f92672>-</span>s <span style=color:#75715e>--file=datanode_meta.sql
</span></span></span></code></pre></div><ol start=4><li>æŠŠæ–°çš„datanodeå¯åŠ¨åˆ° restoremodeï¼Œå’Œcoordinatorç±»ä¼¼</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    pg_ctl <span style=color:#66d9ef>start</span> <span style=color:#f92672>-</span>Z restoremode <span style=color:#f92672>-</span>D <span style=color:#f92672>/</span>var<span style=color:#f92672>/</span>lib<span style=color:#f92672>/</span>pgsql<span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>.<span style=color:#ae81ff>6</span><span style=color:#f92672>/</span>dnode <span style=color:#f92672>-</span>p <span style=color:#ae81ff>5439</span>
</span></span><span style=display:flex><span>    psql <span style=color:#f92672>-</span>d postgres <span style=color:#f92672>-</span>f datanode_meta.<span style=color:#66d9ef>sql</span> <span style=color:#f92672>-</span> p <span style=color:#ae81ff>5439</span>
</span></span><span style=display:flex><span>    pg_ctl stop <span style=color:#f92672>-</span>D <span style=color:#f92672>/</span>var<span style=color:#f92672>/</span>lib<span style=color:#f92672>/</span>pgsql<span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>.<span style=color:#ae81ff>6</span><span style=color:#f92672>/</span>dnode <span style=color:#f92672>-</span>p <span style=color:#ae81ff>5439</span> <span style=color:#f92672>-</span>m fast
</span></span></code></pre></div><ol start=5><li>å¯åŠ¨æ–°çš„datanodeèŠ‚ç‚¹åˆ°æ­£å¸¸çŠ¶æ€ä¸‹
<code>pg_ctl start -Z datanode -D /var/lib/pgsql/9.6/dnode</code></li><li>åœ¨æ¯å° coordinator æ‰§è¡Œ create node å¢åŠ æ–°èŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨ pgxc_pool_reload()</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#66d9ef>create</span> node dnode4 <span style=color:#66d9ef>with</span>(<span style=color:#66d9ef>host</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;hostname&#39;</span>,<span style=color:#66d9ef>type</span> <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;datanode&#39;</span>,port<span style=color:#f92672>=</span> <span style=color:#ae81ff>5439</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>select</span> pgxc_pool_reload();
</span></span></code></pre></div><ol start=7><li>é€€å‡ºç¬¬2æ­¥</li><li>å¯ä»¥æ‰§è¡Œ alter table å‘½ä»¤ï¼ŒæŠŠæ—§è¡¨çš„æ•°æ®é‡æ–°åˆ†å¸ƒåˆ°æ–°èŠ‚ç‚¹ä¸Šã€‚å¦‚æœä¸æ‰§è¡Œè¿™æ­¥ï¼Œåˆ™æ—§è¡¨çš„æ•°æ®åªå­˜åœ¨äºåŸå…ˆçš„èŠ‚ç‚¹ä¸­ã€‚</li></ol><p>ç§»é™¤ DatanodeèŠ‚ç‚¹</p><ol><li>è¦ç§»é™¤ä¸€ä¸ªdatanodeï¼Œé¦–å…ˆè¦æŠŠè¿™ä¸ªdatanodeä¸Šçš„æ•°æ®é‡æ–°åˆ†å¸ƒåˆ°å…¶ä»–èŠ‚ç‚¹ä¸Š</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>table</span> tbl_name1 <span style=color:#66d9ef>delete</span> node (dnode4);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>table</span> tbl_name2 <span style=color:#66d9ef>delete</span> node (dnode4);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>table</span> tbl_name3 <span style=color:#66d9ef>delete</span> node (dnode4);
</span></span><span style=display:flex><span>    .....
</span></span></code></pre></div><p>æ£€æŸ¥æ˜¯å¦æœ‰è¡¨æŠŠæ•°æ®æ”¾åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> pgxc_class <span style=color:#66d9ef>c</span>,pgxc_node n <span style=color:#66d9ef>where</span> n.node_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;dnode4&#39;</span> <span style=color:#66d9ef>and</span> n.oid<span style=color:#f92672>=</span><span style=color:#66d9ef>any</span>(<span style=color:#66d9ef>c</span>.nodeoids);
</span></span></code></pre></div><ol start=2><li>åœæ‰è¯¥èŠ‚ç‚¹</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>pg_ctl stop <span style=color:#f92672>-</span>Z datanode <span style=color:#f92672>-</span>D <span style=color:#f92672>/</span>var<span style=color:#f92672>/</span>lib<span style=color:#f92672>/</span>pgsql<span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>.<span style=color:#ae81ff>6</span><span style=color:#f92672>/</span>dnode <span style=color:#f92672>-</span>m fast;
</span></span></code></pre></div><ol start=3><li>è¿æ¥åˆ°æ‰€æœ‰ coordinatorèŠ‚ç‚¹ åˆ é™¤ç»™èŠ‚ç‚¹</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>drop</span> node  dnode4;
</span></span></code></pre></div><ol start=4><li>åˆ·æ–°ç¼“å­˜</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span> pgxc_pool_reload();
</span></span></code></pre></div></div></div></div><footer class=footer><div class=footer__inner><a href=https://askyx.github.io/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>Asky</span>
<span class=logo__cursor></span></a><div class=copyright><span>Â© 2025 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=https://askyx.github.io/assets/main.js></script><script src=https://askyx.github.io/assets/prism.js></script></div></body></html>